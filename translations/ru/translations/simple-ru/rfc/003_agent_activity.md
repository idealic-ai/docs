# 003: Агент/Действие

> **Действие (Activity):** Это как подробный рецепт для `Инструмента` (Tool). Это конкретный, чётко работающий программный код. Он нужен для выполнения задач, которые требуют обращения к внешнему миру, например, к сайту погоды или базе данных — то есть для всего, что искусственный интеллект не может просто «придумать» сам. — [Глоссарий](./000_glossary.md)

> Sidenote: Требуется: [002: Агент/Инструмент](./002_agent_tool.md)

Этот документ описывает **Протокол Действий**, который определяет, как `Инструменты` (описания возможностей) подкрепляются настоящим, работающим кодом. Если `Инструмент` — это то, *что* можно сделать, то `Действие` — это то, *как* это делается.

## Две разные «записные книжки»

Система агентов использует две отдельные «записные книжки», чтобы отделить описание возможности от её реального исполнения:

- **Книжка Инструментов (Tool Registry):** Здесь хранятся только описания `Инструментов`. Это как меню в ресторане, где перечислены блюда, но не сказано, как их готовить.
- **Книжка Действий (Activity Registry):** Здесь хранятся настоящие рецепты — программный код (`Действия`), который выполняет работу для каждого `Инструмента`.

Такое разделение — ключ к гибкости всей системы. Оно позволяет `Инструментам` работать в режиме «воображения» (когда ИИ сам придумывает результат), а также позволяет легко менять «рецепт» (`Действие`), не меняя при этом «меню» (`Инструмент`). Например, можно сделать разные рецепты для разработки и для настоящей работы.

## Регистрация Действия

`Действие` записывается в свою «книжку» под уникальным именем. Это имя связывает его с `Инструментом`.

```typescript
// Записываем рецепт (Действие).
// Имя 'weatherCheck' должно совпадать с Инструментом, для которого он предназначен.
Activity.register('weatherCheck', async call => {
  const data = await weatherAPI.get(call.location);
  return { temperature: data.temp, conditions: data.desc };
});
```

## Два способа выполнения: Скрытый и Явный

Когда агент использует `Инструмент`, система может работать в одном из двух режимов:

- **Скрытое выполнение:** ИИ использует своё «воображение» и логику. Агент «продумывает» задачу и сразу выдаёт результат, не запуская никакой отдельный код. Это режим по умолчанию, если для `Инструмента` не найден готовый «рецепт» (`Действие`).
  > Sidenote: [104: Концепция/Скрытое](./104_concept_latent.md)
- **Явное выполнение:** Задача передаётся реальному коду. Запускается функция `Действия`, которая и вычисляет результат. Это необходимо для связи с внешним миром (сайтами, базами данных) или для задач, где нужна 100% точность и предсказуемость.

## Как система выбирает способ выполнения

Системе не нужно ничего настраивать, она сама решает, какой режим использовать. Она смотрит на специальное поле `_activity` в описании `Инструмента` и действует по простым правилам:

1.  **Прямое указание в `_activity`**: Если в `Инструменте` прописано это поле, система ищет `Действие` с таким именем.
2.  **Правило одинаковых имён (Рекомендуется)**: Если поля `_activity` нет, система ищет `Действие` с **таким же именем**, как у `Инструмента`. Если находит — использует его.
3.  **Запасной вариант (Скрытый режим)**: Если по первым двум правилам ничего не нашлось, система считает, что готового «рецепта» нет, и просит ИИ «придумать» результат самому (включает скрытое выполнение).

Такой подход всё упрощает:

- **Чтобы твой код заработал, просто назови `Действие` так же, как и `Инструмент`.**
- `Инструменты`, для которых нет кода, будут безопасно работать в режиме «воображения» ИИ.
- Если нужно, можно в `Инструменте` указать особое имя `Действия`, и оно будет главным.

## Почему так важно разделять Действия

Представь, что меню и рецепты в ресторане были бы одним целым. Тогда, чтобы поменять один ингредиент в салате, пришлось бы перепечатывать всё меню и раздавать его заново всем посетителям. Неудобно.

Разделение «меню» и «рецептов» даёт суперспособности:

- **Изменения не ломают агентов**: Можно полностью поменять «рецепт» (код), а агент, использующий `Инструмент`, этого даже не заметит. Он будет работать, как и раньше, но лучше.
- **Можно тестировать разные подходы**: Для одной задачи можно попробовать два способа: дать ИИ самому «придумать» ответ или запустить код, который свяжется с реальным сайтом. И посмотреть, что работает лучше.
- **Постепенные обновления**: Можно внедрять новые «рецепты» (`Действия`) только для части агентов, а остальные пусть пока пользуются старыми или «фантазией» ИИ.

## От описания к действию

Разделив «что делать» (`Инструмент`) и «как делать» (`Действие`), мы получили очень гибкую систему. Но это только часть истории. Теперь, когда у нас есть и описания, и код, остаётся последний шаг: управление. Как все эти вызовы запускаются, выполняются и выстраиваются в правильном порядке.

Следующий документ, [004: Агент/Вызов](./004_agent_call.md), расскажет о протоколе, который превращает эти абстрактные идеи в конкретные, пошаговые действия.