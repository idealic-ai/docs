# 009: Агент/Модуль

> **Модуль**: Это как отдельная, многоразовая деталька лего (называемая `Действие` или `Идея`), которую можно использовать, вызвав её с помощью `Вызова` в специальном «пространстве Модуля». На это указывает свойство `_module`.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требуется:
>   - [004: Агент/Вызов](./004_agent_call.md)
> - Дополняется:
>   - [008: Агент/Импорты](./008_agent_imports.md)

Этот документ объясняет **Правила для Модулей**. Эти правила позволяют запускать `Инструменты` в отдельной, изолированной среде. Это похоже на то, как если бы вы попросили помощи у другой `Идеи` или выполнили `Действие` в совершенно новой, чистой комнате. Это главный способ собирать сложные действия агента из маленьких, самостоятельных и многоразовых «кирпичиков».

## Проблема: Гигантские инструменты и информационный беспорядок

Когда агенты становятся умнее и умеют больше, хранить все их `Инструменты` в одной большой коробке становится неудобно.

1.  **Слишком сложные инструкции**: У искусственного интеллекта (ИИ) есть предел тому, насколько сложные правила он может понять за один раз. Если смешать вместе много сложных `Инструментов`, ИИ может запутаться и не сможет правильно выбрать, что ему делать.
2.  **Информационный беспорядок**: Когда все `Инструменты` находятся в одном месте, ИИ может отвлекаться на ненужную информацию. Это как пытаться делать домашку по математике, когда на столе лежат комиксы и игрушки — легко ошибиться.
3.  **Одноразовость**: `Инструмент`, созданный для одного агента, сложно просто так взять и отдать другому. Придётся тащить с собой всё его окружение, все «игрушки», с которыми он лежал в коробке.

Правила для Модулей решают эти проблемы, вводя **Пространство Модуля** — способ передать задачу (`Вызов`) кому-то другому, кто выполнит её в своей собственной, изолированной среде.

## Свойство `_module`

Пространство Модуля включается с помощью специальной метки `_module` в правилах `Инструмента`. Эта метка говорит системе: «Не выполняй эту команду прямо здесь. Отправь её как запрос внешнему модулю».

Свойство `_module` — это текстовая строка.

- **`_module: 'idea://<имя-идеи>'`**: Эта строка, похожая на веб-адрес, указывает на конкретную `Идею`. Это говорит исполнителю запустить `Вызов` в окружении указанной `Идеи`.
- **`_module: 'anonymous'`**: Эта надпись означает «анонимный модуль». Она используется, когда для `Действия` нужно создать временную изолированную среду, но без создания целой новой `Идеи`.

## Работа в «чистой комнате»

Модуль предоставляет «чистую комнату» для работы. Вместо того чтобы выполнять задачу в шумной и забитой вещами мастерской главного агента, `Вызов` отправляется в новую, изолированную «комнату» (под-запрос). В этой комнате нет ничего лишнего — её окружение создаётся с нуля, а не наследуется.

И вот здесь становятся очень важными **[Правила для Импортов](./008_agent_imports.md)**. Свойство `_imports` в правилах `Инструмента` работает как мост. Оно чётко указывает, какие именно вещи из мастерской родительского агента нужно «импортировать» в чистую комнату модуля. Это даёт главному агенту полный контроль над тем, что увидит модуль, предотвращая информационный беспорядок и создавая по-настоящему независимые компоненты.

## Сборка и Повторное Использование: Композитор и Звукорежиссёр

Модули позволяют собирать очень мощные системы, где одни `Идеи` работают как самостоятельные сервисы, которыми могут управлять другие агенты.

Представь себе агента-`Композитора` и агента-`Звукорежиссёра`.

- **`Звукорежиссёр`** — это самостоятельная `Идея` (`idea://sound-designer`). В его «голове» есть подробные инструкции о том, как работать с синтезатором. У него есть свои правила (`input`), как создавать звуки. Он — независимый эксперт, которого можно использовать много раз.
- **`Композитор`** — его работа написать песню. Один из его `Инструментов` называется `создатьМелодию`. Этот `Инструмент` не содержит логики для создания звука. Вместо этого он поручает задачу эксперту, указывая `_module: 'idea://sound-designer'`.

Когда `Композитор` решает использовать инструмент `создатьМелодию`, он создаёт `Вызов`. При выполнении этого `Вызова` произойдёт следующее:

1.  Будет создан новый, изолированный под-запрос (та самая «чистая комната»).
2.  Загрузится `Идея` `Звукорежиссёра` с его инструкциями по работе с синтезатором.
3.  С помощью `_imports` в «комнату» `Звукорежиссёра` будет передано «описание песни» от `Композитора`.
4.  Теперь ИИ `Звукорежиссёра` видит свои экспертные инструкции и конкретное творческое задание от `Композитора`.
5.  Он создаёт мелодию, которая возвращается как результат работы инструмента `создатьМелодию`.

`Композитору` не нужно знать, как работает синтезатор, а `Звукорежиссёру` не нужно знать о существовании `Композитора`. Они — независимые модули, которые объединяются во время работы для достижения сложной цели.

## Работа с большими инструкциями

Правила для Модулей также решают проблему `Инструментов`, у которых очень большой или сложный результат работы. Вместо того чтобы включать гигантское описание результата (`_output`) в главный запрос (что может помешать другим инструментам), `Инструмент` можно описать только с помощью того, что ему нужно на вход (`input`), и метки `_module`.

ИИ может спланировать `Вызов`, зная только входные данные. А сложный результат будет создан внутри изолированной «комнаты» модуля. Это позволяет агенту планировать последовательность сложных действий, не пытаясь «увидеть» все мельчайшие детали каждого шага в одном окне. ИИ просто доверяет, что модуль сделает всё правильно и вернёт нужный результат, который он сможет использовать на следующих шагах.