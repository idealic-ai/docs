# 002: Агент/Инструмент

> **Инструмент**: Это как чертёж или инструкция для способности, которую может использовать программа-агент. Эту инструкцию показывают умному алгоритму (LLM) как часть его задания. Она объясняет, что можно сделать. Алгоритм «включает» инструмент, создавая `Вызов` (Call) с конкретными деталями. Этот вызов потом выполняется либо «в уме» самого алгоритма, либо специальной компьютерной программой (`Действием`). — [Глоссарий](./000_glossary.md)

>Sidenote:
> - Требуется: [001: Агент/Запрос](./001_agent_request.md)
> - Дополняется: [003: Агент/Действие](./003_agent_activity.md)

Этот документ описывает Инструмент — это как основа, которая позволяет агентам понимать и использовать разные возможности.

## Что такое Инструменты?

**Инструменты — это как набор способностей для супергероя**. Они дают агенту новую крутую возможность: **выбирать, что делать, в зависимости от ситуации**. Это позволяет агентам подбирать правильное поведение для каждой конкретной задачи.

Представь, что агент — это повар на кухне. Инструменты — это его рецепты.

Каждый рецепт (Инструмент) даёт:

- **Чёткие инструкции**: Описание способности, чтобы агент понял, что она делает.
- **Список ингредиентов**: Точное указание, что нужно для работы (входные данные) и что получится в итоге (выходные данные).
- **Возможность комбинировать**: Рецепты можно сочетать, чтобы приготовить сложное блюдо. Так и агент может комбинировать инструменты для выполнения больших задач.
- **Понятно для ИИ**: Рецепты написаны так, что умный алгоритм может их прочитать, понять и выбрать нужный.

Когда агент берёт рецепт (Инструмент) и добавляет в него конкретные ингредиенты (заполняет параметры), он создаёт **Вызов** (Call) — это как заявка на приготовление конкретного блюда. Подробнее о том, как выполняется эта заявка, читай в документе [004: Агент/Вызов](./004_agent_call.md).

> **Примечание**: Любой простой запрос к ИИ можно представить как Идею. Но Инструменты нужны для более сложных ситуаций, когда агенту нужно самому выбирать, что делать. О том, как Идеи могут превращаться в Инструменты, можно прочитать в [007: Агент/Ввод](./007_agent_input.md).

## Когда использовать систему Инструментов

Используй Инструменты, когда хочешь, чтобы твой агент мог:

- **Сам выбирать действия** в зависимости от того, что происходит вокруг.
- **Выбирать из нескольких разных способностей**, чтобы достичь цели (например, искать в Google или в Википедии).
- **Использовать разные способы** для выполнения одного и того же дела (например, разные поисковики).
- **Сочетать размышления ИИ с чёткими правилами** при принятии решений.

## Как устроена система Инструментов

### Главный принцип: Инструкция — это только описание

Система Инструментов построена на одной важной идее: **Инструменты — это просто описание, схема**. Они говорят, *что* можно сделать, но не говорят, *как* именно. Выполнением занимается либо сам умный алгоритм (как бы «в уме»), либо отдельная программа под названием **[003: Агент/Действие](./003_agent_activity.md)**.

Инструкция (схема) Инструмента описывает:

- **Что инструмент делает** (description)
- **Что ему для этого нужно** (входные параметры)
  >Sidenote: о расширениях
  >
  > - `_instance`: Смотри [011: Агент/Инстансинг](./011_agent_instancing.md)
  > - `_module`: Смотри [009: Агент/Модуль](./009_agent_module.md)
- **Что получится в результате** (структура `_output`)
- **Как он называется** (имя `_tool`)
- **Кто его выполняет** (поле `_activity`, подробнее в [003: Агент/Действие](./003_agent_activity.md))

### Системные поля в схеме Инструмента

В схемах Инструментов есть специальные поля, которые начинаются с подчёркивания (`_`). Они нужны для системы:

- **_tool**: Уникальное имя инструмента (обязательно).
- **_activity**: Указывает, какое `Действие` (программа) должно выполнить этот инструмент, если оно нужно. Как система его находит, описано в [003: Агент/Действие](./003_agent_activity.md).
- **_output**: Описание того, что мы ожидаем получить в результате.
- **_reasoningForCall**: Объяснение от агента, почему он решил использовать именно этот инструмент (добавляется системой).

Любое поле без подчёркивания — это обычный параметр, который нужен инструменту для работы. Системные поля всегда идут первыми, чтобы умному алгоритму было проще их понимать.

### Границы системы

Система Инструментов отвечает за:

- Регистрацию Инструментов (хранение их описаний).
- Заполнение параметров (когда ИИ извлекает нужные данные из текста).
- Направление на выполнение (решает, будет ли ИИ делать это «в уме» или передаст специальной программе `Действию`).

Более сложные вещи, такие как управление задачами и состоянием, строятся уже поверх этой системы (например, протокол [004: Агент/Вызов](./004_agent_call.md)).

## Определение Инструмента

Инструменты описываются в формате JSON-схемы. В примере ниже показан `Инструмент` для определения настроения текста (позитивное, негативное). Этот `Инструмент` создан для «скрытого выполнения», то есть он полагается на собственные знания и умения умного алгоритма и не требует отдельной программы.

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует настроение текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

## Объединение схем и Вызов

Хотя каждый Инструмент описывает отдельную способность, их настоящая сила проявляется, когда они используются вместе. Система показывает умному алгоритму все доступные `Инструменты` сразу, как бы выкладывая перед ним целый ящик с инструментами. Это позволяет алгоритму выбрать самый подходящий для конкретной ситуации. Когда ИИ выбирает `Инструмент` и предоставляет для него все нужные данные, он создаёт **Вызов** (Call) — это готовая к исполнению команда. Именно этот `Вызов` передаётся дальше на выполнение.

>Sidenote: Смотри также
> - [004: Агент/Вызов](./004_agent_call.md)

## Скрытое и Явное выполнение

Сам по себе `Инструмент` — это лишь инструкция. А выполнение `Вызова` может происходить двумя способами. По умолчанию используется **скрытое выполнение**: умный алгоритм сам, используя свои внутренние знания, придумывает результат. Это отлично подходит для задач, связанных с языком или знаниями.

Но для действий, которые требуют взаимодействия с внешним миром, — например, отправить запрос в интернет или заглянуть в базу данных, — `Инструмент` нужно связать с настоящей программой. Такое явное, чётко прописанное выполнение называется **Действием** (Activity).

Разделение инструкции (`Инструмент`) и её исполнителя (`Действие`) — это ключевая идея. Она позволяет агенту сначала в общих чертах рассуждать о своих возможностях, а уже потом решать, как именно их применить. При этом саму программу-исполнителя можно легко заменить или обновить, не меняя описание способности. Следующий документ, **[003: Агент/Действие](./003_agent_activity.md)**, расскажет, как `Действия` выполняют работу для `Инструментов`.