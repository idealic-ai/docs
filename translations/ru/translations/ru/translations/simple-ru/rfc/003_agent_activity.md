# Акт 003: Агент/Действие

> **Действие (Activity):** Это настоящий, работающий код, который выполняет то, что обещает «Инструмент». Представьте, что это как рецепт для повара. Действия нужны, когда требуется что-то сделать во внешнем мире — например, узнать погоду в интернете, посмотреть что-то в базе данных или выполнить любую задачу, которую искусственный интеллект не может просто «придумать». — [Глоссарий](./000_glossary.md)

> Sidenote: Требуется: [002: Агент/Инструмент](./002_agent_tool.md)

Этот документ описывает **Протокол Действий**. Он объясняет, как «Инструменты» (о которых шла речь ранее) связаны с реальным, работающим кодом. Если «Инструмент» — это описание того, *что* можно сделать, то «Действие» — это инструкция, *как* это сделать.

## Архитектура с двумя списками

Система агентов использует два разных списка (или реестра), чтобы отделить описание возможности от её реального воплощения:

- **Реестр Инструментов**: Хранит описание того, как выглядят и что обещают «Инструменты».
- **Реестр Действий**: Хранит настоящий код («Действия»), который выполняет работу «Инструментов».

Представьте себе меню в ресторане и кухню. Меню («Реестр Инструментов») просто говорит, что есть блюдо «чизбургер». А на кухне («Реестр Действий») есть настоящий рецепт и повар, который знает, как его приготовить. Такое разделение — ключ к гибкости системы. Оно позволяет «Инструментам» работать в скрытом режиме (когда ИИ сам придумывает результат), а также позволяет легко менять «рецепт» на кухне, не меняя название блюда в меню.

## Регистрация Действия

«Действие» регистрируется под уникальным именем, которое связывает его с «Инструментом».

```typescript
// Регистрируем реализацию Действия.
// Имя 'weatherCheck' должно совпадать с Инструментом, который оно реализует.
Activity.register('weatherCheck', async call => {
  const data = await weatherAPI.get(call.location);
  return { temperature: data.temp, conditions: data.desc };
});
```

## Режимы выполнения: Скрытый и Явный

Система может выполнять запрос к «Инструменту» двумя совершенно разными способами:

- **Скрытое исполнение**: Здесь используется способность ИИ рассуждать. Агент как бы «продумывает» задачу и сам генерирует ответ. Это как спросить очень умного друга, какая погода в Париже, и он, основываясь на своих знаниях, тебе ответит, даже не заглядывая в интернет. Этот режим включается по умолчанию, если для «Инструмента» не найдено соответствующего «Действия».

> Sidenote: [104: Концепция/Скрытое](./104_concept_latent.md)

- **Явное исполнение**: Здесь запрос передаётся настоящему коду. Вызывается функция «Действие», которая и вычисляет результат. Это как если бы твой друг достал телефон, открыл приложение погоды и сказал тебе точный прогноз. Этот режим необходим для взаимодействия с реальным миром (сайтами, базами данных) или для задач, где нужна стопроцентная точность.

## Как система выбирает режим

Система сама решает, какой режим использовать, без всяких сложных настроек. Поле `_activity` в схеме «Инструмента» — это сигнал о том, что для него есть реальный код. Вот как система принимает решение:

1.  **Прямое указание `_activity`**: Если в описании «Инструмента» явно прописано название в поле `_activity`, система ищет «Действие» с этим именем в своём списке.
2.  **Соглашение об именах (рекомендуемый способ)**: Если поле `_activity` пустое, система ищет «Действие», у которого **имя в точности совпадает** с именем «Инструмента». Если находит — отлично, они связаны.
3.  **Запасной вариант (Скрытый режим)**: Если по первым двум правилам ничего не нашлось, система решает, что реального кода для этого «Инструмента» нет, и просит ИИ «придумать» результат.

Такой подход упрощает разработку:

- **Для простой настройки просто назови своё «Действие» так же, как и «Инструмент».**
- «Инструменты», для которых ты ещё не написал код, будут безопасно работать в скрытом режиме.
- Если нужно, можно явно указать в `_activity` другое имя, чтобы один и тот же код («Действие») выполнял работу для нескольких разных «Инструментов».

## Почему так важно это разделение

Если бы мы не разделяли описание «Инструмента» и код «Действия», то они были бы намертво связаны. Чтобы поменять способ выполнения (например, вместо скрытого режима начать использовать реальный погодный сайт), нам пришлось бы найти и переписать каждого агента, который использует этот «Инструмент».

Архитектура с двумя списками решает эту проблему. Описание «Инструмента» (меню) остаётся стабильным, а его реализация (рецепт на кухне) может меняться. Агенты всегда видят одно и то же «меню» и не знают, как именно готовится блюдо. Это значит, что:

- **Изменения в коде не ломают агентов**: Можно переключиться со «скрытого» режима на «явный», не трогая код агента.
- **Можно тестировать разные подходы**: Сравнить, что работает лучше — когда ИИ придумывает ответ или когда используется реальный сервис.
- **Плавное обновление**: Можно запустить новый код «Действия» только для части агентов, пока остальные используют старый или скрытый вариант.

## От описания к действию

Разделяя «что» («Инструмент») и «как» («Действие»), система становится невероятно гибкой. Но это только часть истории. Теперь, когда у нас есть описания и их реализации, остаётся последний элемент — управление всем этим: как вызовы к «Инструментам» организуются, выполняются и выстраиваются в цепочку.

Следующий документ, [004: Агент/Вызов](./004_agent_call.md), расскажет о протоколе, который управляет этим процессом, превращая абстрактные описания в конкретные действия.