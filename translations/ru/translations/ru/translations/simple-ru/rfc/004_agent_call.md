# 004: Агент/Вызов

> **Вызов:** Это как взять «Инструмент» и дать ему конкретное задание с точными деталями для его `параметров`. Это команда, которая говорит, *что именно нужно сделать* прямо сейчас.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требуется:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
> - Открывает возможности для:
>   - [008: Агент/Импорты](./008_agent_imports.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - [202: Идея/Контейнер](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)

Документ [101: Концепция/Идея](./101_concept_idea.md) описывает «Идею» как мощную самодостаточную вещь для хранения знаний и скрытой логики. А [002: Агент/Инструмент](./002_agent_tool.md) объясняет, как агент может понять, что он умеет делать, с помощью специальных «чертежей»-инструкций. Этот документ описывает протокол **004: Агент/Вызов**, который основан на Инструментах и объясняет, как именно выполняется работа с помощью элементов управления «Область» (Scope) и «Метод» (Method).

**Вызов** — это, по сути, Инструмент, которому дали конкретные параметры и сказали: «Вперёд, работай!». Если Инструменты определяют, *что можно сделать*, то Вызовы определяют, *как именно это будет сделано*.

## Путь от Идеи к Вызову

Представь себе, что ты хочешь приготовить что-то.

1.  **Идея**: Общая мысль или знание. Например, «Сделать бутерброд».
2.  **Инструмент**: «Идея» превращается в конкретный «рецепт», который понимает компьютер. Этот рецепт говорит, какие «ингредиенты» (`параметры`) нужны. Например, для бутерброда нужны `хлеб`, `мясо` и `сыр`. (Подробнее о том, как это работает, написано в [002: Агент/Инструмент](./002_agent_tool.md)).
3.  **Вызов**: Это момент, когда искусственный интеллект (ИИ) решает использовать «Инструмент». Он берёт рецепт и заполняет его конкретными ингредиентами: `два куска белого хлеба`, `три ломтика ветчины`, `один кусочек чеддера`. **Вызов** — это одно конкретное использование Инструмента с заданными параметрами.

Главный принцип: **любую Идею можно превратить в Инструмент, который затем можно использовать через Вызов.**

Чтобы узнать больше о том, как «Идея» превращается в «Инструмент», загляни в **[007: Агент/Ввод](./007_agent_input.md)**.

## Управление исполнением: Область и Метод

Как именно будет выполнен `Вызов`, определяют два независимых свойства: **Область** (где он работает) и **Метод** (как он работает). Чтобы их задать, используются специальные свойства (`_module`, `_activity`, `_output`) в описании инструмента.

### Две оси исполнения

1.  **Область (Здесь или Где-то ещё)**
    Область определяет, будет ли задача выполнена прямо тут, внутри текущего агента, или её передадут кому-то вовне.
    - **Здесь (Inline Scope)**: Стандартный режим. `Вызов` обрабатывается немедленно, на месте.
    - **Где-то ещё (Module Scope)**: Включается с помощью `_module`. `Вызов` передаётся на выполнение другому модулю — внешней `Активности` или `Идее`.

2.  **Метод (По инструкции или Творчески)**
    Метод определяет, как будет получен результат: с помощью точного кода или с помощью ИИ.
    - **По инструкции (Explicit Method)**: Включается, если есть свойство `_activity`. Результат `Вызова` генерируется точным, заранее написанным кодом.
    - **Творчески (Latent Method)**: Стандартное поведение, если `_activity` нет. Результат `Вызова` придумывает ИИ. Для этого требуется свойство `_output`.

Эти элементы управления можно сочетать для создания разных способов выполнения задач. А управлять тем, какие знания им доступны, можно с помощью импортов. Подробнее об этом читай в **[008: Агент/Импорты](./008_agent_imports.md)**.

## Создание сложных процессов

`Вызов` — это как строительный блок, из которого можно создавать более сложные и упорядоченные действия. В протоколе COILS именно Вызов запускает такие продвинутые «Идеи», как **[202: Идея/Контейнер](./202_idea_vessel.md)** и **[203: Идея/Процесс](./203_idea_process.md)**. `Контейнер`, например, — это один момент принятия решения. Он содержит полный запрос к агенту, включая все нужные данные (`контекст`) и список доступных `Инструментов` (`схему`), а также ответ агента — `решение`, в котором может быть один или несколько `Вызовов`, готовых к исполнению.

> Sidenote:
>
> - [202: Идея/Контейнер](./202_idea_vessel.md)
> - [203: Идея/Процесс](./203_idea_process.md)

## Способы выполнения Вызовов

Когда агент создаёт несколько Вызовов, их можно выполнять по-разному, в зависимости от задачи. Представь, что у тебя есть список дел.

```typescript
// Выполнить одно дело
const result = await Tool(call);

// Сделать все дела и дождаться, пока каждое будет готово
const results = await Tool.all(calls);

// Пробовать делать всё по очереди, но остановиться, как только одно дело будет успешно выполнено
const result = await Tool.any(calls);

// Начать делать все дела одновременно и посмотреть, какое закончится первым (неважно, успешно или нет)
const result = await Tool.race(calls);
```

Такие способы позволяют:

- **Точно всё контролировать**: Обрабатывать Вызовы по одному, выполняя что-то между ними.
- **Делать всё пачкой**: Выполнять независимые Вызовы одновременно, чтобы было быстрее.
- **Находить быстрые решения**: Останавливаться после первого успеха (`.any()`) или первого-же результата (`.race()`).
- **Делать всё или ничего**: Гарантировать, что все Вызовы в группе будут выполнены успешно (`.all()`), чтобы не было ошибок, когда одно дело зависит от другого.