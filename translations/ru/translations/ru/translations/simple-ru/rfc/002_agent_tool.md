# 002: Агент/Инструмент

> **Инструмент**: Это как чертёж для способности, которую может использовать агент. Эту инструкцию показывают большой языковой модели (LLM) как часть её задачи. Она объясняет, что можно сделать. Модель «активирует» инструмент, создавая `Вызов` (Call) с нужными деталями. Этот `Вызов` затем выполняется либо «в уме» самой модели, либо специальной программой (`Действием`). — [Глоссарий](./000_glossary.md)

> Sidenote: Требуется: [001: Агент/Запрос](./001_agent_request.md). Дополняется: [003: Агент/Действие](./003_agent_activity.md).

Этот документ объясняет, что такое Инструмент — основа, которая позволяет агентам понимать и использовать разные возможности.

## Что такое Инструменты?

**Инструменты — это как набор способностей для супергероя**. Они дают агенту важную возможность: **выбирать, что делать, в зависимости от ситуации**. Это позволяет агентам подбирать правильное действие для каждой задачи.

Представьте, что агент — это повар на кухне. Инструменты — это его рецепты.

Каждый рецепт (Инструмент) даёт:

- **Чёткие инструкции**: Описание способности, чтобы агент понял, что она делает.
- **Список ингредиентов**: Что нужно для работы (входные данные) и что получится в итоге (выходные данные).
- **Возможность комбинировать**: Рецепты можно сочетать для приготовления сложных блюд. Так же и агент может комбинировать инструменты для решения больших задач.
- **Формат, понятный для модели**: Рецепты написаны так, что языковая модель может их прочитать, понять и выбрать нужный.

Когда агент берёт рецепт (Инструмент) и добавляет в него нужные ингредиенты (заполняет параметры), он создаёт **Вызов** (Call) — это как заявка на приготовление конкретного блюда. Подробнее о том, как выполняется эта заявка, читайте в документе [004: Агент/Вызов](./004_agent_call.md).

> **Примечание**: Любой простой запрос к модели можно представить как Идею. Но Инструменты нужны для более сложных ситуаций, когда агенту нужно самому выбирать, что делать. О том, как Идеи могут превращаться в Инструменты, можно узнать в [007: Агент/Ввод](./007_agent_input.md).

## Когда использовать систему Инструментов

Используйте Инструменты, когда хотите, чтобы ваш агент мог:

- **Самостоятельно выбирать действия** в зависимости от контекста.
- **Выбирать из нескольких способностей** для достижения цели (например, искать в Google или в Википедии).
- **Использовать разные реализации** для выполнения одного и того же действия (например, разные поисковые системы).
- **Сочетать рассуждения модели с чёткими правилами** при принятии решений.

## Как устроена система Инструментов

### Главный принцип: Инструкция — это только описание

Система Инструментов основана на одной важной идее: **Инструменты — это просто описание или схема**. Они говорят, *что* можно сделать, но не *как* именно. Выполнением занимается либо сама модель («в уме»), либо отдельная программа — **[003: Агент/Действие](./003_agent_activity.md)**.

Схема Инструмента описывает:

- **Что он делает** (description)
- **Что ему для этого нужно** (входные параметры)
> Sidenote: о расширениях:
- `_instance`: Смотри [011: Агент/Инстансинг](./011_agent_instancing.md)
- `_module`: Смотри [009: Агент/Модуль](./009_agent_module.md)
- **Что получится в результате** (структура `_output`)
- **Как он называется** (имя `_tool`)
- **Кто его выполняет** (поле `_activity`, подробнее в [003: Агент/Действие](./003_agent_activity.md))

### Системные поля в схеме Инструмента

В схемах Инструментов есть специальные системные поля, которые начинаются с подчёркивания (`_`). Они служат инструкциями для агента:

- **_tool**: Уникальное имя инструмента (обязательно).
- **_activity**: Указывает, какая программа (`Действие`) должна выполнить этот инструмент. Подробнее об этом в [003: Агент/Действие](./003_agent_activity.md).
- **_output**: Описание ожидаемого результата.
- **_reasoningForCall**: Объяснение от агента, почему он выбрал именно этот инструмент (добавляется системой автоматически).

Любое поле без подчёркивания — это обычный параметр, нужный инструменту для работы. Системные поля всегда указываются первыми, чтобы модели было проще их обрабатывать.

### Границы системы

Система Инструментов отвечает за:

- Регистрацию Инструментов (хранение их схем).
- Заполнение параметров (когда модель подставляет нужные данные из запроса).
- Направление на выполнение (решает, будет ли модель выполнять задачу «в уме» или передаст её программе — `Действию`).

Более сложные вещи, такие как управление задачами и состоянием, строятся уже поверх этой системы (например, протокол [004: Агент/Вызов](./004_agent_call.md)).

## Определение Инструмента

Инструменты описываются в формате JSON Schema. В примере ниже показан `Инструмент` для определения тональности текста (позитивной или негативной). Этот `Инструмент` создан для «скрытого выполнения», то есть он полагается на знания и умения самой модели и не требует внешней программы.

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует тональность текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

## Объединение схем и Вызов

Хотя каждый Инструмент описывает отдельную способность, их настоящая сила — в совместном использовании. Система предлагает модели все доступные `Инструменты` одновременно, как бы выкладывая перед ней ящик с инструментами. Это позволяет модели выбрать самый подходящий для конкретной задачи. Когда модель выбирает `Инструмент` и заполняет для него все нужные данные, она создаёт **Вызов** (Call) — готовую к исполнению команду. Именно этот `Вызов` передаётся дальше на выполнение.

> Sidenote: [004: Агент/Вызов](./004_agent_call.md).

## Скрытое и Явное выполнение

Сам по себе `Инструмент` — это лишь инструкция. Выполнение `Вызова` может происходить двумя способами. По умолчанию используется **скрытое выполнение**: модель сама генерирует результат, опираясь на свои внутренние знания. Это отлично подходит для задач, связанных с языком или анализом информации.

Но для действий, требующих взаимодействия с внешним миром — например, поиска в интернете или запроса к базе данных — `Инструмент` нужно связать с реальной программой. Такое явное выполнение называется **Действием** (Activity).

Разделение инструкции (`Инструмент`) и её исполнителя (`Действие`) — это ключевая идея. Она позволяет агенту сначала рассуждать о своих возможностях в целом, а потом решать, как их применить. При этом программу-исполнителя можно легко заменить или обновить, не меняя описание самой способности. Следующий документ, **[003: Агент/Действие](./003_agent_activity.md)**, подробно описывает, как `Действия` выполняют работу для `Инструментов`.