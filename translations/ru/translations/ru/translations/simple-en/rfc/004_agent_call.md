# 004: Агент/Вызов

> **Вызов:** Представьте, что **Инструмент** — это кнопка на пульте, например, «Переключить канал». **Вызов** — это когда вы нажимаете на эту кнопку и вводите конкретный номер канала, например, «5». Это реальная команда, чтобы *сделать что-то прямо сейчас*.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требует:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
> - Позволяет:
>   - [008: Агент/Импорты](./008_agent_imports.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - [202: Идея/Сосуд](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)

**[Идея](./101_concept_idea.md)** — это как чертёж, описывающий, как что-то сделать. **[Инструмент](./002_agent_tool.md)** превращает этот чертёж в рабочую кнопку, понятную для ИИ-агента. Этот документ объясняет **Вызов** — то, что происходит, когда агент нажимает на эту кнопку.

**Вызов** — это конкретная команда для Инструмента, со всеми заполненными деталями, готовая к исполнению. Если Инструмент описывает, *что вы можете сделать*, то Вызов — это о том, *как вы это делаете на самом деле*.

## Путь от Идеи к Вызову

Представьте, что вы печёте торт. Вот как это работает:

1.  **Идея**: Это ваш рецепт. В нём содержатся все инструкции и знания о том, как испечь торт.
2.  **Инструмент**: Рецепт используется для создания кнопки «Испечь торт» на умной духовке. Теперь духовка знает, какие ингредиенты ей нужны (например, мука, сахар, яйца) и что она может делать.
3.  **Вызов**: Это когда вы говорите духовке: «Испеки торт, используя шоколад *этой марки*, в течение *30 минут* при *350 градусах*». Вы заполнили все пробелы и дали конкретную, окончательную команду. Вызов — это и есть та самая единственная команда для Инструмента.

Главное правило простое: **любая Идея может стать Инструментом, а любой Инструмент можно использовать в Вызове.**

Чтобы узнать больше о том, как «список покупок» Идеи (входные данные) становится настройками для Инструмента, ознакомьтесь с документом **[007: Агент/Ввод](./007_agent_input.md)**.

## «Ручки управления»: Область и Метод

Когда вы делаете Вызов, вы можете менять способ его выполнения с помощью двух «ручек управления»: **Область** (где он выполняется) и **Метод** (как он выполняется). Система понимает, как вы повернули эти ручки, по специальным инструкциям в настройках Инструмента (`_module`, `_activity`, `_output`).

### Два главных элемента управления

1.  **Область (Где выполняется задача? Здесь или у специалиста?)**
    Область определяет, выполняет ли агент задачу сам или передаёт её кому-то другому.
    - **Здесь (Встроенная область)**: Это вариант по умолчанию. Агент выполняет задачу напрямую. Это как если бы шеф-повар нарезал овощи на своём рабочем месте.
    - **Специалист (Модульная область)**: Запускается инструкцией `_module`. Это как если бы шеф-повар отдал приказ пекарю в другой части кухни. Задача отправляется на выполнение эксперту.

2.  **Метод (Как выполняется задача? По рецепту или творчески?)**
    Метод определяет, следует ли задача точным инструкциям или требует творческого подхода.
    - **Рецепт (Явный метод)**: Запускается инструкцией `_activity`. Задача выполняется по чёткому набору шагов, как робот, следующий коду. Никаких догадок.
    - **Творчество (Скрытый метод)**: Это вариант по умолчанию, когда нет `_activity`. Агенту (ИИ-модели) предлагается самому найти лучший способ что-то сделать. Для этого требуется необязательная инструкция `_output`, которая похожа на просьбу к талантливому повару: «Мне не важно, как ты это сделаешь, просто приготовь вкусный суп».

Эти элементы управления можно комбинировать для создания самых разных способов выполнения работы. Чтобы узнать, как это делать, ознакомьтесь с документом **[008: Агент/Импорты](./008_agent_imports.md)**.

## Создание больших систем с помощью Вызовов

`Call` — это как один кубик Lego. Сам по себе он — простая команда. Но вы можете соединить много Вызовов вместе, чтобы построить гораздо более крупные и сложные вещи. Например, можно создать целый **[Сосуд](./202_idea_vessel.md)** или **[Процесс](./203_idea_process.md)**.

`Vessel` похож на полный набор Lego в коробке. Он содержит всё необходимое для одной большой задачи: инструкции (`context`), список всех доступных кубиков (`schema` из `Tools`) и конечный результат, который агент решает построить (`solution` — список из одного или нескольких `Calls` для запуска).

> Sidenote:
>
> - [202: Идея/Сосуд](./202_idea_vessel.md)
> - [203: Идея/Процесс](./203_idea_process.md)

## Разные способы запуска Вызовов

Когда агент решает сделать несколько Вызовов одновременно, вы можете выбрать, как их запустить.

```typescript
// Выполнить только один Вызов
const result = await Tool(call);

// Выполнить все. Не продолжать, пока каждый из них не завершится.
const results = await Tool.all(calls);

// Попробовать все. Вернуть результат первого, который сработает.
const result = await Tool.any(calls);

// Это гонка! Запустить все и вернуть результат самого первого, который завершится, неважно, успешно или с ошибкой.
const result = await Tool.race(calls);
```

Эти шаблоны позволяют вам:

- **Действовать пошагово**: Обрабатывать каждый Вызов по одному, добавляя между ними свою логику.
- **Работать пакетами**: Запускать группу независимых Вызовов одновременно для ускорения работы.
- **Найти быстрое решение**: Остановиться, как только найдётся один работающий Вызов (`.any()`) или как только завершится любой Вызов (`.race()`).
- **Достигать успеха вместе**: Убедиться, что вся группа Вызовов завершилась успешно, что помогает поддерживать согласованность, когда они зависят друг от друга (`.all()`).