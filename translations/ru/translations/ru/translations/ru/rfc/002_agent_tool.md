# 002: Агент/Инструмент

> **Инструмент**: Это схема, описывающая возможность, которую может использовать агент. Она передаётся LLM как часть запроса и служит понятным интерфейсом для возможного действия. LLM активирует инструмент, создавая `Call` (Вызов) с нужными параметрами, который затем исполняется либо самой LLM (скрытое исполнение), либо через специальную функцию (`Действие`). — [Глоссарий](./000_glossary.md)

> Sidenote: Требуется: [001: Агент/Запрос](./001_agent_request.md). Дополняется: [003: Агент/Действие](./003_agent_activity.md).

Этот документ описывает Инструмент — основной интерфейс на базе схем, который помогает агентам понимать и применять структурированные возможности.

## Что такое Инструменты?

**Инструменты — это ключевой элемент** систем агентских действий. Они открывают новый тип возможностей: **выбор действия в зависимости от контекста**. Это позволяет агентам выбирать и выполнять наиболее подходящие действия в текущей ситуации.

Инструменты предоставляют:

- **Структурированные интерфейсы**: Возможности, определённые схемами, которые агенты могут находить и понимать
- **Типобезопасность**: Понятные правила для входных и выходных данных
- **Компонуемость**: Строительные блоки, которые можно объединять для создания сложных сценариев поведения агентов
- **Интеграция с LLM**: Схемы, с помощью которых языковые модели могут анализировать и принимать решения

Когда агент указывает конкретные параметры для Инструмента, он создаёт **Вызов** (`Call`) — готовый к исполнению экземпляр Инструмента, представляющий собой запрос на действие (подробнее об исполнении Вызова см. в [004: Агент/Вызов](./004_agent_call.md)).

> **Примечание**: Любой запрос к LLM можно представить как Идею — это удобно для простого создания структурированного контента. Но Инструменты нужны для более сложных задач, где требуется динамически выбирать действия. О том, как превратить Идеи в Инструменты с помощью схем, читайте в [007: Агент/Ввод](./007_agent_input.md).

## Когда использовать систему Инструментов

Используйте систему Инструментов, когда вам нужно, чтобы агенты:

- **Динамически выбирали действия** в зависимости от контекста и ситуации
- **Выбирали из нескольких возможностей** для достижения цели
- **Выполняли различные реализации** одной и той же возможности (например, разные поисковые системы)
- **Сочетали рассуждения LLM с явной логикой** в процессе принятия решений

## Архитектура системы Инструментов

### Основной принцип: Схема как интерфейс

Система Инструментов построена на фундаментальном принципе: **Инструменты — это чистые схемы**, которые описывают интерфейсы, но не указывают, как их реализовать. Выполнять Инструмент может либо LLM с помощью своих внутренних рассуждений (скрытое исполнение), либо конкретный код — **[Действие](./003_agent_activity.md)**.

Схема Инструмента определяет:

- **Что** делает инструмент (его описание)
- **Что** ему нужно (входные параметры)
> Sidenote: О расширениях: `_instance` (см. [011: Агент/Инстансинг](./011_agent_instancing.md)) и `_module` (см. [009: Агент/Модуль](./009_agent_module.md)).
- **Что** он возвращает (структура `_output`)
- **Как** он называется (имя `_tool`)
- **Как** он выполняется (поле `_activity`, подробнее см. в [003: Агент/Действие](./003_agent_activity.md))

### Мета-поля схемы Инструмента

Схемы Инструментов используют мета-поля (с префиксом "_") для определения свойств системного уровня:

- **_tool**: Уникальное имя инструмента (обязательно).
- **_activity**: Указывает, какое `Действие` (если есть) должно выполнить этот инструмент. Подробнее о выборе в [003: Агент/Действие](./003_agent_activity.md).
- **_output**: Ожидаемая структура результата (система может сделать это поле необязательным).
- **_reasoningForCall**: Объяснение от агента, почему был создан этот `Вызов` (добавляется системой автоматически).

Любое поле без префикса "_" считается параметром инструмента. При составлении схемы мета-поля всегда идут первыми. Это обеспечивает единую структуру, понятную для LLM.

### Границы системы

Система Инструментов отвечает за:

- Регистрацию Инструментов (определение и хранение их схем)
- Заполнение параметров (извлечение данных из контекста с помощью LLM)
- Маршрутизацию выполнения (решение, использовать скрытое исполнение или `Действие`)

Более высокоуровневые протоколы (например, [004: Агент/Вызов](./004_agent_call.md)) используют эти базовые элементы для организации рабочих процессов, управления состоянием и правил выполнения.

## Определение Инструмента

Инструменты определяются с помощью JSON-схем. Ниже пример `Инструмента` для анализа тональности текста. Он рассчитан на скрытое исполнение: для работы ему достаточно встроенных языковых способностей LLM, и внешняя функция не нужна.

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует тональность текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

## Композиция схем и Вызов

Отдельные Инструменты описывают конкретные возможности, но их настоящая сила — в комбинации. Система передаёт LLM все доступные схемы `Инструментов` в одном запросе (обычно в виде массива). Это позволяет LLM выбрать самый подходящий `Инструмент` для решения текущей задачи. Когда LLM выбирает `Инструмент` и заполняет его параметры, создаётся **Вызов** (`Call`) — готовый к исполнению экземпляр этого `Инструмента`. Именно `Вызов` является основной единицей действия, которая отправляется на выполнение.

> Sidenote: Подробнее см. в [004: Агент/Вызов](./004_agent_call.md).

## Скрытое и явное выполнение

Схема `Инструмента` — это только интерфейс. Его `Вызов` можно выполнить двумя способами. По умолчанию используется **скрытое выполнение**: LLM сама генерирует результат, используя свои внутренние рассуждения. Это идеально для задач, связанных с языком или знаниями. Для действий, которым нужно взаимодействовать с внешним миром (например, вызвать API или обратиться к базе данных), `Инструмент` связывается с функцией в коде. Такая явная реализация называется **Действием** (`Activity`).

Разделение интерфейса (`Инструмент`) и реализации (`Действие`) — это ключевой принцип архитектуры. Он позволяет абстрактно описывать возможности агента, в то время как логику их выполнения можно менять или обновлять независимо. Следующий документ, **[003: Агент/Действие](./003_agent_activity.md)**, подробно описывает, как `Действия` реализуют логику для `Инструментов`.