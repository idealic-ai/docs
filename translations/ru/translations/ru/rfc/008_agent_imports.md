# 008: Агент/Импорты

> **Импорт:** Это ключ, который указывает на часть данных (контекста) из внешней среды, чтобы передать их коду для выполнения. Импорты помогают сфокусировать LLM на нужной информации при **Встраиваемом Скрытом** выполнении или собрать полный контекст для **Модульного** выполнения. Управляется через свойство `_imports`. — [Глоссарий](./000_glossary.md)

[Акт 004: Агент/Вызов](./004_agent_call.md) описывает основные способы выполнения `Вызова`: по **Области** (Встраиваемая или Модульная) и по **Методу** (Явный или Скрытый). **Протокол Импортов** объясняет, как сочетать эти способы и как управлять контекстом для каждого получившегося варианта работы.

## Сочетание Области и Метода

1.  **Встраиваемый Явный (`_activity`)**: Это классический способ использования инструментов. LLM создаёт параметры (`params`), и хост сразу же выполняет локальную функцию. `_imports` здесь обычно не нужны, так как Метод не Скрытый.

2.  **Встраиваемый Скрытый (без `_activity`)**: LLM создаёт и параметры (`params`), и результат (`_output`) за один шаг. `_imports` помогает сфокусировать LLM на нужных частях контекста, чтобы модель не отвлекалась на лишнюю информацию.

3.  **Модульный Явный (`_module` + `_activity`)**: LLM создаёт параметры (`params`). Затем система запускает указанное Действие (`_activity`) из модуля (`_module`) в новой, отдельной среде. Если заданы `_imports`, отфильтрованные данные передаются в код Действия как дополнительный аргумент.

4.  **Модульный Скрытый (`_module`, без `_activity`)**: LLM создаёт параметры (`params`). Затем система запускает новый, изолированный вызов LLM, используя Идею из `_module` как инструкцию. Контекст для этого нового вызова собирается из собственного контекста модуля и данных, указанных в `_imports`.

## Фокусировка поля зрения

Свойство `_imports` — это главный механизм для управления контекстом, который доступен `Вызову`. Оно работает как «белый список», отбирая из родительской среды только нужные данные и создавая для выполнения сфокусированное, ограниченное поле зрения.

- **Во Встраиваемой Области**: `_imports` фокусируют внимание LLM.
- **В Модульной Области**: `_imports` определяют _весь контекст_ для отдельного выполнения.

## Предоставление или Запрос Контекста: Статические и Динамические Импорты

Свойство `_imports` в схеме Инструмента (`Tool`) определяет, как инструмент получает контекст: либо контекст уже одобрен и **предоставлен** заранее, либо LLM **запрашивает** его динамически во время работы.

- **Статические Импорты (Предоставление Контекста)**: Если у свойства `_imports` постоянное значение (`const`), например `_imports: { "const": ["input"] }`, то контекст **предоставляется** заранее. Это значит, что разработчик Инструмента жёстко определил, какие именно данные может видеть инструмент.

> Sidenote:
> 
> ```mermaid
> graph TD
>     subgraph Родительский контекст
>         direction LR
>         input("input")
>         state("state")
>     end
> 
>     subgraph Вызов инструмента
>         direction LR
>         filter{{"_imports: ['input']"}}
>     end
> 
>     input --> filter
>     state -.-> filter
> 
>     subgraph Предоставленный контекст
>         direction LR
>         input_prov("input")
>     end
> 
>     filter --> HITL{{Одобрение человеком}}
>     HITL --> input_prov
>     input_prov --> Execute(Выполнить инструмент)
> 
>     classDef unused stroke-dasharray: 5, 5, stroke:#aaa, color:#aaa
>     class state unused
>     classDef optional stroke-dasharray: 5, 5
>     class HITL optional
> ```

- **Динамические Импорты (Запрос Контекста)**: Если `_imports` описывается гибкой схемой (например, массив с выбором `_imports: { "type": "array", "items": { "enum": ["state"] } }`), то контекст **запрашивается**. В этом случае LLM сама решает, какие из доступных данных ей нужны для создания `Вызова`.

Этот динамический подход особенно эффективен, если используется вместе с системой одобрения человеком. Это обеспечивает важный уровень прозрачности и контроля.

## Сила ограниченного контекста

- **Безопасность и фокус**: Ограничивая доступ к данным, Импорты предотвращают случайные утечки и помогают LLM лучше сфокусироваться. Это делает её работу более предсказуемой, точной и экономичной.
- **Модульность**: Благодаря Импортам модули (Идеи и Действия) становятся по-настоящему независимыми и могут использоваться многократно в разных ситуациях.