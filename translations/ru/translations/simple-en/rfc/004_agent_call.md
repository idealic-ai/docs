# 004: Агент/Вызов

> **Вызов:** Представьте **Инструмент** как кнопку в приложении, например, «Отправить письмо». **Вызов** — это когда вы нажимаете эту кнопку, уже заполнив, кому и что вы хотите написать. Это конкретная команда *сделать что-то прямо сейчас*.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
> 
> - Нужно знать о:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
> - Помогает реализовать:
>   - [008: Агент/Импорты](./008_agent_imports.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - [202: Идея/Контейнер](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)

Мы уже знаем об **[Идее](./101_concept_idea.md)** — полном рецепте чего-либо, и об **[Инструменте](./002_agent_tool.md)**, который превращает этот рецепт в понятную для ИИ кнопку. Этот документ объясняет **Вызов** — то, что происходит, когда ИИ нажимает эту кнопку, чтобы выполнить задачу.

**Вызов** — это как взять рецепт (Инструмент) и добавить в него настоящие ингредиенты (конкретные детали). Если Инструмент говорит: «Я могу приготовить пиццу», то Вызов говорит: «Приготовь пиццу *прямо сейчас*, с пепперони и двойным сыром».

## От Идеи к Действию

Представьте, что вы хотите испечь торт. Вот как это работает:

1.  **Идея**: это ваш полный рецепт торта. В нём есть ингредиенты, шаги приготовления и описание того, как должен выглядеть готовый торт.
2.  **Инструмент**: ваша умная духовка читает рецепт и создаёт программу «Испечь торт». Теперь она понимает, что значит испечь торт, и знает, что для этого нужны мука, сахар и яйца.
3.  **Вызов**: ИИ решает, что пора печь. Он выбирает программу «Испечь торт» и заполняет конкретные детали: «Использовать шоколадную муку, 2 стакана сахара и 3 яйца». Эта конкретная команда испечь торт *прямо сейчас* и есть **Вызов**.

Главное правило простое: **Любую Идею можно превратить в Инструмент, который затем можно использовать в Вызове.**

Чтобы узнать, как именно список ингредиентов из рецепта превращается в поля для Инструмента, ознакомьтесь с документом **[007: Агент/Ввод](./007_agent_input.md)**.

## Управление: Где и Как Выполнять Задачу

Когда вы делаете Вызов, вы можете управлять двумя основными вещами: **Областью** (где он выполняется) и **Методом** (как он выполняется). Система понимает, что вам нужно, на основе специальных пометок в инструкциях Инструмента (например, `_module` или `_activity`).

### Два Рычага Управления

1.  **Область (Где выполняется: на этой кухне или на другой?)**
    Это определяет, будет ли задача выполнена прямо здесь или её отправят в другое место.
    - **Встроенная область**: это обычный способ. Как если бы вы пекли торт на своей собственной кухне. ИИ выполняет задачу там же, где находится.
    - **Модульная область**: это как отправить заказ в специальную пекарню. Пометка `_module` говорит ИИ передать задачу экспертной системе для отдельного выполнения.

2.  **Метод (Как выполняется: по рецепту или творчески?)**
    Это определяет, будет ли задача выполнена по точным шагам или с использованием творческих способностей ИИ.
    - **Явный метод**: это как использовать робота, который в точности следует рецепту. Когда в инструкциях есть пометка `_activity`, это значит, что задача будет выполнена с помощью точного кода. Результат будет одинаковым каждый раз.
    - **Скрытый метод**: это как попросить творческого шеф-повара испечь вам торт. Вы не даёте ему точных шагов, а доверяете его навыкам (мозгу ИИ), чтобы он создал что-то потрясающее. Это происходит, когда пометки `_activity` нет.

Эти два элемента управления, «где» и «как», можно комбинировать, чтобы создавать самые разные мощные действия. Чтобы увидеть, как это работает, ознакомьтесь с **[008: Агент/Импорты](./008_agent_imports.md)**.

## Создание Более Крупных Вещей

Вызов — это основной строительный блок, как один кубик Lego. Соединяя множество Вызовов вместе, мы можем создавать гораздо более крупные и интересные вещи.

Например, **[Контейнер (Vessel)](./202_idea_vessel.md)** — это более крупная идея, похожая на целый разговор с ИИ. Он содержит ваш запрос, все инструменты, которые может использовать ИИ, и его итоговый план, который обычно представляет собой список из одного или нескольких **Вызовов** для выполнения.

> Sidenote:
>
> - [202: Идея/Контейнер](./202_idea_vessel.md)
> - [203: Идея/Процесс](./203_idea_process.md)

## Шаблоны для Выполнения Вызовов

Что, если ИИ нужно сделать несколько Вызовов одновременно? Вы можете указать, как ему с ними обращаться.

```typescript
// Выполнить одну задачу и дождаться её завершения.
const result = await Tool(call);

// Запустить все задачи и дождаться завершения каждой из них.
const results = await Tool.all(calls);

// Запустить все задачи, но остановиться, как только одна из них успешно завершится.
const result = await Tool.any(calls);

// Запустить все задачи и остановиться, как только завершится первая, неважно, успешно или с ошибкой. Как в гонке!
const result = await Tool.race(calls);
```

Эти шаблоны позволяют делать крутые вещи:

- **Один за другим**: Обрабатывать каждую задачу по отдельности.
- **Все сразу**: Выполнять несколько независимых задач одновременно, чтобы ускорить процесс.
- **Первый побеждает**: Попробовать несколько разных способов что-то сделать и использовать тот, который сработает первым (`.any()`).
- **Гонка до финиша**: Посмотреть, какая задача завершится первой, независимо от результата (`.race()`).
- **Всё или ничего**: Убедиться, что вся группа задач завершится успешно. Если одна из них провалится, ни одна не засчитается (`.all()`).