# 005: Агент/Цикл

> **Цикл:** Представьте робота, решающего головоломку. Цикл — это последовательность его шагов. Он постоянно спрашивает: «Что делать дальше?» (`Request`), получает в ответ список действий (`Call`s) и выполняет их. Затем он использует полученные знания, чтобы снова задать вопрос, повторяя цикл, пока не сочтёт задачу решённой и не перестанет предлагать новые действия. — [Глоссарий](./000_glossary.md)

> Sidenote:
> 
> - Требуется:
>   - [Акт 001: Агент/Запрос](./001_agent_request.md)
>   - [Акт 002: Агент/Инструмент](./002_agent_tool.md)
>   - [Акт 004: Агент/Вызов](./004_agent_call.md)

Этот документ объясняет, как работает **Цикл**. Это рецепт, который позволяет компьютерному помощнику («агенту») решать задачи, требующие более одного шага. Он делает это, постоянно спрашивая себя: «Что дальше?»

## Мыслительный Цикл

> Sidenote:
> 
> ```mermaid
graph TD
    Start((Start)) --> AssembleContext(Assemble Context)
    AssembleContext --> InvokeRequest(Invoke Request)
    InvokeRequest --> HasCalls{Solution has Calls?}
    HasCalls -- No --> Stop((End))
    HasCalls -- Yes --> HITL{Human-in-the-Loop}
    HITL -- Approved --> ExecuteCalls(Execute Calls)
    ExecuteCalls -- Results --> AssembleContext
    HITL -- Corrected --> AssembleContext
    classDef optional stroke-dasharray: 5, 5
    class HITL optional
```

Цикл Агента — это основной способ, которым компьютерный помощник самостоятельно выполняет работу. Он работает так:

1.  **Сбор информации:** Сначала цикл начинается со сбора всей необходимой информации. Это включает основную цель, которую вы ему задали, то, что он уже сделал (`State`), и любые другие полезные факты.
2.  **Запрос на следующее действие:** Компьютер собирает всю эту информацию и передает ее своему «мозгу» с помощью процесса **[Акт 001: Агент/Запрос](./001_agent_request.md)**. Он также сообщает «мозгу», какие инструменты ему доступны.
3.  **Получение плана:** «Мозг» думает и отправляет обратно `solution` — список действий для выполнения. Эти действия называются **[Вызовами (Акт 004: Агент/Вызов)](./004_agent_call.md)**.
4.  **Выполнение действий и обучение:**
    - Если в плане есть действия, компьютер их выполняет. Например, если действие — «поиск в интернете», он запустит код своего инструмента для поиска.
    - Результаты этих действий (например, информация, найденная в интернете) добавляются в его память для следующего раунда.
5.  **Остановка:** Если «мозг» возвращает план без действий, это означает, что компьютер считает задачу выполненной. Цикл останавливается.

## Человек в процессе (Human-in-the-Loop)

Отличной особенностью этого цикла является то, что он естественным образом создает паузу, во время которой человек может проверить работу. Поскольку компьютер сначала *планирует* свои действия (`Call`s), а затем *выполняет* их, у вас есть возможность вмешаться.

Представьте, что вы наблюдаете за роботом, который учится готовить. Прежде чем что-либо сделать, он сообщает вам свой план.

- **Одобрение:** Робот говорит: «Я собираюсь добавить чашку соли». Вы можете посмотреть на рецепт и сказать: «Да, всё верно. Продолжай».
- **Исправление:** Или робот может сказать: «Я собираюсь добавить чашку соли», но вы знаете, что нужен сахар. Вы можете остановить его и изменить план, чтобы он использовал сахар.

Это очень важно для безопасности и совместной работы с компьютером. Компьютер может даже использовать ваши изменения для обучения и составления лучших планов в будущем, как описано в **[Акте 012: Агент/План](./012_agent_plan.md)**.