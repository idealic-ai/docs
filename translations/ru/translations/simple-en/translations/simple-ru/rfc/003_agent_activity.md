# Акт 003: Агент/Действие

> **Действие:** Это настоящий, работающий код, который делает то, что обещает «Инструмент». Представьте себе рецепт для шеф-повара. Действия необходимы, когда нужно что-то сделать во внешнем мире — например, проверить погоду в интернете, найти что-то в базе данных или выполнить любую задачу, которую ИИ не может просто «выдумать». — [Глоссарий](./000_glossary.md)

>Sidenote: Требуется: [Акт 002: Агент/Инструмент](./002_agent_tool.md)

Этот документ описывает **Протокол Действий**. Он объясняет, как «Инструменты» (о которых мы говорили ранее) подкрепляются реальным, исполняемым кодом. Если «Инструмент» — это описание того, *что* можно сделать, то «Действие» — это инструкция, *как* это сделать.

## Двухреестровая архитектура

Система агентов использует два разных списка (или реестра), чтобы отделить описание возможности от её реальной реализации:

- **Реестр Инструментов**: Хранит описание того, как выглядят `Инструменты` и что они обещают делать.
- **Реестр Действий**: Хранит реальный код (`Действия`), который выполняет работу для `Инструментов`.

Представьте себе меню ресторана и его кухню. Меню (`Реестр Инструментов`) просто говорит вам, что есть блюдо под названием «чизбургер». Но на кухне (`Реестр Действий`) есть настоящий рецепт и шеф-повар, который знает, как его приготовить. Это разделение — ключ к гибкости системы. Оно позволяет `Инструментам` работать в «режиме воображения» (когда ИИ просто выдумывает результат), а также позволяет легко менять рецепт на кухне, не меняя название блюда в меню.

## Регистрация Действия

«Действие» регистрируется под уникальным именем, которое связывает его с «Инструментом».

```typescript
// Регистрируем код Действия.
// Имя 'weatherCheck' должно совпадать с Инструментом, для которого оно предназначено.
Activity.register('weatherCheck', async call => {
  const data = await weatherAPI.get(call.location);
  return { temperature: data.temp, conditions: data.desc };
});
```

## Режимы выполнения: Скрытый и Явный

Система может обработать запрос к `Инструменту` двумя совершенно разными способами:

- **Скрытое выполнение**: Здесь используется способность ИИ к рассуждению. Агент как бы «продумывает» задачу и самостоятельно генерирует ответ. Это похоже на то, как вы спрашиваете своего сверхразумного друга, какая погода в Париже, и он просто отвечает вам, основываясь на своих общих знаниях, даже не заглядывая в интернет. Этот режим используется по умолчанию, если система не может найти подходящее `Действие` для `Инструмента`.
  >Sidenote: [104: Концепция / Скрытое](./104_concept_latent.md)
- **Явное выполнение**: В этом случае запрос передается реальному коду. Вызывается функция «Действия», и она вычисляет результат. Это как если бы ваш друг достал телефон, открыл погодное приложение и сообщил вам точный прогноз. Этот режим необходим для взаимодействия с реальным миром (например, с веб-сайтами или базами данных) или для задач, требующих 100% точности.

## Как система выбирает режим

Система решает, какой режим использовать, самостоятельно, без каких-либо сложных настроек. Поле `_activity` в черновике `Инструмента` является сигналом о том, что для него существует реальный код. Вот как система принимает решение:

1.  **Прямая ссылка в `_activity`**: Если в описании `Инструмента` явно указано действие в поле `_activity`, система ищет `Действие` с таким именем в своем списке.
2.  **Совпадение по имени (рекомендуемый способ)**: Если поле `_activity` пустое, система ищет `Действие`, у которого **точно такое же имя**, как у `Инструмента`. Если находит, отлично, они связаны.
3.  **Резервный вариант (скрытый режим)**: Если по первым двум правилам ничего не найдено, система решает, что для этого `Инструмента` нет реального кода, и просит ИИ «вообразить» результат.

Такой подход значительно упрощает разработку:

- **Для простой настройки просто назовите ваше `Действие` так же, как и ваш `Инструмент`**
- `Инструменты`, для которых вы еще не написали код, будут безопасно работать в «режиме воображения».
- При необходимости вы можете использовать поле `_activity` для указания другого имени, что позволит одному и тому же коду (`Действие`) выполнять работу для нескольких разных `Инструментов`.

## Почему так важно разделять Действия

Если бы мы не разделяли описание `Инструмента` и код `Действия`, они были бы навсегда связаны. Чтобы изменить способ выполнения задачи (например, переключиться с «воображаемой» ИИ погоды на использование реального погодного сайта), нам пришлось бы находить и переписывать каждого агента, использующего этот `Инструмент`.

Двухреестровая архитектура решает эту проблему. Описание `Инструмента` (меню) остается прежним, а его реализация (рецепт на кухне) может меняться. Агенты всегда видят одно и то же «меню» и им не нужно знать, как на самом деле готовится блюдо. Это означает:

- **Изменение кода не ломает агентов**: Можно переключиться со «скрытого» режима на «явный», не трогая код агента.
- **Можно тестировать разные подходы**: Можно сравнить, что работает лучше — когда ИИ выдумывает ответ или когда его предоставляет реальный сервис.
- **Плавные обновления**: Можно внедрять новый код `Действия` только для части агентов, тогда как остальные будут использовать старую версию или «воображаемую».

## От описания к действию

Разделяя «что» (`Инструмент`) и «как» (`Действие`), система становится невероятно гибкой. Но это лишь часть истории. Теперь, когда у нас есть описания и их реальный код, последняя часть — это управление всем этим: как организуются, выполняются и связываются в цепочки вызовы инструментов.

Следующий документ, [Акт 004: Агент/Вызов](./004_agent_call.md), расскажет о протоколе, который управляет этим процессом, превращая абстрактные описания в конкретные действия.