# 004: Агент/Вызов

> **Вызов:** Это как взять «Инструмент» и дать ему конкретное задание с точными деталями для его `parameters`. Это команда, которая говорит, *что именно делать* прямо сейчас.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требует:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
> - Открывает:
>   - [008: Агент/Импорт](./008_agent_imports.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - [202: Идея/Сосуд](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)

В документе [101: Концепция/Идея](./101_concept_idea.md) «Идея» описывалась как мощный способ хранения знаний и скрытых инструкций. А в [002: Агент/Инструмент](./002_agent_tool.md) объяснялось, как агент может понять, что он умеет делать, используя специальные «черновики» инструкций. Этот документ описывает протокол **004: Агент/Вызов**, который основан на Инструментах и объясняет, как на самом деле выполняется работа с помощью элементов управления «Область» и «Метод».

**Вызов** — это, по сути, Инструмент, которому предоставили конкретные детали и сказали: «Иди, делай своё дело!». Если Инструменты определяют, *что можно сделать*, то Вызовы определяют, *как именно это будет сделано*.

## Путь от Идеи к Вызову

Представьте, что вы хотите что-нибудь съесть.

1.  **Идея**: Общая мысль или часть знания. Например, «Сделать сэндвич».
2.  **Инструмент**: «Идея» превращается в конкретный «рецепт», понятный компьютеру. В этом рецепте указано, какие «ингредиенты» (`parameters`) необходимы. Например, для сэндвича нужны `хлеб`, `мясо` и `сыр`. (Подробнее о том, как это работает, можно прочитать в [002: Агент/Инструмент](./002_agent_tool.md)).
3.  **Вызов**: Это момент, когда ИИ решает использовать «Инструмент». Он берёт рецепт и заполняет его конкретными ингредиентами: `два ломтика белого хлеба`, `три ломтика ветчины` и `один ломтик сыра чеддер`. **Вызов** — это одно конкретное использование Инструмента со всеми заполненными деталями.

Главное правило: **Любую Идею можно превратить в Инструмент, который затем можно использовать через Вызов.**

Чтобы узнать больше о том, как «Идея» становится «Инструментом», ознакомьтесь с документом **[007: Агент/Ввод](./007_agent_input.md)**.

## Контроль выполнения: Область и Метод

Способ выполнения `Invocation` определяется двумя отдельными настройками: **Область** (где он работает) и **Метод** (как он работает). Чтобы их задать, используются специальные свойства (`_module`, `_activity`, `_output`) в описании инструмента.

### Две оси действия

1.  **Область (Здесь vs. Где-то ещё)**
    Область определяет, будет ли задача выполнена прямо здесь, внутри текущего агента, или она будет передана кому-то или чему-то другому.
    - **Здесь (Встроенная область)**: Это обычный способ. `Invocation` обрабатывается немедленно, на месте.
    - **Где-то ещё (Модульная область)**: Включается с помощью `_module`. `Invocation` отправляется в другой модуль — внешнее `Действие` или `Идею` — для выполнения.

2.  **Метод (По правилам vs. Творчески)**
    Метод определяет, как создаётся результат: путём следования точному коду или позволяя ИИ разобраться самостоятельно.
    - **По правилам (Явный метод)**: Включается при наличии свойства `_activity`. Результат `Invocation` создаётся с помощью точного, заранее написанного кода.
    - **Творчески (Скрытый метод)**: Это вариант по умолчанию, если `_activity` отсутствует. ИИ сам придумывает результат. Для этого требуется свойство `_output`, описывающее, каким должен быть результат.

Вы можете смешивать и сочетать эти элементы управления для создания различных способов выполнения задач. Вы можете контролировать, к каким знаниям у них есть доступ, с помощью импорта. Подробнее об этом читайте в **[008: Агент/Импорт](./008_agent_imports.md)**.

## Создание сложных планов

`Invocation` — это как один строительный блок, который можно использовать для создания более крупных и организованных действий. В протоколе COILS именно Вызов запускает продвинутые «Идеи», такие как **[202: Идея/Сосуд](./202_idea_vessel.md)** и **[203: Идея/Процесс](./203_idea_process.md)**. Например, `Vessel` — это один момент принятия решения. Он содержит полный запрос к агенту, включая всю необходимую информацию (`context`) и список доступных `Инструментов` (`schema`), а также ответ агента — `решение`, которое может содержать один или несколько `Вызовов`, готовых к исполнению.

> Sidenote:
>
> - [202: Идея/Сосуд](./202_idea_vessel.md)
> - [203: Идея/Процесс](./203_idea_process.md)

## Способы запуска Вызовов

Когда агент создаёт несколько Вызовов, их можно запускать разными способами, в зависимости от ваших потребностей. Представьте, что у вас есть список дел.

```typescript
// Выполнить одно действие
const result = await Tool(call);

// Выполнить все действия и дождаться завершения каждого из них
const results = await Tool.all(calls);

// Пытаться выполнить действия одно за другим, но остановиться, как только одно из них завершится успешно
const result = await Tool.any(calls);

// Начать выполнять всё одновременно и посмотреть, какое завершится первым (независимо от успеха или неудачи)
const result = await Tool.race(calls);
```

Эти разные способы позволяют вам:

- **Точный контроль**: Обрабатывать Вызовы по одному, выполняя другие задачи в промежутках.
- **Пакетное выполнение**: Запускать независимые Вызовы одновременно для ускорения работы.
- **Быстрый поиск решений**: Останавливаться после первого успешного выполнения (`.any()`) или самого первого результата (`.race()`).
- **Всё или ничего**: Убедиться, что каждый Вызов в группе успешно завершён (`.all()`), что помогает избежать ошибок, когда одна задача зависит от другой.