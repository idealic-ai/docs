# 005: Агент/Цикл

> **Цикл:** Последовательность `Запросов`, направленная на достижение цели. Агент продолжает вызывать `Запросы`, обрабатывать полученные `Вызовы` и передавать результат обратно в контекст следующего `Запроса` до тех пор, пока не перестанут генерироваться `Вызовы`.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требуется:
>   - [Агент/Запрос](./001_agent_request.md)
>   - [Агент/Инструмент](./002_agent_tool.md)
>   - [Агент/Вызов](./004_agent_call.md)

Этот документ описывает **Протокол Цикла**, который позволяет агенту выполнять многошаговые задачи путем итеративного вызова протокола `Запрос`.

## Цикл выполнения

Цикл Агента — это основной механизм для автономного, многошагового выполнения. Он работает следующим образом:

1.  **Сборка контекста:** Цикл начинается со сборки начального контекста, который может включать цель пользователя, текущее `Состояние` и другую релевантную информацию.
2.  **Вызов Запроса:** Он вызывает протокол **[Агент/Запрос](./001_agent_request.md)** с текущим контекстом и схемой доступных `Инструментов`.
3.  **Обработка Вызова:** `Запрос` возвращает `решение`, содержащее массив из нуля или более **[Агент/Вызовов](./003_agent_call.md)**.
4.  **Выполнение и обратная связь:**
    - Если `решение` содержит `Вызовы`, цикл их выполняет. Для `Явных` `Вызовов` это включает в себя вызов соответствующего кода `Действия`.
    - Результаты этих `Вызовов` затем добавляются обратно в контекст для следующей итерации.
5.  **Завершение:** Если `решение` не содержит `Вызовов`, агент считает свою цель достигнутой, и цикл завершается.

## Человек-в-цикле (Human-in-the-Loop, HITL)

Ключевой особенностью Цикла Агента является его естественная поддержка человеческого контроля. Поскольку цикл разделяет генерацию `Вызовов` и их выполнение, это создает возможность для вмешательства пользователя:

- **Подтверждение:** Перед выполнением `Вызовов` система может представить их пользователю для утверждения.
- **Исправление:** Пользователь может изменять параметры `Вызова` или даже заменять его другим.

Эта возможность критически важна для безопасности и совместных задач, где агент выступает в роли ассистента. Корректировки и обратная связь от пользователя могут быть использованы **[Агентом/Планом](./013_agent_plan.md)**, что позволяет агенту уточнять свою стратегию на основе человеческого ввода.
