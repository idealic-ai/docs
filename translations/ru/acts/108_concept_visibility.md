# 108: Концепция/Видимость

> [!DEFINITION] :term[Видимость]{canonical="Visibility"}
> Набор механизмов, контролирующих, какая версия :term[Идеи]{canonical="Idea"} будет выбрана в определённом контексте. Видимость определяется сочетанием истории версий :term[Идеи]{canonical="Idea"}, её связей с ветвями и пути поиска запрашивающей стороны.

> Sidenote:
> - Требует:
>   - :term[107: Концепция/Идентичность]{href="./107_concept_identity.md"}
> - Открывает:
>   - :term[109: Концепция/Адресация]{href="./109_concept_addressing.md"}

Чтобы система развивающихся, взаимосвязанных :term[Идей]{canonical="Idea"} была полезной, должен существовать ясный и предсказуемый способ определять, какая версия :term[Идеи]{canonical="Idea"} видна — или **видима** — в каждом конкретном контексте. Этот документ описывает двухчастную модель, управляющую видимостью: систему версионирования, которая создаёт возможные состояния :term[Идеи]{canonical="Idea"}, и механизм выбора, который определяет, какое состояние становится видимым.

## Версионирование: Создание видимых состояний

Прежде чем версия может быть выбрана, она должна существовать. **Иерархическое версионирование** — это механизм для создания и отслеживания различных состояний :term[Идеи]{canonical="Idea"} с течением времени. Версия — это не просто число, а многоуровневая, разделённая точками иерархия, которая рассказывает историю эволюции :term[Идеи]{canonical="Idea"}.

Версии состоят из **целочисленных ревизий** для последовательных публичных релизов (например, `1.2`) и **ревизий в ветвях** для именованных линий разработки (например, `feature-x`). Например, версия `1.2.feature-x.3` говорит нам, что это третья ревизия ветви `feature-x`, созданной из версии `1.2`.

Правила изменения версии:

- **Совместимые изменения**: Неломающее изменение, такое как добавление нового необязательного поля в схему, создаёт новую минорную ревизию (например, `1.2` становится `1.2.1`).
- **Несовместимые изменения**: Ломающее изменение, такое как удаление поля или изменение типа существующего поля, означает, что новая версия больше не может быть прямой заменой старой. Такое изменение должно «подниматься» на более высокий уровень иерархии версий. Изменение, нарушающее совместимость с `1.2`, приведёт к созданию новой версии `1.3`. Система автоматически обнаруживает такие несовместимости, анализируя изменения в схеме, что гарантирует точное отражение границ совместимости в номерах версий без ручных догадок.

## Выбор: Определение видимого состояния

При наличии богатой истории версий необходим механизм для выбора правильной. Это достигается чётким разделением между тем, как публикуется `Idea` и как она извлекается. Этот процесс имеет два измерения для извлечения: **пространственное** (в каких разделах искать) и **временное** (на какой момент времени).

### Ветви: Публикация и разделение

> [!DEFINITION] :term[Ветвь]{canonical="Branch"}
> Именованная метка, которая разделяет пространство видимости, создавая параллельную, изолированную среду для разработки и экспериментов. Связывание :term[Идеи]{canonical="Idea"} с ветвью является актом публикации.

Например, каждая версия :term[Идеи]{canonical="Idea"} в базе данных связана с одной или несколькими ветвями, такими как `["main", "feature/new-billing"]`. Этот акт публикации делает :term[Идею]{canonical="Idea"} доступной в этих конкретных разделах, обеспечивая безопасный рабочий процесс.

Это даёт два основных преимущества:

- **Изоляция**: Работа над новой функцией (например, в ветви `feature/new-billing`) не мешает стабильной ветви `main`. Это предотвращает влияние незавершённой или ошибочной работы на производственные системы.
- **Эксперименты**: Ветви легко и дёшево создавать. Это поощряет эксперименты, позволяя разработчикам отбросить ветвь, если эксперимент не удался, без какого-либо влияния на основную систему.

### Путь поиска: Приоритетное извлечение

> [!DEFINITION] :term[Путь Поиска]{canonical="Search Path"}
> Упорядоченный список имён ветвей, который определяет механизм извлечения. Он указывает распознавателю, в каких разделах искать и в каком порядке приоритета, создавая каскадную систему наложения.

Этот механизм извлечения — ключевой элемент рабочего процесса разработки и отвечает на **пространственный** вопрос. Например, типичный путь поиска разработчика может быть установлен как `['feature/my-new-idea', 'staging', 'main']`.

Эта конфигурация создаёт каскадную систему наложения для извлечения:

1.  Сначала искать соответствующую :term[Идею]{canonical="Idea"} в разделе `feature/my-new-idea`.
2.  Если не найдено, искать в разделе `staging`.
3.  В конечном итоге, искать в разделе `main`.

Это позволяет разработчику видеть определённую, задуманную реальность, состоящую из его локальных изменений, плавно наложенных на стабильную систему.

### Время отсечения: Временное извлечение

> [!DEFINITION] :term[Время Отсечения]{canonical="Cutoff Time"}
> Временная метка, сопровождающая запрос на разрешение, которая указывает распознавателю найти версию :term[Идеи]{canonical="Idea"}, считавшуюся последней на тот конкретный момент времени.

Второе измерение извлечения — **временное**. Каждый запрос на разрешение выполняется относительно состояния системы, каким оно было в определённый момент. Это контролируется **Временем Отсечения**.

Если время отсечения не указано, оно по умолчанию равно текущему времени (`now()`), извлекая самые последние видимые версии. Однако, указав временную метку из прошлого, можно выполнить «запрос в прошлое». Это указывает распознавателю найти версию :term[Идеи]{canonical="Idea"} — и все её зависимости — которая была последней согласно пути поиска в тот самый момент. Эта возможность является технической основой для идеальной воспроизводимости.

> Sidenote:
> - :term[107: Концепция/Идентичность]{href="./107_concept_identity.md"}

## От модели к применению

В этой главе была определена теоретическая модель видимости — механизмы для создания различных состояний и выбора между ними. Когда эта модель готова, последним элементом является практический язык для взаимодействия с ней.

Следующий документ, :term[109: Концепция/Адресация]{href="./109_concept_addressing.md"}, представляет схему URI `idea:`, конкретный синтаксис, используемый для запроса определённого представления и навигации по этой богатой, версионированной и разветвлённой реальности.