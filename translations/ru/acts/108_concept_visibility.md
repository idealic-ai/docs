# 108: Концепция/Видимость

> [!DEFINITION] :term[Видимость]{canonical="Visibility"}
> Набор механизмов, контролирующих, какая версия :term[Идеи]{canonical="Idea"} будет выбрана в определённом контексте. Видимость определяется сочетанием истории версий :term[Идеи]{canonical="Idea"}, её связей с ветками и путём поиска запрашивающего.

> Sidenote:
> - Требует:
>   - :term[107: Концепция/Идентичность]{href="./107_concept_identity.md"}
> - Открывает:
>   - :term[109: Концепция/Адресация]{href="./109_concept_addressing.md"}

Чтобы система развивающихся, взаимосвязанных :term[Идей]{canonical="Idea" href="./101_concept_idea.md"} была полезной, должен существовать ясный и предсказуемый способ определять, какая версия :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"} отображается, то есть становится **видимой**, в любом заданном контексте. Этот документ описывает двухкомпонентную модель, управляющую :term[видимостью]{canonical="Visibility"}: систему версионирования, которая создаёт возможные состояния :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"}, и механизм выбора, который определяет, какое состояние станет видимым.

## Версионирование: создание видимых состояний

Прежде чем версию можно будет выбрать, она должна существовать. :term[Иерархическое версионирование]{canonical="Hierarchical Versioning"} — это механизм для создания и отслеживания различных состояний :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"} с течением времени. Версия — это не просто число, а многоуровневая, разделённая точками иерархия, которая повествует об эволюции :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"}.

Версии состоят из **целочисленных ревизий** для последовательных публичных релизов (например, `1.2`) и **ревизий в ветках** для именованных линий разработки (например, `feature-x`). Например, версия вроде `1.2.feature-x.3` говорит нам, что это третья ревизия ветки `feature-x`, созданной из версии `1.2`.

Правила развития версии таковы:

- **Совместимые изменения**: Неломающее изменение, при котором новая версия может безопасно использоваться как полная замена старой. Примеры включают изменение данных `context` или `solution` или добавление нового поля в `schema`. Такие изменения создают новую минорную ревизию (например, `1.2` становится `1.2.1`).
- **Ломающие изменения**: Изменение, при котором новая версия не может использоваться как замена старой. Обычно это подразумевает удаление или изменение существующих полей в `schema`. Эти изменения должны «подниматься» на более высокий уровень иерархии версий (например, изменение, нарушающее совместимость с `1.2`, создаст `1.3`). Система может автоматически обнаруживать ломающие изменения на основе схемы.

## Выбор: определение видимого состояния

При наличии богатой истории версий необходим механизм выбора для определения правильной. Это решается чётким разделением между тем, как :term[Идея]{canonical="Idea" href="./101_concept_idea.md"} публикуется, и тем, как она извлекается. Этот процесс имеет два измерения извлечения: **пространственное** (в каких разделах искать) и **временное** (на какой момент времени).

### Ветки: публикация и разделение

> [!DEFINITION] :term[Ветка]{canonical="Branch"}
> Именованная метка, которая разделяет пространство видимости, создавая параллельную, изолированную среду для разработки и экспериментов. Связывание :term[Идеи]{canonical="Idea"} с веткой является актом публикации.

Например, каждая версия :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"} в базе данных связана с одной или несколькими :term[ветками]{canonical="Branch"}, например `["main", "feature/new-billing"]`. Этот акт публикации делает :term[Идею]{canonical="Idea" href="./101_concept_idea.md"} доступной в этих конкретных разделах, обеспечивая безопасный рабочий процесс.

Это даёт два фундаментальных преимущества:

- **Изоляция**: Работа над новой функцией (например, в :term[ветке]{canonical="Branch"} `feature/new-billing`) не мешает стабильной :term[ветке]{canonical="Branch"} `main`. Это предотвращает влияние незаконченной или содержащей ошибки работы на производственные системы.
- **Экспериментирование**: :term[Ветки]{canonical="Branch"} легко и быстро создавать. Это поощряет эксперименты, позволяя разработчикам отбросить :term[ветку]{canonical="Branch"}, если эксперимент не удался, без какого-либо влияния на основную систему.

### Путь поиска: приоритетное извлечение

> [!DEFINITION] :term[Путь поиска]{canonical="Search Path"}
> Упорядоченный список имён веток, определяющий механизм извлечения. Он указывает сопоставителю, в каких разделах и в каком порядке приоритета производить поиск, создавая каскадную систему наложения.

Этот механизм извлечения является ключевым для рабочего процесса разработки и отвечает на **пространственный** вопрос. Например, типичный :term[путь поиска]{canonical="Search Path"} разработчика может быть установлен как `['feature/my-new-idea', 'staging', 'main']`.

Эта конфигурация создаёт каскадную систему наложения для извлечения:

1.  Сначала поиск подходящей :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"} выполняется в разделе `feature/my-new-idea`.
2.  Если не найдено, поиск продолжается в разделе `staging`.
3.  В конечном итоге, поиск выполняется в разделе `main`.

Это позволяет разработчику видеть определённую, задуманную реальность, состоящую из его локальных изменений, бесшовно наложенных поверх стабильной системы.

### Время отсечки: временное извлечение

> [!DEFINITION] :term[Время отсечки]{canonical="Cutoff Time"}
> Временная метка, которая сопровождает запрос на сопоставление, указывая сопоставителю найти ту версию :term[Идеи]{canonical="Idea"}, которая считалась последней на тот конкретный момент времени.

Второе измерение извлечения — **временное**. Каждый запрос на сопоставление выполняется относительно состояния системы, каким оно было в определенный момент. Это контролируется :term[Временем отсечки]{canonical="Cutoff Time"}.

Если :term[время отсечки]{canonical="Cutoff Time"} не указано, оно по умолчанию устанавливается на текущее время (`now()`), извлекая самые последние видимые версии. Однако, указав временную метку из прошлого, можно выполнить «запрос в прошлое». Это указывает сопоставителю найти версию :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"} — и всех её зависимостей, — которая была последней согласно :term[пути поиска]{canonical="Search Path"} в тот самый момент. Эта возможность является технической основой для идеальной воспроизводимости.

> Sidenote:
> - :term[107: Концепция/Идентичность]{href="./107_concept_identity.md"}

## От модели к применению

В этой главе была определена теоретическая модель :term[видимости]{canonical="Visibility"} — механизмы создания различных состояний и выбора между ними. Теперь, когда модель определена, последним элементом является практический язык для взаимодействия с ней.

Следующий документ, :term[109: Концепция/Адресация]{href="./109_concept_addressing.md"}, представляет схему URI :term[idea:]{canonical="idea:"}, конкретный синтаксис, используемый для запроса определённого представления и навигации по этой богатой, версионированной и разветвлённой реальности.
