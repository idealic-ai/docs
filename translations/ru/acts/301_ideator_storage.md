# 301: Идеатор/Хранилище

**Система: Хранилище** — это основной служебный сервис в экосистеме Idea. Сервис Хранилища функционирует как специализированный **Трансформатор Идей**, основная цель которого — предоставлять постоянное, контентно-адресуемое хранилище для `Идей`. Это фундаментальный уровень для памяти и извлечения данных, позволяющий сохранять и версионировать `Идеи` для последующего использования другими сервисами, такими как [Система: Распознаватель](./302_ideator_resolver.md).

## 2. Основная концепция: Хранилище как Трансформатор Идей

Сервис Хранилища следует шаблону `Трансформатора Идей`, принимая на вход `Идею` и возвращая `Идею` на выходе.

- **Вход**: Валидный триплет `Идеи` (`schema`, `solution`, `context`).
- **Процесс**: Сервис получает `Идею`, присваивает ей уникальный, адресуемый идентификатор (включающий версионирование) и сохраняет ее в надежном бэкенде (например, в базе данных PostgreSQL).
- **Выход**: Сервис возвращает исходную `Идею` в качестве подтверждения успешного сохранения. Этот вывод может быть дополнен метаданными, такими как присвоенный идентификатор и версия, подтверждающими его сохранение.

## 3. Хранилище как транзакционная граница

Критически важная роль сервиса Хранилища — действовать как **транзакционная граница**. Когда внешний участник (например, пользователь или другой сервис) отправляет `Идею` и получает подтверждение об успехе, эта начальная транзакция считается завершенной.

Такое разделение является основополагающим для отказоустойчивости и масштабируемости архитектуры. Это позволяет системе создавать сложные, событийно-ориентированные рабочие процессы. Как только `Идея` зафиксирована в `Хранилище`, другие сервисы (например, `Watcher` или `Subscriber`) могут реагировать на это изменение, инициируя новые, независимые транзакции для продолжения процесса. Это предотвращает необходимость в длительных, монолитных транзакциях и создает четкую, проверяемую передачу управления между различными фазами рабочего процесса.

## 4. Ключевые характеристики

### 4.1. Сохранение по принципу «черного ящика»

Сервис Хранилища спроектирован как управляемый «черный ящик». Пользователи отправляют `Идеи` для сохранения, не имея контроля над базовым механизмом хранения (например, типом базы данных, шардированием) или политиками хранения данных. Сервис гарантирует, что `Идея`, однажды принятая, будет сохранена и доступна для распознавания. Конкретные детали реализации остаются на усмотрение поставщика услуг.

### 4.2. Версионирование и неизменяемость

Система построена на принципе неизменяемости. Когда существующая `Идея` «обновляется», сервис Хранилища не изменяет исходную запись. Вместо этого он создает и сохраняет новую версию `Идеи`, сохраняя полную, непрерывную цепь ее истории. Это гарантирует, что любая ссылка на конкретную версию `Идеи` всегда будет вести к абсолютно тому же содержимому. Ссылки могут указывать на конкретную версию или на динамическую ветку (например, `latest`).

### 4.3. Контентная-адресация

Хотя точная схема адресации является деталью реализации, принцип заключается в том, что каждая сохраненная `Идея` уникально идентифицируется и может быть извлечена по своему идентификатору и версии. Это позволяет создать надежную и децентрализованную систему, в которой на `Идеи` можно ссылаться с высокой точностью.

## 5. Публичный интерфейс

Публичный интерфейс системы Хранилища прост и ориентирован на запись, что соответствует его основной роли как «приемника» для `Идей`.

- **Основное взаимодействие**: Единственное публичное взаимодействие — это отправка `Идеи`.

- **Отделение от извлечения**: Для поддержания четкого разделения ответственности сервис Хранилища не предоставляет публичный API для общего извлечения или запросов. Ответственность за получение и распознавание `Идей` явно делегирована сервису **Распознавателя**. Это позволяет каждому сервису сосредоточиться на одной задаче: Хранилище отвечает за сохранение, а Распознаватель — за извлечение и компоновку.