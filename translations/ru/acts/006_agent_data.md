# 006: Агент/Данные

> [!DEFINITION] [Сообщение с данными](./000_glossary.md)
> Постоянное сообщение в контексте, которое содержит данные (`data`) и, возможно, их схему (`schema`). Оно сохраняется между циклами работы агента, чтобы обеспечить стабильный и структурированный контекст.

> Sidenote:
> - Требует:
>   - [001: Агент/Запрос](./001_agent_request.md)
> - Открывает возможности для:
>   - [007: Агент/Ввод](./007_agent_input.md)
>   - [009: Агент/Состояние](./009_agent_state.md)
> - Дополняется:
>   - [005: Агент/Цикл](./005_agent_loop.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)

Этот документ описывает **Протокол Данных** — базовый способ предоставления структурированной, самоописываемой информации. Он служит основой для других подсистем, например, для [Ввода](./007_agent_input.md) и [Состояния](./009_agent_state.md), помогая им управлять данными в `context` агента. В отличие от временных сообщений, сообщения `Data` постоянны и сохраняются между шагами работы агента. Это создает стабильный контекст для выполнения сложных задач.

## Сообщение с данными

> Sidenote:
> - [001: Агент/Запрос](./001_agent_request.md)

Сообщение `Data` — это простой, но мощный способ добавить структурированный контекст в [Запрос](./001_agent_request.md). Это объект со следующими свойствами:

- **`data`**: Любое значение в формате JSON (например, строка, число, объект, массив), которое содержит полезную нагрузку.
- **`schema`**: Необязательная JSON Schema, которая определяет структуру и смысловое значение `data`.
- **`kind`**: Необязательная строка, которая определяет роль сообщения (например, `"state"`, `"input"`). Это позволяет системе и LLM различать разные типы данных в одном и том же контексте.

Сочетание данных и схемы делает контекст понятным для машины. `schema` работает как инструкция: она объясняет LLM, что означает каждое свойство, какого оно типа и какие у него есть ограничения. Это не только помогает LLM правильно рассуждать, но и служит документацией для пользователей, показывая, что можно изменять и настраивать.

## Слияние и идентичность

Протокол может обрабатывать несколько сообщений `Data` в одном `context`. Если система понимает, что несколько сообщений относятся к одному и тому же, она объединяет их в единый объект. Это особенно полезно, когда нужно применить несколько последовательных изменений состояния.

Идентичность сообщения в основном определяется его свойством `kind`. Например, все сообщения с `kind: "state"` без других отличительных признаков считаются имеющими одну и ту же идентичность. Эта идентичность может быть уточнена другими протоколами, в частности [011: Агент/Инстансинг](./011_agent_instancing.md), который позволяет выполнять параллельную обработку, создавая различные контексты.

> Sidenote:
> - [011: Агент/Инстансинг](./011_agent_instancing.md)

Когда есть несколько сообщений, которые можно объединить (например, несколько объектов `state` с изменениями), система может поступить двумя способами. Первый: цикл выполнения агента может сам объединить эти объекты в единое целое, прежде чем передать их LLM. Это снижает нагрузку на модель. Второй: LLM может сама «мысленно объединить» информацию в своём скрытом пространстве, понимая, что разные сообщения — это части одной и той же сущности.

## Взаимодействие с другими протоколами

Протокол `Data` — это базовый шаблон, который дополняют и расширяют другие, более высокоуровневые протоколы.

- **Цикл:** Цикл выполнения использует сообщения `Data` для поддержания непрерывности. Сообщение `State`, являющееся специализированным сообщением `Data`, — это основной способ сохранения информации между шагами (тиками) цикла.

  > Sidenote:
  > - [005: Агент/Цикл](./005_agent_loop.md)

- **Состояние:** Протокол `State` использует сообщение `Data` для представления постоянной, изменяющейся памяти рабочего процесса. `schema` сообщения определяет структуру объекта состояния, включая доступные свойства и переменные.

  > Sidenote:
  > - [010: Агент/Состояние](./010_agent_state.md)

- **Инстансинг:** Все сообщения `Data` подлежат `Инстансингу`. Свойство `_instance` работает как ключ, который ограничивает данные конкретным потоком выполнения в рамках большой пакетной операции. Сообщения `Data` с разными значениями `_instance` не будут объединяться, что обеспечивает изоляцию данных между параллельными процессами.

  > Sidenote:
  > - [011: Агент/Инстансинг](./011_agent_instancing.md)

- **Ввод:** Протокол `Input` использует сообщение `Data` для формального объявления параметров, которые принимает `Запрос`. Это механизм, который превращает статичный `Запрос` в переиспользуемый компонент, подобный функции.

  > Sidenote:
  > - [007: Агент/Ввод](./007_agent_input.md)

## От данных к динамическим связям

Протокол `Data` предоставляет общий контейнер для структурированной информации. Теперь, когда у нас есть эта основа, мы можем изучить, как динамически связывать эти данные между собой. Это ключевой шаг, который позволяет агенту создавать процессы, где результат одного шага становится входными данными для следующего.

Следующий документ, **[008: Агент/Переменные](./008_agent_variables.md)**, описывает протокол, который делает эти динамические связи возможными.
