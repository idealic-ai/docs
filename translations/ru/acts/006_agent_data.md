# 006: Агент/Данные

> **Сообщение с данными:** Постоянное контекстное сообщение, содержащее значение `data` и необязательную `schema`. Оно сохраняется на протяжении всего цикла выполнения агента для обеспечения стабильного, структурированного контекста. — [Глоссарий](./000_glossary.md)

> Sidenote: Требует: [001: Агент/Запрос](./001_agent_request.md). Активирует: [007: Агент/Ввод](./007_agent_input.md), [010: Агент/Состояние](./010_agent_state.md). Дополняется: [005: Агент/Цикл](./005_agent_loop.md), [011: Агент/Инстансинг](./011_agent_instancing.md).

Этот документ описывает **Протокол Данных** — низкоуровневый шаблон для предоставления структурированной, самоописываемой информации. Он служит фундаментальным механизмом, используемым другими подсистемами, такими как **Ввод** и **Состояние**, для управления структурированными данными в `context` агента. В отличие от временных сообщений, сообщения `Data` являются постоянными и сохраняются между итерациями цикла выполнения агента, обеспечивая стабильный контекст для многошаговых задач.

## Сообщение с данными

Сообщение `Data` — это простая, но мощная конструкция для добавления структурированного контекста в [001: Агент/Запрос](./001_agent_request.md). Это объект сообщения, который содержит следующие свойства:

- **`data`**: Любое значение JSON (например, строка, число, объект, массив), которое содержит полезную нагрузку.
- **`schema`**: Необязательная JSON Schema, которая определяет структуру и семантическое значение `data`.
- **`kind`**: Необязательная строка, которая определяет роль сообщения (например, `"state"`, `"input"`). Это позволяет системе и LLM различать различные типы данных в одном и том же контексте.

Соединяя данные с необязательной схемой, сообщение `Data` делает контекст машиночитаемым. `schema` действует как черновик, объясняя LLM, что означает каждое свойство, какой у него тип и какие ограничения применяются. Это не только направляет рассуждения LLM, но и служит формой документации, показывая пользователям, что можно изменить или настроить.

## Слияние и идентичность

Протокол разработан для обработки нескольких сообщений `Data` в рамках одного `context`. Если система определяет, что несколько сообщений имеют одинаковую идентичность, они объединяются в единый, целостный объект. Это особенно полезно для сценариев, таких как применение серии патчей состояния.

Идентичность сообщения в первую очередь определяется его `kind`. Например, все сообщения с `kind: "state"` без каких-либо других отличительных признаков считаются имеющими одинаковую идентичность. Эта идентичность может быть дополнительно уточнена другими протоколами, в частности [011: Агент/Инстансинг](./011_agent_instancing.md), который позволяет параллельную обработку путем создания различных контекстов.

> Sidenote: [011: Агент/Инстансинг](./011_agent_instancing.md)

Когда присутствует несколько объединяемых сообщений (например, несколько объектов `state`, представляющих патчи), система может обработать это двумя способами. Во-первых, цикл выполнения агента может явно объединить эти объекты в единый, целостный объект состояния перед тем, как представить его LLM. Это снижает когнитивную нагрузку на модель. Во-вторых, сама LLM может «мысленно объединить» информацию в своем скрытом пространстве, понимая, что отдельные сообщения представляют разные аспекты одного концепта.

## Композиция с другими протоколами

Протокол `Data` — это фундаментальный шаблон, который специализируется и расширяется несколькими другими протоколами более высокого уровня.

- **Loop:** Цикл выполнения полагается на сообщения `Data` для поддержания непрерывности. Сообщение `State`, специализированное сообщение `Data`, является основным средством для сохранения информации между тактами цикла.

  > Sidenote: [005: Агент/Цикл](./005_agent_loop.md)

- **Input:** Протокол `Input` использует сообщение `Data` для формального объявления параметров, которые принимает `Request`. Это механизм, который превращает статичную `Idea` в повторно используемый, подобный функции `Ideator`.

  > Sidenote: [007: Агент/Ввод](./007_agent_input.md)

- **State:** Протокол `State` использует сообщение `Data` для представления постоянной, развивающейся памяти рабочего процесса. `schema` сообщения определяет структуру объекта состояния, включая то, какие свойства и переменные доступны.

  > Sidenote: [010: Агент/Состояние](./010_agent_state.md)

- **Instancing:** Все сообщения `Data` подвержены `Instancing`. Свойство `_instance` действует как ключ, который ограничивает данные конкретным потоком выполнения в рамках более крупной пакетной операции. Сообщения `Data` с разными значениями `_instance` не будут объединяться, обеспечивая изоляцию данных между параллельными процессами.

  > Sidenote: [011: Агент/Инстансинг](./011_agent_instancing.md)

## От данных к практическому вводу

Протокол `Data` предоставляет универсальный контейнер для структурированной информации. Утвердив эту основу, мы можем теперь изучить его первое крупное применение: предоставление структурированных параметров для запроса. Это критический шаг, который превращает статический документ в динамический, исполняемый инструмент.

Следующий документ, **[007: Агент/Ввод](./007_agent_input.md)**, описывает, как этот шаблон используется для определения формального интерфейса ввода для `Idea`.
