# 006: Агент/Данные

> **Сообщение Данных:** Постоянное контекстное сообщение, содержащее значение `data` и необязательную `schema`. Оно сохраняется на протяжении всего цикла выполнения агента для обеспечения стабильного, структурированного контекста. — [Глоссарий](./000_glossary.md)

> Sidenote:
> - Требует:
>   - [001: Агент/Запрос](./001_agent_request.md)
> - Открывает возможности для:
>   - [007: Агент/Ввод](./007_agent_input.md)
>   - [010: Агент/Состояние](./010_agent_state.md)
> - Дополняется:
>   - [005: Агент/Цикл](./005_agent_loop.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)

Этот документ описывает **Протокол Данных** — низкоуровневый шаблон для предоставления структурированной, самоописываемой информации. Он служит фундаментальным механизмом, используемым другими подсистемами, такими как [Ввод](./007_agent_input.md) и [Состояние](./010_agent_state.md), для управления структурированными данными в `context` агента. В отличие от временных сообщений, сообщения `Data` являются постоянными и сохраняются между итерациями цикла выполнения агента, обеспечивая стабильный контекст для многоэтапных задач.

## Сообщение Данных

> Sidenote:
> - [001: Агент/Запрос](./001_agent_request.md)

Сообщение `Data` — это простая, но мощная конструкция для добавления структурированного контекста в [Запрос](./001_agent_request.md). Это объект сообщения, который содержит следующие свойства:

- **`data`**: Любое значение JSON (например, строка, число, объект, массив), которое содержит полезные данные.
- **`schema`**: Необязательная JSON Schema, которая определяет структуру и семантическое значение `data`.
- **`kind`**: Необязательная строка, которая идентифицирует роль сообщения (например, `"state"`, `"input"`). Это позволяет системе и LLM различать разные типы данных в одном и том же контексте.

Соединяя данные с необязательной схемой, сообщение `Data` делает контекст машиночитаемым. `schema` действует как чертёж, объясняя LLM, что означает каждое свойство, какой у него тип и какие существуют ограничения. Это не только направляет рассуждения LLM, но и служит формой документации, показывая пользователям, что можно изменить или настроить.

## Слияние и Идентичность

Протокол спроектирован для обработки нескольких сообщений `Data` в рамках одного `context`. Если система определяет, что несколько сообщений имеют одинаковую идентичность, они сливаются в один целостный объект. Это особенно полезно для сценариев, таких как применение серии обновлений состояния.

Идентичность сообщения в основном определяется его `kind`. Например, все сообщения с `kind: "state"` без других отличительных признаков считаются имеющими одинаковую идентичность. Эта идентичность может быть дополнительно уточнена другими протоколами, в первую очередь [011: Агент/Инстансинг](./011_agent_instancing.md), который позволяет параллельную обработку путем создания отдельных контекстов.

> Sidenote:
> - [011: Агент/Инстансинг](./011_agent_instancing.md)

При наличии нескольких сообщений, подлежащих слиянию (например, несколько объектов `state`, представляющих обновления), система может обработать это двумя способами. Во-первых, цикл выполнения агента может явно объединить эти объекты в один целостный объект состояния перед его представлением LLM. Это снижает когнитивную нагрузку на модель. Во-вторых, сама LLM может «мысленно объединить» информацию в своем скрытом пространстве, понимая, что отдельные сообщения представляют разные аспекты одной концепции.

## Композиция с Другими Протоколами

Протокол `Data` — это фундаментальный шаблон, который специализируется и расширяется несколькими другими протоколами более высокого уровня.

- **Цикл:** Цикл выполнения полагается на сообщения `Data` для поддержания непрерывности. Сообщение `State`, специализированное сообщение `Data`, является основным средством для сохранения информации между тактами цикла.

  > Sidenote:
  > - [005: Агент/Цикл](./005_agent_loop.md)

- **Состояние:** Протокол `State` использует сообщение `Data` для представления постоянной, развивающейся памяти рабочего процесса. `schema` сообщения определяет структуру объекта состояния, включая доступные свойства и переменные.

  > Sidenote:
  > - [010: Агент/Состояние](./010_agent_state.md)

- **Инстансинг:** Все сообщения `Data` подвержены `Инстансингу`. Свойство `_instance` действует как ключ, который ограничивает данные конкретным потоком выполнения в рамках более крупной пакетной операции. Сообщения `Data` с разными значениями `_instance` не будут сливаться, обеспечивая изоляцию данных между параллельными процессами.

  > Sidenote:
  > - [011: Агент/Инстансинг](./011_agent_instancing.md)

- **Ввод:** Протокол `Input` использует сообщение `Data` для формального объявления параметров, которые принимает `Request`. Это механизм, который превращает статический `Request` в переиспользуемый, подобный функции компонент.

  > Sidenote:
  > - [007: Агент/Ввод](./007_agent_input.md)

## От Данных к Действенным Вводам

Протокол `Data` предоставляет универсальный контейнер для структурированной информации. Утвердив эту основу, мы можем теперь исследовать его первое крупное применение: предоставление структурированных параметров для запроса. Это критический шаг, который превращает статический документ в динамический, исполняемый инструмент.

Следующий документ, **[007: Агент/Ввод](./007_agent_input.md)**, описывает, как этот шаблон используется для предоставления структурированной подсказки для `Request`.
