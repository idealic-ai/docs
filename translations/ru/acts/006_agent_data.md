# 006: Агент/Данные

> **Сообщение с данными:** Постоянное контекстное сообщение, содержащее значение `data` и необязательную `schema`. Оно сохраняется в цикле выполнения агента для обеспечения стабильного и структурированного контекста. — [Глоссарий](./000_glossary.md)

- Требует:
  - [001: Агент/Запрос](./001_agent_request.md)
- Включает:
  - [007: Агент/Ввод](./007_agent_input.md)
  - [010: Агент/Состояние](./010_agent_state.md)
- Дополняется:
  - [005: Агент/Цикл](./005_agent_loop.md)
  - [011: Агент/Инстансинг](./011_agent_instancing.md)

Этот документ описывает **Протокол Данных** — низкоуровневый паттерн для предоставления структурированной, самоописываемой информации. Он служит основополагающим механизмом, который используют другие подсистемы, такие как [Ввод](./007_agent_input.md) и [Состояние](./010_agent_state.md), для управления структурированными данными в `context` агента. В отличие от эфемерных сообщений, сообщения `Data` являются постоянными и сохраняются между итерациями цикла выполнения агента, обеспечивая стабильный контекст для многошаговых задач.

## Сообщение с данными

- [001: Агент/Запрос](./001_agent_request.md)

Сообщение `Data` — это простая, но мощная конструкция для добавления структурированного контекста в [Запрос](./001_agent_request.md). Это объект сообщения, содержащий следующие свойства:

- **`data`**: Любое значение JSON (например, строка, число, объект, массив), которое содержит полезную нагрузку.
- **`schema`**: Необязательная JSON Schema, которая определяет структуру и семантическое значение `data`.
- **`kind`**: Необязательная строка, которая определяет роль сообщения (например, `"state"`, `"input"`). Это позволяет системе и LLM различать разные типы данных в одном и том же контексте.

Сочетая данные с необязательной схемой, сообщение `Data` делает контекст машиночитаемым. `schema` действует как черновик, объясняя LLM, что означает каждое свойство, какой у него тип и какие применяются ограничения. Это не только направляет рассуждения LLM, но и служит формой документации, показывая пользователям, что можно изменить или настроить.

## Слияние и идентичность

Протокол разработан для обработки нескольких сообщений `Data` в рамках одного `context`. Если система определяет, что несколько сообщений имеют одинаковую идентичность, они сливаются в единый целостный объект. Это особенно полезно для сценариев вроде применения серии патчей состояния.

Идентичность сообщения в основном определяется его свойством `kind`. Например, все сообщения с `kind: "state"` без других отличительных признаков считаются имеющими одинаковую идентичность. Эта идентичность может быть уточнена другими протоколами, в первую очередь [011: Агент/Инстансинг](./011_agent_instancing.md), который позволяет осуществлять параллельную обработку, создавая отдельные контексты.

- [011: Агент/Инстансинг](./011_agent_instancing.md)

Когда присутствует несколько сообщений, подлежащих слиянию (например, несколько объектов `state`, представляющих собой патчи), система может обработать это двумя способами. Во-первых, цикл выполнения агента может явно объединить эти объекты в единый целостный объект состояния перед передачей его LLM. Это снижает когнитивную нагрузку на модель. Во-вторых, сама LLM может «мысленно объединить» информацию в своём скрытом пространстве, понимая, что отдельные сообщения представляют разные аспекты одной концепции.

## Композиция с другими протоколами

Протокол `Data` — это основополагающий паттерн, который специализируется и расширяется несколькими другими протоколами более высокого уровня.

- **Цикл:** Цикл выполнения полагается на сообщения `Data` для поддержания непрерывности. Сообщение `State`, являющееся специализированным сообщением `Data`, — это основной инструмент для сохранения информации между тактами цикла.

  - [005: Агент/Цикл](./005_agent_loop.md)

- **Состояние:** Протокол `State` использует сообщение `Data` для представления постоянной, развивающейся памяти рабочего процесса. `schema` сообщения определяет структуру объекта состояния, включая доступные свойства и переменные.

  - [010: Агент/Состояние](./010_agent_state.md)

- **Инстансинг:** Все сообщения `Data` подпадают под действие `Instancing`. Свойство `_instance` выступает в роли ключа, который ограничивает данные конкретным потоком выполнения в рамках более крупной пакетной операции. Сообщения `Data` с разными значениями `_instance` не будут сливаться, что обеспечивает изоляцию данных между параллельными процессами.

  - [011: Агент/Инстансинг](./011_agent_instancing.md)

- **Ввод:** Протокол `Input` использует сообщение `Data` для формального объявления параметров, которые принимает `Request`. Это механизм, который превращает статический `Request` в переиспользуемый, подобный функции компонент.

  - [007: Агент/Ввод](./007_agent_input.md)

## От данных к практическому вводу

Протокол `Data` предоставляет общий контейнер для структурированной информации. Теперь, когда эта основа заложена, мы можем изучить его первое основное применение: предоставление структурированных параметров для запроса. Это решающий шаг, который превращает статический документ в динамический, исполняемый инструмент.

Следующий документ, **[007: Агент/Ввод](./007_agent_input.md)**, описывает, как этот паттерн используется для предоставления структурированного промпта для `Request`.