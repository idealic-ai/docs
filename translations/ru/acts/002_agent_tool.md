# 002: Агент/Инструмент

> [!DEFINITION] [Инструмент](./000_glossary.md)
> Схема, определяющая возможность, которую может использовать агент. Она передается в LLM как часть запроса, выступая в роли структурированного интерфейса для потенциального действия. LLM активирует инструмент, создавая `Call` с определёнными параметрами, который затем выполняется либо скрыто самой LLM, либо явно через зарегистрированную функцию (`Действие`).

> Sidenote:
> - Требуется: [001: Агент/Запрос](./001_agent_request.md)
> - Дополняется: [003: Агент/Действие](./003_agent_activity.md)

`Tool` — это интерфейс на основе схемы, который определяет структурированную возможность для использования агентом. Он служит основополагающим элементом для всех действий агента, позволяя LLM понимать и выбирать из набора возможных поведений.

## Что такое Инструменты?

**Инструменты — это краеугольный камень** систем действий агента. Они открывают новую возможность: **выбор действия в контексте** — позволяя агентам выбирать и выполнять подходящие действия в зависимости от текущей ситуации.

Инструменты обеспечивают:

- **Структурированные интерфейсы**: Возможности, определённые в схеме, которые агенты могут обнаруживать и понимать.
- **Типобезопасность**: Чёткие контракты для входных и выходных данных.
- **Компонуемость**: Строительные блоки, которые объединяются в сложные модели поведения агента.
- **Интеграция с LLM**: Схемы, на основе которых языковые модели могут рассуждать и делать выбор.

Когда агент заполняет определённые параметры для Инструмента, он создаёт **Вызов (Call)** — экземпляр Инструмента со всеми необходимыми параметрами, который представляет собой конкретный запрос на выполнение.

> Sidenote: [004: Агент/Вызов](./004_agent_call.md)

## Когда использовать систему Инструментов

Используйте Систему Инструментов, когда вам нужно, чтобы агенты:

- **Динамически выбирали действия** в зависимости от контекста и ситуации.
- **Выбирали между несколькими возможностями** для достижения цели.
- **Выполняли различные реализации** одной и той же возможности (например, разные поисковые системы).
- **Сочетали рассуждения LLM с явной логикой** в процессе принятия решений.

## Архитектура системы Инструментов

### Основной принцип: Схема как Интерфейс

Система Инструментов построена на фундаментальном принципе: **Инструменты — это чистые схемы**, которые определяют интерфейсы, не предписывая их реализацию. Это разделение интерфейса и реализации является ключом к гибкости и компонуемости системы.

Схема `Tool` — это стандартный объект JSON Schema. Любое поле без префикса в виде нижнего подчеркивания считается параметром инструмента. Система использует специальные мета-поля (с префиксом `_`) для определения системных свойств, которые управляют идентификацией и выполнением инструмента.

Схема Инструмента полностью определяет его интерфейс:

> Sidenote: Расширения:
> - **`_activity`**: Связывает инструмент с детерминированной функцией для явного выполнения. ([003: Агент/Действие](./003_agent_activity.md))
> - **`_delegate`**: Делегирует выполнение инструмента изолированному внешнему исполнителю. ([012: Агент/Делегат](./012_agent_delegate.md))
> - **`_outputPath`**: Делает инструмент состоятельным (stateful), записывая его результат в постоянный объект состояния. ([009: Агент/Состояние](./009_agent_state.md))
> - **`_instance`**: Направляет выполнение инструмента на конкретный экземпляр в запросе с множественными экземплярами. ([011: Агент/Инстансинг](./011_agent_instancing.md))

- **`title`**: Человекочитаемое имя для схемы (необязательно).
- **`description`**: Объясняет, что делает инструмент.
- **`parameters`**: Любые поля без нижнего подчеркивания определяют входные данные, необходимые инструменту.
- **`_tool`**: Предоставляет уникальное имя для идентификации инструмента.
- **`_output`**: Определяет ожидаемую структуру результата работы инструмента.
- **`_reasoningForCall`**: Поле, добавляемое системой, чтобы агент объяснил, почему он выбрал этот инструмент.

Протоколы более высокого уровня строят оркестрацию рабочих процессов, управление состоянием и политики выполнения поверх этих примитивов.

## Определение Инструмента

Инструменты определяются как JSON-схемы. Пример ниже показывает `Tool` для анализа тональности. Этот `Tool` предназначен для скрытого выполнения, так как он полагается на встроенное в LLM понимание языка и не требует внешней функции.

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует тональность текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

## Композиция и выполнение схем

Хотя отдельные Инструменты определяют дискретные возможности, их настоящая сила раскрывается при их композиции. Система представляет все доступные схемы `Tool` для LLM в рамках одного запроса, обычно в виде массива. Это позволяет LLM выбрать наиболее подходящий `Tool` для конкретной ситуации и предоставить необходимые параметры. Получившийся в результате использования инструмента экземпляр — это объект под названием `Call`.

> Sidenote: [004: Агент/Вызов](./004_agent_call.md).

## Скрытое и явное выполнение

Схема `Tool` сама по себе является лишь интерфейсом. Её выполнение может происходить двумя способами. По умолчанию используется **скрытое выполнение**, при котором LLM использует свои внутренние рассуждения для генерации результата, что идеально подходит для задач, связанных с языком или знаниями. Для действий, требующих взаимодействия с внешним миром, — таких как вызов API или доступ к базе данных — `Tool` должен быть связан с детерминированной функцией. Эта явная реализация называется **Действием (Activity)**.

Разделение интерфейса `Tool` от реализации `Действия` является ключевым принципом дизайна. Это позволяет определять возможности агента и рассуждать о них абстрактно, в то время как логику их выполнения можно заменять или обновлять независимо. Следующий документ, **[003: Агент/Действие](./003_agent_activity.md)**, описывает, как `Действия` предоставляют конкретную логику для `Инструментов`.

> Sidenote: [003: Агент/Действие](./003_agent_activity.md).