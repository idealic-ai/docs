# 002: Агент/Инструмент

> **Инструмент**: Схема, определяющая возможность, которую может использовать агент. Она предоставляется LLM как часть запроса и служит структурированным интерфейсом для потенциального действия. LLM активирует инструмент, создавая `Вызов` с конкретными параметрами, который затем выполняется либо скрыто самой LLM, либо явно с помощью зарегистрированной функции кода (`Действие`). — [Глоссарий](./000_glossary.md)

> Sidenote: Требуется: [001: Агент/Запрос](./001_agent_request.md)
> Дополняется: [003: Агент/Действие](./003_agent_activity.md)

`Инструмент` — это интерфейс на основе схемы, который определяет структурированную возможность для использования агентом. Он служит основным строительным блоком для всех действий агента, позволяя LLM понимать и выбирать из списка возможных вариантов поведения.

## Что такое Инструменты?

**Инструменты — это основа** систем действий агентов. Они открывают новый тип возможностей: **выбор действия в контексте** — позволяя агентам выбирать и выполнять подходящие действия в зависимости от текущей ситуации.

Инструменты предоставляют:

- **Структурированные интерфейсы**: Возможности, определённые схемой, которые агенты могут обнаруживать и понимать
- **Типобезопасность**: Чёткие контракты для входных и выходных данных
- **Компонуемость**: Строительные блоки, которые объединяются в сложное поведение агента
- **Интеграция с LLM**: Схемы, которые языковые модели могут анализировать и выбирать

Когда агент заполняет определённые параметры для Инструмента, он создаёт **Вызов** — экземпляр Инструмента со всеми заполненными параметрами, представляющий собой конкретный запрос на выполнение.

> Sidenote: [004: Агент/Вызов](./004_agent_call.md)

## Когда использовать систему Инструментов

Используйте систему Инструментов, когда вашим агентам нужно:

- **Динамически выбирать действия** в зависимости от контекста и ситуации
- **Выбирать между несколькими возможностями** для достижения цели
- **Выполнять различные реализации** одной и той же возможности (например, разные поисковые системы)
- **Совмещать логику LLM с явной логикой** в процессе принятия решений

## Архитектура системы Инструментов

### Основной принцип: Схема как интерфейс

Система Инструментов построена на фундаментальном принципе: **Инструменты — это чистые схемы**, которые определяют интерфейсы, не требуя конкретных реализаций. Такое разделение интерфейса и реализации является ключом к гибкости и компонуемости системы.

Схема `Инструмента` — это стандартный объект JSON Schema. Любое поле без префикса в виде нижнего подчёркивания считается параметром инструмента. Система использует специальные мета-поля (с префиксом `_`) для определения системных свойств, которые управляют идентификацией и выполнением инструмента.

Схема Инструмента определяет его полный интерфейс:

> Sidenote: Расширения:
> 
> - **`_activity`**: Связывает инструмент с детерминированной функцией кода для явного выполнения. ([003: Агент/Действие](./003_agent_activity.md))
> - **`_module`**: Делегирует выполнение инструмента изолированному внешнему модулю. ([009: Агент/Модуль](./009_agent_module.md))
> - **`_outputPath`**: Делает инструмент отслеживающим состояние, записывая его вывод в постоянный объект состояния. ([010: Агент/Состояние](./010_agent_state.md))
> - **`_instance`**: Направляет выполнение инструмента на конкретный экземпляр в запросе с несколькими экземплярами. ([011: Агент/Инстансинг](./011_agent_instancing.md))

- **`title`**: Человекочитаемое имя для схемы (необязательно).
- **`description`**: Объясняет, что делает инструмент.
- **`parameters`**: Любые поля без нижнего подчёркивания определяют входные данные, необходимые инструменту.
- **`_tool`**: Предоставляет уникальное имя для идентификации инструмента.
- **`_output`**: Определяет ожидаемую структуру результата работы инструмента.
- **`_reasoningForCall`**: Поле, добавляемое системой, чтобы агент объяснил, почему он выбрал этот инструмент.

Протоколы более высокого уровня строят оркестрацию рабочих процессов, управление состоянием и политики выполнения поверх этих примитивов.

## Определение Инструмента

Инструменты определяются как JSON-схемы. Пример ниже показывает `Инструмент` для анализа тональности текста. Этот `Инструмент` предназначен для скрытого выполнения, поскольку он опирается на встроенное понимание языка LLM и не требует внешней функции.

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует тональность текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

## Композиция и выполнение схем

Хотя отдельные Инструменты определяют дискретные возможности, их истинная сила раскрывается при их композиции. Система предоставляет все доступные схемы `Инструментов` для LLM в рамках одного запроса, обычно в виде массива. Это позволяет LLM выбрать наиболее подходящий `Инструмент` для конкретной ситуации и предоставить необходимые параметры. Результирующий экземпляр использования инструмента — это объект под названием `Вызов`.

> Sidenote: [004: Агент/Вызов](./004_agent_call.md).

## Скрытое и явное выполнение

Схема `Инструмента` сама по себе является лишь интерфейсом. Её выполнение может происходить двумя способами. По умолчанию используется **скрытое выполнение**, при котором LLM использует свои внутренние рассуждения для генерации вывода, что идеально подходит для языковых или основанных на знаниях задач. Для действий, требующих взаимодействия с внешним миром — например, вызова API или доступа к базе данных — `Инструмент` должен быть связан с детерминированной функцией кода. Такая явная реализация называется **Действие**.

Разделение интерфейса `Инструмента` от реализации `Действия` является ключевым принципом дизайна. Это позволяет определять и анализировать возможности агента абстрактно, в то время как логику выполнения можно заменять или обновлять независимо. Следующий документ, **[003: Агент/Действие](./003_agent_activity.md)**, описывает, как `Действия` предоставляют конкретную логику для `Инструментов`.

> Sidenote: - [003: Агент/Действие](./003_agent_activity.md).