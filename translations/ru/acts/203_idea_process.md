# 203: Идея/Процесс

> **Идея Процесса:** Самодостаточная [Идея](./101_concept_idea.md), которая содержит стратегический [План](./013_agent_plan.md) и его текущее состояние выполнения. Её `schema` — это библиотека [Инструментов](./002_agent_tool.md), её `solution` — это _новый_ `Plan` для текущего такта, а её `context` содержит `Input`, `State` и предыдущий `Plan`.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требует:
>   - [101: Концепция/Идея](./101_concept_idea.md)
>   - [013: Agent/План](./013_agent_plan.md)
>   - [010: Агент/Состояние](./010_agent_state.md)
>   - [007: Агент/Ввод](./007_agent_input.md)
> - Дополняется:
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)

В то время как [202: Идея/Носитель](./202_idea_vessel.md) фиксирует одно реактивное решение, **Идея Процесса** воплощает проактивный и стратегический рабочий процесс. Это артефакт, создаваемый системой [013: Agent/План](./013_agent_plan.md) в ходе выполнения сложной, многоэтапной задачи. Это делает её полной записью как возможностей, доступных процессу, так и конкретной стратегии, выбранной агентом.

## Анатомия Плана

`Идея Процесса` использует триаду `Idea` для создания полного среза рабочего процесса. Этот срез содержит не только выбранную агентом стратегию (`Plan`), но и полную библиотеку возможностей, а также текущее состояние выполнения.

- **`schema` (Палитра):** Определяет библиотеку всех доступных [Инструментов](./002_agent_tool.md), из которых может быть построен `Plan`. Она представляет собой полный набор возможностей агента.

- **`context` (Ситуационная Осведомленность):** Содержит всю информацию, необходимую агенту для планирования и выполнения текущего такта.
  - **Входное Сообщение:** Первоначальный стимул, запустивший весь процесс. Обычно предоставляется один раз и остается неизменным.

    > Sidenote:
    >
    > - [007: Агент/Ввод](./007_agent_input.md)

  - **Сообщение Состояния:** Актуальные, изменяющиеся данные рабочего процесса. Оно содержит сохраненные локальные переменные, которые образуют связи (ребра) между `Calls` в `Plan`.

    > Sidenote:
    >
    > - [010: Агент/Состояние](./010_agent_state.md)

  - **Cообщение Плана:** Это сообщение содержит _утвержденный_ план с предыдущего такта, которому агент может следовать или который может скорректировать.

    > Sidenote:
    >
    > - [013: Agent/План](./013_agent_plan.md)

- **`solution` (Новый План):** Направленный ациклический граф из `Calls`, представляющий собой выбранную агентом стратегию на _текущий_ такт. Он становится `Сообщением Плана` для следующего такта.

### Единство Планирования и Выполнения

Ключевой принцип этой архитектуры — слияние планирования и выполнения в единый, унифицированный процесс. В отличие от традиционных систем, где эти фазы разделены, здесь они происходят одновременно в рамках каждого такта. Агент не просто создает статичный план, а затем отдельно выполняет его; сам акт генерации следующего `solution` (нового `Plan`) _является_ шагом выполнения для текущего такта.

Именно это единство делает систему такой динамичной и эффективной. `Plan` — это живой граф, которому не обязательно быть завершенным, чтобы быть полезным. Он может быть частичным, работать с результатами предыдущего такта и адаптироваться на лету. `Calls`, генерируемые LLM, представляют собой как структуру конвейера, так и сообщения, проходящие внутри него. Эта двойственность позволяет одному запросу к LLM одновременно проверять текущее состояние, корректировать план на основе новых данных и выполнять следующий логический шаг. Нет затратных накладных расходов на отдельные вызовы для перепланирования или проверки; выполнение — это _и есть_ проверка, планирование и корректировка, происходящие одновременно.

> Sidenote:
>
> - [004: Агент/Вызов](./004_agent_call.md)

Эта единая модель дает два мощных преимущества. Во-первых, `Plan` можно создать и симулировать на основе одних лишь его схем, еще до появления конкретных данных. LLM может «отыгрывать» поведение каждого шага, что позволяет проектировать и проверять сложные рабочие процессы с самого начала. Во-вторых, LLM выступает в роли интеллектуального адаптера между шагами. Если выходные данные одного `Call` не полностью соответствуют ожидаемым входным данным следующего, LLM может устранить этот разрыв, обеспечивая исключительную стабильность по мере развития системы. Такая устойчивость предотвращает каскадные сбои, характерные для традиционных систем с жесткими связями.

> Sidenote:
>
> - [105: Концепция/ИИ-центричность](./105_concept_ai_native.md)

### Спектр Гибкости Плана

Объект `State` обеспечивает мощный трехэтапный жизненный цикл для `Plan`, позволяя ему развиваться от гибкого процесса обнаружения до предсказуемого, детерминированного рабочего процесса:

> Sidenote:
>
> - [010: Агент/Состояние](./010_agent_state.md)

1.  **План Свободной Формы:** Изначально `State` можно определить без `schema`. Это дает агенту максимальную свободу для обнаружения `Plan` путем создания новых связей (свойств в объекте `State`) на лету.

2.  **Определенные Связи:** Следующий шаг в "закалке" `Plan` — зафиксировать `schema` для `State`, что определяет основные пути передачи данных. Это можно сделать в спектре от более гибкого к менее гибкому:
    - **Открытые Связи:** Схема может разрешать `additionalProperties`, что обеспечивает соблюдение основных путей данных, но при этом дает агенту свободу создавать новые связи для второстепенных или исключительных случаев.
    - **Закрытые Связи:** Схема может установить `additionalProperties` в `false`, создавая жесткую структуру, которой агент должен точно следовать.

3.  **Завершенный План:** Это финальная стадия, на которой план считается полностью зрелым и предсказуемым. `Завершенный План` становится **Утвержденным Планом**, который передается как `Сообщение Плана` в `context` для последующих тактов. Завершенный план может существовать в двух формах стабильности:
    - **Оптимистичный План:** Завершенный план, охватывающий идеальный случай. Он обеспечивает высокоэффективный путь, но все еще может потребовать корректировки при возникновении непредвиденных событий.
    - **Полный План:** Полностью завершенный план, который со временем был расширен для учета распространенных сбоев, альтернатив и других сценариев, что делает его высоко детерминированным.

Такая последовательность позволяет `Идее Процесса` эволюционировать от гибкого проекта до высоконадежного и многократно используемого актива.

## Неизменяемые Рабочие Процессы: Оркестрация, Анализ и Масштабирование

Сила `Идеи Процесса` заключается в её неизменяемости. Каждый шаг рабочего процесса создает новый, полный срез `Plan` и `State`, сохраняя идеальную, проверяемую историю. Этот ключевой принцип создания цепочки неизменяемых артефактов обеспечивает самые продвинутые возможности системы для оркестрации, анализа и масштабирования.

- **Надежное, Адаптивное Выполнение:** Цикл выполнения, основанный на "тактах", фундаментально надежен, поскольку каждый новый такт работает с полным срезом предыдущего состояния. Эта атомарность предотвращает состояния гонки и гарантирует, что решение агента следовать `Plan` или корректировать его основано на последовательном и предсказуемом представлении мира. Результатом каждого такта является новая `Идея Процесса`, безопасно продвигающая рабочий процесс на один шаг вперед.

  > Sidenote:
  >
  > - [005: Агент/Цикл](./005_agent_loop.md)
  > - [013: Agent/План](./013_agent_plan.md)

- **Устойчивая Оркестрация:** `Идея Процесса` — это самодостаточный артефакт, что делает оркестрацию невероятно надежной. Рабочий процесс можно приостановить, просто сохранив его последний срез. Внешние системы или люди-супервизоры могут затем изучить это "замороженное" состояние для принятия решений. Любые корректировки, такие как перепланирование или изменение состояния, приводят к созданию _новой_ `Идеи Процесса`, которую затем можно использовать для безопасного возобновления рабочего процесса без изменения исторической записи.

  > Sidenote:
  >
  > - [010: Агент/Состояние](./010_agent_state.md)

- **Высокоточное Моделирование:** Эта архитектура является предпосылкой для интерактивного "путешествия во времени". Каждая историческая `Идея Процесса` — это идеальный, высокоточный срез рабочего процесса в определенный момент. Это позволяет пользователям или другим агентам загружать любую точку в истории процесса для проведения аудита, отладки сложного поведения или запуска сценариев "что, если" путем ветвления процесса с этой точки.

  > Sidenote:
  >
  > - [202: Идея/Носитель](./202_idea_vessel.md)

- **Последовательная Параллельная Обработка:** Архитектура на основе срезов достигает масштабного развертывания с помощью протокола Инстансинга. Этот паттерн рассматривает каждую задачу в пакете как независимый поток выполнения, каждый со своим изолированным срезом `State`. Единый `Plan` действует как стратегический шаблон, применяемый ко всем потокам одновременно. За один атомарный такт агент выполняет параллельное планирование для всего пакета, генерируя согласованный набор `Calls`, адаптированный для каждого экземпляра. Это гарантирует последовательный результат для разнообразных задач при значительном повышении эффективности.

  > Sidenote:
  >
  > - [011: Агент/Инстансинг](./011_agent_instancing.md)

## От Предсказуемого Плана к Управляемому Выполнению

`Идея Процесса` может созреть до **Завершенного Плана** — высокопредсказуемого и надежного рабочего процесса. Хотя эта жесткость обеспечивает стабильность, она также может ограничивать гибкость. Системе нужен способ внедрить тонкое, контекстно-зависимое руководство, не нарушая целостности установленного плана.

Эту роль выполняет **[Идея Инструкции](./204_idea_instruction.md)**. `Инструкция` — это структурированный рецепт действий, который предоставляет более высокий уровень стратегического руководства. Она действует как "мыслительный чек-лист" или набор принципов, влияющих на рабочий процесс на двух уровнях: направляя агента при выборе или генерации наиболее подходящего `Plan` для данного контекста, и предоставляя целенаправленное руководство для отдельных выборов и шагов рассуждения во время выполнения этого `Plan`. По сути, `Инструкция` улучшает _логику_ и _рассуждения_ рабочего процесса, обеспечивая соответствие как общей стратегии, так и тактического выполнения желаемой методологии.

> Sidenote:
>
> - [204: Идея/Инструкция](./204_idea_instruction.md)
