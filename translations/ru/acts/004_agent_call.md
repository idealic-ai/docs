# 004: Агент/Вызов

> **Вызов:** Конкретный, исполняемый экземпляр `Инструмента` с заданными значениями для его `params`. Это запрос, ориентированный на вызов того, что _должно быть сделано_.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote: Требует: [002: Агент/Инструмент](./002_agent_tool.md). Позволяет создавать: [103: Концепция/Идеатор](./103_concept_ideator.md), [008: Агент/Импорты](./008_agent_imports.md), [011: Агент/Инстансинг](./011_agent_instancing.md), [202: Идея/Носитель](./202_idea_vessel.md), [203: Идея/Процесс](./203_idea_process.md). Расширяется: [009: Агент/Модуль](./009_agent_module.md).

[002: Агент/Инструмент](./002_agent_tool.md) устанавливает базовый интерфейс на основе схем, который позволяет агентам понимать структурированные возможности. Этот документ описывает протокол **004: Агент/Вызов**, который основан на Инструментах и определяет, как происходит исполнение.

**Вызов** — это конкретный экземпляр Инструмента с заданными значениями параметров, готовый к исполнению. Если Инструменты определяют, _что можно сделать_, то Вызовы определяют, _как это исполняется_.

> [!TIP]
> [001: Агент/Запрос](./001_agent_request.md), который приводит к набору `Вызовов`, является [202: Идея/Носитель](./202_idea_vessel.md). `Носитель` представляет собой единичный, реактивный момент принятия решения, когда агент выбирает из доступных `Инструментов` для формирования ответа.

## Композиция и Контекст

`Вызов` сам по себе является простой структурой данных. Его сила заключается в композиции с другими протоколами, которые управляют его средой исполнения. Эти протоколы активируются специальными мета-свойствами (с префиксом `_`) в схеме `Инструмента`, позволяя одному объекту `Вызова` запускать разнообразные сценарии исполнения.

Придавая этим мета-свойствам ясное семантическое значение, мы делаем LLM активным участником композиции. Модель может анализировать различные комбинации этих свойств для создания сложных и новых цепочек исполнения, переходя от простого выбора инструментов к динамической организации рабочих процессов.

- **Явное Исполнение (`_activity`)**: Самое базовое расширение — это связывание `Вызова` с детерминированной функцией кода. Свойство `_activity` указывает, что `Вызов` должен быть исполнен **Действием**, а не через скрытое рассуждение LLM.

  > Sidenote: [003: Агент/Действие](./003_agent_activity.md).

- **Делегированное Исполнение (`_module`)**: `Вызов` может быть делегирован внешнему **Модулю**. Свойство `_module` обычно содержит ссылку на сохраненный [001: Агент/Запрос](./001_agent_request.md) (часто в виде пути к JSON-файлу), что позволяет вызывать этот запрос как многоразовый инструмент. Это обеспечивает изолированную "чистую комнату" для исполнения, предотвращая смешивание контекста и обеспечивая настоящую инкапсуляцию.

  > Sidenote: [009: Агент/Модуль](./009_agent_module.md).

- **Передача Контекста (`_imports`)**: Протокол **Импортов** контролирует, какой контекст доступен `Вызову`. Его основная задача — сфокусировать внимание LLM во время скрытого исполнения, указывая, какие части родительского контекста следует учитывать. Это предотвращает смешивание контекста и ведет к более надежным результатам. При использовании с `_module` его роль становится еще более значимой: он строго определяет _весь_ контекст для изолированного исполнения модуля.

  > Sidenote: [008: Агент/Импорты](./008_agent_imports.md).

- **Исполнение с Состоянием (`_outputPath`)**: `Вызов` можно сделать состоятельным, указав, куда записывать его результат. Свойство `_outputPath` определяет путь внутри постоянного **Объекта Состояния**, куда должен быть сохранен результат `Вызова`. Это позволяет создавать многоэтапные рабочие процессы, где результат одного `Вызова` может использоваться как входные данные для другого.

  > Sidenote: [010: Агент/Состояние](./010_agent_state.md).

- **Исполнение по Инстансам (`_instance`)**: `Вызов` может быть нацелен на конкретный **Инстанс** в рамках запроса с несколькими инстансами. Свойство `_instance` действует как уникальный идентификатор, фокусируя все операции этого `Вызова` (например, чтение входных данных и запись результатов в **Объект Состояния**) на определенном контексте. Это позволяет эффективно и параллельно обрабатывать несколько состояний с помощью одного и того же набора инструментов.
  > Sidenote: [011: Агент/Инстансинг](./011_agent_instancing.md).

## Паттерны Исполнения Вызовов

Когда агент генерирует несколько Вызовов, можно применять различные стратегии исполнения в зависимости от потребностей приложения:

```typescript
// Исполнение одного Вызова
const result = await Tool(call);

// Исполнить все Вызовы, дождаться всех результатов
const results = await Tool.all(calls);

// Исполнить все Вызовы, вернуть первый успешный результат
const result = await Tool.any(calls);

// Исполнить все Вызовы, вернуть первый завершенный (успешно или с ошибкой)
const result = await Tool.race(calls);
```

Эти паттерны обеспечивают:

- **Точный Контроль**: Обрабатывайте Вызовы по отдельности с собственной логикой между исполнениями
- **Пакетная Обработка**: Исполняйте независимые Вызовы параллельно для максимальной производительности
- **Стратегии Быстрого Завершения**: Останавливайтесь при первом успехе (`.any()`) или первом завершении (`.race()`)
- **Операции "Все или Ничего"**: Убедитесь, что все Вызовы выполняются успешно вместе (`.all()`), сохраняя согласованность для логически сгруппированных Вызовов

## Организация Вызовов в Цикле

Хотя эти паттерны управляют исполнением одной пачки `Вызовов`, агентам часто необходимо выполнять многоэтапные задачи, где результат одного `Вызова` влияет на следующий. Это решается с помощью протокола более высокого уровня, который организует `Запросы` и `Вызовы` в последовательность.

Следующий документ, [005: Агент/Цикл](./005_agent_loop.md), подробно описывает этот цикл исполнения.