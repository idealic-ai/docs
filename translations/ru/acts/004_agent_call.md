# 004: Агент/Вызов

> [!DEFINITION] [Вызов](./000_glossary.md)
> Конкретный, исполняемый :term[экземпляр]{canonical="Instance"} :term[Инструмента]{canonical="Tool"} с определёнными значениями для его `params`. Это ориентированный на вызов запрос о том, что _должно быть сделано_.

> Sidenote:
> - Требует:
>   - [002: Агент/Инструмент](./002_agent_tool.md)
> - Позволяет:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
>   - [014: Агент/Области Видимости](./015_agent_scopes.md)
>   - [012: Агент/Экземплирование](./013_agent_instancing.md)
>   - [202: Идея/Носитель](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)
> - Расширяется:
>   - [013: Агент/Делегат](./014_agent_delegate.md)

Протокол :term[Инструмент]{canonical="Tool"} устанавливает базовый, основанный на схемах интерфейс, который позволяет агентам понимать структурированные возможности, а протокол **:term[Вызов]{canonical="Call"}** основывается на :term[Инструментах]{canonical="Tool"}, чтобы определить, как происходит выполнение.

:term[Вызов]{canonical="Call"} — это конкретный :term[экземпляр]{canonical="Instance"} :term[Инструмента]{canonical="Tool"} с определенными значениями параметров, готовый к выполнению. Если :term[Инструменты]{canonical="Tool"} определяют, _что можно сделать_, то :term[Вызовы]{canonical="Call"} определяют, _как это будет выполнено_.

> [!HEADSUP] На заметку
> :term[Запрос]{href="./001_agent_request.md", canonical="Request"}, который приводит к набору :term[Вызовов]{canonical="Call"}, является :term[Носителем]{href="./202_idea_vessel.md", canonical="Vessel"}. :term[Носитель]{canonical="Vessel"} представляет собой единый, реактивный момент принятия решения, когда агент выбирает из доступных :term[Инструментов]{canonical="Tool"} для формирования ответа.
>
> > Sidenote:
> >
> > - [001: Агент/Запрос](./001_agent_request.md)
> > - [202: Идея/Носитель](./202_idea_vessel.md)

## Результаты Вызовов и Итоговый Вывод

> [!DEFINITION] [Итоговый Вывод](./000_glossary.md)
> Конечное поле `output` в объекте :term[Решения]{canonical="Solution"}, которое соответствует целевой схеме всего цикла выполнения агента. Оно генерируется только тогда, когда агент определяет, что его задача завершена.

Когда делается :term[Запрос]{canonical="Request"}, цель — получить **:term[Итоговый Вывод]{canonical="Final Output"}**. LLM анализирует доступный контекст и принимает решение:

- Если контекст содержит достаточно информации, она генерирует :term[Итоговый Вывод]{canonical="Final Output"} напрямую, завершая процесс.
- Если контекст недостаточен, LLM определяет, что требуется больше информации. Она обнуляет `output` и вместо этого генерирует набор :term[Вызовов]{canonical="Call"} для сбора недостающих :term[данных]{canonical="Data"}.

После выполнения этих :term[Вызовов]{canonical="Call"}, их результаты добавляются в контекст. Затем создается новый :term[Запрос]{canonical="Request"} с этим обогащенным контекстом, что дает LLM еще одну возможность создать :term[Итоговый Вывод]{canonical="Final Output"}. Этот итеративный цикл запросов и вызовов продолжается до тех пор, пока цель не будет достигнута.

> Sidenote:
> - [010: Агент/Цикл](./010_agent_loop.md)

Это четкое разделение между промежуточными результатами (обрабатываемыми через :term[Путь Вывода]{canonical="Output Path"}) и конечным, ориентированным на цель выводом, позволяет создавать сложных, многошаговых агентов.

## Взаимодействие с другими системами

:term[Вызов]{canonical="Call"} сам по себе является простой структурой :term[данных]{canonical="Data"}. Его сила заключается в композиции с другими протоколами, которые управляют его средой выполнения. Эти протоколы активируются специальными мета-свойствами (с префиксом `_`) в схеме :term[Инструмента]{canonical="Tool"}, что позволяет одному объекту :term[Вызова]{canonical="Call"} запускать различные варианты поведения при выполнении.

Придавая этим мета-свойствам ясное семантическое значение, мы позволяем LLM быть активным участником композиции. Она может рассуждать о различных перестановках этих свойств для создания сложных и новых цепочек выполнения, выходя за рамки простого выбора инструментов к динамической оркестровке рабочих процессов. Это взаимодействие между :term[Вызовами]{canonical="Call"} и различными протоколами выполнения является основой способности агента выполнять сложные, многошаговые задачи.

> [!TIP]
> Следующий раздел объясняет связи с другими частями системы, которые будут подробно описаны позже. Не нужно забегать вперед, так как мы рассмотрим все в логической последовательности. Вы сможете вернуться к этому разделу позже.

- **Явное Выполнение (`_activity`)**: Самое фундаментальное расширение — это связывание :term[Вызова]{canonical="Call"} с детерминированной функцией кода. Свойство `_activity` сигнализирует, что :term[Вызов]{canonical="Call"} должен быть выполнен :term[Активностью]{canonical="Activity"}, а не через :term[скрытые рассуждения]{canonical="Latent"} LLM.

  > Sidenote:
  > - [003: Агент/Активность](./003_agent_activity.md).

- **Делегированное Выполнение (`_delegate`)**: :term[Вызов]{canonical="Call"} может быть делегирован внешнему :term[Делегату]{canonical="Delegate"}. Свойство `_delegate` обычно содержит ссылку на сохраненный :term[Запрос]{canonical="Request"} (часто в виде пути к JSON-файлу), что позволяет вызывать этот запрос как многоразовый инструмент. Это обеспечивает изолированную «чистую комнату» для выполнения, предотвращая смешивание контекстов и обеспечивая настоящую инкапсуляцию.

  > Sidenote:
  > - [013: Агент/Делегат](./014_agent_delegate.md).

- **Соединение Контекстов (`_scopes`)**: Протокол :term[Областей Видимости]{canonical="Scope"} контролирует, какой контекст доступен :term[Вызову]{canonical="Call"}. Его основное использование — фокусировка внимания LLM во время :term[скрытого исполнения]{canonical="Latent"}, указывая, какие части родительского контекста следует учитывать. Это предотвращает смешивание контекстов и приводит к более надежным результатам. При использовании с `_delegate` его роль становится еще более мощной: он строго определяет _весь_ контекст для изолированного выполнения делегата.

  > Sidenote:
  > - [014: Агент/Области Видимости](./015_agent_scopes.md).

- **Выполнение с Сохранением Состояния (`_outputPath`)**: :term[Вызов]{canonical="Call"} можно сделать сохраняющим :term[состояние]{canonical="State"}, указав ему, куда записывать результат. Свойство :term[Путь Вывода]{canonical="Output Path"} указывает путь в постоянном :term[Состоянии]{canonical="State"}, где должен храниться результат :term[Вызова]{canonical="Call"}. Это позволяет создавать многошаговые рабочие процессы, где вывод одного :term[Вызова]{canonical="Call"} может использоваться как вход для другого.

  > Sidenote:
  > - [009: Агент/Состояние](./009_agent_state.md).
  > - [008: Агент/Вывод](./008_agent_output.md).

- **:term[Экземплированное]{canonical="Instancing"} Выполнение (`_instance`)**: :term[Вызов]{canonical="Call"} может быть направлен на обработку определенного элемента в пакетном процессе, что позволяет одному запросу управлять несколькими контекстами :term[данных]{canonical="Data"} параллельно. Свойство `_instance` действует как уникальный идентификатор, фокусируя все операции этого :term[Вызова]{canonical="Call"} (например, чтение входных :term[данных]{canonical="Data"} и запись выходных в :term[Состояние]{canonical="State"}) на определенном контексте. Это обеспечивает эффективную параллельную обработку нескольких :term[состояний]{canonical="State"} с использованием одного и того же набора инструментов.
  > Sidenote:
  > - [012: Агент/Экземплирование](./013_agent_instancing.md).

## От Действий к Данным

Хотя :term[Вызовы]{canonical="Call"} определяют, что делает агент, они являются лишь половиной уравнения. Другая половина — это структурированные :term[данные]{canonical="Data"}, которые поступают в них и выходят из них. :term[Вызову]{canonical="Call"} для работы нужны структурированные :term[данные]{canonical="Data"}, а его результаты должны храниться в структурированном виде для использования следующим :term[Вызовом]{canonical="Call"}. 

Следующий документ, :term[005: Агент/Данные]{href="./005_agent_data.md", canonical="Agent/Data"}, описывает основополагающий протокол для структурирования и управления этими :term[данными]{canonical="Data"} в контексте агента.
