# 303: Ideator/Reactor

> **Reactor:** Это особый `Idea Transformer`, разработанный как универсальная среда выполнения для пошаговых взаимодействий агентов с сохранением состояния. Он принимает состояние игры/процесса (`Idea`) и создаёт следующее состояние (`Idea`).
> 
> — [Глоссарий](./000_glossary.md)

Этот документ описывает концепцию преобразования существующей среды выполнения для покера в **«The Reactor»** — универсальную и расширяемую систему управления контекстом для агентов, работающих в реальном времени. Это развитие превращает нашу мощную систему воркфлоу на базе Temporal из узкоспециализированного приложения в протокол. Этот протокол позволит умным, автономным агентам взаимодействовать с любой пошаговой средой, будь то игра с нулевой суммой, совместная симуляция или сложный бизнес-процесс. Reactor станет первым «движком-реактором» для нашей более широкой сети идей.

## От покера к протоколу

Наша текущая среда выполнения — успешный проект. Она использует воркфлоу Temporal для управления сложным микромиром покерных ботов, которые играют, вычисляют и реагируют в среде казино. Мы также разработали API для абстрактного игрового движка, чтобы отделить игровую логику от среды выполнения. Наш покерный движок — это первая реализация этого API, которая закладывает основу для будущего, где различные игровые движки можно будет легко подключать и отключать.

Однако обмен данными внутри нашей системы всё ещё жёстко привязан к формату одной конкретной игры (Poker Hand History Format). Чтобы по-настоящему раскрыть потенциал системы, нам нужно преодолеть это ограничение.

В основе этого изменения лежит внедрение **«триплета идей» (Idea Triplet)** как фундаментальной единицы обмена данными. Вместо отправки простого объекта с состоянием игры, каждое сообщение в системе будет представлять собой самодостаточный триплет:

1.  **Schema:** JSON-схема, которая даёт универсальное семантическое определение состояния игры. Она не только делает данные самоописываемыми, но и содержит достаточно информации для определения следующего допустимого действия или перехода состояния.
2.  **Context:** Дополнительная информация, такая как правила игры, инструкции для бота или исторические данные, которая помогает интерпретировать решение.
3.  **Solution:** Фактическое состояние игры, соответствующее схеме.

Вместе `Schema` и `Solution` образуют полный, самодостаточный снимок состояния игры. Сам по себе `Solution` — это неоднозначное представление игры, просто данные. `Schema` предоставляет критически важный контекст, определяя терминологию, структуру и правила. Этого достаточно, чтобы понять, что можно добавить в игровую нотацию и как может отреагировать другой игрок, что позволяет определить следующий допустимый ход. Это означает, что любой компонент может понять не только текущее состояние, но и ближайшие возможности, не имея предварительных знаний о реализации игры. Ключевое техническое решение, поддерживающее это, заключается в том, что триплет будет единственной единицей данных, передаваемой по критическому пути всех воркфлоу; мы отказываемся от передачи частичных состояний.

Это делает `Idea` настоящим вычислительным примитивом — строительным блоком для создания сложных, развивающихся систем. В отличие от простого, недолговечного запроса к чат-боту, `Idea` — это самодостаточный артефакт с состоянием. Он упаковывает `input` (входные данные), `output` (`solution`, решение), правила (`schema`) и весь `context` своего создания в единый переносимый модуль. Это не просто вопрос; это вопрос, ответ и полная формула, которая их связывает, создавая основу для постоянной, компонуемой системы, а не для разовой транзакции.

## От скрытого к явному: стратегия кристаллизации

Эта архитектура позволяет использовать мощный подход, при котором игровая логика начинается с гибкого **скрытого набора правил (Latent Ruleset)** и может постепенно «кристаллизоваться» в детерминированный **явный набор правил (Explicit Ruleset)**. Система по умолчанию спроектирована для работы со скрытым набором правил, рассматривая явный набор правил как мощное, но необязательное улучшение.

### 1. Скрытый набор правил

Наш основной принцип проектирования — начинать с «худшего» сценария: игры, для которой не существует явного движка. Система создана так, чтобы по умолчанию бесперебойно работать в этом режиме.

Здесь LLM выступает в роли **«универсального интерпретатора»**, фактически становясь дилером и судьёй в игре. Она использует `Schema` и `Context` из триплета, чтобы понимать правила, проверять действия и грамотно продвигать состояние игры. Набор правил является «скрытым» — он содержится в обширных знаниях LLM и информации, предоставленной в триплете, а не в явном коде. Базовый «универсальный движок» будет минимальным: он будет управлять только рассадкой участников и основной последовательностью ходов. Остальное берёт на себя LLM, что обеспечивает беспрецедентную адаптируемость.

### 2. Явный набор правил

Для игр, где у нас есть специальный движок (например, наш существующий покерный движок), система работает в ускоренном, детерминированном режиме. Движок предоставляет явный набор правил, который не заменяет основную функцию триплета, а мощно дополняет её. Он выполняет две основные функции:

- **Обеспечение детерминизма и предсказуемости:** Движок проверяет все действия на соответствие строгим правилам игры, подтверждая, что игрок может сделать в любой момент, и верифицируя действия, выбранные ботами. Это гарантирует предсказуемый и честный игровой процесс.

- **Инжиниринг контекста:** Движок выступает в роли продвинутого поставщика контекста. Он обогащает часть триплета `Context` ценной, специфичной для домена информацией. Это включает историческую статистику поведения игроков, игровые паттерны и другую релевантную аналитику. Такой «спроектированный контекст» позволяет нашим ботам принимать гораздо более умные и стратегические решения.

В этом режиме игровой движок предоставляет явную, жёстко закодированную логику, которая служит источником истины и повышает качество принятия решений нашими агентами, делая систему одновременно надёжной и умной.

### 3. От симуляции к спецификации: новая парадигма разработки

Эта стратегия кристаллизации от скрытой к явной логике открывает революционный подход к разработке. Вместо того чтобы писать спецификацию для новой игры с нуля, мы сначала будем использовать «The Reactor» с его стандартным скрытым набором правил, чтобы _сыграть_ в эту игру.

1.  **Симуляция:** Мы предоставляем Reactor триплет, описывающий новую игру (например, домино), даже совершенно новую. LLM, действуя как универсальный интерпретатор, начнёт симулировать игровой процесс.
2.  **Генерация:** В процессе игры LLM создаёт логи, рассуждения и множество разнообразных игровых сценариев.
3.  **Спецификация:** Затем мы используем эти богатые данные из симуляции как сырьё для написания надёжной, проверенной в деле спецификации и полного набора тестов.

Симуляция предшествует коду и формирует его. Мы можем понять и изучить динамику игры и крайние случаи ещё до того, как будет написана хотя бы одна строка кода детерминированного движка. Это значительно ускоряет разработку и приводит к созданию более надёжных и чётко определённых игровых движков.

## Агенты с состоянием и долговременная память

Ключевая особенность Reactor заключается в том, что действующие в нём агенты имеют состояние. Это не простые боты, выполняющие разовые команды. Поскольку система построена на постоянных воркфлоу, каждый агент может сохранять долговременную память о своих взаимодействиях.

Агент может помнить, что происходило в предыдущих раундах, вспоминать стратегии из совершенно других игр и со временем изучать склонности других игроков. Эта способность сохранять состояние является ключевым отличием, превращающим агентов из простых реагирующих компонентов в сущности, которые учатся и адаптируются в своей среде. Это позволяет достичь гораздо более сложного и стратегического поведения, чем могла бы обеспечить модель «запрос-ответ» без сохранения состояния.

## Значение для бизнеса

Это архитектурное изменение имеет глубокие последствия для бизнеса:

- **Быстрое внедрение:** Мы можем предложить клиентам возможность интегрировать новые игры и даже сложные бизнес-процессы с минимальными инженерными затратами. Универсальный подход позволяет нам запускать ботов для новой игры сразу после получения её схемы, ещё до реализации специального движка.
- **Чёткая спецификация:** Мы можем предоставить клиентам или сторонним разработчикам чёткий формат спецификации (`Schema` состояния игры), позволяя им создавать новые игровые движки, которые напрямую подключаются к нашей среде выполнения. Наш подход «сначала симуляция» поможет нам и нашим партнёрам создавать эти спецификации быстрее и точнее.
- **Спецификация как услуга:** Для клиентов, которым сложно определить сложные системы (например, программу лояльности или вознаграждений), мы можем рассматривать их процесс как «игру». Наш Reactor может симулировать этот процесс, помогая им уточнить правила и автоматически создавая надёжную спецификацию и набор тестов. Это решает серьёзную бизнес-проблему и само по себе становится ценной услугой.
- **Мгновенная функциональность:** Наша система может начать запускать ботов для новой игры в тот момент, когда мы получим её схему, еще до внедрения специального движка.

Преобразуя нашу среду выполнения на основе протокола, мы не просто улучшаем существующий продукт. Мы строим надёжную основу для экосистемы автономных агентов, способных освоить любую игру, что создаёт безграничные возможности для расширения и инноваций.

## Соответствие общей концепции

Этот стратегический сдвиг не просто улучшает наш игровой продукт; он объединяет всю нашу линейку продуктов под единым видением. Эта работа является прямым и практическим продолжением нашей цели по созданию децентрализованной, одноранговой сети для идей, как указано в _Эдикте об автономии_.

**Первый клиент и доказательство концепции**
Эта обновлённая среда выполнения станет первым специализированным клиентом для нашего протокола **«триплета идей»**. Это критически важное доказательство концепции, которое на примере реального коммерческого приложения демонстрирует, как эта абстрактная модель может создавать ощутимую ценность, гибкость и интеллект.

**За пределами игр: универсальная модель взаимодействия**
Архитектура, которую мы создаём, не ограничивается играми. Она предоставляет общую и мощную модель для реакции ИИ-агентов на дискретные изменения в любой среде. Если присмотреться, всё можно рассматривать как пошаговую игру: разговор, финансовую транзакцию, рабочий процесс управления проектами.

Reactor — это первый из многих подобных микросервисов, преобразующих идеи («Idea-Transformer»). Тот же протокол будет поддерживать компонуемую экосистему сервисов, включая:

- Сервис **Resolver**, который обогащает `Idea`, извлекая и встраивая связанные данные из базы данных.
- Сервис **Stats**, который анализирует `Idea` и добавляет исторический или статистический контекст.
- Сервис **Validation**, который проверяет `Idea` на соответствие набору правил и предоставляет обратную связь для повторных попыток.

Создавая систему, которая в совершенстве владеет этой моделью взаимодействия, мы разрабатываем фундаментальную технологию — компонуемый «инструмент в стиле Unix» в более крупной экосистеме сервисов, который можно будет применять к огромному спектру будущих продуктов и услуг. Это делает проект краеугольным камнем будущего нашей компании.