# 006: Агент/Импорты

> **Import:** Ключ, который определяет фрагмент контекста из родительской среды для его использования (`imported`) при выполнении. Он может использоваться для фокусировки внимания LLM при выполнении **Latent Inline** или для создания полного контекста при выполнении **Module Scope**. Управляется свойством `_imports`.
>
> — [Глоссарий](./000_glossary.md)

[Протокол вызовов (Call Protocol)](./003_agent_call.md) определяет высокоуровневые элементы управления для выполнения `Call`: **Scope** (Inline или Module) и **Method** (Explicit или Latent). **Протокол импортов (Imports Protocol)** объясняет, как комбинировать эти элементы и управлять контекстом для каждого из результирующих шаблонов выполнения.

## Сочетание Scope и Method

1.  **Inline Explicit (`_activity`)**: Это классический шаблон использования инструментов. LLM генерирует `params`, и хост немедленно выполняет локальную функцию. `_imports` здесь обычно не используются, так как Method не является Latent.

2.  **Inline Latent (без `_activity`)**: LLM генерирует и `params`, и `_output` за один проход. Свойство `_imports` можно использовать для фокусировки внимания LLM на определённых частях контекста, чтобы избежать влияния нерелевантной информации.

3.  **Modular Explicit (`_module` + `_activity`)**: LLM генерирует `params`. Затем система вызывает указанный Activity (`_activity`) из определённого `_module` в новом, изолированном контексте. Если указаны `_imports`, этот отфильтрованный контекст передаётся в код Activity как дополнительный аргумент.

4.  **Modular Latent (`_module`, без `_activity`)**: LLM генерирует `params`. Затем система инициирует новый, изолированный вызов LLM, используя `Idea`, указанную в `_module`, в качестве руководства. Контекст для этого нового вызова создаётся путём объединения собственного контекста модуля с данными, указанными в `_imports`.

## Фокусировка области видимости

Свойство `_imports` — это основной механизм для управления контекстом, доступным для `Call`. Оно действует как «белый список», фильтруя родительскую среду и предоставляя для выполнения сфокусированную, ограниченную область видимости.

- **В Inline Scope**: `_imports` фокусируют внимание LLM.
- **В Module Scope**: `_imports` определяют _весь контекст_ для изолированного выполнения.

## Предоставление и запрос контекста: статические и динамические импорты

Свойство `_imports` в схеме `Tool` определяет, будет ли контекст предварительно одобрен и **предоставлен** инструменту (статически), или же он будет динамически **запрошен** LLM во время выполнения.

- **Статические импорты (предоставление контекста)**: Если свойство `_imports` имеет значение `const` (например, `_imports: { "const": ["user_request"] }`), контекст **предоставляется** заранее. Разработчик `Tool` жестко прописывает, какой именно контекст разрешено видеть инструменту.

- **Динамические импорты (запрос контекста)**: Если свойство `_imports` представляет собой гибкую схему (например, массив перечислений `_imports: { "type": "array", "items": { "enum": ["session_memory"] } }`), контекст **запрашивается**. LLM сама решает, какие из доступных импортов ей нужны для генерации `Call`.

Этот динамический шаблон особенно эффективен в сочетании с системой подтверждения человеком (human-in-the-loop), что обеспечивает важнейший уровень прозрачности и контроля.

## Преимущества ограниченного контекста

- **Повышенная безопасность и фокусировка**: Ограничивая область видимости, импорты (Imports) предотвращают случайные утечки данных и фокусируют LLM, что ведёт к более предсказуемым, точным и экономичным выполнениям.
- **Улучшенная модульность**: Импорты (Imports) позволяют модулям (`Ideas` и `Activities`) быть по-настоящему автономными и пригодными для многократного использования.