# 008: Агент/Импорты

> **Импорт** — это ключ, который определяет фрагмент контекста из родительской среды для его предоставления (`импорта`) в среду исполнения. Он может использоваться для фокусировки внимания LLM при **внутреннем скрытом** исполнении или для построения всего контекста при исполнении с **модульной областью видимости**. Контролируется свойством `_imports`.
>
> — [Глоссарий](./000_glossary.md)

[Протокол вызова](./004_agent_call.md) определяет высокоуровневые элементы управления для исполнения `Call`: **Область видимости** (внутренняя или модульная) и **Метод** (явный или скрытый). **Протокол импортов** объясняет, как комбинировать эти элементы управления и управлять контекстом для каждого из результирующих шаблонов исполнения.

## Сочетание области видимости и метода

1.  **Внутренний явный (`_activity`)**: Это классический шаблон использования инструмента. LLM генерирует `params`, и хост немедленно исполняет локальную функцию. `_imports` здесь обычно не используются, так как метод не является скрытым.

2.  **Внутренний скрытый (без `_activity`)**: LLM генерирует `params` и `_output` за один раз. Свойство `_imports` можно использовать для фокусировки внимания LLM на определённых частях контекста, чтобы предотвратить влияние на неё нерелевантной информации.

3.  **Модульный явный (`_module` + `_activity`)**: LLM генерирует `params`. Затем система вызывает указанную Активность (`_activity`) из определённого `_module` в новом, изолированном контексте. Если указаны `_imports`, этот отфильтрованный контекст передаётся в код Активности в качестве дополнительного аргумента.

4.  **Модульный скрытый (`_module`, без `_activity`)**: LLM генерирует `params`. Затем система инициирует новый, изолированный вызов LLM, используя `Idea`, указанную в `_module`, в качестве руководства. Контекст для этого нового вызова создаётся путем объединения собственного контекста модуля с данными, указанными в `_imports`.

## Фокусировка поля зрения

Свойство `_imports` — это основной механизм для управления контекстом, доступным для `Call`. Оно действует как «белый список», фильтруя родительскую среду и предоставляя для исполнения сфокусированное, ограниченное поле зрения.

- **Во внутренней области видимости**: `_imports` фокусируют внимание LLM.
- **В модульной области видимости**: `_imports` определяют _весь контекст_ для изолированного исполнения.

## Предоставление и запрос контекста: статические и динамические импорты

Свойство `_imports` в схеме `Tool` определяет, является ли контекст предварительно одобренным и **предоставленным** инструменту, или же он динамически **запрашивается** LLM во время исполнения.

- **Статические импорты (Предоставление контекста)**: Если свойство `_imports` имеет постоянное значение `const` (например, `_imports: { "const": ["user_request"] }`), контекст **предоставляется**. Разработчик `Tool` жестко прописывает точный контекст, который разрешено видеть инструменту.

- **Динамические импорты (Запрос контекста)**: Если свойство `_imports` представляет собой гибкую схему (например, массив перечислений `_imports: { "type": "array", "items": { "enum": ["session_memory"] } }`), контекст **запрашивается**. LLM решает, какие из доступных импортов ему необходимы для генерации `Call`.

Этот динамический шаблон особенно эффективен в сочетании с системой подтверждения человеком, что обеспечивает критически важный уровень прозрачности и контроля.

## Сила ограниченного контекста

- **Повышенная безопасность и фокус**: Ограничивая поле зрения, импорты предотвращают случайную утечку данных и фокусируют LLM, что приводит к более предсказуемому, точному и экономически эффективному исполнению.
- **Улучшенная модульность**: Импорты позволяют модулям (`Ideas` и `Activities`) быть по-настоящему самодостаточными и повторно используемыми.