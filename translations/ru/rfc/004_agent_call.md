# 004: Агент/Вызов

> **Вызов:** Конкретный, исполняемый экземпляр `Tool` с определёнными значениями для его `params`. Это запрос, сфокусированный на вызове того, _что должно быть сделано_.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требуется:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
> - Открывает возможности для:
>   - [008: Агент/Импорты](./008_agent_imports.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - [202: Идея/Контейнер](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)

[101: Концепция/Идея](./101_concept_idea.md) определяет мощную, самодостаточную структуру данных для представления знаний и скрытой логики. [002: Агент/Инструмент](./002_agent_tool.md) создаёт базовый, управляемый схемой интерфейс, который позволяет агентам понимать структурированные возможности. Этот документ описывает протокол **004: Агент/Вызов**, который основан на Инструментах и определяет, как происходит выполнение с помощью элементов управления Областью и Методом.

**Вызов** — это конкретный экземпляр Инструмента с определёнными значениями параметров, готовый к выполнению. Если Инструменты определяют, _что можно сделать_, то Вызовы определяют, _как это будет выполнено_.

## Конвейер от Идеи к Вызову

1.  **Идея**: Самодостаточный, ориентированный на результат документ, представляющий знание или процесс.
2.  **Инструмент**: `Идея`, преобразованная в схему, ориентированную на интерфейс, и зарегистрированная в системе инструментов агента (подробнее о схемах Инструментов, регистрации и архитектуре двойного реестра см. в [002: Агент/Инструмент](./002_agent_tool.md)).
3.  **Вызов**: Когда LLM решает использовать `Инструмент`, она заполняет конкретные параметры, создавая **Вызов**. `Вызов` — это единичный, конкретный случай вызова `Инструмента`.

Основной принцип: **любую Идею можно превратить в Инструмент, который затем можно использовать как Вызов.**

Подробное объяснение того, как входная схема `Идеи` преобразуется в схему параметров `Инструмента`, см. в **[007: Агент/Ввод](./007_agent_input.md)**.

## Управление выполнением: Область и Метод

Выполнение `Вызова` определяется двумя независимыми свойствами: **Областью** (где он выполняется) и **Методом** (как он выполняется). Эти элементы управления обозначаются специальными свойствами (`_module`, `_activity`, `_output`) в схеме инструмента.

### Две оси выполнения

1.  **Область (Встроенная vs. Модульная)**
    Область определяет, происходит ли выполнение в текущем контексте агента или делегируется внешнему, изолированному модулю.
    - **Встроенная область**: Режим по умолчанию, при котором `Вызов` обрабатывается напрямую.
    - **Модульная область**: Обозначается свойством `_module` и делегирует `Вызов` внешнему `Действию` или `Идее`.

2.  **Метод (Явный vs. Скрытый)**
    Метод определяет, генерируется ли результат детерминированным кодом или LLM.
    - **Явный метод**: Обозначается наличием свойства `_activity`; результат `Вызова` генерируется детерминированным кодом.
    - **Скрытый метод**: Поведение по умолчанию при отсутствии `_activity`. Результат `Вызова` генерируется LLM. Требует наличия необязательного свойства `_output`.

Эти элементы управления можно комбинировать в различные шаблоны выполнения, а их контекст контролировать с помощью импортов. Подробное объяснение того, как эти элементы управления комбинируются и как управляется контекст, см. в **[008: Агент/Импорты](./008_agent_imports.md)**.

## Реализация сложных рабочих процессов

`Вызов` — это примитив, который позволяет создавать более сложные, структурированные рабочие процессы. В рамках протокола COILS это механизм, который может инициировать исполняемые `Идеи` более высокого уровня, такие как **[202: Идея/Контейнер](./202_idea_vessel.md)** и **[203: Идея/Процесс](./203_idea_process.md)**. `Контейнер`, например, представляет собой единый, реактивный момент принятия решения. Он инкапсулирует весь запрос к агенту, включая богатый `context` и `schema`, определяющую набор доступных `Инструментов`, а также ответ агента, который представляет собой `solution`, содержащий массив из нуля или более `Вызовов` для выполнения.

> Sidenote:
>
> - [202: Идея/Контейнер](./202_idea_vessel.md)
> - [203: Идея/Процесс](./203_idea_process.md)

## Шаблоны выполнения Вызовов

Когда агент генерирует несколько Вызовов, можно применять различные стратегии выполнения в зависимости от потребностей приложения:

```typescript
// Выполнение одного Вызова
const result = await Tool(call);

// Выполнить все Вызовы, дождаться всех результатов
const results = await Tool.all(calls);

// Выполнить все Вызовы, вернуть первый успешный результат
const result = await Tool.any(calls);

// Выполнить все Вызовы, вернуть первый завершённый результат (успешный или нет)
const result = await Tool.race(calls);
```

Эти шаблоны обеспечивают:

- **Детальный контроль**: Обрабатывайте Вызовы по отдельности с пользовательской логикой между выполнениями.
- **Пакетная обработка**: Выполняйте независимые Вызовы параллельно для максимальной производительности.
- **Стратегии быстрого отказа**: Останавливайтесь при первом успехе (`.any()`) или первом завершении (`.race()`).
- **Операции «всё или ничего»**: Убедитесь, что все Вызовы успешно завершаются вместе (`.all()`), сохраняя согласованность, когда Вызовы логически сгруппированы.