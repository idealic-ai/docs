# 102: Концепция / Суверенитет

> Sidenote:
> 
> - Требуется:
>   - [101: Концепция / Идея](./101_concept_idea.md)
>   - [103: Концепция / Идеатор](./103_concept_ideator.md)
> - Открывает возможности: Практическое развертывание экосистемы.

## 1. Введение

Этот документ описывает протокол **Суверенитета**, который определяет спектр автономии, доступный создателям в экосистеме. Он описывает многоуровневую архитектуру для хостинга и исполнения, позволяя участникам выбирать желаемый уровень контроля: от использования полностью управляемых сервисов до самостоятельного развертывания полного, суверенного решения.

Эта модель — практический мост между абстрактным `Ideator` и конкретным, работающим сервисом.

## 2. Многоуровневая архитектура

Экосистема состоит из пяти отдельных уровней (1-5), каждый из которых построен на базовом уровне **Децентрализованной идентичности**, определенном в [101: Концепция / Идея](./101_concept_idea.md). Эта модель позволяет создателям участвовать на том уровне, который соответствует их потребностям — от простой децентрализованной идентичности до полнофункционального управляемого веб-сервиса.

Полезно рассматривать эту модель как спектр автономии. На одном конце находится управляемый сервис, обеспечивающий удобство. На другом — **полный суверенитет**: использование собственного домена и самостоятельный хостинг всех сервисов, что фактически делает вас собственным провайдером. Управляемые уровни служат необязательным, последовательным мостом между этими двумя состояниями.

### Уровень 1: Управляемый хостинг

Этот уровень предоставляет моментальное и простое решение для хостинга исходного файла Ideator.

- **Как это работает:** В качестве простой точки входа мы предлагаем разместить исходный файл Ideator пользователя в нашем S3-бакете. Созданная нами `TXT`-запись для его управляемого поддомена будет указывать на этот URL в S3. В любой момент пользователь может разместить файл в другом месте и обновить свою `TXT`-запись, чтобы она указывала на новое местоположение (например, на собственный сервер, IPFS и т. д.).
- **Цель:** Избавить создателей от необходимости организовывать собственный хостинг файлов только для того, чтобы начать работу.

---

### Уровень 2: Генерация статического UI

Этот уровень делает Ideator доступными и полезными для людей без необходимости вычислений на стороне сервера.

- **Как это работает:** Для всех доменов Ideator, которые подключают эту услугу, предоставляется общая статическая веб-страница. Когда пользователь заходит на домен Ideator в браузере, JavaScript на стороне клиента выполняет запрос DNS-over-HTTPS (DoH) для получения `TXT`-записи домена, извлекает URL-адрес источника (с хостинга Уровня 1), загружает файл определения Ideator и динамически отображает пользовательский интерфейс.
- **Цель:** Предоставить бесплатное, готовое к использованию веб-приложение для любого Ideator, снижая порог входа.

---

### Уровень 3: GET-эндпоинт на базе CDN

Этот уровень улучшает межмашинное взаимодействие для чтения определения Идеи.

- **Как это работает:** Размещая CDN перед уровнем хостинга, мы можем использовать правила перезаписи запросов. `GET`-запрос к домену Идеи интеллектуально направляется через CDN для предоставления JavaScript-модуля. Это позволяет разработчикам использовать **именованные экспорты** для прямого импорта определенных частей `Idea` (например, `import { schema } from '...'`). Ответ также может включать заголовок `X-TypeScript-Types`, указывающий на файл декларации TypeScript (`.d.ts`) для наилучшего опыта разработки. Исходный документ `Idea` остается доступным через заголовок `Accept: application/json`.
- **Цель:** Предоставить мощный и идиоматичный программный доступ с полной типобезопасностью.

---

### Уровень 4: Публикация (`PUT`)

Этот уровень предоставляет возможность программно публиковать и обновлять Идею.

- **Как это работает:** Этот уровень обрабатывает аутентифицированные `PUT`-запросы к домену Идеи. Один запрос позволяет загрузить новую версию исходного файла Идеи и атомарно обновить все необходимые записи, чтобы новая версия стала активной.
- **Цель:** Предоставить безопасный и простой API для создателей, чтобы они могли управлять жизненным циклом своих Идей.

---

### Уровень 5: Полное исполнение API (`POST`)

Это высший уровень функциональности, превращающий Ideator в настоящий, вызываемый веб-сервис.

- **Как это работает:** Этот уровень обрабатывает `POST`-запросы к домену Ideator, выполняя его логику. Это может быть реализовано через управляемую бессерверную функцию или через собственный эндпоинт, который пользователь хостит самостоятельно.
- **Цель:** Предоставить всю мощь бессерверной архитектуры, позволяя любому опубликовать полнофункциональный микросервис с помощью всего лишь статического файла определения.

## 3. Спецификация API

Все HTTP-взаимодействия происходят в корне домена Идеи (`/`).

- **`GET /`**
  - С заголовком `Accept: text/html` (Уровень 2): Возвращает статический загрузчик UI или перенаправляет на URL-адрес `page`.
  - С заголовком `Accept: application/json` (Уровень 3): Возвращает исходный JSON-файл Идеи.
- **`PUT /`** (Уровень 4)
  - Требует аутентификации. Один `PUT`-запрос одновременно загружает новый исходный файл Идеи и атомарно обновляет URL-адрес `code` в `TXT`-записи, чтобы новая версия стала активной.
- **`POST /`** (Уровень 5)
  - Требует аутентификации/авторизации. Выполняет Ideator.
  - Тело запроса — это JSON-объект, содержащий полезную нагрузку, например: `{"context": "Введенные пользователем данные для обработки"}`.