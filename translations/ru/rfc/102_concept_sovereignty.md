# 102: Концепция/Суверенитет

> Sidenote:
>
> - Требует:
>   - [Протокол Идеи](./101_concept_idea.md)
>   - [Протокол: Идеаторы](./103_concept_ideator.md)
> - Обеспечивает: Практическое развертывание экосистемы.

## 1. Введение

Этот документ описывает протокол **Суверенитета**, который определяет спектр автономии, доступный создателям в экосистеме. Он представляет многоуровневую архитектуру для хостинга и выполнения, позволяя участникам выбирать желаемый уровень контроля: от использования полностью управляемых сервисов до самостоятельного хостинга полного, суверенного решения.

Эта модель — практический мост между абстрактным `Ideator` и конкретным, работающим сервисом.

## 2. Многоуровневая архитектура

Экосистема состоит из пяти отдельных уровней (1-5), каждый из которых строится на основе **Децентрализованной Идентичности**, определённой в [Протоколе Идеи](./101_concept_idea.md). Эта модель позволяет создателям участвовать на том уровне, который соответствует их потребностям — от простой децентрализованной идентичности до полнофункционального управляемого веб-сервиса.

Эту модель полезно рассматривать как спектр автономии. На одном конце находится управляемый сервис, обеспечивающий удобство. На другом — **полный суверенитет**: использование собственного домена и самостоятельный хостинг всех сервисов, что по сути делает вас собственным провайдером. Управляемые уровни служат необязательным, постепенным мостом между этими двумя состояниями.

### Уровень 1: Управляемый хостинг

Этот уровень предоставляет простое и быстрое решение для хостинга исходного файла Ideator.

- **Как это работает:** Для лёгкого старта мы предлагаем разместить исходный файл Ideator пользователя в нашем S3-бакете. `TXT`-запись, которую мы создаём для его управляемого поддомена, будет указывать на этот URL в S3. В любой момент пользователь может разместить файл в другом месте и обновить свою `TXT`-запись, чтобы она указывала на новое местоположение (например, на собственный сервер, IPFS и т.д.).
- **Цель:** Избавить создателей от необходимости настраивать собственный хостинг файлов только для того, чтобы начать работу.

---

### Уровень 2: Генерация статического UI

Этот уровень делает Ideator доступными и полезными для людей без каких-либо вычислений на стороне сервера.

- **Как это работает:** Для всех доменов Ideator, выбравших эту услугу, предоставляется общая статическая веб-страница. Когда пользователь заходит на домен Ideator в браузере, клиентский JavaScript на этой странице выполняет запрос DNS-over-HTTPS (DoH), чтобы получить `TXT`-запись для домена, забирает URL исходного файла (из хостинга Уровня 1), загружает файл определения Ideator и динамически отрисовывает пользовательский интерфейс.
- **Цель:** Предоставить бесплатное, готовое к использованию веб-приложение для любого Ideator, снижая порог входа.

---

### Уровень 3: `GET`-эндпоинт на базе CDN

Этот уровень улучшает межмашинное взаимодействие для чтения определения Идеи.

- **Как это работает:** Размещая CDN перед уровнем хостинга, мы можем использовать правила перезаписи запросов. `GET`-запрос к домену Идеи интеллектуально направляется CDN для отдачи JavaScript-модуля. Это позволяет разработчикам использовать **именованный экспорт** для импорта определённых частей `Idea` напрямую (например, `import { schema } from '...'`). Ответ также может включать заголовок `X-TypeScript-Types`, указывающий на файл декларации TypeScript (`.d.ts`), что обеспечивает лучший опыт для разработчиков. Исходный документ `Idea` остаётся доступным через заголовок `Accept: application/json`.
- **Цель:** Обеспечить мощный и идиоматичный программный доступ с полной типобезопасностью.

---

### Уровень 4: Публикация (`PUT`)

Этот уровень предоставляет возможность публиковать и обновлять Идею программно.

- **Как это работает:** Этот уровень обрабатывает аутентифицированные `PUT`-запросы к домену Идеи. Один запрос может загрузить новую версию исходного файла Идеи и атомарно обновить все необходимые записи, чтобы новая версия стала активной.
- **Цель:** Предоставить создателям безопасный и простой API для управления жизненным циклом их Идей.

---

### Уровень 5: Полноценное выполнение API (`POST`)

Это высший уровень функциональности, превращающий Ideator в настоящий, вызываемый веб-сервис.

- **Как это работает:** Этот уровень обрабатывает `POST`-запросы к домену Ideator, выполняя его логику. Это может быть реализовано через управляемую бессерверную функцию или через собственный эндпоинт, который пользователь хостит самостоятельно.
- **Цель:** Предоставить всю мощь бессерверной архитектуры, позволяя любому опубликовать полнофункциональный микросервис, имея лишь статический файл определения.

## 3. Спецификация API

Все HTTP-взаимодействия происходят в корне домена Идеи (`/`).

- **`GET /`**
  - С заголовком `Accept: text/html` (Уровень 2): Возвращает загрузчик статического UI или перенаправляет на URL `page`.
  - С заголовком `Accept: application/json` (Уровень 3): Возвращает исходный JSON-файл Идеи.
- **`PUT /`** (Уровень 4)
  - Требует аутентификации. Один `PUT`-запрос одновременно загружает новый исходный файл Идеи и атомарно обновляет URL `code` в `TXT`-записи, чтобы сделать новую версию активной.
- **`POST /`** (Уровень 5)
  - Требует аутентификации/авторизации. Выполняет Ideator.
  - Тело запроса — это JSON-объект, содержащий полезную нагрузку, например: `{"context": "Входные данные от пользователя для обработки"}`.