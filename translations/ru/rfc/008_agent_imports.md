# 008: Агент/Импорты

> **Импорт:** Ключ, который идентифицирует часть контекста из родительской среды, чтобы сделать её доступной (`импортированной`) для выполнения. Он может использоваться для фокусировки внимания LLM при **Встроенном Скрытом** исполнении или для построения всего контекста при исполнении в **Области Видимости Модуля**. Управляется свойством `_imports`. — [Глоссарий](./000_glossary.md)

[Акт 004: Агент/Вызов](./004_agent_call.md) определяет высокоуровневые элементы управления для выполнения `Call`: **Область видимости** (Встроенная или Модульная) и **Метод** (Явный или Скрытый). **Протокол Импортов** объясняет, как комбинировать эти элементы управления и управлять контекстом для каждого из результирующих шаблонов выполнения.

## Сочетание Области видимости и Метода

1.  **Встроенный Явный (`_activity`)**: Это классический шаблон использования инструментов. LLM генерирует `params`, и локальная функция немедленно выполняется хостом. `_imports` здесь обычно не используются, так как Метод не является Скрытым.

2.  **Встроенный Скрытый (без `_activity`)**: LLM генерирует и `params`, и `_output` за один проход. Свойство `_imports` можно использовать для фокусировки внимания LLM на определённых частях контекста, предотвращая влияние нерелевантной информации.

3.  **Модульный Явный (`_module` + `_activity`)**: LLM генерирует `params`. Затем система вызывает указанное Действие (`_activity`) из разрешённого `_module` в новом, изолированном контексте. Если указаны `_imports`, этот отфильтрованный контекст передаётся в качестве дополнительного аргумента в код Действия.

4.  **Модульный Скрытый (`_module`, без `_activity`)**: LLM генерирует `params`. Затем система инициирует новый, изолированный вызов LLM, используя `Idea`, указанную в `_module`, в качестве руководства. Контекст для этого нового вызова создаётся путём объединения собственного контекста модуля с данными, указанными в `_imports`.

## Фокусировка Поля Зрения

Свойство `_imports` — это основной механизм для управления контекстом, доступным для `Call`. Оно действует как белый список, фильтруя родительскую среду для предоставления сфокусированного, ограниченного поля зрения для выполнения.

- **Во Встроенной Области видимости**: `_imports` фокусирует внимание LLM.
- **В Модульной Области видимости**: `_imports` определяет _весь контекст_ для изолированного выполнения.

## Предоставление и Запрос Контекста: Статические и Динамические Импорты

Свойство `_imports` в схеме `Tool` определяет, является ли контекст предварительно одобренным и **предоставленным** инструменту, или же он динамически **запрашивается** LLM во время выполнения.

- **Статические Импорты (Предоставление Контекста)**: Если свойство `_imports` имеет значение `const` (например, `_imports: { "const": ["input"] }`), контекст **предоставляется**. Разработчик `Tool` жестко прописывает точный контекст, который разрешено видеть инструменту.

> Sidenote:
> 
> ```mermaid
> graph TD
>     subgraph Parent Context
>         direction LR
>         input("input")
>         state("state")
>     end
> 
>     subgraph Tool Call
>         direction LR
>         filter{{"_imports: ['input']"}}
>     end
> 
>     input --> filter
>     state -.-> filter
> 
>     subgraph Provisioned Context
>         direction LR
>         input_prov("input")
>     end
> 
>     filter --> HITL{{Human approval}}
>     HITL --> input_prov
>     input_prov --> Execute(Execute Tool)
> 
>     classDef unused stroke-dasharray: 5, 5, stroke:#aaa, color:#aaa
>     class state unused
>     classDef optional stroke-dasharray: 5, 5
>     class HITL optional
> ```

- **Динамические Импорты (Запрос Контекста)**: Если свойство `_imports` является гибкой схемой (например, массив перечислений `_imports: { "type": "array", "items": { "enum": ["state"] } }`), контекст **запрашивается**. LLM решает, какие из доступных импортов ему необходимы для генерации `Call`.

Этот динамический шаблон особенно эффективен в сочетании с системой утверждения человеком (human-in-the-loop), обеспечивая критически важный уровень прозрачности и контроля.

## Сила Ограниченного Контекста

- **Повышенная Безопасность и Фокусировка**: Ограничивая поле зрения, Импорты предотвращают случайную утечку данных и фокусируют LLM, что приводит к более предсказуемым, точным и экономически эффективным выполнениям.
- **Улучшенная Модульность**: Импорты позволяют модулям (`Ideas` и `Activities`) быть по-настоящему самодостаточными и повторно используемыми.