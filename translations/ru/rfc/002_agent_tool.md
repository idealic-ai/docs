# 002: Агент/Инструмент

> **Инструмент**: Схема, определяющая возможность, которую может использовать агент. Она передается в LLM как часть запроса, выступая в качестве структурированного интерфейса для потенциального действия. LLM активирует инструмент, создавая `Call` с определенными параметрами, который затем выполняется либо скрыто самой LLM, либо явно зарегистрированной функцией (`Activity`). — [Словарь](./000_glossary.md)

> Sidenote:
>
> - Требуется: [001: Агент/Запрос](./001_agent_request.md)
> - Дополняется: [003: Агент/Активность](./003_agent_activity.md)

Этот документ описывает Инструмент — базовый интерфейс на основе схем, который позволяет агентам понимать и использовать структурированные возможности.

## Что такое Инструменты?

**Инструменты — это краеугольный камень** систем действий агентов. Они предоставляют новый тип возможностей: **выбор действия в контексте** — позволяя агентам выбирать и выполнять соответствующие действия в зависимости от текущей ситуации.

Инструменты предоставляют:

- **Структурированные интерфейсы**: Возможности, определенные схемой, которые агенты могут обнаруживать и понимать
- **Типобезопасность**: Четкие контракты для входных и выходных данных
- **Компонуемость**: Строительные блоки, которые объединяются в сложное поведение агента
- **Интеграция с LLM**: Схемы, на основе которых языковые модели могут делать выводы и выбор

Когда агент заполняет определенные параметры для Инструмента, он создает **Call** — экземпляр Инструмента со всеми заполненными обязательными параметрами, представляющий конкретный запрос на выполнение (см. [004: Агент/Вызов](./004_agent_call.md) для получения подробной информации о выполнении Вызова).

> **Примечание**: Хотя любой запрос к LLM может быть представлен как Идея (что хорошо подходит для простого создания структурированного контента), Инструменты предоставляют механизм для более сложных сценариев, требующих динамического выбора действий. Для получения подробной информации о том, как Идеи могут быть преобразованы в Инструменты через схемы ввода, см. [007: Агент/Ввод](./007_agent_input.md).

## Когда использовать систему Инструментов

Используйте систему Инструментов, когда вам нужно, чтобы агенты:

- **Динамически выбирали действия** в зависимости от контекста и ситуации
- **Выбирали между несколькими возможностями** для достижения цели
- **Выполняли различные реализации** одной и той же возможности (например, разные поисковые системы)
- **Совмещали логику LLM с явной логикой** в процессе принятия решений

## Архитектура системы Инструментов

### Основной принцип: Схема как интерфейс

Система Инструментов построена на фундаментальном принципе: **Инструменты — это чистые схемы**, которые определяют интерфейсы, не требуя конкретных реализаций. Выполнение Инструмента обеспечивается либо скрытой логикой LLM, либо конкретной реализацией в коде, называемой **[003: Агент/Активность](./003_agent_activity.md)**.

Схема Инструмента определяет:

- **Что делает инструмент** (описание)
- **Что ему нужно** (входные параметры)
- **Что он производит** (структура `_output`)
- **Как он идентифицируется** (имя `_tool`)
- **Как он выполняется** (поле `_activity`, см. подробности в [003: Агент/Активность](./003_agent_activity.md))

### Метаполя схемы Инструмента

Схемы Инструментов используют метаполя (с префиксом в виде нижнего подчеркивания) для определения свойств системного уровня:

- **\_tool**: Уникальный идентификатор инструмента (обязательно)
- **\_activity**: Указывает, какая `Activity` (если таковая имеется) должна выполнить этот инструмент. См. стратегию разрешения в [003: Агент/Активность](./003_agent_activity.md).
- **\_output**: Ожидаемая структура вывода (система делает ее необязательной, nullable)
- **\_reasoningForCall**: Объяснение агента, почему был создан этот Вызов (добавляется системой)

Любое поле без префикса в виде нижнего подчеркивания считается параметром инструмента. Метаполя всегда идут первыми в порядке композиции схемы, обеспечивая последовательную структуру для понимания LLM.

### Границы системы

Система Инструментов управляет:

- Регистрацией Инструментов (определение и хранение схем)
- Заполнением параметров (извлечение из контекста с помощью LLM)
- Маршрутизацией выполнения (определение, использовать ли скрытое выполнение или `Activity`)

Протоколы более высокого уровня (такие как [004: Агент/Вызов](./004_agent_call.md)) строят оркестрацию рабочих процессов, управление состоянием и политики выполнения поверх этих примитивов.

## Определение и регистрация Инструмента

Инструменты определяются через JSON-схемы, которые описывают их полный интерфейс:

### Базовая схема Инструмента (Скрытое выполнение)

Этот `Tool` не имеет соответствующей `Activity`, поэтому он будет выполняться LLM.

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует тональность текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

### Инструмент с Активностью (Явное выполнение)

Этот `Tool` предназначен для реализации через `Activity`. См. подробности о регистрации соответствующей реализации в [003: Агент/Активность](./003_agent_activity.md).

```typescript
// Определение схемы инструмента
// См. docs/rfc/003_agent_activity.md
```

### Композиция схем

Схемы Инструментов объединяются в массив `calls` для обработки LLM. Каждая схема дополняется метаполями и информацией о режиме выполнения, а затем добавляется с использованием шаблона `anyOf` из JSON Schema. Поле `_activity` разрешается в соответствии со [Стратегией разрешения Активности](./003_agent_activity.md#activity-resolution-strategy).

```typescript
{
  // ... существующий код ...
}
```

Это позволяет LLM выбирать из доступных инструментов и создавать несколько Вызовов за один запрос.

## Инструменты как основа

Инструменты представляют собой **первый строительный блок** системы действий агента — они определяют, _что можно сделать_ с помощью чистых интерфейсов схем. [003: Агент/Активность](./003_agent_activity.md) определяет, _как выполняется код_, а [004: Агент/Вызов](./004_agent_call.md) строится на этой основе, чтобы определить, _как все оркестрируется_, что позволяет создавать сложные рабочие процессы с несколькими инструментами и стратегии выполнения.