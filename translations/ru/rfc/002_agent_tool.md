# 002: Агент/Инструмент

> **Инструмент**: Схема, определяющая возможность, которую может использовать агент. Она предоставляется LLM как часть запроса, выступая в роли структурированного интерфейса для потенциального действия. LLM активирует инструмент, создавая `Call` с определёнными параметрами, который затем выполняется либо скрыто самой LLM, либо явно зарегистрированной функцией (`Действием`). — [Глоссарий](./000_glossary.md)

> Sidenote: Требует: [001: Агент/Запрос](./001_agent_request.md)
> - Дополняется: [003: Агент/Действие](./003_agent_activity.md)

Этот документ описывает Инструмент — базовый, основанный на схемах интерфейс, который позволяет агентам понимать и использовать структурированные возможности.

## Что такое Инструменты?

**Инструменты — это основа** систем действий агентов. Они открывают новый тип возможностей: **выбор действия в контексте**, позволяя агентам выбирать и выполнять подходящие действия в зависимости от текущей ситуации.

Инструменты предоставляют:

- **Структурированные интерфейсы**: Возможности, определённые схемами, которые агенты могут находить и понимать
- **Типобезопасность**: Чёткие контракты для входных и выходных данных
- **Компонуемость**: Строительные блоки, которые объединяются в сложное поведение агента
- **Интеграция с LLM**: Схемы, на основе которых языковые модели могут делать выводы и выбирать

Когда агент заполняет определённые параметры для Инструмента, он создаёт **Вызов (Call)** — экземпляр Инструмента со всеми необходимыми параметрами, представляющий собой конкретный запрос на выполнение (подробнее о выполнении Вызова см. в [004: Агент/Вызов](./004_agent_call.md)).

> **Примечание**: Хотя любой запрос к LLM можно представить как Идею (что хорошо подходит для простого генерирования структурированного контента), Инструменты предоставляют механизм для более сложных сценариев, требующих динамического выбора действий. Подробнее о том, как Идеи могут быть преобразованы в Инструменты с помощью входных схем, см. в [007: Агент/Ввод](./007_agent_input.md).

## Когда использовать систему Инструментов

Используйте систему Инструментов, когда вам нужно, чтобы агенты:

- **Динамически выбирать действия** в зависимости от контекста и ситуации
- **Выбирать между несколькими возможностями** для достижения цели
- **Выполнять разные реализации** одной и той же возможности (например, разные поисковые системы)
- **Сочетать рассуждения LLM с явной логикой** в процессе принятия решений

## Архитектура системы Инструментов

### Основной принцип: Схема как интерфейс

Система Инструментов построена на фундаментальном принципе: **Инструменты — это чистые схемы**, которые определяют интерфейсы, не требуя конкретных реализаций. Выполнение Инструмента обеспечивается либо скрытыми рассуждениями LLM, либо конкретной реализацией в коде, называемой **[003: Агент/Действие](./003_agent_activity.md)**.

Схема Инструмента определяет:

> Sidenote: Расширения:
> 
> - [010: Агент/Состояние](./011_agent_state.md)
>   - `_outputPath`
> - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - `_instance`
> - [009: Агент/Модуль](./009_agent_module.md)
>   - `_module`

- **Что делает инструмент** (описание)
- **Что ему нужно** (входные параметры)
- **Что он производит** (структура `_output`)
- **Как он идентифицируется** (имя `_tool`)
- **Как он выполняется** (поле `_activity`, подробности см. в [003: Агент/Действие](./003_agent_activity.md))

### Метаполя схемы Инструмента

Схемы Инструментов используют метаполя (с префиксом в виде подчёркивания) для определения системных свойств:

- **_tool**: Уникальный идентификатор инструмента (обязательно)
- **_activity**: Указывает, какое `Действие` (если оно есть) должно выполнить этот инструмент. Стратегию разрешения см. в [003: Агент/Действие](./003_agent_activity.md).
- **_output**: Ожидаемая структура вывода (система делает её необязательной)
- **_reasoningForCall**: Объяснение агента, почему был создан этот Вызов (добавляется системой)

Любое поле без префикса-подчёркивания считается параметром инструмента. Метаполя всегда идут первыми при композиции схемы, обеспечивая единообразную структуру для понимания LLM.

### Границы системы

Система Инструментов отвечает за:

- Регистрацию Инструментов (определение и хранение схем)
- Заполнение параметров (извлечение из контекста с помощью LLM)
- Маршрутизацию выполнения (определение, использовать ли скрытое выполнение или `Действие`)

Протоколы более высокого уровня (например, [004: Агент/Вызов](./004_agent_call.md)) строят оркестрацию рабочих процессов, управление состоянием и политики выполнения поверх этих примитивов.

## Определение Инструмента

Инструменты определяются как JSON-схемы. В приведённом ниже примере показан `Инструмент` для анализа тональности. Этот `Инструмент` предназначен для скрытого выполнения, поскольку он полагается на встроенное понимание языка LLM и не требует внешней функции.

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует тональность текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

## Композиция схем и Вызов

Хотя отдельные Инструменты определяют дискретные возможности, их мощь раскрывается при их композиции. Система предоставляет все доступные схемы `Инструментов` для LLM в рамках одного запроса, обычно в виде массива. Это позволяет LLM выбрать наиболее подходящий `Инструмент` для конкретной ситуации. Когда LLM выбирает `Инструмент` и предоставляет необходимые параметры, создаётся **Вызов** (Call) — конкретный, исполняемый экземпляр этого `Инструмента`. `Вызов` является фундаментальной единицей действия, которая передаётся на выполнение.

> Sidenote: - [004: Агент/Вызов](./004_agent_call.md).

## Скрытое и явное выполнение

Схема `Инструмента` сама по себе является лишь интерфейсом. Выполнение его `Вызова` может происходить двумя способами. По умолчанию используется **скрытое выполнение**, при котором LLM использует свои внутренние рассуждения для генерации вывода, что идеально подходит для языковых или основанных на знаниях задач. Для действий, требующих взаимодействия с внешним миром — например, вызова API или доступа к базе данных — `Инструмент` должен быть связан с детерминированной функцией в коде. Эта явная реализация называется **Действием** (Activity).

Разделение интерфейса `Инструмента` от реализации `Действия` является ключевым принципом проектирования. Это позволяет определять возможности агента и рассуждать о них абстрактно, в то время как базовая логика выполнения может быть заменена или обновлена независимо. Следующий документ, **[003: Агент/Действие](./003_agent_activity.md)**, описывает, как `Действия` предоставляют конкретную логику для `Инструментов`.

> Sidenote: - [003: Агент/Действие](./003_agent_activity.md).