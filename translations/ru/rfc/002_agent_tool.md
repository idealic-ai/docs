# 002: Агент/Инструмент

> **Инструмент**: Схема, определяющая возможность, которую может использовать агент. Она представляется LLM в составе запроса и действует как структурированный интерфейс для потенциального действия. LLM активирует инструмент, создавая `Вызов` с конкретными параметрами, который затем выполняется либо в скрытом режиме самой LLM, либо явно зарегистрированной функцией кода (`Действие`). — [Глоссарий](./000_glossary.md)

- Требует: [001: Агент/Запрос](./001_agent_request.md)
- Дополняется: [003: Агент/Действие](./003_agent_activity.md)

Этот документ описывает Инструмент — фундаментальный интерфейс на основе схем, который позволяет агентам понимать и использовать структурированные возможности.

## Что такое Инструменты?

**Инструменты — это основа** систем действий агентов. Они открывают новый тип возможностей: **выбор действия в контексте** — позволяя агентам выбирать и выполнять подходящие действия в зависимости от текущей ситуации.

Инструменты предоставляют:

- **Структурированные интерфейсы**: Возможности, определённые схемами, которые агенты могут обнаруживать и понимать
- **Типобезопасность**: Чёткие контракты для входов и выходов
- **Компонуемость**: Строительные блоки, которые объединяются в сложное поведение агента
- **Интеграция с LLM**: Схемы, которые языковые модели могут анализировать и выбирать

Когда агент заполняет определённые параметры для Инструмента, он создаёт **Вызов** — экземпляр Инструмента со всеми заполненными обязательными параметрами, представляющий конкретный запрос на исполнение (подробнее об исполнении Вызовов см. в [004: Агент/Вызов](./004_agent_call.md)).

## Когда использовать систему Инструментов

Используйте систему Инструментов, когда вам нужно, чтобы агенты:

- **Динамически выбирали действия** в зависимости от контекста и ситуации
- **Выбирали между несколькими возможностями** для достижения цели
- **Выполняли разные реализации** одной и той же возможности (например, разные поисковые системы)
- **Сочетали рассуждения LLM с явной логикой** в процессе принятия решений

## Архитектура системы Инструментов

### Основной принцип: Схема как интерфейс

Система Инструментов построена на фундаментальном принципе: **Инструменты — это чистые схемы**, которые определяют интерфейсы, не предписывая реализаций. Исполнение Инструмента обрабатывается либо скрытыми рассуждениями LLM, либо конкретной реализацией в коде, называемой [003: Агент/Действие](./003_agent_activity.md).

- [004: Агент/Вызов](./004_agent_call.md).

Схема `Инструмента` — это стандартный объект JSON Schema. Любое поле без префикса в виде нижнего подчёркивания считается параметром инструмента. Система использует специальные мета-поля (с префиксом `_`) для определения свойств системного уровня, которые управляют идентификацией и исполнением инструмента.

Схема Инструмента определяет его полный интерфейс:

Расширения:

- **`_activity`**: Связывает инструмент с детерминированной функцией кода для явного исполнения. ([003: Агент/Действие](./003_agent_activity.md))
- **`_module`**: Делегирует исполнение инструмента изолированному внешнему модулю. ([009: Агент/Модуль](./009_agent_module.md))
- **`_outputPath`**: Позволяет инструменту сохранять состояние, записывая его вывод в постоянный объект состояния. ([010: Агент/Состояние](./010_agent_state.md))
- **`_instance`**: Направляет исполнение инструмента на конкретный экземпляр в запросе с несколькими экземплярами. ([011: Агент/Инстансинг](./011_agent_instancing.md))

- **`title`**: Человекочитаемое имя для схемы.
- **`description`**: Объясняет, что делает инструмент.
- **`parameters`**: Любые поля без нижнего подчёркивания определяют входы, необходимые инструменту.
- **`_tool`**: Предоставляет уникальное имя для идентификации инструмента.
- **`_output`**: Определяет ожидаемую структуру результата инструмента.
- **`_reasoningForCall`**: Поле, добавляемое системой, чтобы агент объяснил, почему он выбрал этот инструмент.

### Границы системы

Система Инструментов обрабатывает:

- Регистрацию Инструментов (определение и хранение схем)
- Заполнение параметров (извлечение из контекста с помощью LLM)
- Скрытое исполнение (когда LLM создаёт вывод напрямую из входных данных)

Протоколы более высокого уровня (такие как [004: Агент/Вызов](./004_agent_call.md)) строят оркестрацию рабочих процессов, управление состоянием и политики исполнения поверх этих примитивов.

## Определение Инструмента

Инструменты определяются как JSON-схемы. Приведённый ниже пример показывает `Инструмент` для анализа тональности. Этот `Инструмент` предназначен для скрытого исполнения, так как он полагается на встроенное в LLM понимание языка и не требует внешней функции.

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует тональность текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

## Композиция схем и Вызов

Хотя отдельные Инструменты определяют дискретные возможности, их сила раскрывается при их композиции. Система представляет все доступные схемы `Инструментов` для LLM в рамках одного запроса, обычно в виде массива. Это позволяет LLM выбрать наиболее подходящий `Инструмент` для конкретной ситуации. Когда LLM выбирает `Инструмент` и предоставляет необходимые параметры, она создаёт **Вызов** — конкретный, исполняемый экземпляр этого `Инструмента`. `Вызов` является фундаментальной единицей действия, которая передаётся на исполнение.

- [004: Агент/Вызов](./004_agent_call.md).

## Скрытое и явное исполнение

Схема `Инструмента` сама по себе является лишь интерфейсом. Исполнение её `Вызова` может происходить двумя способами. По умолчанию используется **скрытое исполнение**, при котором LLM использует свои внутренние рассуждения для генерации вывода, что идеально подходит для языковых или основанных на знаниях задач. Для действий, требующих взаимодействия с внешним миром — например, вызова API или доступа к базе данных — `Инструмент` должен быть соединён с детерминированной функцией кода. Эта явная реализация называется **Действие**.

Разделение интерфейса `Инструмента` от реализации `Действия` является ключевым принципом проектирования. Это позволяет абстрактно определять и анализировать возможности агента, в то время как базовая логика исполнения может быть заменена или обновлена независимо. Следующий документ, **[003: Агент/Действие](./003_agent_activity.md)**, описывает, как `Действия` предоставляют конкретную логику для `Инструментов`.

- [003: Агент/Действие](./003_agent_activity.md)