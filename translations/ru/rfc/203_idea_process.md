# 203: Идея/Процесс

> **Идея Процесса:** Самодостаточная [Идея](./101_concept_idea.md), которая содержит стратегический [План](./012_agent_plan.md) и его актуальное состояние выполнения. Её `schema` — это библиотека [Инструментов](./002_agent_tool.md), её `solution` — это _новый_ `План` для текущего тика, а `context` содержит `Ввод`, `Состояние` и предыдущий `План`.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
> - Требуется:
>   - [101: Концепция/Идея](./101_concept_idea.md)
>   - [012: Агент/План](./012_agent_plan.md)
>   - [010: Агент/Состояние](./010_agent_state.md)
>   - [007: Агент/Ввод](./007_agent_input.md)
> - Дополняется:
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)

В то время как [202: Идея/Носитель](./202_idea_vessel.md) фиксирует одно реактивное решение, **Идея Процесса** воплощает проактивный и стратегический рабочий процесс. Это артефакт, создаваемый системой [012: Агент/План](./012_agent_plan.md) при управлении сложной, многоэтапной задачей. Это делает её полной записью как возможностей, доступных в рамках рабочего процесса, так и конкретной стратегии, выбранной агентом.

## Анатомия Плана

`Идея Процесса` использует триаду `Idea` для создания полного среза рабочего процесса. Этот срез содержит не только выбранную агентом стратегию (`План`), но и полную библиотеку возможностей, а также актуальное состояние выполнения.

- **`schema` (Палитра):** Определяет библиотеку всех доступных [Инструментов](./002_agent_tool.md), из которых может быть построен `План`. Она представляет собой полный набор возможностей агента.

- **`solution` (Новый План):** Направленный ациклический граф (DAG) из `Вызовов`, который является выбранной агентом стратегией на _текущий_ тик. Он становится сообщением `Plan Message` для следующего тика.

- **`context` (Ситуационная Осведомленность):** Содержит всю информацию, необходимую агенту для планирования и выполнения текущего тика.
  - **Входное Сообщение:** Первичный стимул, который запустил весь процесс. Обычно предоставляется только один раз и остается неизменным.

    > Sidenote:
    > - [007: Агент/Ввод](./007_agent_input.md)

  - **Сообщение о Состоянии:** Актуальные, изменяющиеся данные рабочего процесса. Оно содержит сохраненные локальные переменные, которые образуют связи (ребра) между `Вызовами` в `Плане`.

    > Sidenote:
    > - [010: Агент/Состояние](./010_agent_state.md)

  - **Сообщение о Плане:** Это сообщение содержит _утвержденный_ план с предыдущего тика, которому агент может следовать или который может скорректировать.

    > Sidenote:
    > - [012: Агент/План](./012_agent_plan.md)

### Единство Планирования и Выполнения

Ключевой принцип этой архитектуры — слияние планирования и выполнения в единый процесс. В отличие от традиционных систем, где эти фазы разделены, здесь они происходят одновременно в рамках каждого тика. Агент не просто создает статичный план, а затем отдельно выполняет его; сам акт создания следующего `solution` (нового `Плана`) _и есть_ шаг выполнения для текущего тика.

Именно это единство делает систему такой динамичной и эффективной. `План` — это живой граф, которому не обязательно быть завершенным, чтобы быть полезным. Он может быть частичным, работать с результатами предыдущего тика и адаптироваться на лету. `Вызовы`, созданные LLM, представляют собой как структуру конвейера, так и сообщения внутри него. Эта двойственность позволяет одним запросом к LLM одновременно проверять текущее состояние, корректировать план на основе новых данных и выполнять следующий логический шаг. Нет никаких затратных накладных расходов на отдельные вызовы для перепланирования или проверки; выполнение — это одновременно и проверка, и планирование, и корректировка.

> Sidenote:
> - [004: Агент/Вызов](./004_agent_call.md)

Эта единая модель дает два мощных преимущества. Во-первых, `План` можно создать и симулировать, основываясь только на его схемах, еще до того, как появятся конкретные данные. LLM может "проигрывать" поведение каждого шага, что позволяет проектировать и проверять сложные рабочие процессы с самого начала. Во-вторых, LLM действует как интеллектуальный адаптер между шагами. Если выход одного `Вызова` не полностью соответствует ожидаемому входу следующего, LLM может устранить этот разрыв, обеспечивая исключительную стабильность по мере развития системы. Такая устойчивость предотвращает каскадные сбои, характерные для традиционных систем с жесткими связями.

> Sidenote:
> - [105: Концепция/ИИ-центричность](./105_concept_ai_native.md)

### Спектр Гибкости Плана

Объект `State` обеспечивает мощный трехэтапный жизненный цикл `Плана`, позволяя ему развиваться от гибкого процесса поиска до предсказуемого, детерминированного рабочего процесса:

1.  **План в свободной форме:** Изначально `State` можно определить без `schema`. Это дает агенту максимальную свободу для поиска `Плана` путем создания новых связей (свойств в объекте `State`) на лету.

2.  **Определенные Соединения:** Следующий шаг в "упрочнении" `Плана` — зафиксировать `schema` для `State`, что определяет основные пути передачи данных. Это можно сделать с разной степенью гибкости:
    - **Открытые Соединения:** Схема может разрешать `additionalProperties`, что обеспечивает соблюдение основных путей данных, но при этом дает агенту свободу создавать новые связи для второстепенных или исключительных случаев.
    - **Закрытые Соединения:** Схема может установить `additionalProperties` в `false`, создавая жесткую структуру, которой агент должен строго следовать.

3.  **Завершенный План:** Это финальная стадия, на которой план считается полностью зрелым и предсказуемым. `Завершенный План` становится **Утвержденным Планом**, который передается как `Plan Message` в `context` для последующих тиков. Завершенный план может существовать в двух формах стабильности:
    - **Оптимальный План:** Завершенный план, который описывает идеальный случай. Он обеспечивает высокоэффективный путь, но все же может потребовать корректировки при возникновении непредвиденных событий.
    - **Полный План:** Полностью завершенный план, который со временем был расширен для учета распространенных сбоев, альтернатив и других сценариев, что делает его крайне детерминированным.

Такое развитие позволяет `Идее Процесса` превратиться из гибкого проекта в высоконадежный и многократно используемый актив.

## Неизменяемые Рабочие Процессы: Оркестрация, Анализ и Масштабирование

Сила `Идеи Процесса` заключается в ее неизменяемости. Каждый шаг рабочего процесса создает новый, полный срез `Плана` и `Состояния`, сохраняя идеальную, проверяемую историю. Этот ключевой принцип создания цепочки неизменяемых артефактов и обеспечивает самые продвинутые возможности системы для оркестрации, анализа и масштабирования.

- **Надежное, Адаптивное Выполнение:** Цикл выполнения, основанный на "тиках", по своей сути надежен, потому что каждый новый тик работает с полным срезом предыдущего состояния. Эта атомарность предотвращает состояния гонки и гарантирует, что решение агента следовать `Плану` или корректировать его основано на последовательном и предсказуемом представлении о мире. Результатом каждого тика является новая `Идея Процесса`, безопасно продвигающая рабочий процесс на один шаг вперед.

  > Sidenote:
  > - [005: Агент/Цикл](./005_agent_loop.md)
  > - [012: Агент/План](./012_agent_plan.md)

- **Устойчивая Оркестрация:** `Идея Процесса` — это самодостаточный артефакт, что делает оркестрацию невероятно надежной. Рабочий процесс можно приостановить, просто сохранив его последний срез. Внешние системы или люди-наблюдатели могут затем изучить это "замороженное" состояние для принятия решений. Любые изменения, такие как перепланирование или модификация состояния, приводят к созданию _новой_ `Идеи Процесса`, которую затем можно использовать для безопасного возобновления работы без изменения исторической записи.

  > Sidenote:
  > - [010: Агент/Состояние](./010_agent_state.md)

- **Высокоточное Моделирование:** Эта архитектура является предпосылкой для интерактивного "путешествия во времени". Каждая историческая `Идея Процесса` — это идеальный, высокоточный срез рабочего процесса в определенный момент. Это позволяет пользователям или другим агентам загружать любую точку в истории процесса для проведения аудита, отладки сложного поведения или запуска сценариев "что, если" путем создания ответвления процесса с этой точки.

  > Sidenote:
  > - [202: Идея/Носитель](./202_idea_vessel.md)

- **Последовательная Пакетная Обработка:** Подход, основанный на срезах, обеспечивает последовательность при масштабировании рабочих процессов с помощью протокола Инстансинга. `План` действует как шаблон, который применяется к пакету независимых объектов `State`. Поскольку и `План`, и начальное `Состояние` каждого экземпляра являются четко определенными срезами, агент может обработать весь пакет за один атомарный тик, гарантируя согласованный и предсказуемый результат для каждого экземпляра.

  > Sidenote:
  > - [011: Агент/Инстансинг](./011_agent_instancing.md)

## От Предсказуемого Плана к Управляемому Выполнению

`Идея Процесса` может созреть до **Завершенного Плана** — высокопредсказуемого и надежного рабочего процесса. Хотя такая жесткость обеспечивает стабильность, она также может ограничивать гибкость. Системе нужен способ вводить тонкие, контекстно-зависимые указания, не нарушая целостности установленного плана.

Эту роль выполняет **[Идея Инструкции](./204_idea_instruction.md)**. `Инструкция` — это структурированный рецепт действия, который можно совмещать со стабильным `Процессом`. Вместо изменения структуры плана, она предоставляет целенаправленные указания для отдельных выборов _внутри_ этой структуры. Это позволяет `Инструкции` направлять конкретные шаги рассуждений, добавлять новые проверки или влиять на решение в определенном узле графа, обеспечивая дополнительный уровень контроля при сохранении всех гарантий предсказуемого плана. Это механизм для улучшения логики рабочего процесса, а не просто последовательности его действий.

> Sidenote:
> - [204: Идея/Инструкция](./204_idea_instruction.md)
