# 203: Идея/Процесс

> **Идея-Процесс:** Самодостаточная [Идея](./101_concept_idea.md), которая содержит стратегический [План](./012_agent_plan.md) и его текущее состояние выполнения. Её `schema` — это библиотека [Инструментов](./002_agent_tool.md), её `solution` — это _новый_ `План` для текущего шага, а её `context` содержит `Input`, `State` и предыдущий `Plan`.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote: Требует наличия: [101: Концепция/Идея](./101_concept_idea.md), [012: Агент/План](./012_agent_plan.md), [010: Агент/Состояние](./010_agent_state.md), [007: Агент/Ввод](./007_agent_input.md). Дополняется: [011: Агент/Инстансинг](./011_agent_instancing.md).

Если [Идея-Носитель (202: Idea/Vessel)](./202_idea_vessel.md) отражает одно реактивное решение, то **Идея-Процесс** воплощает проактивный и стратегический рабочий процесс. Это артефакт, создаваемый системой [Агент/План (012: Agent/Plan)](./012_agent_plan.md) при выполнении сложной, многоэтапной задачи с течением времени. Это делает его полной записью как возможностей, доступных рабочему процессу, так и конкретной стратегии, выбранной агентом.

## Анатомия Плана

`Идея-Процесс` использует триаду `Idea` для создания полного среза рабочего процесса. Этот срез содержит не только выбранную агентом стратегию (`Plan`), но и полную библиотеку возможностей и текущее состояние выполнения.

- **`schema` (Палитра):** Определяет библиотеку всех доступных [Инструментов](./002_agent_tool.md), из которых может быть построен `Plan`. Она представляет полный набор возможностей агента.

- **`solution` (Новый План):** Направленный ациклический граф (DAG) из `Calls`, который является выбранной агентом стратегией для _текущего_ шага. Он становится `Plan Message` для следующего шага.

- **`context` (Ситуационная осведомленность):** Содержит всю информацию, необходимую агенту для планирования и выполнения текущего шага.
  - **Input Message:** Исходный стимул, который запустил весь процесс. Обычно предоставляется один раз и остается неизменным.

    > Sidenote: [007: Агент/Ввод](./007_agent_input.md)

  - **State Message:** Текущие, изменяющиеся данные для рабочего процесса. Содержит сохраненные локальные переменные, которые образуют связи (ребра) между `Calls` в `Plan`.

    > Sidenote: [010: Агент/Состояние](./010_agent_state.md)

  - **Plan Message:** Это сообщение содержит **Утвержденный План** с предыдущего шага, которому агент может следовать или который может скорректировать.

    > Sidenote: [012: Агент/План](./012_agent_plan.md)

### Единство планирования и исполнения

Ключевой принцип этой архитектуры — слияние планирования и исполнения в единый процесс. В отличие от традиционных систем, где эти фазы разделены, здесь они происходят одновременно на каждом шаге. Агент не просто создает статичный план, а затем отдельно выполняет его; сам акт создания следующего `solution` (нового `Plan`) _и есть_ шаг исполнения для текущего момента.

Это единство делает систему такой динамичной и эффективной. `Plan` — это живой граф, которому не нужно быть полным, чтобы быть полезным. Он может быть частичным, работать с результатами предыдущего шага и адаптироваться на лету. `Calls`, генерируемые LLM, представляют собой как структуру конвейера, так и сообщения, проходящие внутри него. Эта двойственность позволяет одному запросу к LLM одновременно проверять текущее состояние, корректировать план на основе новых данных и выполнять следующий логический шаг. Нет затратных накладных расходов на отдельные вызовы для перепланирования или проверки; исполнение — _это и есть_ проверка, планирование и корректировка, происходящие одновременно.

> Sidenote: [004: Агент/Вызов](./004_agent_call.md)

### Спектр гибкости Плана

Объект `State` обеспечивает мощный трехэтапный жизненный цикл для `Plan`, позволяя ему развиваться от гибкого процесса исследования до предсказуемого, детерминированного рабочего процесса:

1.  **План свободной формы:** Изначально `State` может быть определен без `schema`. Это дает агенту максимальную свободу для обнаружения `Plan` путем создания новых связей (свойств в объекте `State`) на лету.

2.  **Определенные связи:** Следующий шаг в "затвердевании" `Plan` — это фиксация `schema` для `State`, что определяет основные пути передачи данных. Это можно сделать с разной степенью гибкости:
    - **Открытые связи:** Схема может разрешать `additionalProperties`, что обеспечивает соблюдение основных путей данных, но при этом дает агенту свободу создавать новые связи для второстепенных или исключительных случаев.
    - **Закрытые связи:** Схема может устанавливать `additionalProperties` в `false`, создавая жесткую структуру, которой агент должен точно следовать.

3.  **Завершенный План:** Это финальная стадия, на которой план считается полностью зрелым и предсказуемым. `Resolved Plan` становится **Утвержденным Планом** (`Committed Plan`), который передается как `Plan Message` в `context` для последующих шагов. Завершенный план может существовать в двух формах стабильности:
    - **Оптимальный План ("Happy Plan"):** Завершенный план, который описывает идеальный случай. Он обеспечивает высокоэффективный путь, но все же может потребовать корректировки при возникновении непредвиденных событий.
    - **Полный План:** Полностью завершенный план, который со временем был расширен для учета распространенных сбоев, альтернатив и других сценариев, что делает его крайне детерминированным.

Такая прогрессия позволяет `Идее-Процессу` эволюционировать из гибкого проекта в высоконадежный и многократно используемый актив.

## Неизменяемые процессы: Оркестрация, анализ и масштабирование

Сила `Идеи-Процесса` заключается в ее неизменяемости. Каждый шаг рабочего процесса создает новый, полный срез `Plan` и `State`, сохраняя идеальную, проверяемую историю. Этот ключевой принцип создания цепочки неизменяемых артефактов и обеспечивает самые передовые возможности системы для оркестрации, анализа и масштабирования.

- **Надежное, адаптивное исполнение:** Цикл исполнения, основанный на "шагах" (ticks), фундаментально надежен, поскольку каждый новый шаг работает с полным срезом предыдущего состояния. Эта атомарность предотвращает состояния гонки и гарантирует, что решение агента следовать или корректировать `Plan` основано на последовательной и предсказуемой картине мира. Результатом каждого шага является новая `Идея-Процесс`, безопасно продвигающая рабочий процесс на один шаг вперед.

  > Sidenote: [005: Агент/Цикл](./005_agent_loop.md), [012: Агент/План](./012_agent_plan.md)

- **Устойчивая оркестрация:** `Идея-Процесс` — это самодостаточный артефакт, что делает оркестрацию невероятно надежной. Рабочий процесс можно приостановить, просто сохранив его последний срез. Внешние системы или люди-супервайзеры могут затем изучить это замороженное состояние для принятия решений. Любые корректировки, такие как перепланирование или изменение состояния, приводят к созданию _новой_ `Идеи-Процесса`, которую затем можно использовать для безопасного возобновления работы без изменения исторической записи.

  > Sidenote: [010: Агент/Состояние](./010_agent_state.md)

- **Высокоточное моделирование:** Эта архитектура является предпосылкой для интерактивного "путешествия во времени". Каждая историческая `Идея-Процесс` — это идеальный, высокоточный срез рабочего процесса в определенный момент. Это позволяет пользователям или другим агентам загружать любую точку в истории процесса для проведения аудита, отладки сложного поведения или запуска сценариев "что, если" путем разветвления процесса с этой точки.

  > Sidenote: [202: Идея/Носитель](./202_idea_vessel.md)

- **Последовательная пакетная обработка:** Подход, основанный на срезах, обеспечивает последовательность при масштабировании рабочих процессов с помощью протокола Инстансинга. `Plan` действует как шаблон, который применяется к пакету независимых объектов `State`. Поскольку и `Plan`, и начальное `State` каждого экземпляра являются четко определенными срезами, агент может обработать весь пакет за один атомарный шаг, гарантируя согласованный и предсказуемый результат для каждого экземпляра.

  > Sidenote: [011: Агент/Инстансинг](./011_agent_instancing.md)

## От предсказуемого Плана к управляемому исполнению

`Идея-Процесс` может созреть в **Завершенный План** — высокопредсказуемый и надежный рабочий процесс. Хотя эта жесткость обеспечивает стабильность, она также может ограничивать гибкость. Системе нужен способ вводить тонкие, контекстно-зависимые указания, не нарушая целостности устоявшегося плана.

Эту роль выполняет **[Идея-Инструкция](./204_idea_instruction.md)**. `Instruction` — это структурированный рецепт для действия, который может быть скомбинирован со стабильным `Process`. Вместо изменения структуры плана, инструкция предоставляет целенаправленные указания для отдельных выборов _внутри_ этой структуры. Это позволяет `Instruction` направлять конкретные шаги рассуждений, добавлять новые проверки или влиять на решение в определенном узле графа, обеспечивая дополнительный уровень контроля при сохранении всех гарантий предсказуемого плана. Это механизм для улучшения _логики_ рабочего процесса, а не только последовательности его действий.

> Sidenote: [204: Идея/Инструкция](./204_idea_instruction.md)