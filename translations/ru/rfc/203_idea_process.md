# 203: Идея/Процесс

> **Идея-Процесс:** Самодостаточная [Идея](./101_concept_idea.md), которая содержит стратегический [План](./012_agent_plan.md) и текущее состояние его выполнения. Её `schema` — это библиотека [Инструментов](./002_agent_tool.md), её `solution` — это _новый_ `План` для текущего такта, а её `context` содержит `Input`, `State` и предыдущий `План`.
>
> — [Словарь](./000_glossary.md)

> Sidenote:
> - Требуется:
>   - [101: Концепция/Идея](./101_concept_idea.md)
>   - [012: Агент/План](./012_agent_plan.md)
>   - [010: Агент/Состояние](./010_agent_state.md)
>   - [007: Агент/Входные данные](./007_agent_input.md)
> - Дополняется:
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)

В то время как [202: Идея/Носитель](./202_idea_vessel.md) отражает одно реактивное решение, **Идея-Процесс** воплощает проактивный и стратегический рабочий процесс. Это артефакт, создаваемый системой [012: Агент/План](./012_agent_plan.md) при организации сложной, многоэтапной задачи. Это делает его полной записью как доступных возможностей, так и конкретной стратегии, выбранной агентом.

## Анатомия Плана

`Идея-Процесс` использует триаду `Idea`, чтобы предоставить полный снимок рабочего процесса. Этот снимок содержит не только выбранную агентом стратегию (`План`), но и полную библиотеку возможностей и текущее состояние выполнения.

- **`schema` (Палитра):** Определяет библиотеку всех доступных [Инструментов](./002_agent_tool.md), из которых может быть построен `План`. Она представляет полный набор возможностей агента.

- **`context` (Ситуационная осведомленность):** Содержит всю информацию, необходимую агенту для планирования и выполнения текущего такта.
  - **Input Message (Входное сообщение):** Первоначальный стимул, который запустил весь процесс. Обычно предоставляется один раз и остается неизменным.

    > Sidenote:
    > - [007: Агент/Входные данные](./007_agent_input.md)

  - **State Message (Сообщение о состоянии):** Актуальные, изменяющиеся данные рабочего процесса. Содержит сохраненные локальные переменные, которые образуют связи (ребра) между `Вызовами` в `Плане`.

    > Sidenote:
    > - [010: Агент/Состояние](./010_agent_state.md)

  - **Plan Message (Сообщение о плане):** Сообщение содержит _утвержденный_ план с предыдущего такта, которому агент может следовать или который может скорректировать.

    > Sidenote:
    > - [012: Агент/План](./012_agent_plan.md)

- **`solution` (Новый План):** Направленный ациклический граф (DAG) `Вызовов`, который является выбранной агентом стратегией на _текущий_ такт. Он становится `Сообщением о плане` для следующего такта.

### Единство планирования и исполнения

Основной принцип этой архитектуры — слияние планирования и исполнения в единый процесс. В отличие от традиционных систем, где эти фазы разделены, здесь они происходят одновременно в каждом такте. Агент не просто создает статичный план, а затем отдельно его выполняет; сам акт генерации следующего `solution` (нового `Плана`) _и есть_ шаг выполнения для текущего такта.

Это единство делает систему динамичной и эффективной. `План` — это живой граф, которому не обязательно быть полным, чтобы быть полезным. Он может быть частичным, работать с результатами предыдущего такта и адаптироваться на лету. `Вызовы`, сгенерированные LLM, представляют собой как структуру конвейера, так и сообщения, передаваемые внутри него. Эта двойственность позволяет одному запросу к LLM одновременно проверять текущее состояние, корректировать план на основе новых данных и выполнять следующий логический шаг. Нет дорогостоящих накладных расходов на отдельные вызовы для перепланирования или проверки; исполнение — _это_ и есть проверка, планирование и корректировка, происходящие одновременно.

> Sidenote:
> - [004: Агент/Вызов](./004_agent_call.md)

Эта единая модель дает два мощных преимущества. Во-первых, `План` можно создать и симулировать на основе одних только его схем, еще до появления конкретных данных. LLM может «разыгрывать по ролям» поведение каждого шага, что позволяет проектировать и проверять сложные рабочие процессы с самого начала. Во-вторых, LLM действует как интеллектуальный адаптер между шагами. Если выходные данные одного `Вызова` не идеально соответствуют ожидаемым входным данным следующего, LLM может устранить этот разрыв, обеспечивая исключительную стабильность по мере развития системы. Эта устойчивость предотвращает каскадные сбои, характерные для традиционных, жестко связанных систем.

> Sidenote:
> - [105: Концепция/ИИ-центричность](./105_concept_ai_native.md)

### Спектр гибкости Плана

Объект `State` обеспечивает мощный трехэтапный жизненный цикл `Плана`, позволяя ему эволюционировать от гибкого процесса исследования до предсказуемого, детерминированного рабочего процесса:

> Sidenote:
> - [010: Агент/Состояние](./010_agent_state.md)

1.  **План свободной формы:** Изначально `State` можно определить без `schema`. Это дает агенту максимальную свободу для нахождения `Плана` путем создания новых связей (свойств в объекте `State`) на лету.

2.  **Определенные связи:** Следующий шаг в «закалке» `Плана` — зафиксировать `schema` для `State`, что определяет основные пути передачи данных. Это можно сделать с разной степенью гибкости:
    - **Открытые связи:** Схема может разрешать `additionalProperties`, что обеспечивает соблюдение основных путей данных, но при этом дает агенту свободу создавать новые связи для второстепенных или исключительных путей.
    - **Закрытые связи:** Схема может устанавливать `additionalProperties` в `false`, создавая жесткую структуру, которой агент должен строго следовать.

3.  **Завершенный План:** Это финальная стадия, на которой план считается полностью зрелым и предсказуемым. `Завершенный План` становится **Утвержденным Планом**, который передается как `Сообщение о плане` в `context` для последующих тактов. Завершенный план может существовать в двух формах стабильности:
    - **«Счастливый» План:** Завершенный план, который описывает идеальный случай. Он обеспечивает высокоэффективный путь, но все же может потребовать корректировки при возникновении непредвиденных событий.
    - **Полный План:** Полностью завершенный план, который со временем был расширен для учета частых сбоев, альтернатив и других сценариев, что делает его высоко детерминированным.

Такая последовательность позволяет `Идее-Процессу` эволюционировать от гибкого проекта до очень надежного и многократно используемого актива.

## Неизменяемые рабочие процессы: Оркестрация, анализ и масштабирование

Сила `Идеи-Процесса` заключается в её неизменяемости. Каждый шаг рабочего процесса создает новый, полный снимок `Плана` и `Состояния`, сохраняя идеальную, проверяемую историю. Этот основной принцип создания цепочки неизменяемых артефактов и обеспечивает самые передовые возможности системы для оркестрации, анализа и масштабирования.

- **Надежное, адаптивное исполнение:** Цикл исполнения, основанный на «тактах», по своей сути надежен, поскольку каждый новый такт работает с полным снимком предыдущего состояния. Эта атомарность предотвращает состояния гонки и гарантирует, что решение агента следовать `Плану` или корректировать его основывается на последовательной и предсказуемой картине мира. Результат каждого такта — новая `Идея-Процесс`, безопасно продвигающая рабочий процесс на один шаг вперед.

  > Sidenote:
  > - [005: Агент/Цикл](./005_agent_loop.md)
  > - [012: Агент/План](./012_agent_plan.md)

- **Устойчивая оркестрация:** `Идея-Процесс` — это самодостаточный артефакт, что делает оркестрацию невероятно надежной. Рабочий процесс можно приостановить, просто сохранив его последний снимок. Внешние системы или люди-супервайзеры могут затем изучить это «замороженное» состояние для принятия решений. Любые корректировки, такие как перепланирование или изменение состояния, приводят к созданию _новой_ `Идеи-Процесса`, которую затем можно использовать для безопасного возобновления рабочего процесса, не изменяя историческую запись.

  > Sidenote:
  > - [010: Агент/Состояние](./010_agent_state.md)

- **Высокоточное моделирование:** Эта архитектура является предпосылкой для интерактивного «путешествия во времени». Каждая историческая `Идея-Процесс` — это идеальный, высокоточный снимок рабочего процесса в определенный момент. Это позволяет пользователям или другим агентам загружать любую точку в истории процесса для проведения аудита, отладки сложного поведения или запуска сценариев «что, если» путем разветвления процесса с этой точки.

  > Sidenote:
  > - [202: Идея/Носитель](./202_idea_vessel.md)

- **Согласованная параллельная обработка:** Архитектура на основе снимков достигает огромного масштаба благодаря протоколу Инстансинга. Этот паттерн рассматривает каждую задачу в пакете как независимый поток выполнения, каждый со своим изолированным снимком `Состояния`. Единый `План` действует как стратегический шаблон, применяемый ко всем потокам одновременно. За один атомарный такт агент выполняет параллельное планирование для всего пакета, генерируя согласованный набор `Вызовов`, адаптированных для каждого экземпляра. Это гарантирует последовательный результат для разнообразных задач, одновременно резко повышая эффективность.

  > Sidenote:
  > - [011: Агент/Инстансинг](./011_agent_instancing.md)

## От предсказуемого Плана к управляемому исполнению

`Идея-Процесс` может созреть до **Завершенного Плана** — высокопредсказуемого и надежного рабочего процесса. Хотя эта жесткость обеспечивает стабильность, она также может ограничивать гибкость. Системе нужен способ вводить тонкие, контекстно-зависимые указания, не нарушая целостности установленного плана.

Эту роль выполняет **[Идея-Инструкция](./204_idea_instruction.md)**. `Инструкция` — это структурированный рецепт действий, который обеспечивает более высокий уровень стратегического руководства. Она действует как «ментальный чек-лист» или набор принципов, влияющих на рабочий процесс на двух уровнях: направляя агента при выборе или создании наиболее подходящего `Плана` для данного контекста, и предоставляя целенаправленные указания для отдельных выборов и шагов рассуждения во время выполнения этого `Плана`. По сути, `Инструкция` улучшает _логику_ и _рассуждения_ рабочего процесса, гарантируя, что как общая стратегия, так и тактическое исполнение соответствуют желаемой методологии.

> Sidenote:
> - [204: Идея/Инструкция](./204_idea_instruction.md)
