# 203: Идея/Процесс

> **Идея Процесса:** Самодостаточная [Идея](./101_concept_idea.md), которая фиксирует стратегический [План](./012_agent_plan.md) и его текущее состояние выполнения. Её `schema` — это библиотека [Инструментов](./002_agent_tool.md), её `solution` — это _новый_ `План` для текущего тика, а её `context` содержит `Input`, `State` и предыдущий `План`.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote: Требует понимания [101: Концепция/Идея](./101_concept_idea.md), [012: Агент/План](./012_agent_plan.md), [010: Агент/Состояние](./010_agent_state.md) и [007: Агент/Ввод](./007_agent_input.md). Дополняется [011: Агент/Инстансинг](./011_agent_instancing.md).

Если [202: Идея/Носитель](./202_idea_vessel.md) фиксирует одно реактивное решение, то **Идея Процесса** воплощает проактивный и стратегический рабочий процесс. Это артефакт, создаваемый системой [012: Агент/План](./012_agent_plan.md) при организации сложной, многошаговой задачи во времени. Это делает её полной записью как возможностей, доступных рабочему процессу, так и конкретной стратегии, выбранной агентом.

## Анатомия Плана

`Идея Процесса` использует триаду `Идеи` для создания полного снимка рабочего процесса. Этот снимок содержит не только выбранную агентом стратегию (`План`), но и полную библиотеку возможностей и текущее состояние выполнения.

- **`schema` (Палитра):** Определяет библиотеку всех доступных [Инструментов](./002_agent_tool.md), из которых может быть построен `План`. Она представляет собой полный набор возможностей агента.

- **`solution` (Новый План):** Направленный ациклический граф (DAG) из `Вызовов`, который является стратегией агента на _текущий_ тик. Он становится `Сообщением Плана` для следующего тика.

- **`context` (Ситуационная осведомлённость):** Содержит всю информацию, необходимую агенту для планирования и выполнения текущего тика.
  - **Входное Сообщение:** Исходный стимул, запустивший весь процесс. Обычно предоставляется один раз и остаётся неизменным.

    > Sidenote: Смотрите [007: Агент/Ввод](./007_agent_input.md)

  - **Сообщение о Состоянии:** Актуальные, изменяющиеся данные рабочего процесса. Содержит сохранённые локальные переменные, которые образуют связи (рёбра) между `Вызовами` в `Плане`.

    > Sidenote: Смотрите [010: Агент/Состояние](./010_agent_state.md)

  - **Сообщение Плана:** Это сообщение содержит _утверждённый_ план с предыдущего тика, которому агент может следовать или который может скорректировать.

    > Sidenote: Смотрите [012: Агент/План](./012_agent_plan.md)

### Единство Планирования и Выполнения

Основной принцип этой архитектуры — слияние планирования и выполнения в единый, унифицированный процесс. В отличие от традиционных систем, разделяющих эти фазы, здесь они происходят одновременно в рамках каждого тика. Агент не просто создаёт статичный план, а затем отдельно выполняет его; сам акт генерации следующего `solution` (нового `Плана`) _является_ шагом выполнения для текущего тика.

Это единство и делает систему такой динамичной и эффективной. `План` — это живой граф, которому не обязательно быть завершённым, чтобы быть полезным. Он может быть частичным, работать с результатами предыдущего тика и адаптироваться на лету. `Вызовы`, генерируемые LLM, представляют собой как структуру конвейера, так и сообщения, проходящие внутри него. Эта двойственность позволяет одному запросу к LLM одновременно проверять текущее состояние, корректировать план на основе новых данных и выполнять следующий логический шаг. Нет никаких затратных накладных расходов на отдельные вызовы для перепланирования или проверки; выполнение _это и есть_ проверка, планирование и корректировка, происходящие одновременно.

> Sidenote: Смотрите [004: Агент/Вызов](./004_agent_call.md)

Эта единая модель даёт два мощных преимущества. Во-первых, `План` можно создать и симулировать, основываясь только на его схемах, ещё до появления конкретных данных. LLM может «отыгрывать» поведение каждого шага, что позволяет проектировать и проверять сложные рабочие процессы с самого начала. Во-вторых, LLM действует как интеллектуальный адаптер между шагами. Если выходные данные одного `Вызова` не полностью соответствуют ожидаемым входным данным следующего, LLM может устранить этот разрыв, обеспечивая исключительную стабильность по мере развития системы. Такая отказоустойчивость предотвращает каскадные сбои, характерные для традиционных систем с жёсткими связями.

> Sidenote: Смотрите [105: Концепция/ИИ-центричность](./105_concept_ai_native.md)

### Спектр Гибкости Плана

Объект `State` обеспечивает мощный трёхэтапный жизненный цикл для `Плана`, позволяя ему развиваться от гибкого процесса поиска к предсказуемому, детерминированному рабочему процессу:

1.  **План свободной формы:** Изначально `State` можно определить без `schema`. Это даёт агенту максимальную свободу для нахождения `Плана` путём создания новых связей (свойств в объекте `State`) на лету.

2.  **Определённые связи:** Следующим шагом в закреплении `Плана` является фиксация `schema` для `State`, что определяет основные пути передачи данных. Это можно сделать в спектре от более гибкого к менее гибкому:
    - **Открытые связи:** Схема может разрешать `additionalProperties`, что обеспечивает соблюдение основных путей данных, но при этом даёт агенту свободу создавать новые связи для второстепенных или исключительных случаев.
    - **Закрытые связи:** Схема может устанавливать `additionalProperties` в `false`, создавая жёсткую структуру, которой агент должен строго следовать.

3.  **Завершённый План:** Это финальная стадия, на которой план считается полностью зрелым и предсказуемым. `Завершённый План` становится **Утверждённым Планом**, который передаётся как `Сообщение Плана` в `context` для последующих тиков. Завершённый план может существовать в двух формах стабильности:
    - **Оптимистичный План:** Завершённый план, который описывает идеальный случай. Он предлагает высокоэффективный путь, но может потребовать корректировки при возникновении непредвиденных событий.
    - **Полный План:** Полностью завершённый план, который со временем был расширен для учёта частых сбоев, альтернативных путей и других сценариев, что делает его крайне детерминированным.

Такая последовательность позволяет `Идее Процесса` развиваться от гибкого проекта до высоконадёжного и многократно используемого актива.

## Неизменяемые Рабочие Процессы: Организация, Анализ и Масштабирование

Сила `Идеи Процесса` заключается в её неизменяемости. Каждый шаг рабочего процесса создаёт новый, полный снимок `Плана` и `Состояния`, сохраняя идеальную, проверяемую историю. Этот основной принцип создания цепочки неизменяемых артефактов и обеспечивает самые продвинутые возможности системы по организации, анализу и масштабированию.

- **Надёжное, Адаптивное Выполнение:** Цикл выполнения, основанный на "тиках", по своей сути надёжен, так как каждый новый тик работает с полным снимком предыдущего состояния. Эта атомарность предотвращает состояния гонки и гарантирует, что решение агента следовать или корректировать `План` основано на последовательном и предсказуемом представлении мира. Результатом каждого тика является новая `Идея Процесса`, безопасно продвигающая рабочий процесс на один шаг вперёд.

  > Sidenote: Смотрите [005: Агент/Цикл](./005_agent_loop.md) и [012: Агент/План](./012_agent_plan.md)

- **Отказоустойчивая Организация:** `Идея Процесса` — это самодостаточный артефакт, что делает организацию процесса невероятно надёжной. Рабочий процесс можно приостановить, просто сохранив его последний снимок. Внешние системы или люди-супервайзеры могут затем изучить это замороженное состояние для принятия решений. Любые корректировки, такие как перепланирование или изменение состояния, приводят к созданию _новой_ `Идеи Процесса`, которую затем можно использовать для безопасного возобновления рабочего процесса, не изменяя историческую запись.

  > Sidenote: Смотрите [010: Агент/Состояние](./010_agent_state.md)

- **Высокоточное Моделирование:** Эта архитектура является необходимым условием для интерактивного путешествия во времени. Каждая историческая `Идея Процесса` — это идеальный, высокоточный снимок рабочего процесса в определённый момент времени. Это позволяет пользователям или другим агентам загружать любую точку в истории процесса для проведения аудита, отладки сложного поведения или запуска сценариев "что если", ответвляя процесс с этой точки.

  > Sidenote: Смотрите [202: Идея/Носитель](./202_idea_vessel.md)

- **Последовательная Пакетная Обработка:** Подход на основе снимков обеспечивает последовательность при масштабировании рабочих процессов с помощью протокола Инстансинга. `План` действует как шаблон, который применяется к пакету независимых объектов `State`. Поскольку и `План`, и начальное `Состояние` каждого экземпляра являются чётко определёнными снимками, агент может обработать весь пакет за один атомарный тик, гарантируя согласованный и предсказуемый результат для каждого экземпляра.

  > Sidenote: Смотрите [011: Агент/Инстансинг](./011_agent_instancing.md)

## От Предсказуемого Плана к Управляемому Выполнению

`Идея Процесса` может созреть до **Завершённого Плана** — высокопредсказуемого и надёжного рабочего процесса. Хотя эта жёсткость обеспечивает стабильность, она также может ограничивать гибкость. Системе нужен способ вводить тонкие, контекстно-зависимые указания, не нарушая целостности установленного плана.

Эту роль выполняет **[Идея Инструкции](./204_idea_instruction.md)**. `Инструкция` — это структурированный рецепт действия, который можно совмещать со стабильным `Процессом`. Вместо изменения структуры плана она даёт целенаправленные указания для отдельных выборов _внутри_ этой структуры. Это позволяет `Инструкции` направлять определённые шаги рассуждений, добавлять новые проверки или влиять на решение в конкретном узле графа, обеспечивая дополнительный уровень контроля при сохранении всех гарантий предсказуемого плана. Это механизм для улучшения _логики_ рабочего процесса, а не просто последовательности его действий.

> Sidenote: Смотрите [204: Идея/Инструкция](./204_idea_instruction.md)