# 002: Агент/Инструмент

> **Инструмент**: Это как инструкция для суперспособности, которую может использовать умный помощник (агент). Эту инструкцию показывают искусственному интеллекту (ИИ), и она объясняет, что можно сделать. ИИ активирует инструмент, создавая `Вызов` (Call) с нужными деталями. Этот вызов либо выполняется «в уме» самим ИИ, либо запускает настоящую программу (`Activity`). — [Словарь](./000_glossary.md)

> Sidenote:
>
> - Требуется: [001: Агент/Запрос](./001_agent_request.md)
> - Дополняется: [003: Агент/Действие](./003_agent_activity.md)

Этот документ описывает Инструмент — своего рода «инструкцию», которая помогает агентам понимать и использовать разные возможности.

## Что такое Инструменты?

Представь себе видеоигру. **Инструменты — это суперспособности или гаджеты** твоего персонажа. Они дают ему новую возможность: **выбирать правильное действие в нужный момент**. Благодаря им агент может посмотреть на ситуацию и решить, какую именно способность применить.

Инструменты дают нам:

- **Понятные инструкции**: Описания способностей, которые агент может найти и понять.
- **Надёжность**: Чёткие правила, что нужно дать инструменту и что он вернёт в ответ.
- **Совместимость**: Их можно комбинировать, как кубики LEGO, чтобы создавать сложные действия.
- **Понимание для ИИ**: Инструкции, которые искусственный интеллект может прочитать, обдумать и выбрать.

Когда агент решает использовать Инструмент и заполняет все необходимые для этого детали (параметры), он создаёт **Вызов (Call)**. Это как команда «используй эту способность вот так». Подробнее о том, как выполняются вызовы, читай в документе [004: Агент/Вызов](./004_agent_call.md).

> **Примечание**: Любой простой запрос к ИИ можно представить как Идею. Но Инструменты нужны для более сложных случаев, когда агенту нужно самому выбирать, что делать. О том, как Идеи могут превращаться в Инструменты, можно прочитать в [007: Агент/Ввод](./007_agent_input.md).

## Когда нужно использовать систему Инструментов

Используй Инструменты, когда твоему агенту нужно:

- **Выбирать действия на лету**, в зависимости от того, что происходит вокруг.
- **Делать выбор между несколькими способностями** для достижения цели.
- **Использовать разные способы** для выполнения одной и той же задачи (например, искать информацию в Google или в Яндексе).
- **Совмещать размышления ИИ с чёткими правилами** при принятии решений.

## Как устроена система Инструментов

### Главный принцип: Инструкция — это всё

Система Инструментов построена на одной простой идее: **Инструменты — это просто инструкции**, которые описывают, *что* можно сделать, но не говорят, *как* именно. То, как будет выполнен Инструмент, решает либо сам ИИ «в уме», либо настоящая программа под названием **[003: Агент/Действие (Activity)](./003_agent_activity.md)**.

Инструкция (или схема) Инструмента объясняет:

- **Что он делает** (описание).
- **Что ему нужно** (входные параметры).
- **Что он создаёт в итоге** (структура `_output`).
- **Как его зовут** (имя `_tool`).
- **Как он выполняется** (поле `_activity`, подробнее в [003: Агент/Действие](./003_agent_activity.md)).

### Служебные поля в инструкции Инструмента

В инструкциях для инструментов есть специальные «служебные» поля (они начинаются с нижнего подчёркивания). Они нужны системе, чтобы понимать, как работать с инструментом:

- **_tool**: Уникальное имя инструмента (обязательно).
- **_activity**: Указывает, какая программа (`Activity`) должна выполнить этот инструмент. Подробнее о том, как она выбирается, читай в [документе 003](./003_agent_activity.md).
- **_output**: Описание того, что должно получиться в результате.
- **_reasoningForCall**: Объяснение от агента, почему он решил использовать именно этот инструмент (добавляется системой).

Любое поле без нижнего подчёркивания — это обычный параметр, который нужен для работы инструмента. Служебные поля всегда идут первыми, чтобы ИИ было проще их понимать.

### Границы системы

Система Инструментов отвечает за:

- Регистрацию Инструментов (хранение их инструкций).
- Заполнение параметров (когда ИИ находит нужную информацию).
- Направление на исполнение (решение, будет ли ИИ «воображать» результат или запустит настоящую программу).

Более сложные вещи, вроде управления цепочками задач и состоянием, строятся уже поверх этой системы (об этом в [004: Агент/Вызов](./004_agent_call.md)).

## Определение и регистрация Инструмента

Инструменты создаются с помощью JSON-схем, которые полностью описывают, как они работают.

### Простая инструкция (для «воображаемого» исполнения)

У этого `Инструмента` нет связанной с ним программы (`Activity`), поэтому его результат будет придуман самим ИИ.

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует эмоциональную окраску текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

### Инструмент с программой (для реального исполнения)

Этот `Инструмент` создан для того, чтобы его выполняла настоящая программа (`Activity`). О том, как её подключить, читай в [документе 003](./003_agent_activity.md).

```typescript
// Определяем схему инструмента
// Смотри docs/rfc/003_agent_activity.md
```

### Сборка инструкций

Все доступные инструкции для Инструментов собираются вместе в один список `calls`, чтобы ИИ мог их прочитать. Система добавляет в каждую инструкцию служебную информацию, а затем объединяет их все. Это позволяет ИИ выбирать из всех доступных инструментов и даже планировать несколько `Вызовов` за один раз.

```typescript
{
  // ... существующий код ...
}
```

## Инструменты как основа

Инструменты — это **первый и самый важный кирпичик** в системе действий агента. Они определяют, *что можно сделать*, с помощью простых инструкций. Документ [003: Агент/Действие](./003_agent_activity.md) объясняет, *как именно выполняется код*, а [004: Агент/Вызов](./004_agent_call.md) строит на этой основе сложную систему управления задачами, позволяя создавать целые цепочки из разных инструментов.