# 003: Агент/Действие

> **Действие:** Это настоящая компьютерная программа, которая выполняет то, что обещает «Инструмент». Она нужна для настоящих дел, например, чтобы зайти на сайт, проверить базу данных или сделать что-то, о чём искусственный интеллект не может просто «подумать» и угадать. — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требуется: [002: Агент/Инструмент](./002_agent_tool.md)

Этот документ объясняет, как «Инструменты» (описания того, *что* можно сделать) поддерживаются настоящим кодом, который это делает. Представь, что «Инструмент» — это кнопка с надписью «Узнать погоду». А «Действие» — это механизм внутри, который на самом деле связывается со спутником и получает прогноз.

## Архитектура с двумя списками

Чтобы всё было гибко, система использует два разных списка, разделяя описание способности от её выполнения:

- **Список Инструментов**: Хранит описания всех «кнопок» — что они делают.
- **Список Действий**: Хранит сам код, те самые «механизмы» для каждой кнопки.

Такое разделение — главный секрет гибкости всей системы. Оно позволяет ИИ иногда просто «воображать» результат, если у него нет кода для действия. А ещё мы можем легко поменять один «механизм» на другой (например, использовать простой прогноз погоды для тестов и супер-точный для настоящих пользователей), не меняя саму кнопку «Узнать погоду».

## Регистрация Действия

Каждое «Действие» (код) регистрируется под уникальным именем. Это имя связывает его с «Инструментом» (кнопкой).

```typescript
// Регистрируем наш код, то есть «Действие».
// Имя 'weatherCheck' должно совпадать с именем «Инструмента», который он выполняет.
Activity.register('weatherCheck', async call => {
  const data = await weatherAPI.get(call.location);
  return { temperature: data.temp, conditions: data.desc };
});
```

## Способы выполнения: Скрытое и Явное

Когда Агент использует «Инструмент», система может работать двумя совершенно разными способами:

- **Скрытое Исполнение**: Это как спросить очень умного друга. Он не лезет в интернет, а просто использует свои знания и логику, чтобы дать ответ. Агент «додумывает» результат сам. Это режим по умолчанию, если для «Инструмента» не нашлось специального кода.
  > Sidenote:
  >
  > - [104: Концепция/Скрытое](./104_concept_latent.md)
- **Явное Исполнение**: Это как попросить друга посмотреть что-то в телефоне. Система запускает конкретный код («Действие»), чтобы получить точный результат. Это нужно для работы с внешним миром (сайтами, базами данных) или для задач, где нужна стопроцентная точность.

## Как система выбирает Действие

Система сама решает, какой способ использовать, без лишних настроек. В описании «Инструмента» есть специальное поле `_activity`, которое намекает, что для него существует код. Система автоматически решает, как поступить, по этим правилам:

1.  **Прямое указание**: Если в описании «Инструмента» прямо сказано: «используй вот этот код (`_activity`)», система его и ищет.
2.  **Совпадение по имени (рекомендуется)**: Если прямого указания нет, система ищет код («Действие») с **точно таким же именем**, как у «Инструмента». Если находит — использует его. Это самый простой и удобный способ.
3.  **Запасной вариант — «додумать»**: Если ни один из способов не сработал, система решает, что кода нет, и просит ИИ справиться самому (использовать скрытое исполнение).

Такой подход по «договорённости» очень упрощает разработку:

- **Чтобы всё заработало само, просто назовите ваш код («Действие») так же, как и ваш «Инструмент».**
- «Инструменты», для которых вы не написали код, будут безопасно выполняться силами самого ИИ.
- Но если вы прямо укажете имя в поле `_activity`, это будет иметь главный приоритет. Так один и тот же код сможет работать для нескольких разных «Инструментов».

## Почему важно разделять «Действия»

Если бы мы не разделяли описания «Инструментов» и их код, то каждая «кнопка» была бы намертво привязана к своему «механизму». Чтобы переключиться с «додумывания» ответа на реальный запрос к сайту, пришлось бы переписывать каждого агента, который использует этот «Инструмент».

Наша система с двумя списками решает эту проблему. Описания «Инструментов» остаются неизменными, а вот код, который за ними стоит, можно менять сколько угодно. Агенты всегда видят одну и ту же «кнопку», неважно, «додумывает» ли ответ ИИ или выполняет специальный код. Это значит:

- **Изменения в коде не ломают агентов**: Можно легко переключиться с «додумывания» на реальный код, не трогая агента.
- **Тестирование разных подходов**: Можно сравнить, что работает лучше для одной и той же задачи: логика ИИ или обращение к внешнему сервису.
- **Постепенное внедрение**: Можно дать новый код только части агентов, пока остальные используют старую версию или просто «додумывают» результат.