# 005: Агент/Цикл

> **Цикл:** Последовательность `Запросов`, направленных на достижение цели. Агент продолжает вызывать `Запросы`, обрабатывать полученные `Вызовы` и передавать результат обратно в контекст для следующего `Запроса` до тех пор, пока `Вызовы` не перестанут генерироваться. — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требуется:
>   - [001: Агент/Запрос](./001_agent_request.md)
>   - [002: Агент/Инструмент](./002_agent_tool.md)
>   - [004: Агент/Вызов](./004_agent_call.md)

Этот документ описывает **Протокол Цикла**, который позволяет агенту выполнять задачи, состоящие из нескольких шагов, многократно повторяя запрос на следующее действие.

## Цикл Исполнения

Цикл Агента — это главный способ, которым он самостоятельно выполняет большие задачи.

Представьте, что агент строит что-то из LEGO, чтобы достичь цели (например, построить космический корабль). Цикл работает так:

1.  **Сборка Контекста:** Сначала агент смотрит на всё, что у него есть: какова конечная цель, что уже построено (`Состояние`) и какие детали LEGO есть в наличии. Это как подготовка к работе.
2.  **Запрос Действия:** Затем он обращается к своему «мозгу» и спрашивает: «Учитывая всё это, какой следующий шаг?». Он также передает список доступных ему `Инструментов`.
3.  **Обработка Вызовов:** «Мозг» думает и возвращает план — список одного или нескольких действий, которые называются `Вызовами`. Например: «Возьми синий кубик 2x4».
4.  **Исполнение и Обратная связь:**
    - Если в плане есть действия, агент их выполняет — берёт синий кубик и прикрепляет его к кораблю.
    - Результат этого действия (теперь корабль стал немного больше) добавляется в общую картину для следующего шага.
5.  **Завершение:** Если «мозг» возвращает пустой план (ноль `Вызовов`), это значит, что агент считает свою работу законченной. Корабль построен, и цикл останавливается.

## Человек-в-деле (Human-in-the-Loop, HITL)

Самое замечательное в этом цикле то, что он позволяет человеку легко вмешаться и помочь. Поскольку агент сначала *решает*, что делать, а потом *делает*, между этими двумя моментами есть пауза. В эту паузу может вмешаться человек:

- **Одобрение:** Агент может показать человеку свой план («Я собираюсь добавить синий кубик сюда») и дождаться одобрения, прежде чем действовать.
- **Исправление:** Человек может изменить план, сказав: «Нет, лучше возьми красный кубик» или предложив совершенно другое действие.

Эта возможность очень важна для безопасности и для совместной работы, когда агент выступает в роли помощника. Агент может учиться на исправлениях и советах человека, чтобы в будущем составлять более удачные планы, как описано в документе **[012: Агент/План](./012_agent_plan.md)**.
