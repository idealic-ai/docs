# 205: Идея/Бюджет

> **Идея Бюджета:** Это Идея, которая объединяет **полномочия** (разрешение действовать, описанное в её `schema`) и **ресурсы** (активы, которые можно потратить и которые отслеживаются в её `solution`).
>
> — [Глоссарий](./000_glossary.md)

**Идея Бюджета** превращает скучное финансовое планирование в живой, работающий механизм. Представьте, что это не просто список цифр, а умный робот, у которого есть и **разрешение** на действия (его «правила» записаны в `schema`), и **ресурсы** для этих действий (например, деньги на счету, которые отслеживаются в `solution`). Этот робот управляет всеми важными изменениями в системе с помощью команды `refine`.

> Sidenote:
>
> - Требуется:
>   - [Концепция: Идея](./101_concept_idea.md)

Этот документ объясняет, что такое Идеи Бюджетов. Это новый способ думать о деньгах и планах. Обычные бюджеты — это просто цифры в таблице. А Идеи Бюджетов — это как маленькие экономические игры со своими правилами, целями и даже собственными игровыми деньгами.

## Живой Бюджет

В этой системе **`Бюджет` — это не просто число, а живой экономический мотор.** Можно сказать, что Вариант `Бюджета` — это **мозг и нервная система** целой компании. Это живая модель бизнеса, которую можно выполнять как программу. Её можно копировать, переносить с места на место и проверять каждый её шаг.

С помощью команды `refine` мы можем создавать, финансировать и запускать Варианты `Бюджета`, которые работают как маленькие экономики со своими законами, целями и даже выдуманными валютами. Это превращает составление бюджета из скучного процесса «сверху-вниз» в живую, гибкую и честную систему управления потоками ценностей.

```llm
// Вариант Бюджета превращает статичное финансовое планирование в живой экономический механизм.
// Он разделяет планирование (схема определяет правила), финансирование (явные транзакции)
// и полномочия (делегированные разрешения). Это позволяет моделировать всё: от простых
// счетов условного депонирования до сложных казначейств с логикой автоматического реинвестирования, создавая динамичные,
// децентрализованные системы для управления любыми измеримыми ресурсами.
```

### Конституция (`schema`): Стратегический план

**`schema`** — это **Конституция** или главный закон. Это публичное заявление о намерениях, которое помогает всей команде двигаться в одном направлении. В ней прописаны правила, отношения и что самое важное. Она отвечает на вопросы: Какие у нас цели? Что делать в кризис? Как награждать за успехи? Но это не просто цели. `schema` объясняет **глубинный смысл** каждой цифры, превращая `Бюджет` в умного помощника для принятия решений.

`schema` уточняет, что означает каждая цель. Некоторые показатели должны расти бесконечно. Другие, наоборот, нужно уменьшать. А для некоторых `schema` может определить порог «и так сойдёт».

Помимо цифр, `schema` может содержать и словесное описание каждой метрики. `description` для метрики — это официальное определение того, что она значит для бизнеса. Изменение этого описания — важный шаг, который позволяет компании со временем уточнять свои ценности и цели, не ломая старые данные.

Записывая эти умные правила, `schema` не даёт компании слепо гнаться за одной цифрой в ущерб другим. Она даёт мудрость не только знать, что делать, но и понимать, когда цель достигнута и пора переключаться на что-то новое. Изменение этой конституции — это очень серьёзная операция `refine`, потому что она меняет саму суть бизнес-модели.

```llm
// Схема действует как конституция Бюджета, определяя не только, что измерять,
// но и характер каждой цели — максимизировать, минимизировать или ограничивать её. Этот
// стратегический контекст предотвращает слепую оптимизацию отдельных метрик и даёт
// мудрость о том, когда цели достигнуты и ресурсы следует направить на другие
// приоритеты. Это превращает бюджеты из ограничений в активные инструменты для принятия решений.
```

### Снимок (`solution`): Реальность в реальном времени

**`solution`** — это **мгновенный снимок реальности**. Это конкретный, просчитанный результат, который получается, когда специальная программа («решатель») применяет правила из конституции (`schema`) к самым свежим данным. Результат простой, понятный и виден всем. Пересчитать этот снимок — дешёвая и безопасная операция. Это как проверить пульс системы, а не делать ей операцию на сердце.

### Решаемость Бюджета

Не каждый `Бюджет` может выдать работающее `solution`. В его правилах (`schema`) могут быть **жёсткие ограничения** — например, минимальное количество ресурсов, которое нужно иметь, чтобы вообще начать что-то делать. Если эти условия не выполнены, `Бюджет` становится **нерешаемым**.

Это не ошибка, а полезная функция. Нерешаемость защищает систему от пустых обещаний. Нерешаемый `Бюджет` всё равно существует как **план** — чёткое заявление о том, что нужно сделать и что для этого требуется. Он показывает всем, каких именно ресурсов не хватает, чтобы перейти от мечты к делу. Это превращает сбор средств из туманных просьб в точные, обоснованные запросы.

```llm
// Решаемость бюджета означает способность сгенерировать допустимое решение с учётом
// имеющихся ресурсов. Жёсткие ограничения в схеме определяют минимальные пороги,
// ниже которых осмысленное распределение невозможно. Нерешаемые бюджеты остаются
// планами, делая нехватку ресурсов явной и требующей действий. Это защищает от
// невыполнимых обязательств и предоставляет чёткие цели для финансирования.
```

## Бюджет как общая цель

`Бюджет` — это, по сути, **план** на будущее. И этот план может существовать ещё до того, как на него появятся деньги.

**Три стадии жизни Бюджета:**

1.  **Стадия планирования**: `Бюджет` существует как чистая идея — `schema` без денег. Команды могут вместе работать над планом, проигрывать разные сценарии и договариваться.
2.  **Стадия частичного финансирования**: Начинают поступать ресурсы. `Бюджет` может начать работать вполсилы, если выполнены некоторые минимальные требования.
3.  **Полная активация**: Все жёсткие ограничения выполнены. `Бюджет` работает на полную мощность.

Настоящей целью компании становится **сообща наполнить `Бюджет` ресурсами со всех сторон**. Это цель, которую нужно достичь, а не просто кошелёк, который нужно потратить. Ресурсы приходят в разное время и в разной «валюте» от разных участников:

- **Деньги:** Инвесторы или доходы приносят деньги.
- **Время и внимание:** `Бюджет` может определять, сколько часов работы нужно и к какому сроку.
- **Репутация:** В маркетинговом `Бюджете` может быть цель по количеству хороших отзывов в прессе.
- **Вклад сообщества:** `Бюджет` команды по работе с разработчиками может пополняться за счёт принятых программных доработок (pull requests).
- **Вычислительные ресурсы:** Бюджет научного проекта может измеряться в `GPU-часах` или `LLM-токенах`.

Каждый из этих пунктов — это измеримый ресурс, который заполняет свою строчку в большом плане `Бюджета`.

```llm
// Бюджеты проходят три стадии: планирование (нефинансируемое видение), частичное
// финансирование (ограниченная работа при превышении минимальных порогов) и полная активация
// (все ограничения выполнены). Они асинхронно собирают различные валюты,
// причём схема определяет как амбициозные цели, так и жёсткие ограничения.
// Этот поэтапный подход превращает сбор средств в прозрачный, измеримый процесс.
```

## Стратегические возможности

`Бюджет` — это место, где человеческая смекалка и машинный интеллект вместе решают сложные бизнес-задачи.

### Динамическое планирование и симуляция

Поскольку `schema` — это готовая экономическая модель, её можно использовать для симуляций. Участники могут проверять разные экономические идеи или предсказывать, что случится при изменениях, прежде чем тратить реальные ресурсы. Система легко справляется с нехваткой или избытком ресурсов:

- **При нехватке**, логика находит лучший компромисс, направляя ресурсы на самое важное.
- **При избытке**, лишнее грамотно распределяется на рост, сбережения или премии.

Это позволяет командам экспериментировать с разными экономическими моделями и стратегиями, поощряя новаторство и принятие решений на основе данных.

### Фрактальное планирование: Масштабирование во времени

Вместе с системой статистики, которая работает со временем, `Бюджет` становится гибким во времени, позволяя **фрактальное планирование**.

Представьте, что вы можете приближать и отдалять карту времени:

1.  **Декомпозиция (Приближение):** Большой, долгосрочный `Бюджет` можно автоматически разбить на маленькие, краткосрочные задачи. Годовой бюджет можно посмотреть по кварталам или месяцам.
2.  **Композиция (Отдаление):** Ежедневные действия постоянно суммируются «наверх», показывая в реальном времени, как вы движетесь к большим целям.
3.  **Прогнозы и сценарии «что, если»:** Эта временная структура делает симуляции ещё мощнее, позволяя предсказывать будущее на основе текущих тенденций.

```llm
// Фрактальное планирование позволяет Бюджетам плавно масштабироваться по временным горизонтам.
// Годовые стратегические планы разбиваются на ежедневные тактические цели, а ежедневные
// действия суммируются, чтобы показать стратегический прогресс. В сочетании с иерархическими
// агрегациями движка статистики это создаёт плавное согласование между
// долгосрочным видением и немедленным исполнением с мощными возможностями симуляции.
```

### Эволюция через уточнение

`schema` Бюджета может меняться с помощью команды `refine`. Изменение `schema` — это серьёзное, стратегическое действие, равносильное изменению конституции. Ожидается, что изменения будут дополнять старые правила, а не ломать их — так называемое `сужение` схемы. Это гарантирует, что старые процессы, работающие с `Бюджетом`, не сломаются.

Главная причина для таких изменений — потребность в большей детализации. Например, когда один большой `Бюджет` делят на несколько маленьких для разных отделов. Это основной механизм для создания **иерархии и делегирования**.

### Иерархические требования: Бюджеты как двигатели мотивации

Когда родительский `Бюджет` передаёт полномочия дочернему, он выдаёт ему **лицензию на создание мини-экономики**. Эта лицензия — это `schema` дочернего `Бюджета`, которая определяет и **ресурсы** (например, `USD`), и **задание** (например, цель по `написанным_статьям`).

Определяя цели вместе с ресурсами для их достижения, мы создаём мощные **стимулы и динамику**. Мы говорим умным программам (агентам), о чём им нужно заботиться, и даём им средства для этого. Так система организует сложную работу, создавая спрос на конкретные результаты.

`schema` также может включать метрики вроде `токенов_положительного_отзыва` для получения бонусов или `токенов_жалобы` для запуска проверок, создавая мощную систему мотивации.

#### Гибкие бюджеты и обратное давление

Родительский `Бюджет` может дать дочернему `Бюджету` гибкие рамки расходов (например, `базовый_бюджет` и `разрешённый_перерасход`). В `schema` дочернего бюджета может быть логика, которая позволяет использовать перерасход, если достигнуты определённые показатели. Это создаёт механизм «обратного давления», когда успех открывает доступ к дополнительным ресурсам.

#### Метрики «снизу-вверх» и диалог

Поскольку `Бюджет` — это живой механизм, он сам создаёт свои метрики (например, `средняя_стоимость_статьи`). Если эти метрики показывают, что первоначального бюджета недостаточно, эта информация передаётся наверх, запуская диалог для умной, основанной на данных корректировки стратегических планов.

### Автоматический рост и собственные валюты

В этой модели любая метрика может стать валютой. В `schema` содержатся формулы, что делать, когда эти валюты появляются. Например, `Бюджет` может изобрести `ТокенУлучшенияПроцесса`, который зарабатывается за качественное выполнение задач. Потом его можно «потратить», чтобы выделить время на улучшение кода.

`Бюджет` можно настроить так, чтобы он периодически обновлял статистику и пересчитывал распределение ресурсов. Затем `schema` автоматически распределяет результаты по своим правилам, создавая самоподдерживающиеся циклы роста.

```llm
// Бюджеты обеспечивают автоматизированные циклы роста, где любая метрика становится расходуемой
// валютой. Успех в одной области (например, удовлетворённость клиентов) автоматически
// открывает ресурсы в другой (например, инициативы по качеству). Схема определяет
// эти взаимосвязи, создавая прозрачные формулы, где достижения напрямую
// питают будущие возможности, превращая бюджеты в самоподдерживающиеся двигатели роста.
```

### Децентрализованные и вложенные экономики

Модель `Бюджета` позволяет децентрализацию, создавая изолированные финансовые системы, которые могут работать приватно, но взаимодействовать с большой сетью. Компания может профинансировать главный `Бюджет` в основной системе, а затем вести свой собственный, внутренний и закрытый учёт для управления этим `Бюджетом`. Все внутренние операции невидимы для основной сети, которая видит только общие транзакции пополнения и расчётов.

## Финансирование и полномочия: Как это работает

Экономическая система построена на двух простых действиях, управляемых `refine`: финансирование (транзакция) и делегирование (без транзакции).

### 1. Финансирование Бюджета (транзакция)

«Бюджет» — это отдельный Вариант `Бюджета`, который явно пополняется с исходного счёта.

- Пользователь применяет `refine` к шаблону `Бюджета`, указывая сумму и счёт-источник.
- Система проверяет, есть ли у пользователя права на этот счёт.
- В учётную книгу записывается транзакция, которая списывает деньги с исходного счёта и зачисляет их на счёт нового Варианта `Бюджета`. Теперь эти средства принадлежат `Бюджету`.

### 2. Делегирование полномочий (без транзакции)

Как только `Бюджет` пополнен, его владелец может передать право на его использование, не создавая новых транзакций.

- Полномочия выдаются с конкретными разрешениями (например, максимальная сумма трат, разрешённые типы ресурсов).
- **Транзакция не создаётся.** Деньги не перемещаются. Новое разрешение — это как «виртуальная карта», которой разрешено снимать деньги с родительского `Бюджета`.

Этот двухэтапный процесс — сначала пополнить, потом разрешить — даёт максимальную гибкость и контроль.

```llm
// Экономическая система работает на двух основных действиях:
// 1. Финансирование создаёт Вариант Бюджета через явную транзакцию, перемещая ценность с
//    исходных счетов в выделенные пулы.
// 2. Делегирование предоставляет права на траты без транзакций, подобно выпуску
//    виртуальных карт, которые черпают средства из пополненного пула.
// Такое разделение обеспечивает гибкое и проверяемое управление ценностями, где финансирование
// и полномочия контролируются независимо.
```

## Расходы: Транзакция из двух частей

Окончательное перемещение денег из `Бюджета` происходит, когда задача размещена и выполнена. Этот процесс состоит из двух простых, отдельных транзакций, которые гарантируют, что средства зарезервированы и выплачены правильно.

### 1. Резервирование средств под задачу

Когда менеджер использует свои полномочия, чтобы разместить задачу за счёт `Бюджета`, система (`refine` router) проверяет запрос и создаёт одну транзакцию: **списание** с `Бюджета`. Теперь эти деньги считаются «в пути», зарезервированными под эту задачу.

Система проводит **три критически важные проверки**:

**а. Проверка правил:** Позволяет ли выданное разрешение это действие? Система проверяет трату по правилам конкретного разрешения.
**б. Проверка баланса:** Достаточно ли средств в `Бюджете`? Система в реальном времени проверяет текущий баланс `Бюджета`.
**в. Проверка решаемости:** После этого списания, сможет ли `Бюджет` по-прежнему выполнять свои жёсткие ограничения?

Если все три проверки пройдены, система записывает одну транзакцию списания в учётную книгу. Если хотя бы одна проверка не пройдена, система **полностью отклоняет размещение задачи**. Это защищает работников от того, чтобы браться за работу без гарантированной оплаты, и поддерживает честность всей экономической системы.

```llm
// Проверка на рынке обеспечивает три уровня защиты: правила разрешений,
// достаточность баланса и сохранение решаемости. Размещение задачи отклоняется, если
// резервирование средств под неё нарушит какое-либо ограничение или опустит Бюджет ниже
// минимальных порогов. Это создаёт надёжный рынок, где каждая принятая
// задача имеет гарантированное, проверенное финансирование, которое не поставит под угрозу жизнеспособность Бюджета.
```

### 2. Завершение платежа

После успешного выполнения задачи делается финальный вызов `refine`. Система создаёт вторую, балансирующую транзакцию: **зачисление** на счёт работника.

Цикл завершён. Две простые транзакции — списание с `Бюджета` плательщика и зачисление на счёт получателя — это всё, что нужно. Если бы задачу отменили, деньги просто вернулись бы на счёт исходного `Бюджета`.

```llm
// Расходы используют модель транзакций из двух частей: сначала размещение задачи создаёт
// списание с Бюджета (резервирование). Затем выполнение задачи создаёт зачисление
// работнику (расчёт). Эта простая модель гарантирует, что средства правильно
// зарезервированы и баланс всегда сходится, без сложных механизмов условного депонирования.
// Отменённые задачи просто возвращают средства на исходный Бюджет.
```

## Универсальные применения

Вариант `Бюджета` — это гибкий инструмент, который может моделировать множество различных ситуаций.

### Финансовые и бизнес-кейсы

1.  **Стандартное финансирование проекта:** Программный проект получает `Бюджет`, в `schema` которого прописано распределение: `"разработка": "60%", "дизайн": "20%", "тестирование": "20%"`.
2.  **Эскроу для одной задачи:** Для простой фриланс-работы создаётся `Бюджет` и пополняется на точную сумму задачи.
3.  **Управление подписками:** Ежемесячный платёж пользователя за подписку пополняет его личный `Бюджет`. `schema` распределяет эти средства на разные сервисы в зависимости от использования.
4.  **Операционные расходы команды:** Отдел маркетинга получает квартальный `Бюджет`. Руководитель может делегировать право тратить деньги по каждой категории.
5.  **Комиссионные с продаж и распределение прибыли:** `Бюджет` компании отслеживает `ВаловуюПрибыль`. Его `schema` диктует, как прибыль делится между расходами, реинвестированием и бонусами.

### Продвинутые и неденежные применения

6.  **Алгоритмический торговый бот:** `Бюджет` торгового бота хранит активы. Его `schema` — это и есть торговая стратегия с правилами для сделок.
7.  **Гранты и научное финансирование:** Грант на исследование в университете управляется как `Бюджет`. `schema` обеспечивает соблюдение строгих правил расходования, установленных грантодателем.
8.  **Распределение ресурсов по использованию:** Команда по анализу данных может получить месячный `Бюджет` в `1000 GPU-часов` и `50М LLM-токенов`.
9.  **Управление казной DAO:** DAO (децентрализованная автономная организация) управляет своей казной как главным `Бюджетом`. `schema` отражает одобренные сообществом предложения по расходам.
10. **Игровая экономика:** В видеоигре инвентарь игрока — это `Бюджет`, в котором хранятся ресурсы, такие как `Золото`, `Дерево` и `Камень`.
11. **Двигатель личного развития:** `Бюджет` человека отслеживает его усилия и навыки. Его можно пополнять временем и деньгами, а `schema` определяет цели, например, повышение метрики `Владение-Python`. `Бюджет` превращает усилия и вложения в ощутимые, измеримые навыки.

### Универсальное управление ресурсами

`Бюджет` не обязательно должен быть пополнен деньгами. Он может быть пополнен **нереализованным потенциалом**, таким как физические активы или абстрактные, как интеллектуальная собственность. `Бюджет` становится инструментом для запланированного превращения, где `schema` содержит правила, как превратить «Экспертизу» в `ЧасыКонсультаций` (валюту), которые затем можно «продать», чтобы получить `USD`.

Учётная книга не зависит от типа ресурсов и может управлять любым измеримым ресурсом (`LLM-Токены`, `GPU-Часы`, `Хранилище-ГБ`, `API-Кредиты`, `РепутацияРазработчика` и т.д.).

```llm
// Учётная книга не зависит от типа ресурсов и управляет любой измеримой ценностью.
// Бюджеты могут пополняться нереализованным потенциалом (физические активы, экспертиза)
// и содержать правила для их преобразования. Можно отслеживать любой ресурс: деньги, вычисления,
// хранилище, репутацию. Команда refine позволяет проводить транзакции между разными ресурсами,
// создавая единую систему для всех форм обмена и трансформации ценностей.
```

## Техническая основа

В этом разделе описываются ключевые архитектурные компоненты, которые делают возможной эту динамическую систему `Бюджетов`.

### Разделение для скорости: Роль слоя агрегации

Эта модель полагается на **отдельный, работающий в реальном времени слой агрегации** (например, TimescaleDB) для получения мгновенной информации о балансах `Бюджетов`.

- **Учётная книга — источник правды:** Система `refine` записывает каждую транзакцию в неизменяемую учётную книгу.
- **События питают агрегатор:** Учётная книга создаёт событие для каждой новой транзакции.
- **Агрегатор предоставляет живые балансы:** Слой агрегации считывает эти события, чтобы поддерживать постоянно обновляемую и быструю информацию о всех `Бюджетах`.
- **Проверка происходит на быстром слое:** Система запрашивает этот быстрый слой агрегации, а не медленную основную учётную книгу.

Эта архитектура сочетает надёжность учётной книги, основанной на событиях, с высокой производительностью системы проверки балансов в реальном времени.

### Аудит потоков: Происхождение транзакций

Главное преимущество неизменяемой учётной книги — идеальная проверяемость. Поскольку каждая транзакция связана с `Бюджетом`, который её профинансировал, и разрешением, которое её санкционировало, мы можем отследить полную историю любой единицы ценности.

Например, запрос по платежу может раскрыть всю его историю:

- `ЗАЧИСЛЕНИЕ Баланс:Дизайнер-Джейн +$1000` `(Расчёт за РекламнуюКампанию-123)`
  - `└─ СПИСАНИЕ Бюджет:Маркетинг-2025 -$1000` `(Резервирование под РекламнуюКампанию-123)`
    - `   └─ ЗАЧИСЛЕНИЕ Бюджет:Маркетинг-2025 +$200k` `(Пополнено из Казны)`
      - `      └─ СПИСАНИЕ Баланс:Казна-Компании -$200k` `(Для создания бюджета Маркетинга)`
        - `         └─ ЗАЧИСЛЕНИЕ Баланс:Казна-Компании +$1M` `(Событие начального финансирования)`

Эта ясная, непрерывная цепь обеспечивает полную прозрачность того, как средства распределяются и тратятся.

```llm
// Техническая архитектура отделяет неизменяемую учётную книгу (источник правды)
// от слоя агрегации реального времени (производительность). События текут из книги
// в агрегатор, поддерживая живые балансы для быстрой проверки. Каждая
// транзакция сохраняет полную историю происхождения, обеспечивая идеальную проверяемость от
// начального финансирования до конечного расчёта. Это обеспечивает и надёжность, и скорость.
```