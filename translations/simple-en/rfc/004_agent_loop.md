# 005: Агент/Цикл

> **Цикл:** Это как цепочка `Запросов`, которые агент делает, чтобы достичь какой-то цели. Агент продолжает делать `Запросы`, выполнять полученные в ответ `Команды` и добавлять результат обратно в общую картину (контекст) для следующего `Запроса`. Так продолжается до тех пор, пока `Команды` не перестанут появляться.
> 
> — [Глоссарий](./000_glossary.md)

> Sidenote:
> 
> - Требует:
>   - [Агент/Запрос](./001_agent_request.md)
>   - [Агент/Инструмент](./002_agent_tool.md)
>   - [Агент/Команда](./004_agent_call.md)

Этот документ объясняет **Протокол Цикла**. Представь, что это набор правил, которые позволяют агенту выполнять задачи, состоящие из нескольких шагов, раз за разом повторяя `Запрос`.

## Цикл выполнения

Цикл Агента — это главный способ, которым он самостоятельно выполняет сложные задачи шаг за шагом. Он работает как бесконечная петля, которая останавливается только тогда, когда работа сделана. Вот как это происходит:

1.  **Сбор информации:** Цикл начинается с того, что собирает всё, что ему известно: какая у него цель, что уже сделано (`Состояние`) и любую другую важную информацию. Это как если бы ты перед сборкой LEGO выложил все нужные детали перед собой.
2.  **Создание Запроса:** Затем он использует протокол **[Агент/Запрос](./001_agent_request.md)**. Он как бы спрашивает сам себя: «Учитывая всё это, и зная, какие `Инструменты` у меня есть, что мне делать дальше?».
3.  **Обработка Команды:** В ответ на `Запрос` приходит `решение`, в котором есть список **[Агент/Команд](./003_agent_call.md)s**. Это конкретные действия, которые нужно совершить. Их может быть несколько, одна или вообще ни одной.
4.  **Выполнение и обратная связь:**
    - Если в `решении` есть `Команды`, цикл их выполняет. Для `Явных` `Команд` это означает запуск нужного кода `Действия`.
    - Результаты этих `Команд` (например, информация, найденная в интернете) добавляются в общую «копилку знаний» для следующего шага цикла. Теперь агент знает немного больше, чем на предыдущем шаге.
5.  **Завершение:** Если в `решении` не оказалось ни одной `Команды`, агент считает, что цель достигнута, и цикл останавливается. Работа сделана!

## Человек в деле (Human-in-the-Loop, HITL)

Ключевая особенность Цикла Агента — это встроенная возможность для человека наблюдать за процессом и вмешиваться. Это как кнопка «пауза» в игре.

Поскольку цикл сначала решает, *что* делать (генерирует `Команды`), а только потом *делает* это, у человека появляется «окошко», чтобы вмешаться:

- **Одобрение:** Перед тем как выполнить `Команды`, система может показать их тебе и спросить: «Я собираюсь сделать вот это. Всё правильно?».
- **Исправление:** Ты можешь изменить детали `Команды` или даже заменить её на совершенно другую. Например, если агент решил поискать «рецепты яблочного пирога», ты можешь исправить на «простые рецепты яблочного пирога».

Это очень важно для безопасности и для совместной работы, когда агент выступает в роли твоего помощника. Твои исправления и подсказки могут использоваться **[Планом Агента](./012_agent_plan.md)**, что позволяет агенту учиться и становиться умнее на основе твоего мнения.