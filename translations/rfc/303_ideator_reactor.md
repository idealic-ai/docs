# 303: Идеатор/Реактор

> **Реактор:** Особый `Преобразователь Идей`, разработанный как универсальная среда исполнения для пошаговых взаимодействий агентов с сохранением состояния. Он принимает состояние игры/процесса (`Idea`) и создает следующее состояние (`Idea`).
> 
> — [Глоссарий](./000_glossary.md)

Этот документ описывает видение рефакторинга существующей среды исполнения для покера в **«Реактор»** — универсальную и расширяемую систему управления контекстом для агентов в реальном времени. Эта эволюция превращает нашу мощную систему на базе Temporal из одноцелевого приложения в протокол, с помощью которого умные автономные агенты могут взаимодействовать с любой пошаговой средой, будь то игра с нулевой суммой, совместная симуляция или сложный бизнес-процесс. Реактор станет первым «движком-реактором» для нашей более широкой сети идей.

## От специфики покера к протоколу

Наша текущая среда исполнения — это успех. Она использует рабочие процессы Temporal для управления сложным микрокосмом покерных ботов, которые играют, вычисляют и реагируют в среде казино. Мы также разработали API для абстрактного игрового движка, чтобы отделить игровую логику от среды исполнения. Наш покерный движок является первой реализацией этого API, что закладывает основу для будущего, в котором различные игровые движки можно будет легко подключать и отключать.

Однако взаимодействие внутри нашей системы всё ещё жёстко привязано к конкретной игровой нотации (формату истории рук в покере). Чтобы по-настоящему раскрыть потенциал нашей системы, мы выйдем за рамки этого ограничения.

В основе этого рефакторинга лежит внедрение **«Триплета Идей»** как фундаментальной единицы коммуникации. Вместо отправки простого объекта состояния игры, каждое сообщение в системе будет представлять собой самодостаточный триплет:

1.  **Schema:** JSON-схема, которая даёт универсальное семантическое определение состояния игры. Она не только делает данные самоописываемыми, но и содержит достаточно информации для определения следующего допустимого действия или перехода состояния.
2.  **Context:** Дополнительная информация, такая как правила игры, инструкции для ботов или исторические данные, которая влияет на интерпретацию решения.
3.  **Solution:** Фактическое состояние игры, которое соответствует схеме.

Вместе `Schema` и `Solution` образуют полный, самодостаточный снимок состояния игры. `Solution` само по себе — это неоднозначное представление игры; это просто данные. `Schema` предоставляет критически важный контекст, определяя словарь, структуру и правила. Этого достаточно, чтобы понять, что можно добавить в игровую нотацию и как может отреагировать другой игрок, что позволяет определить следующий правильный ход. Это означает, что любой компонент может понять не только текущее состояние, но и его ближайшие возможности, без предварительных знаний о реализации игры. Ключевое техническое решение, поддерживающее это, заключается в том, что триплет будет единственной единицей данных, передаваемой по критическому пути всех рабочих процессов; мы отходим от передачи частичных состояний.

Это делает `Idea` настоящим вычислительным примитивом — строительным блоком для создания сложных, развивающихся систем. В отличие от простого, недолговечного запроса к чат-боту, `Idea` — это самодостаточный артефакт с состоянием. Он упаковывает `входные данные`, `выходные данные` (`solution`), `правила` (`schema`) и весь `контекст` своего создания в единый, переносимый блок. Это не просто вопрос; это вопрос, ответ и полная формула, которая их связывает, создавая постоянную, композитную систему, а не разовую транзакцию.

## От Скрытого к Явному: Стратегия Кристаллизации

Эта архитектура позволяет использовать мощный подход, при котором игровая логика начинается с гибкого **Скрытого Набора Правил** и может постепенно кристаллизоваться в детерминированный **Явный Набор Правил**. Система спроектирована так, чтобы по умолчанию работать со Скрытым Набором Правил, рассматривая Явный Набор Правил как мощное, прогрессивное улучшение, а не как обязательное условие.

### 1. Скрытый Набор Правил

Наш основной принцип проектирования — начать с «худшего» сценария: игры, для которой не существует явного движка. Система создана для бесперебойной работы в этом режиме по умолчанию.

Здесь LLM действует как **«Универсальный Интерпретатор»**, фактически становясь дилером и судьёй в игре. Он использует `Schema` и `Context` из триплета, чтобы понимать правила, проверять действия и разумно продвигать состояние игры. Набор правил «скрытый» — он содержится в обширных знаниях LLM и информации, предоставленной в триплете, а не в явном коде. Базовый «универсальный движок» будет минимальным, управляя только рассадкой участников и основной последовательностью ходов. Остальное берёт на себя LLM, что обеспечивает беспрецедентную адаптивность.

### 2. Явный Набор Правил

Для игр, где у нас есть специальный движок (как наш существующий покерный движок), система работает в ускоренном, детерминированном режиме. Движок предоставляет Явный Набор Правил, который не заменяет основную функцию триплета, а мощно дополняет её. Он выполняет две основные функции:

- **Обеспечение детерминизма и предсказуемости:** Движок проверяет все действия на соответствие строгим правилам игры, подтверждая, что игрок может сделать в любой момент, и проверяя действия, выбранные ботами. Это гарантирует предсказуемый и честный игровой процесс.

- **Инженерия контекста:** Движок действует как sofisticated провайдер контекста. Он обогащает часть `Context` триплета ценной, специфичной для домена информацией. Это включает историческую статистику по поведению игроков, игровые паттерны и другую релевантную аналитику. Этот «спроектированный контекст» позволяет нашим ботам принимать гораздо более умные и стратегические решения.

В этом режиме игровой движок предоставляет явную, жёстко закодированную логику, которая служит источником истины и улучшает качество принятия решений нашими агентами, обеспечивая надёжность и интеллект системы.

### 3. От симуляции к спецификации: Новая парадигма разработки

Эта стратегия кристаллизации от скрытой к явной логике открывает революционный подход к разработке. Вместо того чтобы писать спецификацию для новой игры с нуля, мы сначала будем использовать «Реактор» с его стандартным Скрытым Набором Правил, чтобы _сыграть_ в эту игру.

1.  **Симуляция:** Мы предоставляем Реактору триплет, описывающий новую игру (например, домино), даже совершенно новую. LLM, действуя как универсальный интерпретатор, начнёт симулировать игровой процесс.
2.  **Генерация:** В процессе игры LLM генерирует логи, рассуждения и широкий спектр игровых сценариев.
3.  **Спецификация:** Затем мы используем этот богатый, симулированный вывод как сырьё для написания надёжной, проверенной в деле спецификации и полного набора тестов.

Симуляция предшествует коду и формирует его. Мы можем понять и изучить динамику и крайние случаи игры до того, как будет написана хотя бы одна строка кода детерминированного движка. Это значительно ускоряет разработку и приводит к созданию более надёжных и чётко определённых игровых движков.

## Агенты с состоянием и долговременная память

Критически важной возможностью Реактора является то, что агенты, работающие в нём, обладают состоянием. Это не простые боты, выполняющие разовые команды. Поскольку система построена на персистентных рабочих процессах, каждый агент может сохранять долговременную память о своих взаимодействиях.

Агент может помнить, что происходило в предыдущих раундах, вспоминать стратегии из совершенно других игр и со временем изучать тенденции других игроков. Эта способность сохранять состояние — ключевое отличие, превращающее агентов из простых реактивных компонентов в сущности, которые учатся и адаптируются в своей среде. Это позволяет достичь гораздо более сложного и стратегического поведения, чем могла бы обеспечить модель без сохранения состояния «запрос-ответ».

## Бизнес-перспективы

Этот архитектурный сдвиг имеет глубокие бизнес-последствия:

- **Быстрое внедрение:** Мы можем предложить клиентам возможность интегрировать новые игры и даже сложные бизнес-процессы с минимальными инженерными затратами. Универсальный путь позволяет нам запускать ботов для новой игры в тот момент, когда мы получаем её схему, даже до реализации специального движка.
- **Чёткая спецификация:** Мы можем предоставить клиентам или сторонним разработчикам чёткий формат спецификации (игровая `Schema`), что позволит им создавать новые игровые движки, которые напрямую подключаются к нашей среде исполнения. Наш подход «сначала симуляция» поможет нам и нашим партнёрам создавать эти спецификации быстрее и точнее.
- **Спецификация как услуга:** Для клиентов, которым сложно определить сложные системы (например, программу членства или вознаграждений), мы можем рассматривать их процесс как «игру». Наш Реактор может симулировать процесс, используя Универсальный Путь, помогая им уточнить правила и автоматически создавая надёжную спецификацию и набор тестов. Это решает серьёзную бизнес-проблему и само по себе становится ценной услугой.
- **Немедленная функциональность:** Наша система может начать запускать ботов для новой игры в тот момент, когда мы получаем её схему, даже до реализации специального движка.

Рефакторинг нашей среды исполнения для работы с протоколом — это не просто улучшение существующего продукта. Мы создаём надёжный фундамент для экосистемы автономных агентов, способных освоить любую игру, что открывает безграничные возможности для расширения и инноваций.

## Соответствие общему видению

Этот стратегический сдвиг не просто улучшает наш игровой продукт; он объединяет всю нашу линейку продуктов под единым видением. Эта работа является непосредственным и практическим расширением нашей цели по созданию децентрализованной, peer-to-peer сети для идей, как описано в _Эдикте Автономности_.

**Первый клиент и доказательство концепции**
Эта переработанная среда исполнения послужит первым кастомным клиентом для нашего протокола **«Триплет Идей»**. Это критически важное доказательство концепции, демонстрирующее на реальном коммерческом приложении, как эта абстрактная модель может создавать ощутимую ценность, гибкость и интеллект.

**За рамками игр: универсальная модель взаимодействия**
Архитектура, которую мы строим, не ограничивается играми. Она предоставляет общую и мощную модель для реакции ИИ-агентов на дискретные изменения в любой среде. Если присмотреться, всё можно рассматривать как пошаговую игру: разговор, финансовую транзакцию, рабочий процесс управления проектом.

Реактор — это первый из многих таких микросервисов, «Преобразователей Идей». Тот же протокол будет поддерживать композитную экосистему сервисов, включая:

- Сервис **Резолвер**, который обогащает `Idea`, извлекая и встраивая связанные данные из базы данных.
- Сервис **Статистики**, который анализирует `Idea` и добавляет исторический или статистический контекст.
- Сервис **Валидации**, который проверяет `Idea` на соответствие набору правил и предоставляет обратную связь для повторных попыток.

Создавая систему, которая осваивает эту модель взаимодействия, мы создаём фундаментальную технологию — своего рода «Unix-подобный инструмент» в большой экосистеме сервисов, который можно применять к широкому спектру будущих продуктов и услуг, делая этот проект краеугольным камнем будущего нашей компании.