# 102: Концепция/Суверенитет

> Sidenote:
>
> - Требуется:
>   - [Протокол Идеи](./101_concept_idea.md)
>   - [Протокол: Идеаторы](./103_concept_ideator.md)
> - Обеспечивает: Практическое развертывание экосистемы.

## 1. Введение

Этот документ описывает протокол **Суверенитета**, который определяет спектр автономии, доступный создателям в экосистеме. Он описывает многоуровневую архитектуру для хостинга и исполнения, позволяя участникам выбирать желаемый уровень контроля: от использования полностью управляемых сервисов до самостоятельного хостинга полного, суверенного решения.

Эта модель — практический мост между абстрактным `Идеатором` и конкретным, работающим сервисом.

## 2. Многоуровневая архитектура

Экосистема состоит из пяти отдельных уровней (1-5), каждый из которых строится на базовом уровне **Децентрализованной Идентичности**, описанном в [Протоколе Идеи](./101_concept_idea.md). Эта модель позволяет создателям участвовать на том уровне, который соответствует их потребностям — от простой децентрализованной идентичности до полнофункционального управляемого веб-сервиса.

Эту модель полезно рассматривать как спектр автономии. На одном конце находится управляемый сервис, обеспечивающий удобство. На другом — **полный суверенитет**: использование собственного домена и самостоятельный хостинг всех сервисов, что фактически делает вас собственным провайдером. Управляемые уровни служат необязательным, последовательным мостом между этими двумя состояниями.

### Уровень 1: Управляемый хостинг

Этот уровень предоставляет мгновенное решение для хостинга исходного файла Идеатора без каких-либо сложностей.

- **Как это работает:** В качестве простой точки входа мы предлагаем разместить исходный файл Идеатора пользователя в нашем S3-бакете. Созданная нами `TXT`-запись для их управляемого поддомена будет указывать на этот S3 URL. В любой момент пользователь может разместить файл в другом месте и обновить свою `TXT`-запись, чтобы она указывала на новое местоположение (например, на собственный сервер, IPFS и т.д.).
- **Цель:** Избавить создателей от необходимости настраивать собственный хостинг файлов для начала работы.

---

### Уровень 2: Генерация статического UI

Этот уровень делает Идеаторы доступными и полезными для людей без необходимости вычислений на стороне сервера.

- **Как это работает:** Для всех доменов Идеаторов, выбравших эту услугу, предоставляется общая статическая веб-страница. Когда пользователь заходит на домен Идеатора в браузере, клиентский JavaScript на этой странице выполняет запрос DNS-over-HTTPS (DoH) для получения `TXT`-записи домена, извлекает URL-адрес исходного файла (с хостинга Уровня 1), загружает файл определения Идеатора и динамически отрисовывает пользовательский интерфейс.
- **Цель:** Предоставить бесплатное, готовое к использованию веб-приложение для любого Идеатора, снижая порог входа.

---

### Уровень 3: `GET`-эндпоинт на базе CDN

Этот уровень улучшает межмашинное взаимодействие для чтения определения Идеи.

- **Как это работает:** Размещая CDN перед уровнем хостинга, мы можем использовать правила перезаписи запросов. `GET`-запрос к домену Идеи интеллектуально направляется CDN для отдачи JavaScript-модуля. Это позволяет разработчикам использовать **именованный экспорт** для прямого импорта определенных частей `Идеи` (например, `import { schema } from '...'`). Ответ также может включать заголовок `X-TypeScript-Types`, указывающий на файл декларации TypeScript (`.d.ts`), для обеспечения наилучшего опыта разработки. Необработанный документ `Идеи` остается доступным через заголовок `Accept: application/json`.
- **Цель:** Обеспечить мощный и идиоматичный программный доступ с полной безопасностью типов.

---

### Уровень 4: Публикация (`PUT`)

Этот уровень предоставляет возможность программно публиковать и обновлять Идею.

- **Как это работает:** Этот уровень обрабатывает аутентифицированные `PUT`-запросы к домену Идеи. Один запрос может загрузить новую версию исходного файла Идеи и атомарно обновить все необходимые записи, чтобы новая версия стала активной.
- **Цель:** Предоставить безопасный и простой API для создателей, чтобы управлять жизненным циклом своих Идей.

---

### Уровень 5: Полноценное исполнение API (`POST`)

Это высший уровень функциональности, превращающий Идеатор в настоящий, вызываемый веб-сервис.

- **Как это работает:** Этот уровень обрабатывает `POST`-запросы к домену Идеатора, исполняя его логику. Это может быть реализовано через управляемую бессерверную функцию или путем самостоятельного хостинга собственного эндпоинта пользователем.
- **Цель:** Предоставить всю мощь бессерверной архитектуры, позволяя любому опубликовать полнофункциональный микросервис, имея лишь статический файл определения.

## 3. Спецификация API

Все HTTP-взаимодействия происходят в корне домена Идеи (`/`).

- **`GET /`**
  - С заголовком `Accept: text/html` (Уровень 2): Возвращает загрузчик статического UI или перенаправляет на `page` URL.
  - С заголовком `Accept: application/json` (Уровень 3): Возвращает исходный JSON-файл Идеи.
- **`PUT /`** (Уровень 4)
  - Требуется аутентификация. Один `PUT`-запрос одновременно загружает новый исходный файл Идеи и атомарно обновляет `code` URL в `TXT`-записи, чтобы новая версия стала активной.
- **`POST /`** (Уровень 5)
  - Требуется аутентификация/авторизация. Исполняет Идеатор.
  - Тело запроса — это JSON-объект, содержащий полезную нагрузку, например: `{"context": "Входные данные от пользователя для обработки"}`.