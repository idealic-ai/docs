# 003: Агент/Действие

> [!DEFINITION] [Действие](./000_glossary.md)
> Это конкретный код, который выполняет работу для «Инструмента». Действие — это как рецепт для повара: оно говорит, что именно нужно сделать, чтобы выполнить задачу, например, запросить данные с другого сайта или что-то сохранить.

> Sidenote:
> - Требуется: [002: Агент/Инструмент](./002_agent_tool.md)

Этот документ объясняет, как работают **Действия**. Если `Инструмент` — это описание того, *что* можно сделать, то `Действие` — это *как* это сделать, то есть сам работающий код.

## Архитектура с двумя списками

Чтобы отделить описание от реального выполнения, система использует два разных списка:

*   **Список Инструментов**: Хранит описания того, что можно делать (например, «Узнать погоду»).
*   **Список Действий**: Хранит сам код, который выполняет эту работу (например, код, который подключается к сайту погоды).

Представь, что у тебя есть меню в ресторане и кухня. Меню (`Список Инструментов`) просто говорит, какие блюда есть. А на кухне (`Список Действий`) есть повара и рецепты, которые знают, как эти блюда приготовить. Такое разделение делает систему очень гибкой.

Можно использовать «воображаемые» блюда, когда повар (ИИ) просто придумывает результат, или приготовить настоящее блюдо по рецепту. А еще можно поменять рецепт на кухне, а в меню название блюда останется прежним.

## Как зарегистрировать Действие

Каждому `Действию` дается уникальное имя, чтобы его можно было связать с `Инструментом`.

```typescript
// Регистрируем код для Действия.
// По правилу, Действие можно связать с Инструментом с таким же именем.
Activity.register('weatherCheck', async call => {
  const data = await weatherAPI.get(call.location);
  return { temperature: data.temp, conditions: data.desc };
});
```

## Два способа выполнения: Скрытый и Явный

Когда агент использует `Инструмент`, есть два способа получить результат:

*   **Скрытое выполнение**: ИИ использует свое «воображение». Он не выполняет реальный код, а просто «придумывает» наиболее вероятный ответ. Это происходит, если для `Инструмента` не нашлось подходящего `Действия`.
    > Sidenote:
    > - [104: Концепция/Скрытое](./104_concept_latent.md)
*   **Явное выполнение**: Вызывается настоящий, работающий код (`Действие`). Это нужно для задач, где важна точность: получить данные с сайта, что-то посчитать или сохранить в базу данных.

## Как система выбирает способ выполнения

Система сама решает, какой способ использовать, без сложных настроек. Поле `_activity` в описании `Инструмента` — это намек на то, что для него существует реальный код. Вот как это работает:

1.  **Прямое указание**: Если в описании `Инструмента` прямо указано имя в поле `_activity`, система ищет `Действие` с этим именем.
2.  **Правило одинаковых имен (Рекомендуется)**: Если поле `_activity` пустое, система ищет `Действие`, имя которого совпадает с именем `Инструмента`. Если находит — они связываются автоматически.
3.  **Запасной вариант (Скрытое выполнение)**: Если `Действие` не найдено ни одним из способов, система решает, что эту задачу нужно выполнить «в уме», то есть скрыто.

Благодаря этому правила очень простые:

*   **Чтобы всё работало само, называй `Действие` и `Инструмент` одинаково.**
*   `Инструменты` без кода будут безопасно выполняться с помощью «воображения» ИИ.
*   Если нужно, можно всегда явно указать, какой код использовать, и это будет иметь приоритет.

## Зачем вообще разделять Инструменты и Действия?

Если бы описание `Инструмента` и код `Действия` были одним целым, то любая мелочь превращалась бы в проблему. Например, чтобы поменять способ получения данных (вместо воображения ИИ использовать реальный сайт), пришлось бы искать и исправлять всех агентов, которые используют этот `Инструмент`.

А благодаря разделению на два списка, мы можем менять «рецепт» на кухне (`Действие`), не трогая «меню» (`Инструмент`). Агенты всегда видят одно и то же описание, не зная, как именно оно выполняется.

Это позволяет:

*   **Менять код без поломок**: Можно заменить «воображаемый» ответ на реальный, и агент этого даже не заметит.
*   **Тестировать разные подходы**: Можно сравнить, что работает лучше для одной и той же задачи — воображение ИИ или настоящий код.
*   **Внедрять изменения постепенно**: Можно дать новый код только некоторым агентам, а остальные будут пользоваться старым или «придумывать» результат.

## От описания к действию

Итак, мы отделили «что» (`Инструмент`) от «как» (`Действие`), сделав систему гибкой. Но это лишь часть истории. Теперь, когда у нас есть описание и код, нужно понять, как всем этим управлять: как запускать, отслеживать и выстраивать задачи в цепочку.

Следующий документ, [004: Агент/Вызов](./004_agent_call.md), расскажет, как система управляет выполнением и превращает абстрактные описания в конкретные действия.
