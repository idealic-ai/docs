# 003: Агент/Действие

> **Действие:** Это конкретный код, который выполняет работу для «Инструмента». Это как мотор в машине, который заставляет её ехать. Действие нужно для задач, которые искусственный интеллект (ИИ) не может сделать просто «в уме» — например, проверить погоду в интернете или сохранить что-то в памяти. — [Словарь](./000_glossary.md)

> Sidenote:
> - Требуется: [002: Агент/Инструмент](./002_agent_tool.md)

Этот документ объясняет **Протокол Действий**, который описывает, как «Инструменты» (описания задач) связываются с настоящим, работающим кодом.

Представь, что «Инструмент» — это кнопка в приложении с надписью «Узнать погоду». А «Действие» — это тот самый код, который запускается при нажатии на эту кнопку: он идёт в интернет, находит сайт с погодой и возвращает тебе температуру.

## Архитектура двух списков

Чтобы отделить идею от её воплощения, система использует два разных списка:

*   **Список Инструментов:** Здесь хранятся только описания того, что можно сделать (например, «кнопка для проверки погоды»).
*   **Список Действий:** Здесь хранится сам код, который выполняет работу (например, «код, который заходит на сайт погоды»).

Такое разделение делает систему очень гибкой. Можно сначала создать «Инструмент», работу которого ИИ будет просто воображать. А потом, не меняя сам «Инструмент», подключить к нему разный код — один для тестов, другой для настоящей работы.

## Как зарегистрировать Действие

Каждому «Действию» (кусочку кода) дают уникальное имя. По этому имени его можно будет найти и связать с «Инструментом».

```typescript
// Регистрируем код для Действия.
// Обычно Действию дают то же имя, что и у Инструмента, которым оно будет управлять.
Activity.register('weatherCheck', async call => {
  // Код обращается к погодному сервису и получает данные
  const data = await weatherAPI.get(call.location);
  // Возвращаем результат
  return { temperature: data.temp, conditions: data.desc };
});
```

## Как это работает: В уме или по-настоящему?

Когда ИИ использует «Инструмент», он может выполнить задачу двумя способами:

*   **Скрытое исполнение (в уме):** ИИ использует свою логику и воображение, чтобы «придумать» результат. Он как бы представляет, что могло бы получиться, и сразу выдаёт ответ. Это происходит, если для «Инструмента» не нашлось реального кода.
    > Sidenote:
    > - [104: Концепция/Скрытое](./104_concept_latent.md)
*   **Явное исполнение (по-настоящему):** Вызов «Инструмента» передаётся настоящему коду — «Действию». Этот код выполняется и возвращает точный результат. Этот способ необходим для общения с внешним миром (например, с сайтами или базами данных) или для задач, где нужна 100% точность.

## Как система решает, какой способ выбрать

Система сама решает, как выполнить задачу — «в уме» или по-настоящему. Для этого она смотрит на специальное поле `_activity` в описании «Инструмента» и следует простым правилам:

1.  **Прямое указание:** Если в описании «Инструмента» чётко прописано имя «Действия» в поле `_activity`, система ищет код именно с этим именем.
2.  **Правило одинаковых имён (рекомендуется):** Если поле `_activity` пустое, система ищет в списке «Действий» код, имя которого **полностью совпадает** с именем «Инструмента». Если находит — они автоматически связываются.
3.  **Запасной вариант (в уме):** Если по первым двум правилам код не нашёлся, система решает, что эту задачу нужно выполнить «в уме» (скрытое исполнение).

Благодаря этому всё работает очень просто:

*   **Хочешь, чтобы Инструмент работал по-настоящему? Просто дай коду-Действию такое же имя.**
*   «Инструменты», для которых нет кода, автоматически будут выполняться «в уме» — это безопасно и ничего не сломает.
*   Если нужно, чтобы один и тот же код выполнял работу для разных «Инструментов», можно прописать его имя в поле `_activity` напрямую.

## Почему так важно разделять Инструменты и Действия

Представь, что описание «Инструмента» и его код были бы одним целым. Тогда, чтобы поменять способ проверки погоды (например, перейти с одного сайта на другой), пришлось бы найти и переписать всех агентов, которые этим пользуются. Это неудобно.

Наша система с двумя списками решает эту проблему. Описания «Инструментов» остаются неизменными, а код, который за ними стоит, можно менять когда угодно. Агенты всегда видят одну и ту же «кнопку», не зная, какой моторчик её крутит.

Это даёт суперспособности:

*   **Изменение кода не ломает агентов:** Можно заменить выполнение «в уме» на настоящий код, и агент этого даже не заметит.
*   **Можно тестировать разные подходы:** Например, сравнить, что работает лучше для одной и той же задачи, — логика ИИ или обращение к внешнему сайту.
*   **Можно внедрять обновления постепенно:** Запустить новый код только для части агентов, пока остальные используют старый или выполняют задачу «в уме».

## От описания к действию

Итак, мы разделили «что делать» (`Инструмент`) и «как делать» (`Действие`), что дало нам гибкость. Но это только часть истории. Теперь, когда у нас есть описания и их код, остался последний шаг — организовать их работу: как вызовы этих инструментов управляются, выполняются и выстраиваются в цепочки.

Следующий документ, [004: Агент/Вызов](./004_agent_call.md), расскажет о протоколе, который превращает абстрактные описания в конкретные действия.