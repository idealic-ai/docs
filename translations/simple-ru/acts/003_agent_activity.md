# 003: Агент/Действие

> **Действие:** Это конкретная программа, которая всегда работает одинаково и выполняет то, что обещает `Инструмент`. Это способ делать что-то, для чего нужно обращаться к внешнему миру (например, к сайту погоды), базе данных или выполнять любую задачу, с которой нейросеть не может справиться в своём «воображении». — [Глоссарий](./000_glossary.md)

> Sidenote: - Требуется: [002: Агент/Инструмент](./002_agent_tool.md)

Этот документ описывает **Протокол Действий**, который определяет, как `Инструменты` подкрепляются настоящим, исполняемым кодом. Если `Инструмент` — это описание того, *что* можно сделать, то `Действие` — это то, *как* это сделать на самом деле.

## Архитектура Двух Реестров

Представь, что у системы есть две разные записные книжки. Это нужно, чтобы отделить описание способности от её реального воплощения:

- **Реестр Инструментов**: Хранит описание того, что умеют `Инструменты`. Это как меню в ресторане — оно только описывает блюда.
- **Реестр Действий**: Хранит настоящие программы (`Действия`), которые выполняют работу. Это как рецепты на кухне, по которым повар готовит блюда из меню.

Такое разделение — ключ к гибкости системы. Оно позволяет `Инструментам` работать в «режиме воображения» (когда нейросеть сама придумывает результат), а также позволяет легко заменять одну программу на другую (например, простую для теста и сложную для настоящей работы), не меняя описание в «меню».

## Регистрация Действия

`Действие` регистрируется под уникальным именем, которое связывает его с `Инструментом`.

```typescript
// Регистрируем настоящую программу (Действие).
// Имя 'weatherCheck' должно совпадать с Инструментом, который оно выполняет.
Activity.register('weatherCheck', async call => {
  const data = await weatherAPI.get(call.location);
  return { temperature: data.temp, conditions: data.desc };
});
```

## Режимы Выполнения: Скрытый и Явный

Когда агент использует `Инструмент`, система может работать в двух разных режимах:

- **Скрытое выполнение**: Система использует «воображение» нейросети. Агент «продумывает» задачу и сразу выдаёт ответ. Это как спросить у очень умного друга, какая погода в Париже, и он, основываясь на своих знаниях, даст правдоподобный ответ. Этот режим используется по умолчанию, если для `Инструмента` не найдено реальной программы.
  > Sidenote: - [104: Концепция/Скрытое](./104_concept_latent.md)
- **Явное выполнение**: Система вызывает настоящую программу. `Действие` запускается, чтобы получить точный результат. Это необходимо для общения с внешним миром (например, с сайтами или базами данных) или для задач, где нужна 100% точность. Это как взять телефон и посмотреть погоду в приложении.

## Как система решает, что делать

Системе не нужны сложные настройки, чтобы выбрать режим. Она сама решает, что делать, когда вызывается `Инструмент`. В описании `Инструмента` есть специальное поле `_activity`, которое подсказывает, что нужно искать настоящую программу. Вот как это работает:

1.  **Прямое указание**: Если в описании `Инструмента` прямо указано имя в поле `_activity`, система ищет программу с этим именем.
2.  **Совпадение по имени (Рекомендуется)**: Если поле `_activity` пустое, система ищет `Действие` с **таким же именем**, как у `Инструмента`. Если находит, то автоматически связывает их.
3.  **Запасной вариант (Скрытый режим)**: Если по первым двум правилам ничего не нашлось, система решает, что реальной программы нет, и просит нейросеть «вообразить» результат.

Такой подход всё упрощает:

- **Чтобы всё работало без настроек, просто назови свою программу (`Действие`) так же, как и `Инструмент`.**
- `Инструменты`, для которых нет программы, будут безопасно работать в режиме «воображения».
- Если нужно, можно напрямую указать в `Инструменте` имя программы, и это всегда будет иметь приоритет.

## Зачем вообще разделять Инструменты и Действия?

Если бы мы не разделяли описание `Инструмента` и его программу (`Действие`), они были бы навсегда связаны. Чтобы поменять способ выполнения (например, вместо «воображения» нейросети начать использовать реальный сайт погоды), пришлось бы найти и изменить каждого агента, который использует этот `Инструмент`.

Архитектура с двумя реестрами решает эту проблему. Описания `Инструментов` остаются неизменными, а их «начинка» может меняться. Агенты всегда работают с одним и тем же «меню», не зная, готовит ли блюдо нейросеть или настоящая программа. Это значит, что:

- **Изменения в коде не ломают агентов**: Можно переключиться со «скрытого» режима на «явный», не трогая код агента.
- **Можно тестировать разные подходы**: Легко сравнить, что работает лучше для конкретной задачи — «воображение» нейросети или настоящая программа.
- **Можно обновляться постепенно**: Можно запустить новую программу только для части агентов, пока остальные продолжают использовать старую или режим «воображения».

## От Описания к Действию

Разделяя «что» (`Инструмент`) и «как» (`Действие`), система становится невероятно гибкой. Но это только часть истории. Когда у нас есть описания и программы, остаётся последний шаг — управление: как все эти вызовы запускаются, выполняются и выстраиваются в правильном порядке.

Следующий документ, [004: Агент/Вызов](./004_agent_call.md), расскажет о протоколе, который управляет этим процессом, превращая абстрактные описания в конкретные действия.
