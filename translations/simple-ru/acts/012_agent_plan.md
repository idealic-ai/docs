# 012: Агент/План

> **План:** Это как карта сокровищ, где каждый шаг — это «Вызов Инструмента». Эта карта показывает, в каком порядке нужно действовать, и ты не можешь вернуться назад, только двигаться вперёд. То, что ты будешь делать на следующем шаге, зависит от того, что ты сделал на предыдущем — всё это записывается в «Объект Состояния». — [Словарь](./000_glossary.md)

> [!WARNING]
> Этот документ — пока что заготовка, и в будущем мы его дополним. Он описывает главную идею Планов — более умного способа управлять действиями, который построен на основе систем Состояния и Вызовов.

> Sidenote:
> - Требует:
>   - [004: Агент/Вызов](./004_agent_call.md)
>   - [005: Агент/Цикл](./005_agent_loop.md)
>   - [010: Агент/Состояние](./010_agent_state.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)

Этот документ описывает **Протокол Плана**. Он помогает агентам (нашим умным программам) перейти от простых реакций на события к выполнению сложных многоходовых задач. Представь, что агент научился не просто отбивать мячик, а играть в целую шахматную партию. `План` — это не просто список команд. Это умная `Идея`, которая, как дирижёр, руководит другой `Идеей` (с данными) и направляет её по разным сервисам-помощникам.

## 1. План как внешний дирижёр

Самое главное правило Протокола Плана — это **передача управления**. `План` — это не часть той `Идеи` с данными, над которой он работает. Представь, что у тебя есть конструктор (это `Идея` с данными) и инструкция по сборке (это `План`). Инструкция — это отдельная книжка, а не деталь конструктора. Сам конструктор очень простой и просто хранит записку: «Сейчас меня собирают по этой инструкции». А в самой инструкции отмечено, на каком ты сейчас шаге.

Такое разделение даёт несколько больших плюсов:

- **Гибкость**: Одна и та же `Идея` (например, твоя фотография) может одновременно участвовать в разных делах. Её могут и улучшать, и отправлять другу, и печатать — по трём разным планам сразу. Это возможно, потому что у неё нет своего встроенного плана действий.
- **Всё под контролем**: `План` — это единственный источник правды о том, на каком этапе находится работа. Его `решение` (solution) — это как закладка в инструкции, которая показывает, какой шаг сейчас выполняется. Это позволяет следить за процессом и продолжать с того же места, если что-то пошло не так.
- **Адаптивность**: Поскольку `План` — это тоже `Идея`, другие умные программы могут создавать его, изменять или объединять с другими планами. Это позволяет создавать очень гибкие и самообучающиеся процессы, которые подстраиваются под задачу.

## 2. Управление и исполнение

`План` — это карта действий (`Вызовов Инструментов`), по которой можно двигаться только вперёд. Эта карта выполняется внутри **[Цикла Агента (Agent/Loop)](./005_agent_loop.md)**. Один такой цикл может сделать несколько дел одновременно, но `План` позволяет агенту следовать длинной цепочке шагов, где одно зависит от другого. Так агент выполняет много циклов подряд, чтобы достичь большой цели.

Когда один из сервисов-помощников заканчивает свою работу над `Идеей`, он смотрит на ссылку на `План` (которая передаётся вместе с задачей) и спрашивает: «Куда отправить дальше?». `План` решает, к какому следующему помощнику направить `Идею`.

Для очень долгих и сложных процессов выполнение `Плана` лучше доверить специальной программе-менеджеру (например, Temporal). Она похожа на очень надёжного прораба на стройке: она запоминает состояние всего проекта, даже если он длится неделями и выполняется на разных компьютерах, и ничего не теряет.

## 3. Безопасность и конфиденциальность

Так как вся логика управления находится в `Плане`, он работает как надёжный охранник информации.

- **Разделение информации**: Каждый сервис-помощник знает только свою маленькую задачу. Он получает `Идею`, делает своё дело и возвращает её обратно дирижёру (`Плану`). Он не знает, откуда `Идея` пришла и куда пойдёт дальше. Это как в шпионском фильме, где каждый агент знает только свою часть миссии.
- **Управление секретами**: `План` может надёжно хранить все секреты, например, пароли или ключи. Когда какому-то помощнику для работы нужен пароль, `План` даёт его только ему и только на время работы. Секреты не записываются в саму `Идею`, поэтому они в безопасности.

Такая модель делает систему быстрой и безопасной. Она позволяет создавать сложные процессы, в которых `План`-дирижёр сам следит за конфиденциальностью и правами доступа.
