# 108: Концепция/Видимость

> [!DEFINITION] :term[Видимость]{canonical="Visibility"}
> Это набор правил, который определяет, какую версию :term[Идеи]{canonical="Idea"} мы видим в определённой ситуации. Видимость зависит от истории версий :term[Идеи]{canonical="Idea"}, её веток и пути поиска того, кто её запрашивает.

> Sidenote:
> - Требует:
>   - :term[107: Концепция/Идентичность]{href="./107_concept_identity.md"}
> - Открывает возможности для:
>   - :term[109: Концепция/Адресация]{href="./109_concept_addressing.md"}

Чтобы система развивающихся и связанных друг с другом :term[Идей]{canonical="Idea" href="./101_concept_idea.md"} была полезной, нужен ясный и предсказуемый способ определять, какая версия :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"} видна в каждом конкретном случае. Этот документ описывает модель, которая управляет :term[видимостью]{canonical="Visibility"}. Она состоит из двух частей: системы версий, которая создаёт разные состояния :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"}, и механизма выбора, который решает, какое из этих состояний показать.

## Версионирование: Создание состояний для просмотра

Прежде чем выбрать версию, она должна существовать. :term[Иерархическое версионирование]{canonical="Hierarchical Versioning"} — это механизм для создания и отслеживания различных состояний :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"} с течением времени. Версия — это не просто число, а целая история эволюции :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"}, записанная в виде чисел, разделённых точками.

Версии состоят из **целочисленных ревизий** для последовательных публичных выпусков (например, `1.2`) и **ревизий в ветках** для именованных линий разработки (например, `feature-x`). Например, версия `1.2.feature-x.3` говорит нам, что это третья ревизия в ветке `feature-x`, которая была создана из версии `1.2`.

Правила изменения версий:

- **Совместимые изменения**: Это правки, которые ничего не ломают. Новую версию можно безопасно использовать вместо старой. Примеры: изменение данных в `context` или `solution`, или добавление нового поля в `schema`. Такие изменения создают новую минорную ревизию (например, `1.2` становится `1.2.1`).
- **Ломающие изменения**: Это изменения, после которых новую версию нельзя просто так использовать вместо старой. Обычно это происходит при удалении или изменении существующих полей в `schema`. Такие изменения должны «подниматься» на более высокий уровень иерархии версий (например, изменение, ломающее совместимость с `1.2`, создаст версию `1.3`). Система может автоматически обнаруживать такие ломающие изменения в схеме.

## Выбор: Определяем видимое состояние

Когда у нас есть богатая история версий, нужен механизм, чтобы выбрать правильную. Эта задача решается чётким разделением между тем, как :term[Идея]{canonical="Idea" href="./101_concept_idea.md"} публикуется, и тем, как она запрашивается. Процесс имеет два измерения для запроса: **пространственное** (в каких разделах искать) и **временное** (на какой момент времени).

### Ветки: Публикация и разделение

> [!DEFINITION] :term[Ветка]{canonical="Branch"}
> Именованная метка, которая делит пространство видимости, создавая параллельную, изолированную среду для разработки и экспериментов. Связывание :term[Идеи]{canonical="Idea"} с веткой — это акт её публикации.

Например, каждая версия :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"} в базе данных связана с одной или несколькими :term[ветками]{canonical="Branch"}, например `["main", "feature/new-billing"]`. Этот акт публикации делает :term[Идею]{canonical="Idea" href="./101_concept_idea.md"} доступной в этих конкретных разделах, обеспечивая безопасный рабочий процесс.

Это даёт два основных преимущества:

- **Изоляция**: Работа над новой функцией (например, в :term[ветке]{canonical="Branch"} `feature/new-billing`) не мешает стабильной :term[ветке]{canonical="Branch"} `main`. Это предотвращает попадание не доделанной или ошибочной работы в основные системы.
- **Эксперименты**: :term[Ветки]{canonical="Branch"} легко и бесплатно создавать. Это поощряет эксперименты, позволяя разработчикам просто удалить :term[ветку]{canonical="Branch"}, если эксперимент не удался, без какого-либо влияния на основную систему.

### Путь Поиска: Приоритетный запрос

> [!DEFINITION] :term[Путь Поиска]{canonical="Search Path"}
> Упорядоченный список названий веток, который определяет механизм запроса. Он говорит системе, в каких разделах и в каком порядке искать, создавая систему «наслаивающихся» представлений.

Этот механизм запроса является ключевым для рабочего процесса разработки и отвечает на **пространственный** вопрос. Например, типичный :term[путь поиска]{canonical="Search Path"} разработчика может быть установлен как `['feature/my-new-idea', 'staging', 'main']`.

Такая конфигурация создаёт каскадную систему для поиска:

1.  Сначала ищем подходящую :term[Идею]{canonical="Idea" href="./101_concept_idea.md"} в разделе `feature/my-new-idea`.
2.  Если не нашли, ищем в разделе `staging`.
3.  И наконец, если ничего не найдено, ищем в разделе `main`.

Это позволяет разработчику видеть определённую, нужную ему реальность, состоящую из его локальных изменений, которые органично накладываются поверх стабильной системы.

### Момент Среза: Временной запрос

> [!DEFINITION] :term[Момент Среза]{canonical="Cutoff Time"}
> Временная метка, которая сопровождает запрос на получение данных. Она указывает системе найти ту версию :term[Идеи]{canonical="Idea"}, которая считалась последней на этот конкретный момент времени.

Второе измерение запроса — **временное**. Каждый запрос выполняется относительно состояния системы, каким оно было в определённый момент. Это контролируется :term[Моментом Среза]{canonical="Cutoff Time"}.

Если :term[момент среза]{canonical="Cutoff Time"} не указан, по умолчанию используется текущее время (`now()`), и система находит самые свежие видимые версии. Однако, указав метку времени из прошлого, можно выполнить «запрос в прошлое». Это указывает системе найти ту версию :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"} — и всех её зависимостей, — которая была последней согласно :term[пути поиска]{canonical="Search Path"} в тот самый момент. Эта возможность является технической основой для идеальной воспроизводимости.

> Sidenote:
> - :term[107: Концепция/Идентичность]{href="./107_concept_identity.md"}

## От модели к применению

В этой главе мы определили теоретическую модель :term[видимости]{canonical="Visibility"} — механизмы для создания различных состояний и выбора между ними. Теперь, когда модель готова, остался последний элемент — практический язык для взаимодействия с ней.

Следующий документ, :term[109: Концепция/Адресация]{href="./109_concept_addressing.md"}, представляет схему URI :term[idea:]{canonical="idea:"} — конкретный синтаксис, используемый для запроса определённого представления и навигации по этой богатой, версионированной и разветвлённой реальности.
