# 304: Идеатор/Наблюдатель

> **Наблюдатель:** «Исходный» :term[Идеатор]{canonical="Ideator"}, который постоянно следит за изменениями в сервисе :term[Хранилища]{canonical="Storage"}. Когда что-то меняется (например, сохраняется новая версия :term[Идеи]{canonical="Idea"}), он запускает новую операцию, обычно вызывая :term[План]{canonical="Plan"} для обработки новых данных.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
> - Требуется:
>   - [301: Идеатор/Хранилище](./301_ideator_storage.md)
>   - [011: Агент/План](./011_agent_plan.md)

## 1. Введение

Этот документ описывает **Протокол Наблюдателя**. Это очень важная часть системы, которая позволяет создавать рабочие процессы, работающие по событиям и не ждущие ответа сразу (асинхронно).

`Наблюдатель` (или Подписчик) — это постоянно работающий сервис, который следит за изменениями в `Хранилище` и, когда что-то меняется, запускает новые процессы.

Представьте его как почтальона. Почтальон не ждёт, пока вы напишете ответное письмо. Он просто доставляет вам письмо (событие), и вы уже сами решаете, что с ним делать дальше — например, начать писать ответ.

## 2. Наблюдатель как «исходный» Идеатор

В отличие от сервиса `Хранилища`, который является «приёмником» (завершает операции), `Наблюдатель` — это «источник». Его задача не закончить старую операцию, а **начать новую**.

Вот как это обычно работает:

1. Новая `Идея` сохраняется в `Хранилище`. Первая операция завершена.
2. `Хранилище` сообщает всем подписчикам, что произошло изменение.
3. `Наблюдатель`, который подписан на эти уведомления, получает сообщение.
4. `Наблюдатель` запускает совершенно новую, независимую операцию. Обычно он вызывает [:term[План]{canonical="Plan"} (011: Агент/План)](./011_agent_plan.md) и передаёт ему новую `Идею`, чтобы начать следующий этап работы.

## 3. Работа с долгими процессами

`Наблюдатель` — это ключ к управлению задачами, которые могут выполняться очень долго: часы или даже дни.

Допустим, у нас есть `План`, в котором есть шаг, требующий много времени (например, нужно дождаться ответа от человека или обработать огромный файл). Обычный `План` не может просто остановиться и «подождать» так долго.

Вместо этого `План` может поручить долгую задачу другому сервису и завершить свою работу. Когда тот сервис закончит, он сохранит результат в `Хранилище`. И тут в игру вступает `Наблюдатель`: он «увидит» этот новый результат и запустит *новый* `План`, чтобы продолжить работу с того места, где она остановилась.

Такой подход позволяет создавать очень надёжные и большие процессы. Они не зависят от памяти или времени жизни одного запущенного приложения. Длинная задача разбивается на серию коротких операций, каждая из которых запускается по своему событию.
