# 002: Агент/Инструмент

> [!DEFINITION] [Инструмент](./000_glossary.md)
> Это «чертёж», который описывает способность, доступную агенту. Он показывается большой языковой модели (ИИ) как часть запроса и работает как понятная инструкция для возможного действия. ИИ активирует инструмент, создавая :term[Вызов]{canonical="Call"} с конкретными параметрами. Этот вызов затем выполняется либо «в уме» самим ИИ (скрытое исполнение), либо с помощью специальной функции в коде (:term[Активности]{canonical="Activity"}).

> Sidenote:
> - Требуется: :term[001: Агент/Запрос]{href="./001_agent_request.md"}
> - Дополняется: :term[003: Агент/Действие]{href="./003_agent_activity.md"}

:term[Инструмент]{canonical="Tool"} — это, по сути, инструкция или «чертёж», который описывает действие, доступное агенту. Представь, что это как рецепт в кулинарной книге. Он служит основой для всех действий агента, давая ИИ своего рода «меню» с возможными вариантами поведения, из которого тот может выбирать.

## Что такое Инструменты?

**Инструменты — это фундамент** для всех действий агента. Они дают ему новую суперспособность: **выбирать действие в зависимости от ситуации**. Это позволяет агентам подбирать и выполнять наиболее подходящие действия, исходя из того, что происходит вокруг.

Что дают Инструменты:

- **Понятные инструкции**: Чётко описанные способности, которые агенты могут найти и понять.
- **Надёжность**: Ясные правила о том, какие данные нужны на входе и что должно получиться на выходе.
- **Сочетаемость**: Они как детали конструктора, которые можно соединять для создания сложных поведений.
- **Понятность для ИИ**: Инструкции, которые языковые модели могут анализировать и на основе которых могут делать выбор.

Когда агент заполняет конкретные параметры для Инструмента, он создаёт :term[Вызов]{canonical="Call"} — это как заполненный бланк заказа на выполнение действия, где указаны все детали.

> Sidenote:
> :term[004: Агент/Вызов]{href="./004_agent_call.md"}
>

## Когда использовать систему Инструментов

Используйте систему Инструментов, когда вам нужно, чтобы агенты:

- **Выбирали действия на лету**, в зависимости от ситуации.
- **Могли выбирать из нескольких разных способностей** для достижения цели.
- **Использовали разные способы** для выполнения одной и той же задачи (например, искали информацию в Google или в Яндексе).
- **Совмещали размышления ИИ с чёткими, заранее заданными правилами** при принятии решений.

## Инструкция как основа

Система Инструментов построена на простом правиле: **Инструменты — это просто «чертежи»**, которые описывают, *что* можно сделать, но не говорят, *как* именно это делать. Такое разделение инструкции и её выполнения — ключ к гибкости всей системы.

«Чертёж» `Инструмента` — это обычный объект JSON Schema. Любое поле без знака подчеркивания `_` в начале считается параметром (тем, что нужно «вписать» в бланк). Система использует специальные поля (начинающиеся с `_`) для системных настроек, которые управляют тем, как инструмент будет найден и запущен.

Чертёж Инструмента полностью описывает его:

> Sidenote:
> Расширения:
>
> - **`_activity`**: Связывает инструмент с конкретной функцией в коде для явного выполнения. См. :term[003: Агент/Действие]{href="./003_agent_activity.md"}
> - **`_delegate`**: Передаёт выполнение инструмента внешнему, изолированному исполнителю. См. :term[013: Агент/Делегат]{href="./014_agent_delegate.md"}
> - **`_outputPath`**: Делает инструмент «запоминающим», сохраняя его результат в специальном объекте. См. :term[008: Агент/Результат]{href="./008_agent_output.md"}
> - **`_instance`**: Направляет выполнение инструмента на конкретный экземпляр, если в запросе их несколько. См. :term[012: Агент/Экземпляры]{href="./013_agent_instancing.md"}

- **`title`**: Понятное человеку название (необязательно).
- **`description`**: Объяснение, что делает инструмент.
- **`properties`**: Поля без `_` описывают, какие данные нужны инструменту для работы.
- **`_tool`**: Уникальное имя для идентификации инструмента.
- **`_output`**: Описывает, как должен выглядеть результат работы.
- **`_reasoningForCall`**: Поле, которое система добавляет, чтобы агент объяснил, почему он выбрал именно этот инструмент.

Более сложные системы могут строить поверх этих простых «деталей» целые рабочие процессы, управляя порядком действий и их выполнением.

## Описание Инструмента

Инструменты описываются с помощью JSON-схем. В примере ниже показан `Инструмент` для определения тональности текста (например, позитивный он или негативный). Этот `Инструмент` рассчитан на скрытое исполнение — то есть ИИ сам, основываясь на своём понимании языка, должен выдать результат без запуска внешнего кода.

::::columns
:::column{title="Описание Инструмента"}

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует тональность текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

:::
:::column{title="Пример ответа от ИИ"}

```json
// Запрос: "Какая тональность у фразы 'Это лучшее, что я видел!'?"
{
  "_tool": "sentimentAnalysis",
  "text": "Это лучшее, что я видел!",
  "_output": {
    "sentiment": "positive",
    "confidence": 0.99
  }
}
```

:::
::::

## Сборка схем для ИИ

Агент не просто использует инструменты; часто ему нужно выдать какой-то итоговый, структурированный ответ после завершения задачи. Для этого система берёт «чертежи» всех доступных :term[Инструментов]{canonical="Tool"} и объединяет их с «чертежом» для финального ответа, который задал пользователь. Получается одна большая, общая инструкция, которая отправляется ИИ в виде :term[Запроса]{canonical="Request"}.

Такая сборка даёт ИИ выбор, как ответить. В зависимости от задачи, он может:

- **Создать только `meta` и `calls`:** Если для решения задачи нужно сделать несколько шагов, ИИ вызовет один или несколько инструментов, обновит версию :term[Идеи]{canonical="Idea"} в объекте `meta`, а поле `output` (финальный ответ) оставит пустым.
- **Создать только `meta` и `output`:** Если на вопрос можно ответить сразу, без инструментов, ИИ предоставит финальный результат в поле `output`, обновит `meta`, а `calls` (вызовы) оставит пустыми.
- **Создать всё сразу:** Иногда ИИ может выполнить действие и сразу же дать финальный ответ за один шаг, обновив `meta`.

Этот механизм позволяет использовать один и тот же гибкий подход как для простых ответов в одно действие, так и для сложных задач с использованием множества инструментов. Разработчик просто предоставляет «чертежи» `Инструментов` и «чертёж» для ответа по отдельности, а система сама собирает их в структуру, которую ИИ может использовать для принятия решений.

В примере ниже показано, как 