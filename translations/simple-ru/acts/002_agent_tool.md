# 002: Агент/Инструмент

> [!DEFINITION] [Инструмент](./000_glossary.md)
> Это как чертёж, который описывает способность, которую может использовать агент (наша умная программа). Этот чертёж показывается искусственному интеллекту (ИИ), и он работает как понятная инструкция для возможного действия. ИИ «активирует» инструмент, создавая «Вызов» с нужными данными. Этот вызов выполняется либо «скрыто» самим ИИ, либо «явно» с помощью специального кода, который называется «Действие» (`Activity`).

> Sidenote:
> *   Требуется: [001: Агент/Запрос](./001_agent_request.md)
> *   Дополняется: [003: Агент/Действие](./003_agent_activity.md)

`Инструмент` — это, по сути, схема-инструкция, которая описывает какое-то умение агента. Это как кубик в конструкторе, из которого строятся все действия агента. Благодаря инструментам ИИ понимает, из каких «кубиков» он может выбирать, чтобы что-то сделать.

## Что такое Инструменты?

**Инструменты — это основа** того, как действуют агенты. Они дают агентам новую крутую возможность: **выбирать действие по ситуации**. То есть агент смотрит, что происходит, и сам решает, какой инструмент лучше всего использовать прямо сейчас.

Что дают инструменты:

*   **Понятные инструкции**: Чётко описанные способности, которые агенты могут найти и понять.
*   **Защита от ошибок**: Понятные правила, что можно вводить и что получится на выходе.
*   **Возможность комбинировать**: Инструменты можно складывать вместе, как детали конструктора, чтобы выполнять сложные задачи.
*   **Понятны для ИИ**: Искусственный интеллект может «читать» эти схемы, думать о них и выбирать нужную.

Когда агент берёт Инструмент и заполняет все необходимые для него данные, он создаёт **Вызов** (`Call`) — это как бы готовый к исполнению приказ.

> Sidenote:
> [004: Агент/Вызов](./004_agent_call.md)
>

## Когда использовать Инструменты

Система Инструментов нужна, когда вы хотите, чтобы агенты:

*   **Сами выбирали действия** в зависимости от того, что происходит.
*   **Выбирали из нескольких вариантов**, чтобы достичь цели (например, искать в Google или в Яндексе).
*   **Использовали разные способы** для одного и того же действия (например, разные поисковики).
*   **Сочетали мышление ИИ с чёткими правилами** при принятии решений.

## Как устроена система Инструментов

### Главный принцип: Схема — это инструкция

Система Инструментов построена на одной простой идее: **Инструменты — это просто схемы**, которые описывают, *что* можно сделать, но не *как* это делать. Это разделение «что» и «как» — ключ к гибкости всей системы.

Схема `Инструмента` — это обычный JSON-объект. Любое поле без знака подчёркивания в начале — это параметр, то есть информация, которая нужна инструменту. А специальные поля (с `_` в начале) — это служебные настройки, которые объясняют системе, что это за инструмент и как его использовать.

Схема Инструмента полностью описывает его:

> Sidenote:
> Дополнительные возможности:
>
> *   **`_activity`**: Связывает инструмент с настоящим кодом для явного выполнения. ([003: Агент/Действие](./003_agent_activity.md))
> *   **`_delegate`**: Передаёт выполнение инструмента внешней, изолированной программе. ([012: Агент/Делегирование](./012_agent_delegate.md))
> *   **`_outputPath`**: Делает инструмент «запоминающим», сохраняя его результат в специальное хранилище. ([009: Агент/Состояние](./009_agent_state.md))
> *   **`_instance`**: Направляет выполнение инструмента на конкретный экземпляр, если их несколько. ([011: Агент/Инстансинг](./011_agent_instancing.md))

*   **`title`**: Название для человека (необязательно).
*   **`description`**: Объяснение, что делает инструмент.
*   **`parameters`**: Любые поля без `_` — это то, что нужно инструменту для работы.
*   **`_tool`**: Уникальное имя, чтобы отличать этот инструмент от других.
*   **`_output`**: Описание того, как должен выглядеть результат работы.
*   **`_reasoningForCall`**: Сюда агент записывает, почему он решил использовать именно этот инструмент.

Более сложные системы уже на основе этих простых «кубиков» строят целые процессы, управляют данными и решают, как и что выполнять.

## Описание Инструмента

Инструменты описываются с помощью схем в формате JSON. Пример ниже показывает `Инструмент` для определения настроения в тексте. Он рассчитан на «скрытое» выполнение, то есть ИИ сам справится с этой задачей, потому что он и так отлично понимает язык. Ему не нужна для этого сторонняя программа.

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует настроение текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

## Сочетание и выполнение схем

Хотя каждый Инструмент — это отдельная маленькая способность, вся их сила раскрывается, когда их много. Система показывает ИИ все доступные схемы `Инструментов` сразу, как меню в ресторане. ИИ может выбрать самый подходящий `Инструмент` для текущей задачи и передать ему нужные данные. Когда инструмент выбран и готов к работе, это называется `Вызов` (`Call`).

> Sidenote:
> *   [004: Агент/Вызов](./004_agent_call.md).

## Скрытое и явное выполнение

Схема `Инструмента` сама по себе — это всего лишь инструкция. А вот выполнить её можно двумя способами. По умолчанию используется **скрытое выполнение**: ИИ использует свои внутренние знания, чтобы выдать результат. Это идеально подходит для задач, связанных с языком или знаниями. Но для действий, которые требуют связи с внешним миром — например, отправить запрос в интернет или заглянуть в базу данных — `Инструмент` нужно подключить к настоящему коду. Такое явное, заранее написанное действие называется **Действие** (`Activity`).

Разделение инструкции (`Инструмент`) и её реального выполнения (`Действие`) — это ключевая идея. Она позволяет агенту сначала «думать» о своих возможностях в общем виде, а уже потом решать, как именно их применить. А сам код для выполнения можно легко поменять, не трогая «меню» способностей. Следующий документ, **[003: Агент/Действие](./003_agent_activity.md)**, расскажет, как `Действия` оживляют `Инструменты`.

> Sidenote:
> *   [003: Агент/Действие](./003_agent_activity.md).
