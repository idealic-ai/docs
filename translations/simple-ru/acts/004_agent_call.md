# 004: Агент/Вызов

> [!DEFINITION] [Вызов](./000_glossary.md)
> Это конкретная, готовая к выполнению инструкция для `Инструмента`, в которой указаны все нужные значения. Это как приказ, который говорит, что _нужно сделать_ прямо сейчас.

> Sidenote:
> - Требует:
>   - [002: Агент/Инструмент](./002_agent_tool.md)
> - Открывает возможности для:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
>   - [013: Агент/Области](./013_agent_scopes.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - [202: Идея/Носитель](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)
> - Расширяется:
>   - [012: Агент/Делегат](./012_agent_delegate.md)

Документ [002: Агент/Инструмент](./002_agent_tool.md) объяснил, как агенты понимают, на что они способны, с помощью структурированных схем. Этот документ описывает протокол **004: Агент/Вызов**, который основан на `Инструментах` и определяет, как именно происходит выполнение.

**Вызов** — это как бы «активированный» `Инструмент`, у которого все параметры заполнены, и он готов к работе. Если `Инструменты` — это список того, _что можно сделать_ (например, «нарисовать круг»), то `Вызовы` — это команда, _как это выполнить_ (например, «нарисовать круг радиусом 5 см в центре экрана»).

> [!HEADSUP] К сведению
> Когда [Запрос (001: Агент/Запрос)](./001_agent_request.md) приводит к созданию набора `Вызовов`, этот набор называется [Носителем (202: Идея/Носитель)](./202_idea_vessel.md). `Носитель` — это как бы один момент принятия решения, когда агент выбирает из доступных `Инструментов`, чтобы сформировать ответ.

## Композиция и Контекст

Сам по себе `Вызов` — это простая структура данных. Его сила в том, как он сочетается с другими правилами, которые управляют его выполнением. Эти правила включаются с помощью специальных «мета-свойств» (они начинаются с `_`) в схеме `Инструмента`. Это позволяет одному `Вызову` запускать самые разные действия.

Придавая этим мета-свойствам ясный смысл, мы позволяем ИИ активно участвовать в построении сложных цепочек команд. Он может размышлять о различных комбинациях этих свойств, чтобы создавать новые и сложные рабочие процессы, переходя от простого выбора инструмента к настоящей оркестровке задач.

> [!TIP]
> Следующий раздел объясняет связи с другими частями системы, о которых мы подробно поговорим позже. Не нужно спешить и перескакивать — мы все рассмотрим по порядку. Вы всегда сможете вернуться к этому разделу.

- **Явное Выполнение (`_activity`)**: Самое базовое расширение — это связать `Вызов` с конкретной частью кода, которая всегда работает одинаково. Свойство `_activity` — это сигнал, что `Вызов` должен быть выполнен настоящим кодом (мы называем это **Действием**), а не просто «продуман» ИИ.

  > Sidenote:
  > - [003: Агент/Действие](./003_agent_activity.md).

- **Делегированное Выполнение (`_delegate`)**: `Вызов` можно передать другому, внешнему исполнителю — **Делегату**. Свойство `_delegate` обычно содержит ссылку на сохраненный [Запрос](./001_agent_request.md) (часто в виде пути к файлу). Это позволяет использовать другой запрос как готовый инструмент. Представьте, что вы даете задачу специалисту, который выполняет ее в отдельной «чистой комнате», не мешая вашей основной работе.

  > Sidenote:
  > - [012: Агент/Делегат](./012_agent_delegate.md).

- **Управление Контекстом (`_scopes`)**: Протокол **Scopes** (Области видимости) контролирует, какая информация доступна для `Вызова`. В основном это используется, чтобы сфокусировать внимание ИИ во время «размышлений», указывая, какие части общей информации ему следует учитывать. Это как дать ученику только учебник по математике для решения задачи, чтобы он не отвлекался на книги по истории. Это предотвращает путаницу и помогает получить более надежный результат. При использовании с `_delegate` это свойство становится еще мощнее: оно строго определяет _весь_ контекст для изолированной работы делегата.

  > Sidenote:
  > - [013: Агент/Области](./013_agent_scopes.md).

- **Сохранение Состояния (`_outputPath`)**: `Вызов` может сохранять свой результат. Свойство `_outputPath` указывает, куда именно в специальном **Объекте Состояния** нужно записать результат `Вызова`. Это позволяет создавать многошаговые процессы, где результат одного `Вызова` становится исходными данными для другого.

  > Sidenote:
  > - [009: Агент/Состояние](./009_agent_state.md).

- **Работа с Экземплярами (`_instance`)**: `Вызов` можно направить на обработку конкретного **Экземпляра** в запросе, где их может быть много. Свойство `_instance` работает как уникальный номер, который говорит `Вызову`: «Все, что ты делаешь — читаешь данные, записываешь результат — делай только для этого экземпляра». Это позволяет эффективно и параллельно обрабатывать множество разных состояний с помощью одного и того же набора инструментов.
  > Sidenote:
  > - [011: Агент/Инстансинг](./011_agent_instancing.md).

## Способы выполнения Вызовов

Когда агент создает несколько `Вызовов` сразу, их можно выполнять по-разному, в зависимости от задачи:

```typescript
// Выполнить один Вызов
const result = await Tool(call);

// Выполнить все Вызовы и дождаться всех результатов
const results = await Tool.all(calls);

// Выполнять все, пока один не завершится успешно
const result = await Tool.any(calls);

// Выполнять все, вернуть результат самого первого, который завершится (неважно, успешно или нет)
const result = await Tool.race(calls);
```

Эти подходы позволяют:

- **Точно контролировать процесс**: Обрабатывать `Вызовы` по одному, добавляя свою логику между ними.
- **Обрабатывать пачками**: Выполнять независимые `Вызовы` одновременно для максимальной скорости.
- **Быстро получать результат**: Останавливаться после первого успеха (`.any()`) или первого завершения (`.race()`).
- **Действовать по принципу «все или ничего»**: Гарантировать, что все `Вызовы` в группе выполнятся успешно (`.all()`), сохраняя целостность данных.

## Организация Вызовов в цикле

Хотя эти способы помогают выполнить одну пачку `Вызовов`, агентам часто нужно решать многошаговые задачи, где результат одного шага влияет на следующий. Для этого существует протокол более высокого уровня, который управляет последовательностью `Запросов` и `Вызовов`.

Следующий документ, [005: Агент/Цикл](./005_agent_loop.md), подробно описывает этот цикл выполнения.
