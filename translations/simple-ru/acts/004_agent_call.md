# 004: Агент/Вызов

> [!DEFINITION] [Вызов](./000_glossary.md)
> Это как инструкция к :term[Инструменту], но уже с указанными деталями (параметрами). Если :term[Инструмент] — это шаблон действия, то :term[Вызов] — это конкретная, готовая к выполнению команда: «сделай вот это, именно так».

> Sidenote:
> - Требует:
>   - [002: Агент/Инструмент](./002_agent_tool.md)
> - Используется в:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
>   - [013: Агент/Области](./013_agent_scopes.md)
>   - [011: Агент/Экземплирование](./011_agent_instancing.md)
>   - [202: Идея/Носитель](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)
> - Расширяется:
>   - [012: Агент/Делегат](./012_agent_delegate.md)

Протокол :term[Инструмент] — это как чертёж, который помогает агентам (нашим ИИ-помощникам) понять, что они вообще умеют делать. Этот документ рассказывает о протоколе **:term[Вызов]**, который строится на основе :term[Инструментов] и объясняет, как именно выполняется действие.

:term[Вызов] — это готовый к исполнению :term[Инструмент] с уже заполненными данными. Если :term[Инструменты] описывают, *что можно сделать*, то :term[Вызовы] определяют, *как это будет сделано*.

> [!HEADSUP] На заметку
> Когда :term[Запрос]{href="./001_agent_request.md"} превращается в набор :term[Вызовов], он становится :term[Носителем]{href="./202_idea_vessel.md"}. :term[Носитель] — это как моментальный снимок решения, когда агент выбирает нужные :term[Инструменты] для ответа на задачу.
>
> > Sidenote:
> >
> > - [001: Агент/Запрос](./001_agent_request.md)
> > - [202: Идея/Носитель](./202_idea_vessel.md)

## Как всё собирается вместе

Сам по себе :term[Вызов] — это простая структура с данными. Его настоящая сила проявляется, когда он работает вместе с другими правилами, которые управляют его выполнением. Эти правила включаются с помощью специальных «мета-свойств» (они начинаются с `_`). Они позволяют одной команде :term[Вызова] запускать самые разные действия.

Давая этим мета-свойствам ясные имена и значения, мы позволяем ИИ-модели активно участвовать в построении логики. Она может обдумывать разные комбинации этих свойств, чтобы создавать сложные и новые цепочки действий. Это уже не просто выбор инструмента, а настоящая организация рабочего процесса.

> [!TIP]
> В следующем разделе объясняется, как эта часть системы связана с другими, о которых мы подробно расскажем позже. Не нужно спешить и перескакивать вперёд — мы всё рассмотрим по порядку. Вы всегда сможете вернуться к этому разделу.

- **Прямое выполнение (`_activity`)**: Самый простой способ — это связать :term[Вызов] с конкретным куском программного кода. Свойство `_activity` говорит системе, что этот :term[Вызов] должен быть выполнен не ИИ-моделью, а специальным :term[Действием], которое всегда работает одинаково.

  > Sidenote:
  > - [003: Агент/Действие](./003_agent_activity.md).

- **Перепоручение (`_delegate`)**: :term[Вызов] можно «перепоручить» внешнему помощнику — :term[Делегату]. Свойство `_delegate` обычно содержит ссылку на сохранённый :term[Запрос] (часто это просто путь к файлу). Это позволяет использовать другой запрос как готовый инструмент. Такой подход создаёт изолированную «чистую комнату» для выполнения, где ничто не мешает и не путается.

  > Sidenote:
  > - [012: Агент/Делегат](./012_agent_delegate.md).

- **Настройка окружения (`_scopes`)**: Протокол :term[Области] контролирует, какая информация доступна для :term[Вызова]. В основном это нужно, чтобы сфокусировать внимание ИИ-модели на конкретной части данных при выполнении. Это помогает избежать путаницы и получить более точный результат. Когда это используется вместе с `_delegate`, его роль становится ещё важнее: он строго определяет, какую информацию получит изолированный помощник.

  > Sidenote:
  > - [013: Агент/Области](./013_agent_scopes.md).

- **Сохранение результата (`_outputPath`)**: :term[Вызов] может запоминать свой результат. Свойство `_outputPath` указывает, куда именно в общем :term[Состоянии] нужно записать итог работы :term[Вызова]. Это позволяет создавать многошаговые процессы, где результат одного :term[Вызова] становится входными данными для другого.

  > Sidenote:
  > - [009: Агент/Состояние](./009_agent_state.md).

- **Работа с экземпляром (`_instance`)**: :term[Вызов] можно нацелить на конкретный :term[Экземпляр] данных, если их несколько. Свойство `_instance` работает как уникальный ярлычок, который указывает, что все операции этого :term[Вызова] (чтение, запись) должны относиться только к этому :term[Экземпляру]. Это позволяет эффективно и одновременно обрабатывать несколько наборов данных одними и теми же инструментами.
  > Sidenote:
  > - [011: Агент/Экземплирование](./011_agent_instancing.md).

## Способы выполнения Вызовов

Когда агент создаёт несколько :term[Вызовов] сразу, их можно выполнять по-разному, в зависимости от задачи:

```typescript
// Выполнить один Вызов
const result = await Tool(call);

// Выполнить все Вызовы и дождаться всех результатов
const results = await Tool.all(calls);

// Выполнить все и вернуть первый успешный результат
const result = await Tool.any(calls);

// Выполнить все и вернуть самый первый результат (неважно, успешный или нет)
const result = await Tool.race(calls);
```

Эти подходы позволяют:

- **Точно всё контролировать**: Обрабатывать :term[Вызовы] по одному, добавляя свою логику между ними.
- **Обрабатывать пачками**: Выполнять независимые :term[Вызовы] одновременно для максимальной скорости.
- **Быстро находить решение**: Останавливаться, как только найдётся первый успешный результат (`.any()`), или как только появится любой результат (`.race()`).
- **Делать всё или ничего**: Гарантировать, что все :term[Вызовы] в группе выполнятся успешно (`.all()`), чтобы сохранить целостность данных.

## Организация Вызовов в цикле

Эти шаблоны помогают управлять выполнением одной группы :term[Вызовов], но часто агентам нужно выполнять задачи в несколько шагов, где результат одного шага влияет на следующий. Для этого существует протокол более высокого уровня, который организует `Запросы` и :term[Вызовы]{canonical="Вызов"} в единую последовательность.

Следующий документ, :term[005: Агент/Цикл]{href="./005_agent_loop.md"}, подробно описывает этот процесс.
