# 011: Агент/Выражения

> [!DEFINITION] [Выражение](./000_glossary.md)
> Это специальный способ записи, который позволяет объединить несколько путей в :term[ссылке на переменную]{canonical="Variable Reference"} или :term[пути вывода]{canonical="Output Path"}. С его помощью можно создавать потоки данных, которые работают по условию или одновременно (параллельно).

> Sidenote:
> - Требует:
>   - :term[007: Агент/Переменные]{href="./007_agent_variables.md"}
>   - :term[008: Агент/Вывод]{href="./008_agent_output.md"}
> - Открывает возможность для:
>   - :term[012: Агент/План]{href="./012_agent_plan.md"}

:term[Ссылки на переменные]{canonical="Variable Reference"} и :term[пути вывода]{canonical="Output Path"} — это как провода, по которым текут данные. А **выражения** — это как переключатели и разветвители для этих проводов, они добавляют в схему логику.

Это простой, но мощный способ создавать условия («если..., то...») и параллельные потоки данных. Благодаря им агент может вести себя сложнее и умнее, подстраиваясь под ситуацию.

В выражениях используются два знака: `||` (означает «ИЛИ») для условий и `&&` (означает «И») для одновременных действий. Их можно применять двумя способами: чтобы собрать данные для инструмента из разных мест или чтобы отправить результат работы инструмента в несколько мест сразу.

## Входные выражения (Много-в-один)

Когда выражения используются во входных данных для :term[вызова инструмента]{canonical="Tool Call"}, они позволяют одному параметру брать данные из нескольких источников. Это создаёт поток данных типа **«много-в-один» (M:1)**, что позволяет гибко собирать данные, например, использовать запасные варианты (если одних данных нет, берём другие).

> Sidenote:
> ```mermaid
> graph TD
>     SourceA["†state.userInput"] --> ToolInput["processData(data)"]
>     SourceB["†state.default"] --> ToolInput
> ```

Эта возможность очень важна для создания надёжных инструментов, которые можно использовать много раз. Вместо того чтобы требовать данные в строго определённом формате, инструмент может сам подстраиваться под ситуацию и брать информацию оттуда, где она есть в данный момент.

::::columns
:::column{title="Запасной вариант с ||"}

Когда в :term[ссылке на переменную]{canonical="Variable Reference"} используется `||`, это работает как запасной вариант. Выражение `†state.userInput || †state.default` говорит системе: сначала поищи данные в `state.userInput`. Если их там нет, возьми данные из `state.default`. Это удобно, чтобы задавать значения по умолчанию или работать с необязательными данными.

```json
{
  "_tool": "processData",
  "data": "†input.optionalData || †state.defaultData"
}
```

:::
:::column{title="Одновременная зависимость с &&"}

Когда в :term[ссылке на переменную]{canonical="Variable Reference"} используется `&&`, это работает как пропускной пункт. Он проверяет, что все нужные данные существуют. Если все на месте, выражение передаёт значение _последнего_ пути в цепочке. Это отличный способ убедиться, что инструмент запустится только тогда, когда все необходимые для него данные готовы.

```json
// Этот инструмент запустится, только если загружены и профиль пользователя, и его права.
// Параметр `permissions` получит значение из `†state.permissions`.
{
  "_tool": "renderDashboard",
  "permissions": "†state.userProfile && †state.permissions"
}
```

:::
::::

## Выходные выражения (Один-ко-многим)

Когда выражения используются в :term[пути вывода]{canonical="Output Path"}, они позволяют записать результат работы одного инструмента сразу в несколько мест. Это создаёт поток данных типа **«один-ко-многим» (1:M)**, что позволяет создавать ветвления (когда в зависимости от результата выбирается разный путь) и веерную рассылку (когда результат отправляется всем сразу).

> Sidenote:
> ```mermaid
> graph TD
>     ToolOutput["verifyUser()"] --> DestA["†data.user.verified"]
>     ToolOutput --> DestB["†data.user.failed"]
> ```

Этот механизм позволяет одному инструменту иметь несколько разных исходов, зависящих от ситуации. Это основа для создания умных агентов, которые могут реагировать на происходящее и выбирать правильный путь действий в зависимости от результатов.

::::columns
:::column{title="Альтернативные пути (Ветвление) с ||"}
Использование `||` в :term[пути вывода]{canonical="Output Path"} позволяет инструменту объявить возможные исходы своей работы. Логика самого инструмента решает, по какому пути записать результат. Это полезно для создания условий, когда инструмент может либо успешно завершить работу, либо потерпеть неудачу.

```json
// Если `verifyUser` сработал успешно, результат записывается в `data.user.verified`;
// в противном случае — в `data.user.failed`
{
  "_tool": "verifyUser",
  "userId": "perfect-stranger",
  "_outputPath": "†data.user.verified || †data.user.failed"
}
```

:::
:::column{title="Одновременные пути (Веерная рассылка) с &&"}
Использование `&&` в :term[пути вывода]{canonical="Output Path"} даёт команду системе сделать «веерную рассылку» — записать один и тот же результат в несколько мест одновременно. Это полезно, чтобы оповестить о результате разные части системы или для записи в журнал событий.

```json
// Одновременная запись в объекты `user` и `audit` в состоянии.
{
  "_tool": "generateSummary",
  "text": "Long body of text here...",
  "_outputPath": "†data.user.summary && †data.audit.summary"
}
```

:::
::::

## От выражений к стратегиям

Выражения — это логический «клей», который соединяет отдельные :term[вызовы инструментов]{canonical="Tool Call", plural=true}. С их помощью агент может перейти от простых, последовательных действий к построению сложных, разветвлённых сценариев работы.

В следующем документе, :term[012: Агент/План]{href="./012_agent_plan.md"}, рассказывается, как эти гибкие связи используются для построения полноценного, стратегического :term[Плана]{canonical="Plan"}.
