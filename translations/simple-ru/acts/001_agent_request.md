# 001: Агент/Запрос

> **Запрос:** Это однократное, полностью самостоятельное обращение к языковой модели (LLM). Оно берёт `контекст` и `схему`, а на выходе даёт `решение`. — [Словарь](./000_glossary.md)

> Sidenote:
>
> - Включает: [101: Концепция/Идея](./101_concept_idea.md)
>
> NPM: [https://www.npmjs.com/package/@augceo/agent](@idealic-ai/agent)

`Запрос` — это как один кирпичик, из которых строится вся система агента. Он представляет собой понятный, повторяемый и расширяемый способ общения с искусственным интеллектом (ИИ). Представь, что ты даёшь ИИ не просто команду, а целую папку с инструкциями (`контекст`) и шаблон для ответа (`схема`), чтобы в итоге получить точный, структурированный результат (`решение`). В отличие от обычной просьбы в чате, `Запрос` — это законченное, самодостаточное задание, которое служит мотором для всех более сложных способностей агента.

## Контекст: Папка с материалами

> Sidenote:
> ИИ обработает `контекст`, чтобы создать `решение`, соответствующее `схеме`.
>
> ```mermaid
> graph TD
>     subgraph Ввод от пользователя
>         direction LR
>         Context[\Контекст\]
>         Schema[\Схема\]
>     end
>
>     Process{{"Запрос"}}
>
>     subgraph Вывод от ИИ
>         direction LR
>         Solution[/Решение/]
>     end
>
>     Context --> Process
>     Schema --> Process
>     Process --> Solution
>     Schema -.-> Solution
>
>     linkStyle 2 stroke-width:2px,fill:none,stroke:gray,stroke-dasharray: 5 5;
>     linkStyle 3 stroke-width:2px,fill:none,stroke:gray,stroke-dasharray: 5 5;
> ```

Основа любого `Запроса` — это его `контекст`, то есть набор `Сообщений`. Каждое `Сообщение` — это простая заметка, в которой указана `роль` (например, «система», «пользователь» или «помощник») и `содержимое`. Такая структура позволяет передать ИИ целый диалог со всеми нужными деталями.

В обычном чате сообщения просто добавляются друг за другом, создавая длинную историю переписки. Здесь же всё иначе. `Контекст` для каждого `Запроса` — это отдельная, тщательно собранная «папка с материалами» для конкретной задачи. В неё не попадает ничего лишнего из прошлых разговоров. Ответы ИИ тоже не добавляются в неё автоматически — для каждого нового задания папка собирается заново. Это гарантирует, что процесс можно повторить и получить тот же результат, а у ИИ будет ровно та информация, которая ему нужна, без риска что-то «забыть» или упустить.

Этот управляемый `контекст` — главный способ передать ИИ инструкции, данные и подсказки. Всё, что нужно для выполнения задачи (кроме `схемы` для ответа), находится в этих сообщениях.

Простой пример набора `Сообщений`:

```json
[
  { "role": "system", "content": "Ты — полезный помощник." },
  { "role": "user", "content": "Какая столица Франции?" }
]
```

Наша система делает эту структуру ещё мощнее. В поле `content` может быть не только текст, но и специальные объекты, которые мы называем **особыми типами содержимого**. Например, вместо простой фразы там может быть структурированный объект вроде `{ "type": "input", "input": { ... } }`.

> Sidenote:
> Особые типы сообщений, описанные в Актах:
>
> - [006: Агент/Данные](./006_agent_data.md) - передаёт ИИ данные и их значение в виде сообщения
> - [007: Агент/Ввод](./007_agent_input.md) - структурированная инструкция для ИИ
> - [010: Агент/Состояние](./010_agent_state.md) - данные, которые сохраняются между шагами выполнения
> - [013: Agent/План](./013_agent_plan.md) - заранее подготовленный план для многошагового выполнения

Эта возможность делает `контекст` главным инструментом для расширения возможностей системы.

Для каждого особого типа содержимого есть своя программа-обработчик. Эти обработчики выстраиваются в цепочку. Прежде чем `Запрос` отправится к ИИ, эта цепочка обрабатывает каждое сообщение в `контексте`. Обработчик может на лету изменить ключевые части `Запроса`:

- **Настройки ИИ**: Поменять модель, креативность (temperature) или другие параметры.
- **Схему**: Изменить шаблон, по которому ИИ должен будет дать ответ.
- **Контекст**: Поменять итоговый список сообщений, которые увидит ИИ. Например, превратить специальный объект в понятный для ИИ текст или добавить новые сообщения.

Этот мощный механизм позволяет агенту работать со сложными, структурированными идеями, каждый раз создавая идеальный запрос для выполнения конкретной задачи.

## Схема: Шаблон для ответа

> Sidenote:
>
> - Узнать больше можно на [json-schema.org](https://json-schema.org/)

`Схема` — это как анкета или бланк (в формате JSON Schema), который описывает, как именно должен выглядеть итоговый `ответ`. Эта система позволяет задать любую структуру: от простого текста до сложных объектов с множеством вложенных полей. ИИ обязан сгенерировать `решение`, которое строго соответствует этой схеме. Это гарантирует, что результат всегда будет предсказуемым и правильно оформленным.

Когда схемы становятся сложнее, они начинают направлять не только финальный ответ, но и сам процесс мышления ИИ. Например, в схему можно добавить поля для самих данных, а рядом — поля, где ИИ должен описать свои рассуждения, шаги решения или уровень уверенности. Так схема превращается в инструмент, который формирует сам процесс генерации ответа.

Главный принцип нашей архитектуры — это сборка схем из кубиков. Более сложные способности создаются путём объединения простых, многоразовых компонентов схем. Это позволяет создавать знания и умения агента модульно, как конструктор.

## Выполнение и Решение

После того как `контекст` обработан, итоговый список сообщений и `схема` отправляются к ИИ одним запросом. Ответ ИИ — это и есть `решение`, структурированный документ в формате JSON, который полностью соответствует заданной `схеме`.

Этот процесс можно представить как создание короткого рассказа. Поскольку ИИ работает, предсказывая следующее слово, он генерирует `решение` сверху вниз, следуя структуре `схемы`. Поэтому порядок и названия полей в схеме напрямую влияют на то, как ИИ «рассказывает» свой ответ.

Например, если в схеме сначала идёт поле для логических рассуждений (например, `"процесс_мышления"`), а только потом поле для итогового ответа (`"данные"`), то ИИ будет вынужден сначала изложить свои мысли, а уже потом дать ответ. Эти рассуждения становятся частью контекста, который влияет на генерацию последующих данных. Это очень мощный механизм, который позволяет нам направлять «мысли» ИИ и получать лучший результат, формируя сам путь, по которому он к нему приходит.

> [!HEADSUP] Heads up
> Вся эта цепочка — `контекст`, `схема` и итоговое `решение` — образует единый, самодостаточный и воспроизводимый блок. Когда мы сохраняем этот блок, система называет его [101: Концепция/Идея](./101_concept_idea.md).

## От структурированного ответа к действиям

`Запрос` — это надёжный способ получить один, чётко структурированный `ответ`. Но чтобы создавать по-настоящему умных агентов, нам нужно нечто большее. Нам нужен способ предложить ИИ целое «меню» возможностей — разных действий, из которых он может выбирать для достижения цели. Для этого нужна система, которая позволяет описывать эти действия как отдельные, выбираемые элементы.

> Sidenote:
>
> - [002: Агент/Инструмент](./002_agent_tool.md)

Следующий документ, [002: Агент/Инструмент](./002_agent_tool.md), рассказывает о том, как создавать такие возможности.
