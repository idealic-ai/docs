# 001: Агент/Запрос

> [!DEFINITION] Запрос
> Это как одноразовое, полностью готовое задание для искусственного интеллекта (ИИ). Ты даёшь ему всю нужную информацию (**контекст**) и чёткие правила для ответа (**схему**), а он создаёт готовый результат (**решение**).

> Sidenote:
> - Что позволяет:
>   - :term[101: Концепция/Идея]{href="./101_concept_idea.md"}
> - Ссылки:
>   - [NPM: @idealic/agent](https://www.npmjs.com/package/@augceo/agent)

**Запрос** — это главный «кирпичик», из которого работает система агента. Он похож на хорошо организованный конвейер для общения с ИИ, который превращает подробную информацию и понятные правила в точный, структурированный ответ. В отличие от обычной просьбы к чат-боту, Запрос — это полностью самостоятельная задача. Он как мотор, который приводит в движение все более сложные способности агента.

## Контекст: Поток сообщений

> Sidenote:
> ИИ обработает **контекст**, чтобы создать **решение**, соответствующее **схеме**.
>
> ```mermaid
> graph TD
>     subgraph Ввод от пользователя
>         direction LR
>         Context[\Контекст\]
>         Schema[\Схема\]
>     end
>
>     Process{{"Запрос"}}
>
>     subgraph Вывод от ИИ
>         direction LR
>         Solution[/Решение/]
>     end
>
>     Context --> Process
>     Schema --> Process
>     Process --> Solution
>     Schema -.-> Solution
>
>     linkStyle 2 stroke-width:2px,fill:none,stroke:gray,stroke-dasharray: 5 5;
>     linkStyle 3 stroke-width:2px,fill:none,stroke:gray,stroke-dasharray: 5 5;
> ```

В основе каждого Запроса лежит его **контекст** — это как стопка карточек с сообщениями. На каждой карточке есть `роль` (кто говорит: `«система»`, `«пользователь»` или `«помощник»`) и `содержание`. Такая стопка карточек позволяет показать ИИ целый разговор со всеми деталями.

В обычном чате сообщения просто добавляются одно за другим. Здесь же **контекст** для каждого Запроса — это отдельный, тщательно подготовленный пакет информации. Его собирают для конкретной задачи, и в нём нет ничего лишнего из прошлых разговоров. Ответы ИИ не добавляются обратно автоматически; для каждой новой задачи контекст создаётся заново. Это гарантирует, что ИИ всегда получит именно ту информацию, которая нужна, и ничего важного не «забудет».

Этот управляемый контекст — главный способ передать ИИ подсказки, данные и инструкции. Всё, что нужно для работы, кроме правил для ответа (**схемы**), находится в этих сообщениях.

Простой набор сообщений может выглядеть так:

```json
[
  { "role": "system", "content": "Ты — полезный помощник." },
  { "role": "user", "content": "Какая столица Франции?" }
]
```

Наша система идёт дальше: в поле `content` может быть не только текст, но и специальные объекты, которые мы называем **пользовательскими типами контента**. Например, вместо простого текста там может быть объект вроде `{ "type": "input", "input": { ... } }`.

> Sidenote:
> Пользовательские типы сообщений описаны в Актах:
>
> - :term[006: Агент/Данные]{href="./006_agent_data.md"} — передать ИИ данные и их значение в виде сообщения.
> - :term[007: Агент/Ввод]{href="./007_agent_input.md"} — структурированная подсказка для ИИ.
> - :term[009: Агент/Состояние]{href="./009_agent_state.md"} — информация, которая сохраняется между шагами.
> - :term[010: Агент/План]{href="./010_agent_plan.md"} — заранее подготовленный план для выполнения из нескольких шагов.

Эта возможность делает **контекст** главным элементом для расширения системы.

Для каждого такого особого типа контента есть свой «обработчик». Перед отправкой Запроса к ИИ, эти обработчики выстраиваются в очередь и поочерёдно проверяют каждое сообщение. Обработчик может на лету изменять главные части Запроса:

- **Настройки ИИ**: менять модель, «температуру» (креативность) и другие параметры.
- **Схему**: изменять правила (JSON-схему), которым должен соответствовать итоговый ответ.
- **Контекст**: менять сам список сообщений для ИИ. Например, превратить специальный объект в понятный для ИИ текст или добавить новые сообщения.

Этот мощный механизм позволяет агенту работать со сложными, структурированными идеями, каждый раз создавая идеальное задание для ИИ.

## Схема: Указываем путь к решению

> Sidenote:
> - Подробнее читайте на [json-schema.org](https://json-schema.org/)

**Схема** — это набор правил (в формате JSON Schema), который точно описывает, как должно выглядеть желаемое **решение**. Это очень мощный инструмент, который позволяет описать любые данные: от простого текста до сложных, вложенных друг в друга объектов. ИИ обязан создать **решение**, которое строго следует этой схеме. Это гарантирует, что ответ всегда будет аккуратным и предсказуемым.

Чем сложнее схема, тем лучше она может направлять не только результат, но и сам процесс «мышления» ИИ. Например, в схему можно добавить поля для самих данных и отдельные поля, где ИИ должен описать свои рассуждения, шаги или уверенность в ответе. Так схема становится активным инструментом, который формирует процесс работы ИИ.

Главный принцип этой системы — составление схем из готовых блоков. Более сложные возможности строятся путём объединения простых, многоразовых частей схем. Это позволяет создавать знания и способности агента как из конструктора.

## Выполнение и Решение

После обработки **контекста**, финальный список сообщений и **схема** отправляются к ИИ в одном запросе. Ответ ИИ — это и есть **решение**: структурированный JSON-документ, который точно соответствует заданной **схеме**.

Этот процесс можно сравнить с написанием короткого рассказа. Поскольку ИИ предсказывает следующее слово, он создаёт **решение** сверху вниз, следуя структуре **схемы**. Порядок и устройство полей в схеме напрямую влияют на «рассказ», который создаёт ИИ.

Например, если схема сначала требует поле для рассуждений (например, `"мыслительный_процесс"`), а уже потом — поле для ответа (`"данные"`), то ИИ будет вынужден сначала объяснить свою логику, и только потом дать ответ. Эти рассуждения становятся частью контекста, который влияет на финальный результат. Это мощный механизм, который позволяет нам направлять «мысли» ИИ, получая контроль над результатом.

> [!HEADSUP] На заметку
> Весь этот процесс — **контекст**, **схема** и итоговое **решение** — образует единое, самостоятельное и повторяемое целое. Когда мы сохраняем его, система называет это **101: Концепция/Идея**.

## От структурированного ответа к действиям

**Запрос** — это надёжный способ получить один структурированный ответ по заданным правилам. Но чтобы строить по-настоящему умных агентов, нам нужно больше. Нам нужен способ предложить ИИ целое «меню» возможностей — разных действий, из которых он может выбирать для достижения цели. Для этого нужна система, которая описывает эти действия как отдельные, выбираемые элементы.

> Sidenote:
> - :term[002: Агент/Инструмент]{href="./002_agent_tool.md"}

Следующий документ, **002: Агент/Инструмент**, рассказывает, как определяются эти возможности.
