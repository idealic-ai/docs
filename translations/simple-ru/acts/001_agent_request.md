# 001: Агент/Запрос

> [!DEFINITION] [Запрос](./000_glossary.md)
> Представь, что ты даёшь задание очень умному роботу. `Запрос` — это одна такая миссия. Ты даёшь ему папку со всей нужной информацией (`контекст`) и точный чертёж того, как должен выглядеть готовый ответ (`схема`). В результате робот возвращает тебе идеально заполненный по чертежу отчёт (`решение`).

> Sidenote:
> - Включает: [101: Концепция/Идея](./101_concept_idea.md)
>
> NPM: [https://www.npmjs.com/package/@augceo/agent](@idealic-ai/agent)

`Запрос` — это как один кирпичик, из которых строятся все действия умного агента. Это не просто обычный вопрос, а целый «пакет с заданием» для искусственного интеллекта (ИИ). Внутри этого пакета есть всё необходимое: подробная информация (`контекст`) и чёткие правила-инструкции для ответа (`схема`). В итоге ИИ выдаёт точный, структурированный ответ (`решение`). В отличие от простого вопроса в чате, `Запрос` — это полноценная, самостоятельная задача, которая служит двигателем для всех более сложных способностей агента.

## Контекст: Поток сообщений

> Sidenote:
> ИИ обработает `контекст` и создаст `решение`, которое соответствует `схеме`.
>
> ```mermaid
> graph TD
>     subgraph Ввод от пользователя
>         direction LR
>         Context[\Контекст\]
>         Schema[\Схема\]
>     end
>
>     Process{{"Запрос"}}
>
>     subgraph Вывод ИИ
>         direction LR
>         Solution[/Решение/]
>     end
>
>     Context --> Process
>     Schema --> Process
>     Process --> Solution
>     Schema -.-> Solution
>
>     linkStyle 2 stroke-width:2px,fill:none,stroke:gray,stroke-dasharray: 5 5;
>     linkStyle 3 stroke-width:2px,fill:none,stroke:gray,stroke-dasharray: 5 5;
> ```

Основа любого `Запроса` — это его `контекст`. Представь его как стопку карточек с сообщениями. На каждой карточке указано, кто говорит (например, «система», «пользователь» или «помощник»), и что именно он говорит. Это позволяет передать ИИ целый диалог или набор инструкций.

В обычном чате сообщения просто добавляются друг за другом, и история переписки постоянно растёт. Здесь всё иначе. `Контекст` для каждого `Запроса` — это тщательно собранный, отдельный пакет информации. Его готовят специально для одной конкретной задачи, и в нём нет ничего лишнего из прошлых разговоров. Ответы ИИ не добавляются обратно автоматически — для каждой новой задачи `контекст` собирается заново. Это гарантирует, что процесс можно повторить и получить тот же результат, а ИИ всегда будет иметь перед глазами только нужную информацию, не рискуя что-то «забыть» или упустить.

`Контекст` — это главный способ передать ИИ команды, данные и инструкции. Всё, что нужно для работы, кроме правил для финального ответа (`схемы`), передаётся через эти сообщения.

Простой `контекст` в виде сообщений может выглядеть так:

```json
[
  { "role": "system", "content": "Ты — полезный ассистент." },
  { "role": "user", "content": "Какая столица у Франции?" }
]
```

Наша система делает эту структуру ещё мощнее. В поле `content` можно помещать не только текст, но и специальные объекты, которые мы называем **особыми типами контента**. Например, вместо простого текста там может быть структурированный объект вроде `{ "type": "input", "input": { ... } }`.

> Sidenote:
> Особые типы сообщений, описанные в Актах:
>
> - [006: Агент/Данные](./006_agent_data.md) — передаёт ИИ данные и объясняет их значение.
> - [007: Агент/Ввод](./007_agent_input.md) — структурированная команда, которую должен использовать ИИ.
> - [009: Агент/Состояние](./009_agent_state.md) — информация, которая сохраняется между шагами работы.
> - [010: Агент/План](./010_agent_plan.md) — готовый план для выполнения многошаговых задач.

Эта возможность делает `контекст` главным инструментом для расширения возможностей системы.

Каждый такой особый тип контента связан со своей программой-обработчиком. Все эти обработчики выстраиваются в своего рода «сборочный конвейер». Прежде чем `Запрос` отправится к ИИ, этот конвейер обрабатывает каждое сообщение в `контексте`. Обработчик может на лету изменять ключевые части `Запроса`:

- **Настройки ИИ**: Менять параметры, например, какую модель использовать или насколько творческим должен быть ответ.
- **Схема**: Изменять чертёж (JSON-схему), по которому должен быть построен финальный ответ.
- **Контекст**: Менять сам набор сообщений, который увидит ИИ. Например, превратить особый объект в понятный для ИИ текст или добавить новые сообщения с подсказками.

Этот мощный «конвейер» позволяет агенту работать со сложными, структурированными идеями, каждый раз создавая идеальное задание для ИИ.

## Схема: Чертёж для ответа

> Sidenote:
> - Узнать больше можно на [json-schema.org](https://json-schema.org/)

`Схема` — это как подробный чертёж (на языке JSON Schema), который описывает, как именно должен выглядеть готовый `ответ`. Эта система позволяет описать любые данные: от простого слова до сложной таблицы с множеством вложенных деталей. ИИ обязан сгенерировать `ответ`, который строго соответствует этому чертежу. Это гарантирует, что результат всегда будет аккуратным и предсказуемым.

Чем сложнее становится `схема`, тем больше она может направлять не только финальный ответ, но и сам процесс мышления ИИ. Например, в схеме можно предусмотреть поля не только для самих данных, но и отдельные поля, где ИИ должен описать свои рассуждения, шаги решения или степень уверенности. Так `схема` становится активным инструментом, который формирует мыслительный процесс.

Ключевой принцип этой архитектуры — возможность собирать сложные `схемы` из более простых, многоразовых «деталей». Это похоже на сборку сложных механизмов из стандартных блоков, что делает систему гибкой и масштабируемой.

## Выполнение и Решение

После того, как «конвейер» обработал `контекст`, финальный набор сообщений и `схема` отправляются к ИИ в виде одного запроса. Ответ ИИ — это `решение`, то есть структурированный документ в формате JSON, который полностью соответствует `схеме`.

Этот процесс можно сравнить с написанием короткого рассказа. Поскольку ИИ работает, предсказывая следующее слово, он создаёт `решение` шаг за шагом, строго следуя структуре `схемы`. Порядок полей в схеме напрямую влияет на то, как ИИ строит свой «рассказ».

Например, если в `схеме` сначала идёт поле для размышлений (например, `"процесс_мышления"`), а уже потом поле для ответа (`"данные"`), то ИИ будет вынужден сначала объяснить, как он собирается решать задачу, и только потом дать сам ответ. Его размышления становятся частью контекста, который влияет на финальный результат. Это мощный инструмент, который позволяет нам направлять «мысли» ИИ и получать 훨씬 лучший контроль над результатом, формируя сам путь к нему.

> [!HEADSUP] Внимание
> Вся эта цепочка — `контекст`, `схема` и получившееся `решение` — образует единый, самодостаточный и воспроизводимый блок. Когда этот блок сохраняется, система называет его [101: Концепция/Идея](./101_concept_idea.md).

## От структурированного ответа к действиям

`Запрос` — это надёжный способ получить один структурированный ответ. Но чтобы создавать по-настоящему умных агентов, нам нужно больше. Нам нужен способ предложить ИИ целое «меню» возможностей — разных действий, из которых он может выбирать для достижения цели. Для этого нужна система, которая позволит описывать эти действия как отдельные, выбираемые варианты.

> Sidenote:
> - [002: Агент/Инструмент](./002_agent_tool.md)

Следующий документ, [002: Агент/Инструмент](./002_agent_tool.md), рассказывает о том, как создавать такие «инструменты».
