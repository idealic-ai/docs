# 001: Агент/Запрос

> **Запрос:** Это одно, полностью самостоятельное задание для искусственного интеллекта (ИИ). Он берёт «контекст» (инструкции и данные) и «схему» (шаблон ответа), а в результате выдаёт «решение». — [Глоссарий](./000_glossary.md)

> Sidenote:
> - Включает: [101: Концепция/Идея](./101_concept_idea.md)
>
> NPM: [https://www.npmjs.com/package/@augceo/agent](@idealic-ai/agent)

«Запрос» — это как главный строительный блок всей системы. Представь, что это не просто короткая команда для ИИ, а целая папка с заданием. В ней есть всё: что нужно сделать, какие данные использовать и в каком формате должен быть ответ. Благодаря этому задания получаются понятными, их можно повторять, и на их основе строятся все более сложные умения нашего агента.

## Контекст: Папка с сообщениями для миссии

> Sidenote:
> ИИ обработает `Контекст`, чтобы создать `Решение`, соответствующее `Схеме`.
>
> ```mermaid
> graph TD
>     subgraph Ввод от пользователя
>         direction LR
>         Context[\Контекст\]
>         Schema[\Схема\]
>     end
>
>     Process{{"Запрос"}}
>
>     subgraph Вывод от ИИ
>         direction LR
>         Solution[/Решение/]
>     end
>
>     Context --> Process
>     Schema --> Process
>     Process --> Solution
>     Schema -.-> Solution
>
>     linkStyle 2 stroke-width:2px,fill:none,stroke:gray,stroke-dasharray: 5 5;
>     linkStyle 3 stroke-width:2px,fill:none,stroke:gray,stroke-dasharray: 5 5;
> ```

Основа любого «Запроса» — это его «контекст». Это набор «сообщений», как в чате. Каждое сообщение имеет свою роль (например, «система», «пользователь» или «помощник») и само содержание.

Но в отличие от обычного чата, где история сообщений просто растёт, здесь для каждого нового задания собирается свежая, чистая «папка» с контекстом. Старые разговоры не мешают. Ответы ИИ не добавляются в неё автоматически; для каждого нового вычисления контекст создаётся заново. Это гарантирует, что у ИИ всегда будет только нужная информация, без мусора, и он ничего не «забудет».

Через этот «контекст» ИИ получает все инструкции и данные. Всё, что ему нужно знать для выполнения задачи, находится в этих сообщениях (кроме «схемы» для ответа).

Вот как может выглядеть простой набор сообщений:

```json
[
  { "role": "system", "content": "Ты — полезный ассистент." },
  { "role": "user", "content": "Какая столица Франции?" }
]
```

#### Конвейер обработки сообщений

Система делает этот процесс ещё круче. В поле `content` может быть не просто текст, а специальные объекты — назовём их **«особые вложения»**. Например, вместо строки с текстом там может быть объект вроде `{ "type": "input", "input": { ... } }`.

> Sidenote:
> Особые типы сообщений, описанные в Актах:
>
> - [006: Агент/Данные](./006_agent_data.md) - как передать ИИ данные и объяснить их смысл.
> - [007: Агент/Ввод](./007_agent_input.md) - как дать ИИ структурированную подсказку.
> - [010: Агент/Состояние](./010_agent_state.md) - как сохранять «память» между шагами.
> - [012: Агент/План](./012_agent_plan.md) - как подготовить план для выполнения сложных задач.

Благодаря этому «контекст» становится главным местом для расширения возможностей системы.

Для каждого такого «особого вложения» есть свой обработчик-помощник. Прежде чем отправить «Запрос» к ИИ, эти помощники по очереди просматривают все сообщения. Они могут на ходу изменять детали задания:

- **Настройки ИИ**: менять модель, уровень «креативности» (температуру) и другие параметры.
- **Схему**: изменять шаблон, по которому ИИ должен дать ответ.
- **Контекст**: менять сам список сообщений. Например, превращать «особое вложение» в понятный для ИИ текст или добавлять новые подсказки.

Этот мощный «конвейер» позволяет агенту работать не с простым текстом, а со сложными идеями, каждый раз создавая идеальное задание для ИИ.

## Схема: Шаблон для ответа

«Схема» — это как анкета или бланк, который должен заполнить ИИ. Она описывает точную структуру желаемого «решения». Это очень мощный инструмент, который позволяет получить любые данные: от простого слова до сложных таблиц с кучей деталей. ИИ обязан выдать ответ, который строго соответствует этой «анкете», поэтому результат всегда получается аккуратным и предсказуемым.

Схемы можно делать сложными, чтобы они направляли не только сам ответ, но и процесс размышления ИИ. Например, в схеме можно сделать поля для самого ответа, а рядом — отдельные поля, где ИИ должен описать ход своих мыслей, логику или насколько он уверен в ответе.

Главный принцип здесь — собирать сложные схемы из простых, как конструктор. Это позволяет создавать новые способности для агента, комбинируя уже готовые блоки знаний.

## Выполнение и Решение

После того как «конвейер» обработал «контекст», финальный список сообщений и «схема» отправляются к ИИ одним пакетом. Ответ ИИ — это и есть «решение», то есть документ в формате JSON, который точно соответствует «схеме» (заполненная анкета).

Этот процесс похож на то, как ИИ пишет короткий рассказ по заданному плану. Поскольку ИИ просто предсказывает следующее слово, он заполняет «анкету» сверху вниз, поле за полем. Порядок полей в «схеме» напрямую влияет на то, как ИИ строит свой рассказ.

Например, если в схеме сначала идёт поле «ход мыслей», а потом поле «финальный ответ», то ИИ будет вынужден сначала описать, как он рассуждает, и только потом дать сам ответ. Его размышления становятся частью контекста, который влияет на финальный результат. Это позволяет нам направлять «мысли» ИИ и получать более качественные ответы.

> [!TIP]
> Вся эта цепочка — «контекст», «схема» и полученное «решение» — образует единое, самодостаточное и повторяемое задание. Когда мы сохраняем его, система называет это [101: Концепция/Идея](./101_concept_idea.md).

## От структурированных ответов к выбору действий

«Запрос» — это надёжный способ получить от ИИ один чётко структурированный ответ. Но чтобы строить по-настоящему умных агентов, нам нужно больше. Нам нужен способ предложить ИИ целое «меню» возможностей — разных действий, из которых он может выбирать для достижения цели.

> Sidenote:
> - [002: Агент/Инструмент](./002_agent_tool.md)

Следующий документ, [002: Агент/Инструмент](./002_agent_tool.md), расскажет, как мы создаём такие «инструменты» для агента.
