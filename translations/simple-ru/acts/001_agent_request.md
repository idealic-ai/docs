# 001: Агент/Запрос

> **Запрос:** Это как одна задачка для нейросети (LLM). Ты даёшь ей `контекст` (что происходит) и `схему` (что ты хочешь получить), а она выдаёт `решение`. — [Глоссарий](./000_glossary.md)

> Sidenote:
> - Даёт возможность для: [101: Концепция/Идея](./101_concept_idea.md)
>
> NPM: [https://www.npmjs.com/package/@augceo/agent](@idealic-ai/agent)

Этот документ объясняет, что такое **Запрос**. Представь, что Запрос — это основная «команда» для общения с нейросетью. Это как моторчик, который берёт абстрактную [101: Концепция/Идея](./101_concept_idea.md), добавляет к ней `контекст` и `схему`, и получает конкретное `решение`.

## Конвейер Запроса

> Sidenote:
> Нейросеть обработает `контекст`, чтобы создать `решение`, соответствующее `схеме`.
>
> ```mermaid
> graph TD
>     subgraph "Что даёт пользователь"
>         direction LR
>         Context[\Контекст\]
>         Schema[\Схема\]
>     end
>
>     Process{{"Запрос"}}
>
>     subgraph "Что выдаёт нейросеть"
>         direction LR
>         Solution[/Решение/]
>     end
>
>     Context --> Process
>     Schema --> Process
>     Process --> Solution
>     Schema -.-> Solution
>
>     linkStyle 2 stroke-width:2px,fill:none,stroke:gray,stroke-dasharray: 5 5;
>     linkStyle 3 stroke-width:2px,fill:none,stroke:gray,stroke-dasharray: 5 5;
> ```

`Запрос` — это не просто текст, который ты пишешь нейросети. Это целый конвейер, который берёт сложный, многосоставный контекст и превращает его в один чёткий ответ, который соответствует заданной схеме.

### Контекст: Список сообщений

Основа любого `Запроса` — это `контекст`. Он выглядит как список сообщений (массив объектов `Message`). Это позволяет показать нейросети всю историю разговора, даже если в нём участвовало несколько «персонажей» или было много реплик.

Простой контекст может выглядеть так:

```json
[
  { "role": "system", "content": "Ты — полезный ассистент." },
  { "role": "user", "content": "Какая столица Франции?" }
]
```

### Особые типы контента

Система идёт дальше и позволяет использовать **особые типы контента** в сообщениях. Вместо обычного текста, в `content` может быть что-то более сложное, например, объект `{ "type": "state", "state": { ... } }`.

За эти особые типы отвечает система `Content` (можно посмотреть в `agent/src/Content/Content.ts`). У каждого такого типа есть свой «обработчик» — маленькая программа, которая знает, что с ним делать. Все эти обработчики выстраиваются в конвейер. Когда сообщение проходит по конвейеру, его обработчик может изменить три главные части Запроса:

- **Конфигурация LLM**: Менять настройки нейросети, например, какую модель использовать или насколько «творческим» должен быть ответ.
- **Схема**: Изменять JSON-схему, по которой нейросеть будет строить свой ответ.
- **Контекст**: Изменять сам список сообщений для нейросети. Например, он может превратить особый тип контента в понятный для нейросети текст или добавить новые сообщения.

Этот мощный конвейер позволяет агенту работать не с простым текстом, а со сложными идеями и структурами. Он на лету собирает идеальную «команду» для нейросети, чтобы она точно выполнила задачу.

### Схема: Направляем к решению

`схема` — это как чертёж или инструкция (в формате JSON Schema), которая точно описывает, как должно выглядеть `решение`. Это очень мощная штука, которая может описать всё что угодно: от простого слова до сложной таблицы с кучей данных. Нейросеть обязана сгенерировать `решение` строго по этому чертежу. Это гарантия, что ответ всегда будет иметь правильную структуру и его можно будет предсказать.

Чем сложнее становится схема, тем больше она может. Её можно использовать не только для описания результата, но и чтобы управлять процессом «мышления» нейросети. Например, в схеме можно сделать поля для самих данных, и отдельные поля, где нейросеть должна будет описать свои рассуждения, ход мыслей или насколько она уверена в ответе. Так схема становится активным инструментом, который формирует сам процесс создания ответа.

Главный принцип этой системы — сборка схем из кубиков. Более сложные возможности строятся путём объединения простых, многоразовых кусочков схем. Это как строить из LEGO: можно создавать что-то очень большое и сложное, используя стандартные детали. Так мы определяем знания и умения агента.

### Выполнение и Решение

После того как `контекст` обработан, итоговый список сообщений и `схема` отправляются нейросети одним запросом. Ответ нейросети — это и есть `решение`. Это структурированный JSON-документ, который точно соответствует заданной `схеме`.

Этот процесс можно представить как создание маленького рассказа. Нейросеть предсказывает следующее слово (токен) одно за другим, поэтому она создаёт `решение` сверху вниз, строго следуя структуре `схемы`. Порядок и названия полей в схеме напрямую влияют на то, какой «рассказ» получится у нейросети.

Например, если в схеме сначала идёт поле для рассуждений (например, `"thought_process"`), а только потом поле для итоговых данных (`data`), то нейросеть будет вынуждена сначала объяснить свой ход мыслей, и только потом дать ответ. Эти рассуждения становятся частью контекста и влияют на то, какими будут сами данные. Это очень крутой механизм, который позволяет нам направлять «мышление» нейросети и контролировать результат, указывая ей путь.

> [!TIP]
> Весь этот конвейер Запроса — `контекст`, `схема` и получившееся `решение` — образует единое целое, которое можно сохранить и повторить. Когда мы сохраняем эту тройку, система называет её [101: Концепция/Идея](./101_concept_idea.md).

## От структурированного ответа к выбору действий

`Запрос` — это надёжный способ получить один чёткий ответ по заданной схеме. Но чтобы создавать по-настоящему умных агентов, нам нужно больше. Нам нужен способ предложить нейросети «меню» из разных возможностей — действий, из которых она может выбрать нужное для достижения цели. Для этого нужна система, которая позволит описывать эти действия как отдельные «кнопки», которые можно нажать.

> Sidenote:
> - [002: Агент/Инструмент](./002_agent_tool.md)

Следующий документ, [002: Агент/Инструмент](./002_agent_tool.md), как раз и рассказывает о том, как описывать эти возможности.
