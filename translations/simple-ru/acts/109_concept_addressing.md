# 109: Концепция/Адресация

> [!DEFINITION] :term[idea:]{canonical="idea:"}
> Это как веб-адрес (`http://`), но для мира :term[Идей]{canonical="Idea"}. Он позволяет как просить «самую новую версию чего-либо», так и создавать точные, постоянные ссылки на конкретную версию :term[Идеи]{canonical="Idea"}, которая никогда не изменится.

> Sidenote:
> - Требует понимания:
>   - :term[Видимость]{href="./108_concept_visibility.md"}

Схема адресов :term[idea:]{canonical="idea:"} — это особый язык, который мы используем для навигации в мире :term[Идей]{canonical="Idea"}, где у всего есть версии и разные ветки развития. Он нужен, чтобы запрашивать :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"} и создавать постоянные, воспроизводимые ссылки на их конкретные, разрешённые версии.

> Sidenote:
> - Понятия :term[Веток]{canonical="Branch" href="./108_concept_visibility.md#branches-publication-and-partitioning"} и :term[Пути Поиска]{canonical="Search Path" href="./108_concept_visibility.md#the-search-path-prioritized-retrieval"}, по которым происходит навигация с помощью этой схемы адресов, подробно описаны в главе :term[Видимость]{href="./108_concept_visibility.md"}.

## Из чего состоит ссылка `idea:`

Ссылка :term[idea:]{canonical="idea:"} может включать несколько частей:

- **Схема**: :term[idea:]{canonical="idea:"} — всегда начинается так, чтобы система поняла, что мы ищем :term[Идею]{canonical="Idea"}.
- **Домен**: Необязательный адрес проекта, начинается с `//` (например, `//my-project.com`). Если его нет, поиск идёт внутри текущего проекта.
- **Указатель ветки**: Необязательное указание конкретной :term[ветки]{canonical="Branch"} (например, `~main/`). `~main/` — это обычно главная, стабильная версия. `/` в начале — краткая запись для `~main/`.
- **Путь**: Название :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"} (например, `schemas/UserProfile`). Похоже на путь к файлу в папке.
- **Префикс версии**: Необязательное требование к версии (например, `?1.2`), что означает «дай мне последнюю версию, совместимую с 1.2».
- **Разрешённая версия**: В итоговой ссылке — точный номер найденной версии (например, `:1.2.3`).
- **Фрагмент**: Указатель на определённую часть внутри :term[Идеи]{canonical="Idea" href="./101_concept_idea.md"} (например, `#schema`), как якорь на веб-странице.

## Состояния ссылок

Ссылка :term[idea:]{canonical="idea:"} может быть в разных состояниях — как вопрос или как ответ.

1.  **Относительный запрос («Просьба»):** `idea:schemas/UserProfile?1.2`
    - Это просьба найти последнюю версию `UserProfile`, совместимую с `1.2`. Система будет искать её по :term[Пути Поиска]{canonical="Search Path" href="./108_concept_visibility.md#the-search-path-prioritized-retrieval"} в **текущем проекте**.

2.  **Абсолютный запрос:** `idea://my-project.com/schemas/UserProfile?1.2`
    - Это уже точный запрос к конкретному домену. Система не будет искать где-то ещё.

3.  **Запрос к конкретной ветке:** `idea:~main/schemas/UserProfile` (или `idea:/schemas/UserProfile`)
    - Префикс `~` означает, что нужно искать только в :term[ветке]{canonical="Branch"} `main`, игнорируя обычный :term[Путь Поиска]{canonical="Search Path" href="./108_concept_visibility.md#the-search-path-prioritized-retrieval"}.

4.  **Разрешённая ссылка («Ответ»):** `idea://my-project.com/:staging/schemas/UserProfile?1.2:1.2.staging.4`
    - Это постоянная и однозначная запись о результате поиска. Она говорит: «Мы искали в проекте `my-project.com`, в :term[ветке]{canonical="Branch"} `staging` и нашли точную версию `1.2.staging.4`».

## Пример рабочего процесса

Эти правила позволяют нескольким людям безопасно работать над одним проектом одновременно.

1.  **Создание ветки**: Разработчик создаёт новую :term[ветку]{canonical="Branch"} `feature/user-onboarding-v2`. Его :term[Путь Поиска]{canonical="Search Path" href="./108_concept_visibility.md#the-search-path-prioritized-retrieval"} теперь настроен так, чтобы сначала искать в `feature/user-onboarding-v2`, а потом в `main`.

2.  **Разработка процесса**: Разработчик создаёт новый `Процесс` :term[Идею]{canonical="Idea" href="./101_concept_idea.md"} с адресом `idea:processes/onboarding`. Поскольку он работает в своей :term[ветке]{canonical="Branch"} `feature/user-onboarding-v2`, все новые версии автоматически сохраняются в неё. Он может спокойно всё менять и тестировать, не мешая другим.

3.  **Использование существующих частей**: В новом процессе нужно отправить письмо. Разработчик обращается к стандартной инструкции по адресу `idea:activities/send-email`. Система сначала ищет её в :term[ветке]{canonical="Branch"} `feature/user-onboarding-v2`. Не найдя, она смотрит в следующей по списку — `main` — и находит там стабильную версию.

4.  **Переопределение части**: Разработчику нужен особый шаблон для приветственного письма. Он создаёт новую версию `idea:records/email-templates/welcome`. Эта новая версия сохраняется в его :term[ветке]{canonical="Branch"} `feature/user-onboarding-v2`. Теперь, когда его процесс запрашивает этот шаблон, система сначала находит его новую версию и использует её, не трогая старую в `main`.

5.  **Публикация**: Когда работа закончена, разработчик «публикует» её. :term[Идея]{canonical="Idea" href="./101_concept_idea.md"} с технической версией `1.3.new-login.2` копируется, получает чистый номер `1.4` и публикуется в :term[ветке]{canonical="Branch"} `main`. Теперь это новая стабильная версия для всех.

6.  **Контролируемые обновления**: Другой процесс в системе использовал `idea:processes/onboarding?1`. Поскольку новая версия `1.4` подходит под этот запрос, в следующий раз этот процесс автоматически подхватит обновление. Чтобы этого избежать и обеспечить стабильность, можно «закрепить» зависимость, указав более точную версию, например `?1.3`.