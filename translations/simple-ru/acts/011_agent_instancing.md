# 011: Агент/Инстансинг

> [!DEFINITION] [Инстансинг](./000_glossary.md)
> Это когда ты просишь агента сделать что-то, но не один раз, а сразу много раз для разных, независимых задачек. Каждая задачка — это `экземпляр` со своим `состоянием` и уникальным номером.



**Протокол Инстансинга** — это как конвейер на фабрике для задач агента. Он позволяет взять один и тот же [План](./010_agent_plan.md) (инструкцию) и запустить его одновременно для множества независимых `Состояний` (заготовок). Это делает работу гораздо быстрее и качественнее.

## Как работает Инстансинг

В основе Инстансинга лежит протокол **[009: Агент/Состояние](./009_agent_state.md)**. Вместо того чтобы отправлять одно `Состояние` (одну задачу), мы отправляем целый список таких состояний. Каждое состояние в списке — это отдельная, независимая задачка, или `экземпляр`.

Чтобы ИИ не запутался, какому `Состоянию` какая команда предназначена, каждому из них присваивается уникальная метка через специальное свойство `_instance`. Эти метки — короткие и простые (например, `①`, `②`). С их помощью ИИ понимает, с каким именно экземпляром он сейчас работает.

Этот подход даёт большие плюсы:

- **Скорость**: Мы обрабатываем много задач за один раз, как будто на кассе в супермаркете открыли сразу десять окошек.
- **Качество**: Когда ИИ видит сразу несколько похожих задач в одном запросе, он лучше понимает общую картину и придумывает более качественные и одинаковые решения для всех.

## Совместная работа с контекстными сообщениями

Вся магия протокола в том, как метка `_instance` заставляет разные типы сообщений работать только с «правильным» экземпляром.

- **Состояние:** Сообщение `Состояние` (State) — это сердце протокола. Каждый `Экземпляр` — это отдельное `Состояние` со своей меткой `_instance`. Это как отдельный холст для рисования: на каждом можно создавать свою картину, не боясь испортить соседнюю.



- **Ввод:** Сообщение `Ввод` (Input) можно использовать двумя способами. Если у него нет метки `_instance`, то его инструкция применяется ко всем экземплярам сразу (как приказ для всей армии). Если же метка есть, то инструкция выполняется только для одного конкретного экземпляра (как личное поручение одному солдату).



- **Области видимости (Scopes):** Метка `_instance` помогает изолировать данные. Когда команда `Вызов` (Call) направлена на конкретный экземпляр, то и её `_scopes` (данные, которые она видит) тоже относятся только к этому экземпляру. Это похоже на то, как у каждого ученика в классе есть свой пенал с ручками — никто не может взять ручку из чужого пенала.



## Совместная работа с другими протоколами

Инстансинг хорошо сочетается с другими протоколами, которые управляют выполнением задач.

- **Вызовы (Calls):** Свойство `_instance` в сообщении `Вызов` (Call) — это главный навигатор. Оно как почтовый адрес, который гарантирует, что любая команда (например, записать результат или прочитать данные) будет выполнена точно в нужном `Экземпляре`.



- **План (Plan):** Если Инстансинг — это конвейер, то `План` — это чертёж того, что на этом конвейере собирают. Один и тот же `План` (чертёж) можно использовать для каждого `Экземпляра` (заготовки) в большой партии, чтобы получить одинаковый результат.



## От Планирования к Процессу

`План` — это многоразовый рецепт, а `Инстансинг` — это способ приготовить по нему сразу много блюд. А **[Идея-Процесс](./203_idea_process.md)** — это и есть готовый результат: подробная запись о том, какой был рецепт и как готовилось каждое блюдо.