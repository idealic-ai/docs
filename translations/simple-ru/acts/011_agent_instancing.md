# 011: Агент/Инстансинг

> **Инстансинг:** Это процесс обработки множества независимых «инстансов» (каждый со своим «объектом состояния» и уникальным номером) в рамках одного запроса к агенту. — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требуется: [010: Агент/Состояние](./010_agent_state.md)
> - Совместимо с:
>   - [007: Агент/Входные данные](./007_agent_input.md)
>   - [008: Агент/Импорты](./008_agent_imports.md)
>   - [013: Agent/План](./013_agent_plan.md)

**Протокол Инстансинга** — это способ, который позволяет нашему умному помощнику-агенту работать не с одной задачей, а сразу с целой пачкой независимых дел в одном запросе. Представь, что агент — это супер-повар, который может одновременно готовить десять разных блюд на одной кухне. Благодаря этому он работает намного быстрее и качественнее, потому что видит всю картину целиком. Этот протокол — ключ к тому, чтобы агент мог обрабатывать не по одной штучке, а целые потоки данных.

## Как работает механизм Инстансинга

Инстансинг основан на протоколе **[010: Агент/Состояние](./010_agent_state.md)**. Но вместо того, чтобы давать агенту одно «состояние» (или, скажем, одну рабочую область), мы даём ему целый список таких областей. Каждая из них — это отдельная задача, или «инстанс».

Чтобы агент не запутался, работая со всеми задачами одновременно, каждой из них присваивается **уникальный номер** в специальном поле `_instance`. Эти номера — короткие и понятные метки (например, `①`, `②`), которые помогают «мозгу» агента (LLM) понимать, какое действие к какой задаче относится. Это как стикеры на разных папках с домашним заданием.

Такой подход даёт большие преимущества:

- **Эффективность**: Это как открыть сразу десять касс в магазине вместо одной. Скорость работы многократно возрастает, потому что много задач решается за один раз.
- **Качество**: Когда агент видит сразу несколько похожих задач, он лучше понимает общую цель и может придумать более продуманный и качественный план действий для всех.

## Взаимодействие с другими сообщениями

Сила этого протокола в том, как уникальный номер `_instance` управляет поведением других типов сообщений.

- **Состояние (State):** Сообщение о состоянии — это сердце протокола. Каждый «инстанс» — это отдельный объект состояния со своей меткой `_instance`. Это как отдельный холст для каждой картины: можно рисовать на всех сразу, и краски с одного холста не попадут на другой.

  > Sidenote:
  >
  > - [010: Агент/Состояние](./010_agent_state.md)

- **Входные данные (Input):** Сообщение с входными данными можно использовать двумя способами. Если отправить общее сообщение `Input` без метки `_instance`, его инструкция применится ко всем задачам сразу. А если указать метку, например `①`, то эта инструкция будет только для задачи номер один, заменяя собой общую.

  > Sidenote:
  >
  > - [007: Агент/Входные данные](./007_agent_input.md)

- **Импорты (Imports):** Метка `_instance` помогает разделить данные. Когда мы вызываем какой-то Модуль для работы над конкретной задачей, он получает доступ только к тем данным, которые относятся именно к ней. Это как если бы ты попросил друга помочь с математикой: ты даёшь ему только тетрадь по математике, а не все учебники сразу, чтобы он не запутался.

  > Sidenote:
  >
  > - [008: Агент/Импорты](./008_agent_imports.md)

## Взаимодействие с другими протоколами

Инстансинг работает вместе с протоколами более высокого уровня, чтобы управлять ходом выполнения задач.

- **Вызовы (Calls):** Поле `_instance` в сообщении `Call` — это как адрес на письме. Он точно указывает, к какому «инстансу» применить действие. Благодаря этому все изменения — будь то запись результата или чтение данных — происходят в правильном месте.

  > Sidenote:
  >
  > - [004: Агент/Вызов](./004_agent_call.md)

- **План (Plan):** Инстансинг даёт нам способ выполнять много задач параллельно, а `План` определяет, что именно нужно делать. Один и тот же План можно использовать для каждого «инстанса» в запросе. Это как инструкция по сборке: по одной и той же инструкции можно собрать сотни одинаковых игрушек, и каждая будет сделана правильно.

  > Sidenote:
  >
  > - [013: Agent/План](./013_agent_plan.md)

## От параллельной работы к планированию

Инстансинг даёт нам механизм для одновременной работы над множеством независимых состояний. Однако последовательность действий для каждого состояния часто бывает сложной и требует своего описания. Чтобы справиться с этим, агенту нужен готовый «рецепт», который можно применять к каждому инстансу.

Следующий документ, **[013: Agent/План](./013_agent_plan.md)**, описывает протокол для создания таких многоразовых планов действий.
