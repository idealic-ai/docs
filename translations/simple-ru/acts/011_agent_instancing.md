# 011: Агент/Инстансинг

> [!DEFINITION] [Инстансинг](./000_glossary.md)
> Это когда нужно выполнить одну и ту же задачу для множества разных вещей одновременно. Представь, что тебе нужно отправить 100 одинаковых писем, но разным людям. Инстансинг — это процесс, при котором ты создаёшь 100 независимых «экземпляров» этого письма, каждый со своим адресом, и отправляешь их все за один раз, а не по одному.

> Sidenote:
> - Требует: [009: Агент/Состояние](./009_agent_state.md)
> - Совместим с:
>   - [007: Агент/Ввод](./007_agent_input.md)
>   - [013: Агент/Области](./013_agent_scopes.md)
>   - [010: Агент/План](./010_agent_plan.md)

**Протокол Инстансинга** — это умный способ выполнять множество одинаковых задач очень быстро. Он позволяет взять один общий **[План](./010_agent_plan.md)** (как инструкцию) и применить его сразу к куче независимых объектов `Состояния`. Это сильно ускоряет работу и делает результат более предсказуемым.

## Как работает механизм Инстансинга

Инстансинг работает на основе протокола **[009: Агент/Состояние](./009_agent_state.md)**. Вместо того чтобы отправлять агенту одно `состояние`, ты можешь отправить ему целый список, где каждый элемент — это отдельная задача или `экземпляр`.

Чтобы агент не запутался, каждому `состоянию` в списке присваивается уникальный значок-метка, например `①` или `②`. Эта метка хранится в специальном поле `_instance`. Благодаря этим меткам, ИИ-модель точно знает, какая операция к какому `экземпляру` относится.

Это даёт огромные плюсы:

- **Эффективность**: Представь, что ты можешь испечь сто кексов в одной большой печи вместо того, чтобы печь их по одному. Инстансинг так же обрабатывает множество задач за один раз, экономя время.
- **Предсказуемость**: Когда ИИ видит все похожие задачи сразу, он лучше понимает общую картину. Это помогает ему создавать более качественные и единообразные планы для каждой из них.

## Взаимодействие с другими сообщениями

Сила этого протокола в том, как метка `_instance` помогает разграничивать информацию от разных типов сообщений.

- **Состояние:** Сообщение `Состояния` — это основа всего. Каждый `экземпляр` — это отдельный `объект состояния` со своей уникальной меткой `_instance`. Это как если бы у каждого ученика в классе был свой собственный чистый лист для работы, чтобы они не мешали друг другу.

  > Sidenote:
  > - [009: Агент/Состояние](./009_agent_state.md)

- **Ввод:** Сообщение `Ввода` можно использовать двумя способами. Если отправить одно общее сообщение `Ввода` (без метки), его содержимое будет применяться ко всем `экземплярам` сразу. А если отправить сообщение с меткой (например, для `②`), то эти данные увидит только второй `экземпляр`, заменяя для него общую информацию.

  > Sidenote:
  > - [007: Агент/Ввод](./007_agent_input.md)

- **Области:** Метка `_instance` изолирует рабочие пространства (`области`). Когда `вызов` направлен на конкретный `экземпляр`, его `_scopes` (данные, с которыми он работает) также относятся только к этому `экземпляру`. Именно поэтому `делегат` (помощник) видит только ту информацию, которая нужна для его маленькой задачи, даже если он — лишь один из многих в большом потоке одновременных задач.

  > Sidenote:
  > - [013: Агент/Области](./013_agent_scopes.md)

## Взаимодействие с другими протоколами

Инстансинг сочетается с другими протоколами для управления всем процессом.

- **Вызовы:** Указание метки `_instance` в `вызове` — это главный способ направить его на нужную цель. Эта метка гарантирует, что все действия, будь то запись результата или чтение данных из `состояния`, произойдут именно в том `экземпляре`, для которого они предназначены.

  > Sidenote:
  > - [004: Агент/Вызов](./004_agent_call.md)

- **План:** Если инстансинг — это способ выполнять задачи параллельно, то `План` — это сама последовательность этих задач. Один и тот же `План` можно применить к каждому `экземпляру` в запросе. Это гарантирует, что сложный, многошаговый процесс будет выполнен одинаково для целой партии данных.

  > Sidenote:
  > - [010: Агент/План](./010_agent_plan.md)

## От Плана к Процессу

`План` — это многоразовый шаблон для работы. `Инстансинг` — это механизм, который выполняет этот план в большом масштабе. А **[Идея Процесса](./203_idea_process.md)** — это конечный результат, артефакт. Он представляет собой полную и самодостаточную запись, объединяющую стратегический план и его реальное выполнение для всех `экземпляров`.
