# 014: Агент/Мета

> [!DEFINITION] [Мета-свойства](./000_glossary.md)
> Это специальный блок информации, который служит «паспортом» для :term[Запроса]{canonical="Request"}. В нём записано его уникальное имя, версия, дата создания и к каким «веткам» он относится. Эта информация помогает компьютеру точно знать, что это за запрос, и находить его среди других.



Хотя многие задачи для искусственного интеллекта могут быть одноразовыми, для создания сложных систем, которые запоминают свои действия, нужен способ точно определять и отслеживать каждый :term[Запрос]{href="./001_agent_request.md"} и его :term[Решение]{href="./001_agent_request.md"}. Для этого и существует объект **`Мета`**. Это как визитная карточка :term[Запроса]{canonical="Request"}: она содержит стабильную, понятную для компьютера информацию, которая позволяет сохранять, версионировать, находить и отслеживать историю запроса. Самое важное, что ИИ может сам создавать новые такие «визитки» или создавать их «копии» для новых версий, превращая простой ответ в акт творения.

## Объект `Мета` в жизненном цикле Запроса

Объект `Мета` — это главный участник в жизни :term[Запроса]{href="./001_agent_request.md"}. Он появляется в `контексте`, чтобы сообщить ИИ, с какой именно задачей он работает, и в `схеме`, как обязательная часть `решения`.

- **В `контексте`**: сообщение `meta` даёт ИИ «паспорт» той задачи или процесса, который он сейчас обновляет.
- **В `схеме`**: схема `решения` требует, чтобы в нём был объект `meta`. Это заставляет ИИ подумать и обновить «паспорт» в рамках своей работы.
- **В `решении`**: ИИ создаёт новый объект `meta`, часто с обновлённой версией, показывая, что задача продвинулась на следующий шаг.

Этот круговорот превращает ИИ из простого исполнителя в активного участника, который помогает развивать долгоживущую и версионируемую сущность.

> [!HEADSUP] На заметку: от Запроса к Идее
> Вся эта цепочка :term[Запроса]{href="./001_agent_request.md"} — `контекст` (включая сообщение `Meta`), `схема` и итоговое `решение` — образует единый, самодостаточный блок. Когда этот блок сохраняется, система называет его :term[Идеей]{href="./101_concept_idea.md"}. Объект `Мета` — это ключ, который превращает мимолётный `Запрос` в постоянную, адресуемую `Идею`.
>
> > Sidenote:
> > :term[101: Концепция/Идея]{href="./101_concept_idea.md"}.

::::columns
:::column{title="Пример структуры Запроса"}

```json
// ИИ получает текущие метаданные как контекст
// и должен создать новые в решении.
{
  "context": [
    {
      "type": "meta",
      "meta": {
        "domain": "reactor.ideas.services",
        "path": "/games/321",
        "version": "1.2.3",
        "branches": ["main"],
        "createdAt": "2025-10-26T10:00:00Z"
      }
    },
    {
      "type": "state",
      "state": {
        "...текущее состояние игры..."
      }
    }
  ],
  "schema": {
    "type": "object",
    "properties": {
      "meta": {
        "$ref": "MetaSchema"
      },
      "output": {
        "$ref": "GameSchema"
      }
    }
  }
}
```

:::
:::column{title="Пример Решения"}

```json
// Решение от ИИ включает следующее состояние игры
// и повышенную версию в новом мета-объекте.
{
  "meta": {
    "domain": "reactor.ideas.services",
    "path": "/games/321",
    "version": "1.2.4",
    "branches": ["main"],
    "createdAt": "2025-10-26T10:05:00Z"
  },
  "output": {
    "...следующее состояние игры..."
  },
  "calls": []
}
```

:::
::::

## Самостоятельное развитие и версионирование

Одна из ключевых задач объекта `Мета` — позволить процессам, управляемым агентами, развиваться самостоятельно. Когда система сообщает ИИ текущую версию и просит указать новую в `решении`, она поручает ему «перелистнуть страницу» — обновить номер версии. Если ИИ вносит небольшие, совместимые изменения, он должен увеличить младшую цифру версии (например, с `1.2.3` до `1.2.4`). Это создаёт новый, неизменяемый «снимок» состояния и логики, формируя полную историю действий агента, которую можно проверить.



Это создаёт проблему в больших системах: если два разных процесса одновременно отреагируют на разные события, они оба могут попытаться обновить версию с `1.2.3` до `1.2.4`. Возникнет путаница, как будто два человека одновременно пытаются сохранить файл под одним и тем же именем.

Система решает эту проблему с помощью «ветвления». Когда нужно начать новую линию разработки, процесс добавляет новую ветку в массив `branches` (например, `["main", "my-feature"]`). Версии становятся похожими на `1.2.3.branch-A.1` и `1.2.3.branch-B.1`. Это позволяет им развиваться параллельно, не мешая друг другу. Позже эти разные истории можно будет объединить.



## Связь «паспорта» с адресом

Информация внутри объекта `Мета` содержит всё необходимое, чтобы дать :term[Запросу]{canonical="Request"} уникальный адрес, известный во всём мире. Это позволяет найти, перенаправить или сослаться на конкретную версию пары «запрос-решение» из любой программы.



Процесс поиска связывает запрос (например, «дай мне последнюю версию») с конкретным, неизменным результатом. Вот как это работает:

- **Мета (Паспорт)**: Свойства конкретной, версионированной сущности.
  - _meta.domain:_ `my-project.com` (домен)
  - _meta.path:_ `bob` (путь)
  - _meta.version:_ `1.2.staging.1` (версия)
  - _meta.branches:_ `['staging']` (ветки)
  - _meta.createdAt:_ `2025-10-26T10:00:00Z` (дата создания)

- **Ссылка (Запрос на поиск)**: Динамический запрос на поиск сущности.
  - `idea://my-project.com/bob?1.2` (адрес)
  - _В каких ветках искать:_ `['staging']`
  - _Не старше чем:_ `2025-10-26T10:00:00Z` (из `createdAt`)

- **Найдено (Результат)**: Постоянный, однозначный адрес, указывающий на найденный ресурс.
  - `idea://my-project.com/~:staging/bob?1.2:1.2.staging.1`
  - _Ветка:_ `~:staging`
    - _искали в:_ любой ветке из списка
    - _нашли в:_ `staging`
  - _Версия:_ `1.2:1.2.staging.1`
    - _искали:_ последнюю, совместимую с `1.2`
    - _нашли:_ `1.2.staging.1`

Это делает каждую пару «запрос-решение» самодостаточной и легко находимой по своему адресу.