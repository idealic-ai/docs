# 014: Агент/Мета

> [!DEFINITION] [Мета-свойства](./000_glossary.md)
> Это как паспорт для :term[Идеи]{canonical="Idea"}. В нём записана вся основная информация: имя, «прописка» (пространство имён), версия, дата создания и к каким веткам развития она относится. Этот паспорт позволяет компьютерам точно понимать, что это за :term[Идея]{canonical="Idea"}, откуда она и как её найти.

> Sidenote:
> - Требует:
>   - :term[001: Агент/Запрос]{href="./001_agent_request.md"}
>   - :term[107: Концепция/Идентичность]{href="./107_concept_identity.md"}
> - Делает возможным:
>   - :term[108: Концепция/Видимость]{href="./108_concept_visibility.md"}
>   - :term[110: Концепция/Адресация]{href="./110_concept_addressing.md"}

Хотя у каждой :term[Идеи]{canonical="Idea"} её уникальность рождается из связей с другими идеями (:term[Эмерджентная Идентичность]{href="./107_concept_identity.md"}), для общения с программами нужен более прямой и понятный способ её опознать. Для этого и существует объект **`Meta`**.

Это «визитная карточка» :term[Идеи]{canonical="Idea"}, которая даёт компьютерам чёткую и стабильную информацию для отслеживания версий, поиска и понимания того, с чем они работают.

## Объект `Meta` в жизненном цикле Запроса

Объект `Meta` — это главный участник в жизни :term[Запроса]{href="./001_agent_request.md"}. Он появляется в «контексте», чтобы сообщить нейросети (LLM), с какой :term[Идеей]{canonical="Idea"} она работает, и в «схеме» — как обязательная часть будущего решения.

- **В `context` (контексте)**: Сообщение `meta` передаёт нейросети «паспорт» той :term[Идеи]{canonical="Idea"}, которую она сейчас обрабатывает.
- **В `schema` (схеме)**: Схема для `solution` (решения) требует, чтобы в ответе было свойство `meta`. Это заставляет нейросеть подумать об идентичности :term[Идеи]{canonical="Idea"} и обновить её, если нужно.
- **В `solution` (решении)**: Нейросеть создаёт новый объект `meta`, часто с обновлённой версией, отражая то, как :term[Идея]{canonical="Idea"} изменилась.

Такой круговорот превращает нейросеть из простого исполнителя в активного участника жизни и развития :term[Идеи]{canonical="Idea"}.

::::columns
:::column{title="Пример структуры Запроса"}

```json
// Нейросеть получает текущие мета-данные как контекст
// и должна создать новые в своём решении.
{
  "context": [
    {
      "type": "meta",
      "meta": {
        "domain": "reactor.ideas.services",
        "path": "/games/321",
        "version": "1.2.3",
        "branches": ["main"],
        "createdAt": "2025-10-26T10:00:00Z"
      }
    },
    {
      "type": "state",
      "state": {
        "...текущее состояние игры..."
      }
    }
  ],
  "schema": {
    "type": "object",
    "properties": {
      "meta": {
        "$ref": "MetaSchema"
      },
      "output": {
        "$ref": "GameSchema"
      }
    }
  }
}
```

:::
:::column{title="Пример Решения"}

```json
// Решение нейросети включает следующее состояние игры
// и повышенную версию в новом мета-объекте.
{
  "meta": {
    "domain": "reactor.ideas.services",
    "path": "/games/321",
    "version": "1.2.4",
    "branches": ["main"],
    "createdAt": "2025-10-26T10:05:00Z"
  },
  "output": {
    "...следующее состояние игры..."
  },
  "calls": []
}
```

:::
::::

## Самостоятельное развитие и управление версиями

Одна из ключевых задач объекта `Meta` — дать :term[Идее]{canonical="Idea"} возможность развиваться самой. Когда мы сообщаем нейросети текущую версию и ветки развития, а затем просим её создать новую версию в ответе, мы даём ей задание обновить «паспорт» :term[Идеи]{canonical="Idea"}. Каждый раз, когда агент реагирует на что-то, он может немного увеличить номер версии (например, с 1.2.3 на 1.2.4), создавая новый, неизменяемый «снимок» своего состояния и логики.

Здесь может возникнуть сложность: если два разных процесса одновременно отреагируют на разные события, они оба могут попытаться обновить версию с `1.2.3` до `1.2.4`. Это как если бы два человека одновременно попытались сохранить файл под одним и тем же именем — кто-то проиграет.

Система решает эту проблему с помощью механизма веток, который описан в концепции :term[Видимости]{href="./108_concept_visibility.md"}. Когда нужно начать новую линию развития, процесс создаёт новую ветку (например, `["main", "my-feature"]`). Тогда версии становятся такими: `1.2.3.branch-A.1` и `1.2.3.branch-B.1`. Это позволяет им развиваться параллельно, не мешая друг другу. Позже эти разные истории можно будет объединить.

## Связь между «паспортом» и адресом

Поля в объекте `Meta` напрямую связаны с частями адреса в схеме :term[idea:]{href="./110_concept_addressing.md"}. Это создаёт прочную связь между «паспортом» :term[Идеи]{canonical="Idea"} и её адресом в сети.

Из этих свойств можно составить постоянный, точный адрес, указывающий на конкретное состояние :term[Идеи]{canonical="Idea"}: `idea://my-project.com/~staging/bob?1.2.3`

> Sidenote:
> - Адресная схема :term[idea:]{href="./110_concept_addressing.md"} — это как раз тот язык, который мы используем, чтобы ссылаться на эти развивающиеся :term[Идеи]{canonical="Idea"} и работать с ними.

Этот постоянный адрес может быть результатом поиска по более общему запросу, например:

- Мета: `idea://my-project.com/~staging/bob?1.2.3`
  - _meta.domain:_ `my-project.com`
  - _meta.path:_ `bob`
  - _meta.version:_ `1.2.staging.1`
  - _meta.branches:_ `['staging']`
  - _meta.createdAt:_ `2025-10-26T10:00:00Z`


- Ссылка-запрос: `idea://my-project.com/bob?1.2`
  - _Искать в ветках:_ `['staging']`
  - _Не позднее чем:_ `2025-10-26T10:00:00Z`

- Найдено: `idea://my-project.com/~:staging/bob?1.2:1.2.staging.1`
  - _Ветка:_ `~:staging`
    - _запрошено:_ любая ветка
    - _получено_: `staging`
  - _Версия:_ `1.2:1.2.staging.1`
    - _запрошено:_ `1.2`
    - _получено:_ `1.2.staging.1`

Благодаря этому :term[Идея]{canonical="Idea"} сама себя описывает. В её объекте `Meta` содержится вся информация, чтобы создать на неё постоянную и точную ссылку.
