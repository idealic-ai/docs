# 002: Агент/Инструмент

> **Инструмент**: Представь, что у твоего робота-помощника есть пояс с гаджетами, как у Бэтмена. Инструмент — это инструкция для одного такого гаджета. Она объясняет умной программе (агенту), что можно сделать. Например, «найти картинку в интернете». Когда агент решает использовать гаджет, он создаёт специальную команду — `Вызов` (Call). А выполнить эту команду может либо сам агент «в уме», либо другая программа-помощник, которая называется `Действие`. — [Глоссарий](./000_glossary.md)

> Sidenote: - Требуется: [001: Агент/Запрос](./001_agent_request.md)
> - Дополняется: [003: Агент/Действие](./003_agent_activity.md)

В этом документе мы разберёмся, что такое Инструменты. Если представить нашего агента (умную программу) как конструктор LEGO, то Инструменты — это самые важные детальки, которые дают ему разные умения.

## Что такое Инструменты?

**Инструменты — это как набор гаджетов для супергероя**. Они дают агенту самую крутую суперспособность: **самому выбирать, что делать дальше**. Благодаря этому агент может подбирать правильный гаджет для каждой конкретной задачи, а не просто слепо выполнять один приказ.

Представь, что наш агент — это повар на кухне. А Инструменты — это его поваренная книга с рецептами.

Каждый рецепт (Инструмент) в этой книге:

- **Даёт понятные указания**: Объясняет, что это за блюдо мы готовим и что оно делает.
- **Перечисляет «ингредиенты»**: Говорит, что нужно для работы (например, «текст для перевода») и что получится в конце (например, «переведённый текст»).
- **Позволяет творить**: Рецепты можно смешивать, чтобы приготовить что-то сложное, прямо как настоящий шеф-повар.
- **Написан для ИИ**: Рецепты составлены на таком языке, чтобы наш повар-компьютер мог их сам прочитать, понять и выбрать самый подходящий.

Когда повар выбрал рецепт (Инструмент) и отмерил все нужные ингредиенты, он создаёт **Вызов** (Call). Это похоже на заказ в ресторане, который отправляется на кухню: «Приготовить блины по этому рецепту с клубничным джемом!». Этот заказ и есть команда к действию. О том, как она выполняется, читай в документе [004: Агент/Вызов](./004_agent_call.md).

> **Кстати**: Если ты просто просишь ИИ «напиши стих», это простая «Идея». А Инструменты нужны, когда задача сложнее, и ИИ должен сам, как детектив, решать, какие шаги предпринять — например, сначала поискать информацию в интернете, потом проанализировать её, а потом написать отчёт. О том, как из простых Идей рождаются Инструменты, рассказано здесь: [007: Агент/Ввод](./007_agent_input.md).

## Зачем вообще нужны Инструменты

Используй Инструменты, когда хочешь, чтобы твой агент умел:

- **Думать самостоятельно** и сам решать, какой гаджет применить в ответ на новую ситуацию.
- **Выбирать из нескольких вариантов**, чтобы достичь цели (например, искать ответ в Google или в Википедии).
- **Пробовать разные подходы** к одной и той же задаче (например, использовать разные поисковые системы).
- **Сочетать творчество ИИ со строгими правилами** при принятии решений.

## Как всё это работает

### Главное правило: Рецепт — это не еда

Вся система Инструментов построена на одной простой мысли: **Инструмент — это всего лишь рецепт, описание**. Он говорит, *что* можно сделать, но не говорит, *как* именно. А готовить блюдо будет либо сам ИИ-повар (как бы «в своей голове»), либо он поручит это специальной машине-помощнику под названием **[003: Агент/Действие](./003_agent_activity.md)**.

В рецепте (Инструменте) описано:

- **Что он делает** (description)
- **Что для этого нужно** (какие «ингредиенты»-параметры)
> Sidenote: о расширениях:
> 
> - `_instance`: Это для продвинутых штук, о них тут: [011: Агент/Инстансинг](./011_agent_instancing.md)
> - `_module`: И об этих тоже: [009: Агент/Модуль](./009_agent_module.md)
- **Что получится в итоге** (как будет выглядеть готовое «блюдо» в поле `_output`)
- **Как он называется** (имя в поле `_tool`)
- **Кто его будет готовить** (поле `_activity`, которое указывает на машину-помощника, подробнее в [003: Агент/Действие](./003_agent_activity.md))

### «Служебные» поля в рецепте

В рецептах есть специальные поля, их имена начинаются с нижнего подчёркивания (`_`). Это как служебные пометки для главного повара (системы):

- **_tool**: Уникальное название рецепта (обязательно).
- **_activity**: Пометка, какая машина-помощник (`Действие`) нужна для готовки, если она вообще нужна.
- **_output**: Описание того, как должно выглядеть идеальное готовое блюдо.
- **_reasoningForCall**: Записка от агента самому себе, почему он решил использовать именно этот рецепт (система добавляет её автоматически).

Любое другое поле без `_` — это обычный «ингредиент», который нужен для работы. Служебные поля всегда пишут первыми, чтобы нашему ИИ-повару было проще их читать.

### За что отвечает система

Система, которая управляет Инструментами, работает как шеф-повар на большой кухне. Она отвечает за то, чтобы:

- **Хранить поваренную книгу**: собирать все рецепты (Инструменты) в одном месте.
- **Помогать заполнить заказ**: когда ИИ решает что-то сделать, система помогает ему правильно вписать все «ингредиенты».
- **Отдать заказ на кухню**: решить, кто будет выполнять работу — сам ИИ «в уме» или специальная программа-помощник (`Действие`).

Более сложные вещи, вроде управления очередью заказов, строятся уже поверх этой системы (например, протокол [004: Агент/Вызов](./004_agent_call.md)).

## Как выглядит Инструмент на самом деле

Инструменты описываются на специальном языке для компьютеров — JSON-схема. Это похоже на карточку с рецептом. Вот пример Инструмента, который умеет определять настроение текста (весёлый он или грустный). Этот Инструмент простой, так что наш ИИ-повар может справиться с ним сам, «подумав», без помощи других машин.

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует настроение текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

## От ящика с инструментами к конкретной задаче

Хотя каждый Инструмент — это отдельное умение, настоящая магия начинается, когда их много. Система не прячет инструменты от агента, а выкладывает перед ним весь ящик сразу. Агент смотрит на все доступные ему «гаджеты» и выбирает тот, который лучше всего подходит для текущей задачи. Когда он выбрал инструмент и подготовил всё необходимое для него — он создаёт **Вызов** (Call). Это и есть готовая к исполнению команда, которая передаётся дальше.

> Sidenote: - [004: Агент/Вызов](./004_agent_call.md).

## Два способа выполнить работу: «в уме» или позвать на помощь

Сам по себе `Инструмент` — это только инструкция. А выполнить команду (`Вызов`) по этой инструкции можно двумя способами.

**Первый способ: «в уме»**. Наш ИИ-повар сам придумывает результат, используя свои знания и опыт. Это как сочинить стихотворение или придумать шутку — для этого не нужны специальные машины. Этот способ используется по умолчанию.

**Второй способ: с помощью помощника**. Для некоторых задач нужна помощь со стороны. Например, чтобы узнать погоду на улице, нужно отправить запрос в интернет. Для этого `Инструмент` связывается со специальной программой-помощником, которая называется **Действие** (Activity).

Именно в этом разделении вся суть! Рецепт (`Инструмент`) и исполнитель (`Действие`) — это разные вещи. Благодаря этому агент может сначала спокойно обдумать план, а уже потом решить, справится ли он сам или ему понадобится помощь. Плюс, программу-помощника (например, старую хлебопечку) можно в любой момент заменить на новую, а рецепт хлеба останется прежним. О том, как работают эти помощники, мы поговорим в следующем документе: **[003: Агент/Действие](./003_agent_activity.md)**.