# 003: Агент/Действие

> **Действие (Activity):** Представь, что `Инструмент` — это кнопка в приложении с надписью «Узнать погоду». А `Действие` — это как раз тот самый код, та самая магия внутри, которая идёт в интернет и смотрит, солнечно там или идёт дождь. Без `Действия` кнопка — просто красивая картинка. — [Глоссарий](./000_glossary.md)

> Sidenote: - Чтобы понять этот текст, лучше сначала прочитать про `Инструменты`: [002: Агент/Инструмент](./002_agent_tool.md)
>

Этот документ объясняет, как мы даём нашим `Инструментам` (просто описаниям того, что можно сделать) настоящую силу с помощью работающего кода. Если `Инструмент` — это обещание что-то сделать, то `Действие` — это само выполнение этого обещания.

## Две разные «записные книжки»

Чтобы наш умный агент мог работать, у него есть две разные «записные книжки» или «полки с книгами». В одной хранится список того, *что он умеет делать*, а в другой — подробные инструкции, *как именно это делать*.

- **Книжка с Меню (Tool Registry):** Здесь лежат красивые описания `Инструментов`. Например, «Узнавать погоду», «Искать картинки». Это просто список возможностей.
- **Книжка с Рецептами (Activity Registry):** А здесь хранятся настоящие «рецепты» — то есть программный код (`Действия`), который выполняет всю работу.

Зачем так сложно? Чтобы можно было легко поменять рецепт, не перепечатывая всё меню! Например, сегодня мы узнаём погоду с одного сайта, а завтра — с другого, более точного. Агент этого даже не заметит, для него кнопка «Узнать погоду» останется прежней.

## Добавляем новый «рецепт»

Чтобы добавить новый «рецепт» в нашу книжку, мы используем специальную команду. Мы говорим системе: «Вот тебе рецепт под названием 'weatherCheck'. Он будет делать то-то и то-то».

```typescript
// Записываем наш рецепт (Действие).
// Имя 'weatherCheck' должно совпадать с Инструментом, для которого он предназначен.
Activity.register('weatherCheck', async call => {
  const data = await weatherAPI.get(call.location);
  return { temperature: data.temp, conditions: data.desc };
});
```

## Два пути: Фантазия и Реальная Работа

Когда агент хочет что-то сделать, у него есть два пути:

- **Путь Фантазии (Скрытое выполнение):** Агент не запускает никакой код. Он просто использует свой огромный мозг (ИИ), чтобы *представить*, какой мог бы быть ответ. Это как если бы ты спросил друга, какая погода, и он бы не посмотрел в окно, а просто предположил, основываясь на времени года.
  > Sidenote: - Когда ИИ «фантазирует», это называется скрытым режимом. Узнать про это больше можно здесь: [104: Концепция/Скрытое](./104_concept_latent.md)
- **Путь Реальной Работы (Явное выполнение):** Агент находит нужный «рецепт» и честно выполняет его шаг за шагом. Он запускает программу, которая идёт на сайт погоды и приносит точный ответ. Этот путь нужен, когда нужна 100% точность, а не догадки.

## Как агент выбирает, что делать

Как же агент решает, фантазировать или работать по-настоящему? У него есть простое правило из трёх шагов:

1.  **Искать особую подсказку**: Сначала он смотрит в «меню» (`Инструмент`), нет ли там специальной записки в поле `_activity` о том, какой «рецепт» (`Действие`) использовать.
2.  **Искать по такому же названию (самый частый способ)**: Если записки нет, он ищет «рецепт» с точно таким же названием, как у самого «блюда» в меню. Если находит — запускает его.
3.  **Включить фантазию**: Если он ничего не нашёл по первым двум правилам, значит, рецепта нет. Тогда он пожимает плечами и просто придумывает результат сам.

Благодаря этому всё очень просто:

- **Хочешь, чтобы твой код заработал, — назови `Действие` так же, как и `Инструмент`.**
- `Инструменты`, для которых нет кода, будут безопасно работать с помощью «фантазии» ИИ.
- Если очень нужно, можно указать в `Инструменте` особое имя `Действия`, и система будет использовать его.

## Почему так важно всё разделять

Представь, что в ресторане рецепт салата был бы напечатан прямо в меню. Если повар решит добавить новый соус, ему придётся перепечатать все-все меню в ресторане! Глупо, правда?

Разделение «меню» и «рецептов» даёт нам суперсилы:

- **Можно улучшать рецепты тайно**: Ты можешь полностью поменять программу, которая ищет погоду, а агент этого и не заметит. Для него всё останется по-старому, просто ответы станут точнее.
- **Можно экспериментировать**: Можно дать двум агентам одну и ту же задачу. Один будет «фантазировать» ответ, а другой — использовать настоящий код. И ты посмотришь, кто справился лучше.
- **Можно обновляться по частям**: Новые крутые «рецепты» можно дать только самым продвинутым агентам, а остальные пока пусть пользуются старыми или «фантазией» ИИ. Это безопасно.

## От описания к действию

Итак, мы разделили «что делать» (`Инструмент`) и «как делать» (`Действие`). Теперь у нас есть и меню, и рецепты. Остался последний шаг: научить «официанта» принимать заказы и передавать их на «кухню», чтобы всё заработало как часы.

Об этом — в следующем документе, [004: Агент/Вызов](./004_agent_call.md), который расскажет, как эти идеи превращаются в настоящие, пошаговые действия.
