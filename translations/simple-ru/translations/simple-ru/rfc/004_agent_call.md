# 004: Агент/Вызов

> **Вызов:** Это как взять рецепт-шаблон (`Инструмент`) и заполнить его конкретными ингредиентами. Получается готовая к выполнению команда, которая говорит, *что именно нужно сделать*.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Что нужно знать сначала:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
> - Что это поможет создать:
>   - [008: Агент/Импорты](./008_agent_imports.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - [202: Идея/Контейнер](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)

Представь, что у тебя есть классная **[Идея](./101_concept_idea.md)** — например, рецепт самых вкусных в мире печенек. Сама по себе это просто мысль в твоей голове. 

Чтобы компьютер (наш «Агент») понял твой рецепт, тебе нужен **[Инструмент](./002_agent_tool.md)**. Это как специальный бланк для заказа, где есть пустые поля: «Форма печенья: ___», «Начинка: ___».

Этот документ — про **Вызов**. Вызов — это когда ты берёшь этот бланк и заполняешь его: «Форма печенья: звёздочка», «Начинка: шоколадная крошка». Теперь это не просто шаблон, а конкретная команда, которую Агент может выполнить: «Испеки печенье-звёздочку с шоколадной крошкой!»

**Вызов** превращает возможность («можно испечь печенье») в конкретное действие («испечь вот такое печенье прямо сейчас»).

## Путь от Идеи до Вызова

Давай проследим весь путь от мысли до готовой команды:

1.  **Идея**: Всё начинается с задумки. Это твой рецепт или план. «Хочу нарисовать монстрика!»
2.  **Инструмент**: Мы превращаем идею в шаблон, понятный для Агента. Это как формаляр с пустыми полями: «Монстрик: цвет ___, количество глаз ___, добрый или злой? ___». (Больше об этом написано в [002: Агент/Инструмент](./002_agent_tool.md)).
3.  **Вызов**: Агент решает использовать Инструмент и заполняет пустые поля: «Монстрик: цвет зелёный, количество глаз три, добрый». Это и есть **Вызов** — готовая к исполнению команда.

Главное правило простое: **любую Идею можно превратить в Инструмент, а любой Инструмент — в Вызов.**

> Sidenote: Если интересно, как именно данные из Идеи попадают в поля Инструмента, загляни в **[007: Агент/Ввод](./007_agent_input.md)**.

## Как управлять выполнением: Где и Как?

Чтобы команда выполнялась правильно, Агенту нужно знать две вещи: **ГДЕ** её выполнять и **КАК**. Для этого у нас есть два «переключателя», которые Агент видит по специальным меткам в коде (`_module`, `_activity`, `_output`).

### Два измерения выполнения

1.  **Область (ГДЕ? Тут или где-то ещё?)**
    Она определяет, кто выполняет задачу: сам Агент или он её кому-то поручает.
    - **Встроенная Область** (по умолчанию): Агент делает всё сам, на своём «рабочем месте». Как повар, который сам нарезает овощи для салата.
    - **Модульная Область** (если есть метка `_module`): Агент передаёт задачу внешнему помощнику. Как если бы повар отдал овощи в специальную машину для нарезки, а сам занялся соусом.

2.  **Метод (КАК? По инструкции или творчески?)**
    Он определяет, как Агент приходит к результату.
    - **Явный Метод** (если есть метка `_activity`): Агент действует строго по написанному коду, как по математической формуле. Результат всегда будет одинаковым, без сюрпризов.
    - **Скрытый Метод** (по умолчанию): Здесь Агент включает «воображение». Он сам придумывает решение, опираясь на общую цель. Результат может быть креативным и разным каждый раз. Чтобы он не нафантазировал лишнего, ему дают подсказку, какой тип ответа от него ждут (свойство `_output`).

Эти переключатели можно сочетать, чтобы гибко управлять задачами. Больше подробностей об этом — в документе **[008: Агент/Импорты](./008_agent_imports.md)**.

## Строим сложные задачи из простых

`Вызов` — это как один кирпичик LEGO. Сам по себе он простой, но из множества таких кирпичиков можно построить целый замок. Точно так же из Вызовов собираются сложные, многоэтапные задачи.

Именно Вызовы запускают более крупные Идеи, например **[Контейнер](./202_idea_vessel.md)**. Контейнер — это как большая «рабочая заявка» для Агента, где описана вся ситуация. Агент изучает её и в ответ выдаёт список `Вызовов` — пошаговый план того, что нужно сделать.

> Sidenote:
>
> - [202: Идея/Контейнер](./202_idea_vessel.md)
> - [203: Идея/Процесс](./203_idea_process.md)

## Способы выполнения вызовов

Когда Агенту нужно выполнить сразу несколько команд (Вызовов), он может делать это по-разному:

```typescript
// Выполнить одну-единственную команду
const result = await Tool(call);

// Сделай ВСЕ эти команды и дождись, пока каждая завершится
const results = await Tool.all(calls);

// Начни делать все команды, но верни мне ответ от ПЕРВОЙ, которая УСПЕШНО справилась
const result = await Tool.any(calls);

// Кто быстрее? Запусти все команды и верни результат от той, что финишировала САМОЙ ПЕРВОЙ (неважно, успешно или с ошибкой)
const result = await Tool.race(calls);
```

Такой подход очень удобен, потому что позволяет:

- **Всё контролировать**: выполнять команды по одной, шаг за шагом.
- **Делать всё сразу**: запускать кучу независимых задач одновременно, чтобы сэкономить время.
- **Быстро получать ответ**: не ждать всех, а брать первый же подходящий результат (`.any()`)
- **Устроить гонку**: узнать, какой способ решения оказался самым быстрым (`.race()`).
- **Работать надёжно**: убедиться, что все связанные задачи выполнены успешно (`.all()`), иначе ничего не засчитывать.