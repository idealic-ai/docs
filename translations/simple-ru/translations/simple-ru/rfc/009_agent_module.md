# 009: Агент/Модуль: Как делить большие задачи на маленькие

> **Модуль**: Представь себе детальку LEGO. Она сама по себе что-то умеет (это `Действие` или `Идея`). Ты можешь взять эту детальку и использовать её в своей постройке, просто «позвав» её (`Вызов`). Эта деталька будет работать в своём собственном маленьком мирке, чтобы никому не мешать.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требуется:
>   - [004: Агент/Вызов](./004_agent_call.md)
> - Дополняется:
>   - [008: Агент/Импорты](./008_agent_imports.md)

В этой главе мы разберёмся, что такое **Модули**. Представь, что у твоего робота-помощника (агента) есть суперспособности (`Инструменты`). Модули — это правила, которые позволяют использовать эти способности в отдельной, «чистой комнате», чтобы никто и ничто не мешало. Это как попросить другого робота помочь тебе с частью задания. Так мы можем собирать большие и сложные программы из маленьких, удобных и многоразовых кубиков.

## Проблема: Гигантские инструменты и беспорядок

Когда твой робот-помощник учится делать много всего, хранить все его умения (`Инструменты`) в одной большой куче становится очень неудобно. Почему?

1.  **Слишком сложно разобраться**: Представь, что ты дал роботу инструкцию, в которой смешаны правила для готовки супа, починки велосипеда и игры на пианино. Робот просто запутается и не сможет понять, что делать. У искусственного интеллекта (ИИ) тоже есть предел, он не может держать в голове всё сразу.
2.  **Много лишнего**: Когда все инструменты лежат в одной коробке, ИИ может отвлечься на ненужные. Это как пытаться делать уроки, а на столе разбросаны игрушки, телефон и комиксы. Легко отвлечься и сделать ошибку.
3.  **Неудобно делиться**: Если один робот научился классно рисовать, а ты хочешь научить этому другого, тебе придётся передать ему не только кисточку (`Инструмент`), но и всю коробку с красками, альбомами и даже стол, за которым он сидел. Это неудобно.

Модули решают эти проблемы. Они создают **специальное рабочее место** (пространство модуля). Это как отправить задачу (`Вызов`) другому специалисту, который сделает свою работу в отдельном кабинете, где ему никто не мешает.

## Команда `_module`

Чтобы отправить задачу в такой отдельный «кабинет», мы используем специальную команду `_module` в правилах для `Инструмента`. Это как приписка на задании: «Эту часть пусть сделает кто-то другой, не я».

Команда `_module` — это просто текст.

- **`_module: 'idea://<имя-идеи>'`**: Эта надпись похожа на адрес сайта. Она указывает, какого именно другого робота-специалиста (`Идею`) нужно позвать на помощь.
- **`_module: 'anonymous'`**: Эта надпись означает «любой свободный». Она нужна, когда нам просто требуется временная «чистая комната» для какого-то `Действия`, и нам не важно, кто именно его выполнит.

## Работа в «чистой комнате»

Представь, что модуль — это идеально чистый рабочий стол. Когда ты отправляешь туда задачу (`Вызов`), этот стол абсолютно пуст. Задача не выполняется в общей мастерской главного робота, где всё завалено другими вещами.

Но как же тогда специалист в этой «чистой комнате» получит нужные для работы вещи? Для этого есть **[Правила для Импортов](./008_agent_imports.md)**. Это как список вещей, которые нужно принести в эту комнату. С помощью специальной команды `_imports` главный робот говорит: «Возьми вот этот чертёж и этот молоток из моей мастерской и передай их специалисту». Так в «чистой комнате» появляется только то, что нужно для дела, и ничего лишнего.

## Собираем из кубиков: Композитор и Звукорежиссёр

Благодаря модулям мы можем строить очень крутые и сложные системы. Некоторые роботы (`Идеи`) могут стать настоящими мастерами своего дела, а другие роботы будут просто обращаться к ним за помощью.

Давай представим робота-`Композитора` и робота-`Звукорежиссёра`.

- **`Звукорежиссёр`** — это отдельный, независимый робот (`Идея` по адресу `idea://sound-designer`). Он — профи по созданию крутых звуков на синтезаторе. Он знает всё о нотах, эффектах и ритмах.
- **`Композитор`** — его задача написать целую песню. У него есть инструмент `создатьМелодию`. Но сам `Композитор` не умеет работать с синтезатором. Вместо этого, его инструмент — это просто записка: «Попроси `Звукорежиссёра` сделать это для меня» (`_module: 'idea://sound-designer'`)

И вот что происходит, когда `Композитор` хочет создать мелодию:

1.  Он «зовёт» (`Вызов`) свой инструмент `создатьМелодию`.
2.  Система видит команду `_module` и создаёт для `Звукорежиссёра` отдельную студию («чистую комнату»).
3.  В эту студию загружаются все знания `Звукорежиссёра` о музыке.
4.  С помощью команды `_imports`, `Композитор` передаёт в студию записку: «Нужна весёлая мелодия в быстром темпе».
5.  `Звукорежиссёр`, находясь в своей студии, видит свою задачу и все свои инструменты. Он колдует над синтезатором и создаёт мелодию.
6.  Готовая мелодия отправляется обратно `Композитору` как результат работы инструмента `создатьМелодию`.

Смотри, что получилось: `Композитору` не нужно разбираться в синтезаторах, а `Звукорежиссёру` не обязательно знать, для какой песни он пишет музыку. Они как два независимых профессионала, которые могут работать вместе, чтобы создать что-то большое и классное.

## Работа с огромными результатами

Модули помогают ещё с одной вещью. Иногда результат работы инструмента — это что-то огромное. Например, не просто мелодия, а целая партитура для оркестра на 100 страниц (`_output`).

Если бы `Композитор` пытался держать в голове всю эту партитуру, планируя остальные части песни, он бы запутался.

С модулями всё проще. `Композитор` просто говорит: «Мне нужна партитура от `Звукорежиссёра`». Он не заглядывает внутрь и не видит все 100 страниц сразу. Он просто знает, что `Звукорежиссёр` сделает свою работу и отдаст ему готовый результат.

Это позволяет роботу-помощнику планировать большие и сложные дела, не утопая в мелких деталях каждого шага. Он просто доверяет каждому модулю-специалисту, зная, что получит то, что нужно для следующего шага.