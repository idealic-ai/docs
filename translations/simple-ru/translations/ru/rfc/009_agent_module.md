# 009: Агент/Модуль

> **Модуль**: Представь, что это отдельный «специалист» (в виде набора «Действий» или «Идей»), которого твой главный агент может позвать на помощь. Этот специалист работает сам по себе и может использоваться много раз. Чтобы позвать его, используется особая команда `Call` и пометка `_module`.
>
> — [Словарь](./000_glossary.md)

> Sidenote:
>
> - Нужно прочитать:
> - [004: Агент/Вызов](./004_agent_call.md)
> - Помогает понять:
> - [008: Агент/Импорты](./008_agent_imports.md)

Эта статья объясняет, как работают **Модули**. Модули — это как приглашённые специалисты для твоего AI-агента. Они позволяют выполнять разные «Инструменты» в своей собственной, отдельной «комнате», не мешая основной работе. Это главный способ собирать очень умных и сложных агентов из маленьких, самостоятельных и многоразовых деталек, как из конструктора LEGO.

## Проблема: Один большой ящик с инструментами и полный беспорядок

Когда у AI-агента появляется всё больше и больше способностей, хранить все его «Инструменты» в одной большой куче становится неудобно.

1.  **Слишком длинный список**: Представь, что тебе дали инструкцию на 1000 страниц, чтобы собрать стул. Ты запутаешься! Компьютер (LLM) тоже путается, если у него гигантский список инструментов. Он может не понять, какой из них выбрать.
2.  **Путаница и беспорядок**: Когда все инструменты лежат в одном ящике, агент может случайно схватить не тот. Например, он хотел закрутить шуруп, а взял молоток, потому что тот лежал рядом и отвлёк его. Это называется «утечка контекста» — когда ненужная информация сбивает с толку.
3.  **Неудобно делиться**: Если ты собрал классный инструмент для одного агента, его очень сложно отдать другому. Придётся тащить не только сам инструмент, но и весь ящик, в котором он лежит.

Модули решают эти проблемы. Они создают для каждого инструмента отдельное рабочее место — **Область Видимости Модуля**. Это как попросить специалиста поработать в его собственной чистой мастерской.

## Пометка `_module`

Чтобы сказать агенту: «Эту задачу должен выполнить приглашённый специалист», мы используем специальную пометку `_module` в описании Инструмента. Эта пометка — сигнал, что работу нужно передать кому-то другому.

Пометка `_module` — это просто текст.

- **`_module: 'idea://<имя-идеи>'`**: Эта запись похожа на адрес. Она говорит: «Найди специалиста по имени `<имя-идеи>` и передай ему эту задачу».
- **`_module: 'anonymous'`**: Эта запись означает «анонимный специалист». Используется, когда тебе не нужен конкретный эксперт, а просто нужно выполнить задачу в тишине и чистоте, в отдельной комнате, чтобы никто не мешал.

## Работа в «чистой комнате»

Модуль предоставляет для работы «чистую комнату». Вместо того чтобы толкаться в шумной мастерской главного агента, задача выполняется в новом, изолированном пространстве. Информация для работы в этой комнате не берётся откуда попало, а тщательно подготавливается.

И вот тут нам на помощь приходит **[Протокол Импортов](./008_agent_imports.md)**. Пометка `_imports` в описании Инструмента — это как список вещей, которые нужно взять с собой в «чистую комнату». Главный агент говорит: «Возьми с собой вот этот чертёж и этот карандаш, больше ничего не понадобится». Так он точно контролирует, что увидит модуль-специалист, и избегает беспорядка.

## Собираем сложное из простого: Композитор и Звукорежиссёр

Модули позволяют создавать потрясающие вещи, объединяя разных специалистов. Это как если бы композитор и звукорежиссёр работали вместе над песней.

Представь себе агента-**`Композитора`** и агента-**`Звукорежиссёра`**.

- **`Звукорежиссёр`** — это самостоятельный специалист (`idea://sound-designer`). Он всё знает о синтезаторах и умеет создавать крутые звуки. Он — независимый эксперт, которого можно позвать на любой проект.
- Задача **`Композитора`** — написать красивую песню. Один из его инструментов называется `создатьМелодию`. Но `Композитор` сам не умеет работать с синтезаторами. Вместо этого он зовёт на помощь эксперта, используя пометку `_module: 'idea://sound-designer'`.

Когда `Композитор` решает создать мелодию, происходит следующее:

1.  Он отправляет запрос, как будто звонит `Звукорежиссёру`.
2.  Для `Звукорежиссёра` открывается его собственная чистая студия.
3.  С помощью `_imports` `Композитор` передаёт ему задание: «Мне нужна весёлая и быстрая мелодия для припева».
4.  `Звукорежиссёр` видит своё экспертное руководство по синтезаторам и конкретное задание от `Композитора`.
5.  Он создаёт идеальную мелодию и отправляет готовый результат обратно `Композитору`.

`Композитору` не нужно было разбираться в синтезаторах, а `Звукорежиссёру` — в написании всей песни. Это два независимых модуля, которые объединились, чтобы создать что-то по-настоящему крутое.

## Как быть с огромными инструкциями?

Модули также помогают, когда у инструмента очень сложный результат. Например, инструмент «Построй замок».

Инструкция для запуска может быть простой: «Нужен замок высотой в 10 башен». Но подробный чертёж готового замка (`_output`) будет занимать целую стену. Если показывать этот гигантский чертёж главному агенту сразу, он запутается и не сможет думать о других задачах.

С модулями всё проще. Главный агент просто говорит: «Заказываю один замок». И передаёт этот заказ модулю «Строитель замков».

Агент доверяет, что модуль сам разберётся со всеми сложными чертежами и вернёт ему готовый замок. Ему не нужно видеть все детали заранее. Так он может спокойно планировать следующие шаги, например, «проложить дорогу к замку», пока модуль-специалист выполняет свою сложную работу.