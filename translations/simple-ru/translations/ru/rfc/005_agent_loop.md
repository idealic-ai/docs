# 005: Агент/Цикл

> **Цикл:** Представь, что ты решаешь большую задачу, например, собираешь сложный конструктор LEGO. Ты не можешь сделать всё сразу. Ты делаешь это шаг за шагом. «Цикл» — это как раз такой процесс, когда ИИ решает задачу по частям. Он делает один шаг (`Запрос`), смотрит, что получилось (`Вызов`), и использует эту информацию, чтобы понять, какой шаг сделать следующим. И так снова и снова, пока задача не будет выполнена. — [Глоссарий](./000_glossary.md)

> Sidenote:
> 
> - Чтобы это понять, нужно знать о:
>   - [001: Агент/Запрос](./001_agent_request.md)
>   - [002: Агент/Инструмент](./002_agent_tool.md)
>   - [004: Агент/Вызов](./004_agent_call.md)

Этот документ объясняет, как работает **Протокол Цикла**. Это похоже на «режим мышления» для искусственного интеллекта, который позволяет ему выполнять большие задачи, состоящие из множества маленьких шагов.

## Как устроен Цикл

> Sidenote:
> 
> ```mermaid
graph TD
    Start((Начало)) --> AssembleContext(Собрать информацию)
    AssembleContext --> InvokeRequest(Сделать запрос)
    InvokeRequest --> HasCalls{В решении есть действия?}
    HasCalls -- Нет --> Stop((Конец))
    HasCalls -- Да --> HITL{Контроль человека}
    HITL -- Одобрено --> ExecuteCalls(Выполнить действия)
    ExecuteCalls -- Результаты --> AssembleContext
    HITL -- Исправлено --> AssembleContext
    classDef optional stroke-dasharray: 5, 5
    class HITL optional
```

Цикл Агента — это его основной способ работать самостоятельно, шаг за шагом. Это работает как компьютерная игра:

1.  **Сбор Информации:** Прежде чем начать, ты смотришь на карту, проверяешь свой инвентарь и читаешь описание квеста. Точно так же и ИИ сначала собирает всю нужную информацию: твою цель, что он уже знает (`Состояние`) и другие подсказки.

2.  **Выбор Действия:** Теперь ты решаешь, что делать дальше. «Наверное, стоит поговорить с торговцем». Это и есть `Запрос`. ИИ смотрит на всю информацию и на свои доступные `Инструменты` и решает, какой следующий шаг будет самым правильным.

3.  **Получение Плана:** Твой `Запрос` приводит к `решению` — конкретному плану действий. Например, план может состоять из одного действия (`Вызов`): «подойти к торговцу и заговорить».

4.  **Выполнение и Обучение:**
    - Если в плане есть действия (`Вызовы`), ИИ их выполняет. Например, «запускает» нужный инструмент.
    - Результат этого действия (например, торговец дал тебе ключ) добавляется в «память» ИИ. Эта новая информация поможет ему на следующем шаге.

5.  **Завершение:** Если в какой-то момент ИИ решает, что больше никаких действий не требуется, это значит, что цель достигнута. Квест выполнен, и цикл завершается.

## Человек-в-деле (Ваше участие)

Самое классное в этом цикле — ты можешь в любой момент вмешаться и помочь. ИИ сначала думает, *что сделать*, а потом *делает это*. Между этими двумя моментами есть небольшая пауза, в которую можешь включиться ты.

- **Одобрение:** Представь, что ИИ — твой помощник, и он говорит: «Я собираюсь заказать 100 пицц». Ты можешь посмотреть на его план и сказать: «Да, хорошая идея, действуй!».

- **Исправление:** Или ты можешь сказать: «Нет, не 100, а только 2». Ты можешь изменить детали плана или дать совершенно новую команду.

Это очень важно для безопасности, чтобы ИИ не наделал глупостей. Так он становится не просто инструментом, а настоящим партнёром. Когда ты его исправляешь, ИИ учится на твоих подсказках и в будущем строит **[012: Агент/План](./012_agent_plan.md)** умнее.