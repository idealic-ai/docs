# 004: Агент/Вызов

> **Вызов:** Представь, что у тебя есть дрель (`Инструмент`). «Вызов» — это когда ты берёшь эту дрель, вставляешь в неё конкретное сверло и нажимаешь кнопку, чтобы просверлить дырку в определённом месте. Это уже не просто возможность что-то сделать, а конкретное действие, которое нужно выполнить прямо сейчас.
> 
> — [Глоссарий](./000_glossary.md)

> Sidenote:
> 
> - Требует:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
> - Позволяет:
>   - [008: Агент/Импорты](./008_agent_imports.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - [202: Идея/Контейнер](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)

Вспомним, что такое «[Идея](./101_concept_idea.md)» — это как рецепт или план. А «[Инструмент](./002_agent_tool.md)» — это когда мы превращаем этот рецепт в понятную для компьютера инструкцию, где перечислены нужные «ингредиенты» (параметры).

Этот документ расскажет о **Вызове**. «Вызов» — это следующий шаг. Это когда мы берём инструкцию (`Инструмент`) и заполняем все поля конкретными значениями. Например, если инструкция говорит «выбери цвет», то вызов — это «выбери *красный* цвет».

Проще говоря:
*   **Инструмент** говорит, *что можно сделать* (например, «умею рисовать круг»).
*   **Вызов** говорит, *что именно нужно сделать прямо сейчас* (например, «нарисуй круг радиусом 5 сантиметров в центре экрана»).

## Процесс от Идеи к Вызову

Представь, что мы строим что-то из LEGO.

1.  **Идея**: Это чертёж или просто мысль в голове о том, какую машинку мы хотим собрать.
2.  **Инструмент**: Это инструкция по сборке, которую может понять робот. В ней написано: «нужен красный кубик 2x4» и «нужен синий кубик 2x2». Но пока не сказано, куда их ставить. Это просто список возможностей.
3.  **Вызов**: Робот (наш искусственный интеллект) берёт инструкцию и решает: «Взять красный кубик 2x4 и поставить его в точку А». Это уже конкретная команда, готовая к исполнению.

Главная мысль: **Любую Идею можно превратить в Инструмент, который затем исполняется как Вызов.**

(О том, как именно список «ингредиентов» Идеи превращается в параметры для Инструмента, можно почитать тут: **[007: Агент/Ввод](./007_agent_input.md)**).

## Элементы управления исполнением: Область и Метод

Когда мы даём команду (делаем `Вызов`), нам нужно решить две важные вещи: *где* её выполнять и *как* её выполнять. Для этого есть два «переключателя»: Область и Метод.

### Две оси исполнения

Представь, что ты шеф-повар на кухне, а твой `Вызов` — это команда «приготовить торт».

1.  **Область (Где готовить?)**
    Определяет, будешь ли ты готовить сам или поручишь это кому-то другому.
    - **Встроенная область (здесь, на моей кухне):** Ты готовишь торт сам, прямо на своём рабочем месте. Это режим по умолчанию.
    - **Модульная область (в специальном цеху):** Ты понимаешь, что торт сложный, и отправляешь заказ в кондитерский цех, который специализируется на тортах. Ты не делаешь это сам, а поручаешь специалисту.

2.  **Метод (Как готовить?)**
    Определяет, будешь ли ты следовать строгому рецепту или проявишь творчество.
    - **Явный метод (по строгому рецепту):** У тебя есть точная пошаговая инструкция: «200 грамм муки, взбивать 5 минут, печь при 180 градусах». Результат всегда будет одинаковый. Это как запустить программу с чётким кодом.
    - **Скрытый метод (творчески):** Тебе говорят: «Сделай красивый и вкусный торт». У тебя нет точного рецепта, и ты используешь свой опыт и фантазию (как это делает нейросеть), чтобы создать что-то классное. Результат каждый раз может быть немного разным.

Эти «переключатели» можно сочетать. Например, можно приготовить торт творчески, но на своей кухне. Или отправить в кондитерский цех заказ на приготовление торта по строгому рецепту. Подробнее о том, как это всё комбинируется, рассказано в документе **[008: Агент/Импорты](./008_agent_imports.md)**.

## Реализация сложных рабочих процессов

Один `Вызов` — это как один кирпичик LEGO. Сам по себе он прост, но из множества таких кирпичиков можно построить огромный замок.

Точно так же `Вызовы` — это строительные блоки для создания больших и сложных планов действий. Например, такие штуки как **[Идея/Контейнер](./202_idea_vessel.md)** и **[Идея/Процесс](./203_idea_process.md)** — это целые «наборы инструкций», которые состоят из множества `Вызовов`. «Контейнер» можно представить как коробку, в которую ты кладёшь весь свой запрос (что нужно сделать, какие инструменты можно использовать), а в ответ получаешь готовое решение — список `Вызовов`, которые нужно выполнить.

> Sidenote:
> 
> - [202: Идея/Контейнер](./202_idea_vessel.md)
> - [203: Идея/Процесс](./203_idea_process.md)

## Паттерны исполнения Вызовов

А что если искусственный интеллект решил, что нужно сделать не одно, а сразу несколько дел? Например, одновременно нарисовать картинку, написать текст и найти что-то в интернете. У нас есть несколько способов, как с этим справиться.

Представь, что у тебя есть команда роботов-помощников.

```typescript
// Исполнение одного Вызова
const result = await Tool(call);

// Исполнить все Вызовы, дождаться всех результатов
const results = await Tool.all(calls);

// Исполнить все Вызовы, вернуть первый успешный результат
const result = await Tool.any(calls);

// Исполнить все Вызовы, вернуть первый завершённый (успешно или нет)
const result = await Tool.race(calls);
```

Эти команды похожи на приказы для твоих роботов:

- **Точное управление (`Tool(call)`):** «Робот, сделай это». Просто даёшь одну команду одному роботу.
- **Ждать всех (`.all()`):** Ты говоришь команде: «Вот вам три задания. Я буду ждать, пока вы не закончите *все три*». Ты получишь результат, только когда все дела будут сделаны.
- **Кто первый справится (`.any()`):** Ты даёшь три разных задания и говоришь: «Кто из вас *первым успешно* закончит своё дело, пусть сразу же докладывает. Остальные могут останавливаться». Это полезно, когда тебе нужен любой результат как можно скорее.
- **Кто просто самый быстрый (`.race()`):** Ты говоришь: «На старт, внимание, марш! Мне неважно, получится у вас или нет, просто скажите, кто из вас *первым закончил* — неважно, с каким результатом». Это как гонка, где важна только скорость финиша.