# 002: Агент/Инструмент

> **Инструмент**: Представь себе, что агент — это персонаж в компьютерной игре, а Инструменты — это его особые умения или заклинания. Каждый инструмент — это как карточка с описанием: что умение делает, что ему нужно для использования (например, цель) и какой будет результат. Агент (умная программа) смотрит на все эти карточки и решает, какое умение применить в данный момент. Когда он решает и нажимает «кнопку», он создаёт **Вызов (Call)** — конкретную команду, которую нужно выполнить. Эта команда может быть выполнена либо самим «мозгом» агента, либо специальным кодом, который называется **Действие (Activity)**. — [Глоссарий](./000_glossary.md)

> Sidenote: Требуется: [001: Агент/Запрос](./001_agent_request.md)
> - Дополняется: [003: Агент/Действие](./003_agent_activity.md)

В этом документе мы разберёмся, что такое Инструменты — это своего рода «инструкции», которые помогают агентам понимать, какие у них есть суперспособности и как ими пользоваться.

## Что такое Инструменты?

**Инструменты — это самое главное** в том, как агенты действуют. Они дают агентам очень важную способность: **выбирать, что делать дальше**. Вместо того чтобы просто следовать заранее написанному сценарию, агент может посмотреть на ситуацию и сам решить, какое из своих «умений» (инструментов) лучше всего использовать прямо сейчас.

Вот что делают Инструменты:

- **Дают понятные «инструкции»**: У каждого инструмента есть чёткое описание, как у умения в игре, чтобы агент точно знал, что оно делает.
- **Гарантируют порядок**: В инструкциях чётко сказано, какие данные нужны на входе (например, текст для перевода) и что получится на выходе (переведённый текст). Никакой путаницы!
- **Работают как кубики LEGO**: Инструменты можно соединять вместе, чтобы агент мог выполнять сложные задачи, состоящие из нескольких простых шагов.
- **Понятны искусственному интеллекту**: Эти инструкции написаны на таком языке (в виде схем), который большие языковые модели (LLM) легко читают и понимают, чтобы сделать правильный выбор.

Когда агент выбрал инструмент и указал всё, что для него нужно (например, для инструмента «отправить_сообщение» он указал, кому и что писать), он создаёт **Вызов (Call)**. Это уже не просто описание умения, а конкретная команда: «Отправить сообщение Пете с текстом 'Привет!'». Этот **Вызов** готов к исполнению. (О том, как он исполняется, мы поговорим в документе [004: Агент/Вызов](./004_agent_call.md)).

> **Кстати**: Можно просто попросить умную программу (LLM) что-то сделать, и это будет похоже на «Идею». Это хорошо работает для простых задач вроде «напиши стих». Но Инструменты нужны для более крутых вещей, когда программе нужно самой выбирать из нескольких разных действий. О том, как превратить простую «Идею» в полноценный «Инструмент», можно почитать в [007: Агент/Ввод](./007_agent_input.md).

## Когда нужны Инструменты?

Инструменты полезны, когда твоему агенту нужно:

- **Думать на ходу**: Самому решать, что делать, в зависимости от того, что происходит вокруг.
- **Иметь выбор**: Когда есть несколько способов достичь цели (например, найти информацию можно в Google, а можно в Википедии), агент должен выбрать лучший.
- **Использовать разные версии одного умения**: Например, умение «найти картинку» может использовать разные поисковики.
- **Совмещать «чутьё» и точный расчёт**: То есть использовать и творческое мышление умной программы (LLM), и строгие, заранее написанные правила.

## Как устроена система Инструментов

### Главное правило: Инструкция — это не само действие

Система Инструментов работает по простому правилу: **Инструмент — это только описание, как инструкция к LEGO**. В ней нарисовано, что можно собрать, но самих кубиков там нет.
Точно так же Инструмент лишь описывает, *что можно сделать*, но не говорит, *как именно*. Само действие выполняет либо «мозг» агента (LLM), либо специальный кусочек кода, который называется **[003: Агент/Действие](./003_agent_activity.md)**.

В «инструкции» (схеме) Инструмента всегда указано:

- **Что он делает** (например, «переводит текст»)
- **Что ему для этого нужно** (например, сам текст и язык, на который переводить)
> Sidenote: Расширения:
>

- `_instance`: Об этом есть отдельный документ [011: Агент/Инстансинг](./011_agent_instancing.md)
- `_module`: И об этом тоже [009: Агент/Модуль](./009_agent_module.md)
- **Что получится в результате** (поле `_output`)
- **Как он называется** (уникальное имя, например, `_tool: 'translator'`)
- **Кто будет его выполнять** (поле `_activity`, которое указывает на специальный код, если он нужен. Подробнее в [003: Агент/Действие](./003_agent_activity.md))

### «Служебные» поля в инструкции

В инструкциях для инструментов есть специальные поля, которые начинаются с подчёркивания (`_`). Это как служебные пометки для самой системы, а не для агента.

- **\_tool**: Уникальное имя инструмента (обязательно).
- **\_activity**: Указывает, какой именно код (`Activity`) нужно запустить, чтобы выполнить действие.
- **\_output**: Описывает, как будет выглядеть результат.
- **\_reasoningForCall**: Сюда система записывает объяснение от агента, почему он решил использовать именно этот инструмент.

А все поля *без* подчёркивания — это обычные параметры, которые нужны для работы инструмента (например, `text: 'Привет, мир!'`). Служебные поля всегда пишутся первыми, чтобы умной программе (LLM) было проще их читать.

### За что отвечает система?

Сама система Инструментов — это как менеджер, который:

- **Собирает и хранит все «инструкции»** (инструменты).
- **Помогает агенту заполнить все поля** в инструкции, используя информацию из текущего разговора.
- **Решает, кто будет выполнять команду**: сам «мозг» агента или специальный код (`Activity`).

А уже более сложные вещи, например, выполнение цепочки из нескольких команд или запоминание результатов, делаются поверх этой системы (об этом в документе [004: Агент/Вызов](./004_agent_call.md)).

## Как создать Инструмент?

Инструменты описываются с помощью специальных «инструкций» в формате JSON-схемы. Вот пример инструмента, который определяет настроение (тональность) текста. Ему не нужен специальный код, потому что умная программа (LLM) и так хорошо понимает язык и может сделать это сама.

```typescript
// Регистрируем новый инструмент под названием 'sentimentAnalysis'
Tool.register('sentimentAnalysis', {
  // Тип данных: это объект с полями
  type: 'object',
  // Описание, чтобы агент понял, что делает инструмент
  description: 'Анализирует тональность текста',
  // Список полей (параметров)
  properties: {
    // Служебное поле с именем инструмента
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    // Параметр, который нужен на входе: текст для анализа
    text: { type: 'string', description: 'Текст для анализа' },
    // Служебное поле, описывающее результат
    _output: {
      type: 'object',
      properties: {
        // Результат будет содержать тональность (например, "позитивная")
        sentiment: { type: 'string' },
        // И уверенность в оценке (число)
        confidence: { type: 'number' },
      },
    },
  },
});
```

## «Книга заклинаний» и команда к действию

Каждый отдельный инструмент — это как одно заклинание. Но настоящая магия начинается, когда у тебя есть целая «книга заклинаний»! Система показывает агенту сразу все доступные ему инструменты. Агент изучает их все и выбирает тот, который лучше всего подходит для текущей задачи.
Когда агент выбрал инструмент и указал все детали (например, «использовать файербол на вот том гоблине»), он создаёт **Вызов (Call)**. Это уже не просто описание, а готовая к исполнению команда. **Вызов** — это и есть та самая единица действия, которая отправляется на выполнение.

> Sidenote: - [004: Агент/Вызов](./004_agent_call.md).
>

## Выполнение: в уме или по-настоящему?

Инструкция к инструменту — это только описание. А вот выполнить команду (**Вызов**) можно двумя способами.

1.  **Скрытое выполнение (в уме)**: Это когда агент выполняет задачу сам, используя свой «мозг» (LLM). Это отлично подходит для задач, связанных с текстом, знаниями или логикой. Например, определить настроение текста.
2.  **Явное выполнение (по-настоящему)**: Это когда нужно сделать что-то во внешнем мире — например, отправить емейл, найти картинку в интернете или проверить погоду. Для этого инструмент связывают со специальным кодом, который умеет это делать. Такой код называется **Действие (Activity)**.

Разделять «инструкцию» (Инструмент) и «исполнителя» (Действие) — очень умная идея. Благодаря этому можно описать все способности агента, а потом менять способ их выполнения. Например, можно поменять поисковик для поиска картинок, не переписывая сам инструмент «найти_картинку». В следующем документе, **[003: Агент/Действие](./003_agent_activity.md)**, мы как раз и поговорим о том, как эти **Действия** работают.

> Sidenote: - [003: Агент/Действие](./003_agent_activity.md).