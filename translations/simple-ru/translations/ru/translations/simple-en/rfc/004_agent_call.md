# 004: Агент/Команда

> **Команда:** Представь, что **Инструмент** — это кнопка в приложении, например, «Отправить фото». А **Команда** — это когда ты нажимаешь на эту кнопку и выбираешь конкретную фотографию, чтобы отправить её другу. Это действие, которое происходит *прямо сейчас*.
>
> — [Словарик](./000_glossary.md)

> Sidenote:
>
> - Нужно для этого:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
> - Открывает возможности для:
>   - [008: Агент/Импорты](./008_agent_imports.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - [202: Идея/Контейнер](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)

**[Идея](./101_concept_idea.md)** — это как рецепт блюда. **[Инструмент](./002_agent_tool.md)** — это когда ты добавляешь по этому рецепту новую кнопку на свою умную кухонную плиту. А этот документ — про **Команду** (или «Вызов»): что происходит, когда ты нажимаешь на эту кнопку.

**Команда** — это приказ для Инструмента, где все детали уже заполнены и всё готово к действию. Если Инструмент — это описание того, *что можно сделать*, то Команда — это когда ты *это делаешь на самом деле*.

## Путь от рецепта до готового блюда

Давай представим, что ты печёшь торт. Вот как всё устроено:

1.  **Идея**: У тебя есть секретный семейный рецепт торта. В нём записано всё-всё: какие нужны продукты, как их смешивать, сколько печь. Это и есть **Идея**.
2.  **Инструмент**: Ты программируешь свою умную духовку по этому рецепту. У неё появляется новая кнопка: «Испечь торт». Теперь духовка знает, какие продукты ей нужны и что делать. Эта кнопка — **Инструмент**.
3.  **Команда**: А теперь самое интересное! Ты нажимаешь кнопку и говоришь: «Испеки торт, используя вот *этот* шоколад, пеки ровно *30 минут* и при температуре *180 градусов*». Ты дал конкретную команду со всеми деталями. Это и есть **Команда**.

Главное правило простое: **Любую Идею можно превратить в Инструмент, а любой Инструмент можно использовать, чтобы дать Команду.**

Чтобы понять, как «список продуктов» для торта превращается в настройки для кнопки, загляни в документ **[007: Агент/Ввод](./007_agent_input.md)**.

## «Ручки управления»: Где и Как

Когда ты даёшь Команду, ты можешь настроить, как она будет выполняться. Для этого есть две «ручки управления»: **Где** (место выполнения) и **Как** (способ выполнения). Система понимает, как ты повернул эти ручки, по специальным кодовым словам в настройках Инструмента (`_module`, `_activity`, `_output`).

### Две главные настройки

1.  **Где? (Сделать самому или попросить другого?)**
    Эта настройка решает, кто выполнит задачу: сам агент или кто-то другой.
    - **Здесь (Сделать самому)**: Это обычный способ. Агент выполняет задачу сам, на своём месте. Как будто шеф-повар сам нарезает овощи.
    - **У специалиста (Попросить другого)**: Включается кодовым словом `_module`. Это как если бы шеф-повар крикнул пекарю в другой цех: «Эй, испеки хлеб!». Задача уходит к другому специалисту.

2.  **Как? (Строго по рецепту или с фантазией?)**
    Эта настройка решает, нужно ли следовать точным шагам или можно проявить творчество.
    - **По рецепту (Точно по шагам)**: Включается кодовым словом `_activity`. Задачу нужно выполнить по чёткому плану, как робот. Никаких догадок и фантазии.
    - **С фантазией (Творчески)**: Это обычный способ, если нет `_activity`. Агент (то есть искусственный интеллект) сам придумывает, как лучше выполнить задачу. Ему можно дать подсказку через `_output`, и это будет звучать так: «Мне неважно, как ты это сделаешь, просто приготовь вкусный суп».

Эти настройки можно смешивать, чтобы выполнять работу самыми разными способами. Если интересно, как это работает, читай документ **[008: Агент/Импорты](./008_agent_imports.md)**.

## Строим большие системы из маленьких Команд

`Команда` — это как один кубик Lego. Сам по себе он простой. Но из множества кубиков можно построить что-то огромное и крутое, например, замок или космический корабль. В нашем мире такие сложные постройки из Команд называются **[Контейнер](./202_idea_vessel.md)** или **[Процесс](./203_idea_process.md)**.

`Контейнер` — это как коробка с набором Lego. В ней есть всё для сборки одной большой модели: инструкция (`context`), список всех нужных кубиков (`schema` из Инструментов) и картинка того, что нужно собрать (`solution` — список Команд, которые нужно выполнить).

> Sidenote:
>
> - [202: Идея/Контейнер](./202_idea_vessel.md)
> - [203: Идея/Процесс](./203_idea_process.md)

## Разные способы запускать Команды

Если агенту нужно выполнить сразу несколько Команд, можно выбрать, как именно он это сделает.

```typescript
// Выполнить только одну Команду
const result = await Tool(call);

// Выполнить все. Ждать, пока каждая не закончится.
const results = await Tool.all(calls);

// Попробовать все. Вернуть ответ от первой, которая сработает.
const result = await Tool.any(calls);

// Устроить гонку! Запустить все и вернуть ответ от самой быстрой, неважно, успешный или нет.
const result = await Tool.race(calls);
```

Это позволяет тебе:

- **Действовать пошагово**: Выполнять каждую Команду по очереди.
- **Делать всё сразу**: Запускать кучу дел одновременно, чтобы было быстрее.
- **Найти хоть одно решение**: Пробовать разные варианты, пока не найдётся один рабочий (`.any()`).
- **Добиться успеха вместе**: Убедиться, что вся группа задач успешно выполнена (`.all()`).
- **Выбрать самого быстрого**: Устроить гонку и взять результат от того, кто справился первым (`.race()`).