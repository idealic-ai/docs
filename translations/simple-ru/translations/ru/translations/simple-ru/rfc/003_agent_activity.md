# Акт 003: Агент/Действие

> **Действие (Activity):** Это настоящий, работающий код, который делает то, что обещает «Инструмент». Представь, что это как рецепт для повара на кухне. Действия нужны, когда нужно что-то сделать в реальном мире, например, проверить погоду в интернете, заглянуть в какую-то базу данных или выполнить любую задачу, которую искусственный интеллект не может просто «вообразить». — [Глоссарий](./000_glossary.md)

> Sidenote: Требуется: [002: Агент/Инструмент](./002_agent_tool.md)
>

Этот документ рассказывает о **правилах для Действий**. Он объясняет, как «Инструменты» (о которых мы говорили раньше) соединяются с настоящим кодом, который что-то делает. Если «Инструмент» — это описание того, *что* можно сделать, то «Действие» — это сама программа, которая это *делает*.

## Архитектура из двух списков

Представь, что у умной системы есть две разные записные книжки, чтобы не путать описание возможности с её реальным выполнением:

*   **Список Инструментов**: Здесь хранятся только описания — что умеет делать тот или иной `Инструмент`.
*   **Список Действий**: А здесь хранится настоящий код (`Действия`), который выполняет эту работу.

Это похоже на меню в ресторане и саму кухню. Меню (`Список Инструментов`) просто говорит, что есть блюдо «чизбургер». А на кухне (`Список Действий`) есть настоящий рецепт и повар, который знает, как его приготовить. Такое разделение — ключ к гибкости. Оно позволяет Инструментам работать в «воображаемом» режиме (когда ИИ сам придумывает результат), а также позволяет легко менять «рецепт» на кухне, не меняя название блюда в меню.

## Запись Действия в систему

Чтобы система знала, какой код какому Инструменту соответствует, мы «регистрируем» Действие под специальным именем, которое связывает его с Инструментом.

```typescript
// Записываем в систему настоящее Действие.
// Имя 'weatherCheck' должно быть таким же, как у Инструмента, который оно выполняет.
Activity.register('weatherCheck', async call => {
  const data = await weatherAPI.get(call.location);
  return { temperature: data.temp, conditions: data.desc };
});
```

## Два способа работы: Скрытый и Явный

Система может выполнить просьбу к `Инструменту` двумя совершенно разными способами:

*   **Скрытое исполнение**: Здесь ИИ использует свою способность рассуждать. Он как бы «продумывает» задачу и сам придумывает ответ. Это как спросить очень умного друга, какая погода в Париже. Он не полезет в интернет, а прикинет в уме, основываясь на своих знаниях, и даст тебе ответ. Этот способ включается по умолчанию, если для `Инструмента` не найден соответствующий код `Действия`.
> Sidenote: [104: Концепция/Скрытое](./104_concept_latent.md)
*   **Явное исполнение**: А здесь запрос передаётся настоящему коду. Вызывается наша программа-«Действие», которая и получает точный результат. Это как если бы твой друг достал телефон, открыл приложение погоды и сказал тебе точный прогноз. Этот способ нужен для работы с реальным миром (сайтами, файлами) или для задач, где нужна стопроцентная точность.

## Как система выбирает способ

Самое классное, что система сама решает, какой способ использовать. Поле `_activity` в описании `Инструмента` — это как бы намёк, что для него существует настоящий код. Вот как система принимает решение:

1.  **Прямое указание в `_activity`**: Если в описании `Инструмента` прямо написано имя Действия, система будет искать именно его.
2.  **Договорённость об именах (лучший способ)**: Если поле `_activity` пустое, система ищет «Действие», у которого **имя точно такое же**, как у `Инструмента`. Если находит — отлично, они связаны.
3.  **Запасной вариант (Скрытый режим)**: Если по первым двум правилам ничего не нашлось, система решает: «Окей, настоящего кода для этого нет, попрошу-ка я ИИ просто придумать результат».

Такой подход всё очень упрощает:

*   **Чтобы всё заработало, просто назови своё «Действие» так же, как и «Инструмент».**
*   `Инструменты`, для которых ты ещё не написал код, всё равно будут работать в безопасном «воображаемом» режиме.
*   Если нужно, можно явно указать в `_activity` другое имя. Так один и тот же код (`Действие`) сможет выполнять работу для нескольких разных `Инструментов`.

## Почему так важно разделять Действия

Представь, что было бы, если бы описание `Инструмента` и код `Действия` были склеены намертво. Чтобы поменять способ выполнения (например, вместо «воображаемого» режима начать использовать реальный сайт с погодой), нам пришлось бы найти и переписать каждую программу, которая использует этот `Инструмент`.

Архитектура с двумя списками решает эту проблему. Описание `Инструмента` (меню) остаётся прежним, а его реализация (рецепт на кухне) может меняться. Программы всегда видят одно и то же «меню» и даже не знают, как именно готовится блюдо. Это значит, что:

*   **Изменения в коде не ломают программы**: Можно переключиться с «воображаемого» режима на реальный, не трогая основной код.
*   **Можно пробовать разное**: Сравнить, что работает лучше — когда ИИ придумывает ответ или когда используется настоящий сервис.
*   **Можно обновляться постепенно**: Запустить новый код `Действия` только для части пользователей, пока остальные используют старый или «воображаемый» вариант.

## От описания к действию

Разделяя «что делать» (`Инструмент`) и «как делать» (`Действие`), мы получаем очень гибкую и умную систему. Но это еще не всё. Теперь, когда у нас есть «меню» и «кухня», нужен кто-то, кто будет принимать заказы и следить, чтобы всё работало как надо.

Следующий документ, [004: Агент/Вызов](./004_agent_call.md), расскажет о правилах, которые управляют этим процессом, превращая простые описания в настоящие полезные действия.