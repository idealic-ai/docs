# 003: Агент/Действие

> **Действие (Activity):** Это настоящий, рабочий код, который выполняет то, что обещает «Инструмент». Представь, что это как рецепт для повара. Действия нужны, когда тебе нужно сделать что-то во внешнем мире — например, проверить погоду в интернете, найти что-то в базе данных или выполнить любую задачу, которую искусственный интеллект не может просто «выдумать». — [Глоссарий](./000_glossary.md)

> Sidenote: - Требуется: [002: Агент/Инструмент](./002_agent_tool.md)
>

Этот документ рассказывает о **Протоколе Действий**. Он объясняет, как «Инструменты» (о которых мы говорили раньше) подкрепляются настоящим, исполняемым кодом. Если «Инструмент» — это описание того, *что* можно сделать, то «Действие» — это инструкция, *как* это сделать.

## Архитектура с двумя списками

Система агентов использует два разных списка (или реестра), чтобы отделить описание возможности от её реального воплощения:

- **Реестр Инструментов**: Хранит описание того, как выглядят `Инструменты` и что они обещают сделать.
- **Реестр Действий**: Хранит настоящий код (`Действия`), который выполняет работу для `Инструментов`.

Представь себе меню в ресторане и его кухню. Меню (`Реестр Инструментов`) просто говорит, что есть такое блюдо, как «чизбургер». Но на кухне (`Реестр Действий`) есть настоящий рецепт и повар, который знает, как его приготовить. Это разделение — ключ к гибкости системы. Оно позволяет `Инструментам` работать в режиме «воображения» (когда ИИ просто выдумывает результат), а также позволяет легко менять рецепт на кухне, не меняя название блюда в меню.

## Регистрация Действия

«Действие» регистрируется под уникальным именем, которое связывает его с «Инструментом».

```typescript
// Регистрируем код Действия.
// Имя 'weatherCheck' должно совпадать с Инструментом, для которого оно предназначено.
Activity.register('weatherCheck', async call => {
  const data = await weatherAPI.get(call.location);
  return { temperature: data.temp, conditions: data.desc };
});
```

## Режимы выполнения: Скрытый и Явный

Система может обработать запрос к `Инструменту` двумя совершенно разными способами:

- **Скрытое исполнение**: Здесь используется способность ИИ рассуждать. Агент как бы «продумывает» задачу и сам генерирует ответ. Это как спросить очень умного друга, какая погода в Париже, и он просто скажет тебе, основываясь на своих общих знаниях, даже не заглядывая в интернет. Этот режим используется по умолчанию, если система не может найти подходящее `Действие` для `Инструмента`.
  > Sidenote: - [104: Концепция/Скрытое](./104_concept_latent.md)
- **Явное исполнение**: Это когда запрос передаётся реальному коду. Вызывается функция «Действия», и она вычисляет результат. Это как если бы твой друг достал телефон, открыл приложение погоды и сказал тебе точный прогноз. Этот режим необходим для взаимодействия с реальным миром (например, с веб-сайтами или базами данных) или для задач, которые должны быть на 100% точными.

## Как система выбирает режим

Система решает, какой режим использовать, сама по себе, без всяких сложных настроек. Поле `_activity` в черновике `Инструмента` — это сигнал, что для него есть реальный код. Вот как система принимает решение:

1.  **Прямая ссылка `_activity`**: Если в описании `Инструмента` в поле `_activity` явно указано имя действия, система ищет `Действие` с таким именем в своём списке.
2.  **Совпадение по имени (Рекомендуемый способ)**: Если поле `_activity` пусто, система ищет `Действие`, у которого **точно такое же имя**, как у `Инструмента`. Если находит — отлично, они связаны.
3.  **Запасной вариант (Скрытый режим)**: Если по первым двум правилам ничего не найдено, система решает, что для этого `Инструмента` нет реального кода, и просит ИИ «вообразить» результат.

Такой подход значительно упрощает разработку:

- **Для простой настройки просто назови своё `Действие` так же, как и `Инструмент`**
- `Инструменты`, для которых ты ещё не написал код, будут безопасно работать в режиме «воображения».
- При необходимости ты можешь использовать поле `_activity`, чтобы указать другое имя, позволяя одному и тому же коду (`Действие`) выполнять работу для нескольких разных `Инструментов`.

## Почему так важно разделять Действия

Если бы мы не разделяли описание `Инструмента` и код `Действия`, они были бы навсегда склеены. Чтобы изменить способ выполнения задачи (например, переключиться с «воображаемой» погоды от ИИ на использование реального погодного сайта), нам пришлось бы найти и переписать каждого агента, использующего этот `Инструмент`.

Архитектура с двумя списками решает эту проблему. Описание `Инструмента` (меню) остаётся прежним, а его реализация (рецепт на кухне) может меняться. Агенты всегда видят одно и то же «меню» и им не нужно знать, как на самом деле готовится блюдо. Это означает:

- **Изменение кода не ломает агентов**: Ты можешь переключиться со «скрытого» режима на «явный», не трогая код агента.
- **Можно тестировать разные подходы**: Ты можешь сравнить, что работает лучше — когда ИИ придумывает ответ или когда его предоставляет реальный сервис.
- **Плавные обновления**: Ты можешь выкатывать новый код `Действия` только для некоторых своих агентов, в то время как остальные будут использовать старую версию или «воображаемую».

## От описания к действию

Разделяя «что» (`Инструмент`) и «как» (`Действие`), система становится невероятно гибкой. Но это только часть истории. Теперь, когда у нас есть описания и их реальный код, последний элемент — это управление всем этим: как вызовы к инструментам организуются, выполняются и связываются в цепочки.

Следующий документ, [004: Агент/Вызов](./004_agent_call.md), расскажет о протоколе, который управляет этим процессом, превращая абстрактные описания в конкретные действия.