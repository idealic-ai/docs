# 004: Агент/Вызов

> **Вызов:** Это как взять «Инструмент» и дать ему конкретное задание с точными деталями для его `параметров`. Это команда, которая говорит, *что именно делать* прямо сейчас.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требует:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
> - Открывает:
>   - [008: Агент/Импорты](./008_agent_imports.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - [202: Идея/Сосуд](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)

В документе [101: Концепция/Идея](./101_concept_idea.md) было рассказано, что «Идея» — это мощный способ хранить знания и скрытые инструкции. А в [002: Агент/Инструмент](./002_agent_tool.md) объяснялось, как агент понимает, что он умеет делать, используя специальные «чертежи» для инструкций. Этот документ описывает протокол **004: Агент/Вызов**, который основан на Инструментах и объясняет, как на самом деле выполняется работа с помощью настроек «Область действия» и «Метод».

**Вызов** — это, по сути, Инструмент, которому дали конкретные детали и сказали: «Иди и сделай своё дело!». Если Инструменты определяют, *что можно сделать*, то Вызовы определяют, *как именно это будет сделано*.

## Путь от Идеи к Вызову

Представь, что ты хочешь что-нибудь съесть.

1.  **Идея**: Общая мысль или знание. Например, «Сделать бутерброд».
2.  **Инструмент**: «Идея» превращается в конкретный «рецепт», который понимает компьютер. В этом рецепте говорится, какие «ингредиенты» (`параметры`) нужны. Например, для бутерброда нужны `хлеб`, `мясо` и `сыр`. (Подробнее о том, как это работает, можно прочитать в [002: Агент/Инструмент](./002_agent_tool.md)).
3.  **Вызов**: Это момент, когда ИИ решает использовать «Инструмент». Он берёт рецепт и заполняет его конкретными ингредиентами: `два ломтика белого хлеба`, `три ломтика ветчины` и `один ломтик сыра чеддер`. **Вызов** — это одно конкретное использование Инструмента со всеми заполненными деталями.

Главное правило: **Любую Идею можно превратить в Инструмент, который затем можно использовать через Вызов.**

Чтобы узнать больше о том, как «Идея» становится «Инструментом», загляни в **[007: Агент/Ввод](./007_agent_input.md)**.

## Управление выполнением: Область действия и Метод

Как будет выполнен `Вызов`, определяют две отдельные настройки: **Область действия** (где он работает) и **Метод** (как он работает). Чтобы их задать, используются специальные свойства (`_module`, `_activity`, `_output`) в описании инструмента.

### Две оси действия

1.  **Область действия (Здесь или Где-то ещё)**
    Область действия решает, будет ли работа выполнена прямо здесь, внутри текущего агента, или её передадут кому-то или чему-то другому.
    - **Здесь (Внутреннее исполнение)**: Это обычный способ. `Вызов` обрабатывается немедленно, на месте.
    - **Где-то ещё (Модульное исполнение)**: Это включается с помощью `_module`. `Вызов` отправляется другому модулю — внешнему `Действию` или `Идее` — для выполнения.

2.  **Метод (По инструкции или Творчески)**
    Метод решает, как создаётся результат: следуя точному коду или позволяя ИИ разобраться самому.
    - **По инструкции (Явный метод)**: Включается, если есть свойство `_activity`. Результат `Вызова` создаётся с помощью точного, заранее написанного кода.
    - **Творчески (Скрытый метод)**: Это способ по умолчанию, если нет `_activity`. ИИ сам придумывает результат. Для этого требуется свойство `_output`, чтобы описать, каким должен быть результат.

Ты можешь смешивать и сочетать эти настройки, чтобы создавать разные способы выполнения задач. Ты можешь контролировать, к каким знаниям у них есть доступ, используя импорты. Подробнее об этом читай в **[008: Агент/Импорты](./008_agent_imports.md)**.

## Построение сложных планов

`Вызов` — это как один кубик, из которого можно строить более крупные и организованные действия. В протоколе COILS Вызов запускает продвинутые «Идеи», такие как **[202: Идея/Сосуд](./202_idea_vessel.md)** и **[203: Идея/Процесс](./203_idea_process.md)**. `Сосуд`, например, — это один момент принятия решения. Он содержит полный запрос к агенту, включая всю необходимую информацию (`context`) и список доступных `Инструментов` (`schema`), а также ответ агента — `решение`, в котором может быть один или несколько готовых к выполнению `Вызовов`.

> Sidenote:
>
> - [202: Идея/Сосуд](./202_idea_vessel.md)
> - [203: Идея/Процесс](./203_idea_process.md)

## Способы запуска Вызовов

Когда агент создаёт несколько Вызовов, их можно запускать по-разному, в зависимости от того, что нужно. Представь, что у тебя есть список дел.

```typescript
// Сделать что-то одно
const result = await Tool(call);

// Сделать всё и дождаться завершения каждого дела
const results = await Tool.all(calls);

// Пробовать делать по одному, но остановиться, как только одно дело будет успешно выполнено
const result = await Tool.any(calls);

// Начать делать всё одновременно и посмотреть, что завершится первым (неважно, успешно или нет)
const result = await Tool.race(calls);
```

Эти разные способы позволяют:

- **Точно контролировать**: Обрабатывать Вызовы по одному, делая что-то ещё в промежутках.
- **Делать всё пачкой**: Запускать независимые Вызовы одновременно, чтобы было быстрее.
- **Находить быстрые решения**: Останавливаться после первого успеха (`.any()`) или самого первого результата (`.race()`)
- **Делать всё или ничего**: Убедиться, что каждый Вызов в группе будет успешным (`.all()`), что помогает избежать ошибок, когда одна задача зависит от другой.