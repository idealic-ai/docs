# 004: Агент/Вызов

> **Вызов:** Представь, что **Инструмент** — это кнопка в приложении, например, «Отправить письмо». А **Вызов** — это когда ты нажимаешь эту кнопку, уже указав, кому и что ты хочешь отправить. Это конкретная команда *сделать это прямо сейчас*.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Нужно знать о:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
> - Помогает реализовать:
>   - [008: Агент/Импорты](./008_agent_imports.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - [202: Идея/Сосуд](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)

Мы уже знаем об **[Идее](./101_concept_idea.md)** — это как полный рецепт чего-либо, и об **[Инструменте](./002_agent_tool.md)** — это когда рецепт превращается в кнопку, понятную для ИИ. Этот документ объясняет **Вызов** — то, что происходит, когда ИИ нажимает на эту кнопку, чтобы выполнить работу.

**Вызов** — это как взять рецепт (Инструмент) и добавить настоящие ингредиенты (конкретные детали). Если Инструмент говорит: «Я могу приготовить пиццу», то Вызов говорит: «Приготовь пиццу *прямо сейчас*, с пепперони и двойным сыром».

## От Идеи к Действию

Представь, что ты хочешь испечь торт. Вот как это работает:

1.  **Идея**: это твой полный рецепт торта. В нём есть ингредиенты, шаги и то, как должен выглядеть готовый торт.
2.  **Инструмент**: твоя умная духовка читает рецепт и создаёт программу «Испечь торт». Теперь она понимает, что значит печь торт, и знает, что для этого нужны мука, сахар и яйца.
3.  **Вызов**: ИИ решает, что пора печь. Он выбирает программу «Испечь торт» и заполняет детали: «Использовать шоколадную муку, 2 стакана сахара и 3 яйца». Эта конкретная команда испечь торт *прямо сейчас* и есть **Вызов**.

Главное правило простое: **Любую Идею можно превратить в Инструмент, который затем можно использовать в Вызове.**

Чтобы узнать, как именно список ингредиентов из рецепта превращается в поля для Инструмента, загляни в **[007: Агент/Ввод](./007_agent_input.md)**.

## Управление: Где и как выполнить задачу

Когда ты делаешь Вызов, ты можешь контролировать две главные вещи: **Область** (где он выполняется) и **Метод** (как он выполняется). Система понимает, чего ты хочешь, по специальным пометкам в инструкциях Инструмента (например, `_module` или `_activity`).

### Два рычага управления

1.  **Область (Где выполняется: на этой кухне или на другой?)**
    Это решает, будет ли задача выполнена прямо здесь или её отправят куда-то ещё.
    - **Встроенная область**: это обычный способ. Как будто ты печёшь торт на своей кухне. ИИ выполняет задачу там же, где находится.
    - **Модульная область**: это как отправить заказ в специальную пекарню. Пометка `_module` говорит ИИ передать задачу экспертной системе, чтобы она выполнила её отдельно.

2.  **Метод (Как выполняется: по рецепту или творчески?)**
    Это решает, будет ли задача выполнена по точным шагам или с помощью творческого интеллекта ИИ.
    - **Явный метод**: это как использовать робота, который идеально следует рецепту. Когда в инструкциях есть пометка `_activity`, это значит, что задача будет выполнена с помощью точного кода. Результат будет одинаковым каждый раз.
    - **Скрытый метод**: это как попросить творческого шеф-повара испечь тебе торт. Ты не даёшь ему точных шагов, а доверяешь его мастерству (мозгу ИИ), чтобы он сделал что-то потрясающее. Это происходит, когда пометки `_activity` нет.

Эти два элемента управления, «где» и «как», можно смешивать, чтобы создавать самые разные мощные действия. Чтобы увидеть, как это работает, загляни в **[008: Агент/Импорты](./008_agent_imports.md)**.

## Создание более крупных вещей

Вызов — это базовый строительный блок, как один кирпичик Lego. Собирая много Вызовов вместе, мы можем строить гораздо более крупные и интересные вещи.

Например, **[Сосуд](./202_idea_vessel.md)** — это более крупная идея, похожая на целый разговор с ИИ. Он содержит твой запрос, все инструменты, которые может использовать ИИ, и итоговый план ИИ, который обычно представляет собой список из одного или нескольких **Вызовов** для выполнения.

> Sidenote:
>
> - [202: Идея/Сосуд](./202_idea_vessel.md)
> - [203: Идея/Процесс](./203_idea_process.md)

## Способы выполнения вызовов

А что, если ИИ нужно сделать несколько Вызовов сразу? Ты можешь сказать ему, как с ними поступить.

```typescript
// Выполнить одну задачу и дождаться её завершения.
const result = await Tool(call);

// Запустить все задачи и дождаться, пока все они завершатся.
const results = await Tool.all(calls);

// Запустить все задачи, но остановиться, как только одна из них успешно завершится.
const result = await Tool.any(calls);

// Запустить все задачи и остановиться, как только первая завершится, неважно, успешно или нет. Как в гонке!
const result = await Tool.race(calls);
```

Эти способы позволяют делать крутые вещи:

- **Один за другим**: выполнять каждую задачу отдельно.
- **Все сразу**: делать кучу независимых дел одновременно, чтобы было быстрее.
- **Побеждает первый**: попробовать несколько разных способов что-то сделать и использовать тот, который сработает первым (`.any()`).
- **Гонка до финиша**: посмотреть, какая задача завершится первой, независимо от результата (`.race()`).
- **Всё или ничего**: убедиться, что целая группа задач выполнена успешно. Если одна провалится, ни одна не засчитается (`.all()`).