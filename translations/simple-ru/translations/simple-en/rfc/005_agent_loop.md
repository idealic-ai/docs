# 005: Агент/Цикл

> **Цикл:** Представь себе робота, который пытается решить головоломку. Цикл — это серия шагов, которые он предпринимает. Он постоянно спрашивает: «Что мне делать дальше?» (`Запрос`), получает в ответ список действий (`Вызовы`) и затем выполняет их. Он использует то, что узнал, чтобы снова задать вопрос, повторяя этот круг, пока не решит, что головоломка решена, и не перестанет предлагать новые действия. — [Глоссарий](./000_glossary.md)

> Sidenote:
> 
> - Требует:
>   - [001: Агент/Запрос](./001_agent_request.md)
>   - [002: Агент/Инструмент](./002_agent_tool.md)
>   - [004: Агент/Вызов](./004_agent_call.md)

Этот документ объясняет, как работает **Цикл**. Это как рецепт, который позволяет компьютерному помощнику («агенту») решать задачи, требующие более одного шага. Он делает это, постоянно спрашивая себя: «Что дальше?»

## Цикл Мышления

> Sidenote:
> 
> ```mermaid
graph TD
    Start((Start)) --> AssembleContext(Assemble Context)
    AssembleContext --> InvokeRequest(Invoke Request)
    InvokeRequest --> HasCalls{Solution has Calls?}
    HasCalls -- No --> Stop((End))
    HasCalls -- Yes --> HITL{Human-in-the-Loop}
    HITL -- Approved --> ExecuteCalls(Execute Calls)
    ExecuteCalls -- Results --> AssembleContext
    HITL -- Corrected --> AssembleContext
    classDef optional stroke-dasharray: 5, 5
    class HITL optional
```

Цикл Агента — это основной способ, которым компьютерный помощник работает самостоятельно, чтобы выполнить задачу. Вот как это происходит:

1.  **Собрать информацию:** Сначала цикл начинает собирать всё, что ему нужно знать. Это включает основную цель, которую ты ему поставил, то, что он уже сделал (`Состояние`), и любые другие полезные факты.
2.  **Спросить, что делать дальше:** Компьютер берёт всю эту информацию и передаёт её своему «мозгу», используя процесс **[001: Агент/Запрос](./001_agent_request.md)**. Он также сообщает «мозгу», какие инструменты у него есть.
3.  **Получить план:** «Мозг» думает и присылает в ответ `решение` — это список действий, которые нужно выполнить. Эти действия называются **[004: Агент/Вызов](./004_agent_call.md)ами**.
4.  **Сделать и запомнить:**
    - Если в плане есть действия, компьютер их выполняет. Например, если действие — «найти в интернете», он запустит код для своего инструмента поиска.
    - Результаты этих действий (например, информация, найденная в интернете) добавляются в его память для следующего круга.
5.  **Понять, когда остановиться:** Если «мозг» присылает план с нулём действий, это значит, что компьютер считает задачу выполненной. Цикл останавливается.

## Человек в процессе (Human-in-the-Loop)

Очень крутая особенность этого цикла в том, что он естественно создаёт паузу, во время которой человек может проверить работу компьютера. Поскольку компьютер сначала *планирует* свои действия (`Вызовы`), а потом *выполняет* их, у тебя есть шанс вмешаться.

Представь, что ты присматриваешь за роботом, который учится готовить. Прежде чем что-то сделать, он сообщает тебе свой план.

- **Одобрение:** Робот говорит: «Я собираюсь добавить стакан соли». Ты можешь посмотреть в рецепт и сказать: «Да, всё правильно. Действуй».
- **Исправление:** Или робот может сказать: «Я собираюсь добавить стакан соли», но ты знаешь, что нужен сахар. Ты можешь остановить его и изменить его план, чтобы он использовал сахар.

Это очень важно для безопасности и для совместной работы с компьютером. Компьютер даже может использовать твои исправления, чтобы учиться и составлять лучшие планы в будущем, как описано в **[012: Агент/План](./012_agent_plan.md)**.