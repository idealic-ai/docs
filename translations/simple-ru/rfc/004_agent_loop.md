# 005: Агент/Цикл

> **Цикл:** Это последовательность `Запросов`, направленных на достижение цели. Агент продолжает отправлять `Запросы`, обрабатывать полученные в ответ `Вызовы` и использовать результат для следующего `Запроса`. Он повторяет это до тех пор, пока `Вызовы` не перестанут создаваться.
> 
> — [Словарь](./000_glossary.md)

> Sidenote:
> 
> - Требуется:
> - [Агент/Запрос](./001_agent_request.md)
> - [Агент/Инструмент](./002_agent_tool.md)
> - [Агент/Вызов](./004_agent_call.md)

Этот документ объясняет **Протокол Цикла**. С его помощью агент может выполнять сложные, многошаговые задачи, постоянно повторяя `Запрос`.

## Цикл выполнения

Цикл Агента — это главный способ, которым он самостоятельно выполняет задачи шаг за шагом. Представь, что ты собираешь сложную модель из Лего. Твои действия будут очень похожи на этот цикл:

1.  **Сбор информации:** Сначала цикл собирает всё, что ему нужно знать: какая у тебя цель (собрать машинку), в каком состоянии всё находится сейчас (`State`) и другую полезную информацию. Это как разложить все детальки и инструкцию перед собой.
2.  **Отправка `Запроса`:** Затем он отправляет **[Агент/Запрос](./001_agent_request.md)** со всей этой информацией и списком доступных `Инструментов` (что он умеет делать). Это как посмотреть в инструкцию и спросить себя: «Так, что мне делать дальше с этими детальками?».
3.  **Получение инструкций:** В ответ на `Запрос` приходит `решение`, в котором есть список конкретных действий — **[Агент/Вызовов](./003_agent_call.md)**. Их может быть несколько, одно или вообще ни одного. Инструкция может сказать: «Возьми синюю детальку и прикрепи к красной».
4.  **Выполнение и запоминание:**
    - Если в `решении` есть `Вызовы` (действия), цикл их выполняет. Например, прикрепляет одну детальку к другой.
    - Результат этого действия («синяя и красная детальки теперь вместе») добавляется к общей информации для следующего шага.
5.  **Завершение:** Если в `решении` не оказалось ни одного `Вызова`, это значит, что агент считает задачу выполненной. Инструкция говорит: «Поздравляем, модель собрана!». Цикл останавливается.

## Человек в процессе (HITL)

Одна из самых крутых особенностей Цикла Агента — это возможность для человека в любой момент всё проконтролировать. Поскольку цикл сначала придумывает, что делать (`Вызовы`), а только потом это делает, у нас появляется «пауза для проверки», в которую может вмешаться человек:

- **Подтверждение:** Перед тем как выполнить действия, система может показать их тебе и спросить: «Я собираюсь сделать вот это. Всё правильно?».
- **Исправление:** Ты можешь изменить детали команды (например, «нет, используй не синюю детальку, а зелёную») или даже дать совсем другую команду.

Эта возможность очень важна для безопасности и для тех случаев, когда агент работает как твой помощник. Агент учится на твоих исправлениях и использует их для составления нового **[Плана](./012_agent_plan.md)**, чтобы в следующий раз лучше понять, чего ты хочешь.