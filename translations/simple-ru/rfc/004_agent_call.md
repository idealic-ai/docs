# 004: Агент/Вызов

> **Вызов:** Это как конкретная, готовая к исполнению команда для `Инструмента`, в которой уже указаны все нужные детали (`params`). Это запрос, сфокусированный на том, что *должно быть сделано*. — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требует: [103: Концепция/Идеатор](./103_concept_ideator.md)
> - Открывает возможности для: [008: Агент/Импорты](./008_agent_imports.md), [011: Агент/Инстансинг](./011_agent_instancing.md)

Документ [101: Концепция/Идея](./101_concept_idea.md) описывает «Идею» — мощный способ хранения знаний и скрытой логики в одном файле. Документ [002: Агент/Инструмент](./002_agent_tool.md) объясняет, как на основе этих Идей создавать интерфейсы, понятные для искусственного интеллекта (ИИ). Этот документ описывает **Протокол Вызова**, который использует Инструменты, чтобы определить, как именно будет выполняться команда, управляя её Областью и Методом.

**Вызов** — это конкретный экземпляр Инструмента с заданными параметрами, полностью готовый к выполнению. Если Инструменты определяют, *что можно сделать*, то Вызовы определяют, *как именно это будет выполнено*.

## Процесс превращения Идеи в Вызов

Представь себе конвейер из трёх шагов:

1.  **Идея**: Это самодостаточный документ, как готовый рецепт с результатом. Он описывает знание или процесс.
2.  **Инструмент**: «Идея» переворачивается и становится интерфейсом. Если Идея — это готовый торт, то Инструмент — это форма для выпечки и список ингредиентов. Агент (ИИ) регистрирует этот Инструмент, чтобы знать, что он может его использовать (подробнее об этом в [002: Агент/Инструмент](./002_agent_tool.md)).
3.  **Вызов**: Когда ИИ решает использовать `Инструмент`, он заполняет все «поля» (параметры) конкретными значениями. Например, для инструмента «Испечь торт» он указывает: «мука — 2 стакана, сахар — 1 стакан». Это и есть **Вызов** — одна конкретная команда для `Инструмента`.

Основной принцип: **любую Идею можно превратить в Инструмент, который затем можно запустить через Вызов.**

Чтобы подробно узнать, как входные данные `Идеи` превращаются в параметры `Инструмента`, смотри документ **[007: Агент/Ввод](./007_agent_input.md)**.

## Управление выполнением: Область и Метод

Выполнение `Вызова` определяется двумя независимыми свойствами: **Областью** (где он работает) и **Методом** (как он работает). Агент понимает, как действовать, по специальным свойствам в схеме инструмента: `_module`, `_activity`, `_output`.

### Две оси выполнения

1.  **Область (Встроенная или Модульная)**
    Область определяет, выполняется ли задача внутри текущего процесса агента или передаётся какому-то внешнему, отдельному модулю.
    - **Встроенная Область**: Это режим по умолчанию. `Вызов` обрабатывается здесь и сейчас. Это как решать задачу в уме.
    - **Модульная Область**: Активируется свойством `_module`. Задача передаётся внешнему помощнику (`Activity` или `Idea`). Это как попросить калькулятор посчитать что-то за тебя.

2.  **Метод (Явный или Скрытый)**
    Метод определяет, как будет получен результат: с помощью чёткого кода или с помощью творческого подхода ИИ.
    - **Явный Метод**: Активируется свойством `_activity`. Результат `Вызова` создаётся по заранее написанному, предсказуемому коду. Это как следовать кулинарному рецепту шаг за шагом.
    - **Скрытый Метод**: Это поведение по умолчанию, когда `_activity` отсутствует. Результат `Вызова` придумывает сам ИИ. Это как попросить шеф-повара приготовить блюдо из имеющихся продуктов на своё усмотрение. Для этого требуется свойство `_output`, чтобы ИИ знал, в каком формате представить результат.

Эти элементы управления можно комбинировать для создания различных способов выполнения задач. Подробнее о том, как они сочетаются, можно прочитать в **[008: Агент/Импорты](./008_agent_imports.md)**.

## Идея, Инструмент и Вызов: Разные цели

Чтобы понять, как всё это связано, нужно увидеть, на чём сфокусирован каждый из этих трёх элементов.

-   **Идея** — **сфокусирована на результате**. Её главная цель — показать готовую мысль или финальный продукт. Её схема описывает `solution` (решение или результат), который был получен из `context` (исходных данных). Это запись того, что *было* или *могло бы быть*.

-   **Инструмент** — **сфокусирован на интерфейсе**. Его схема описывает параметры (что нужно подать на вход) и структуру `_output` (что получится на выходе). Это как пустой шаблон или описание функции, которое ждёт, когда его используют.

-   **Вызов** — **сфокусирован на действии**. Это конкретная, готовая к исполнению команда для `Инструмента`. Он берёт интерфейс `Инструмента` и заполняет его реальными значениями, превращаясь в готовый приказ о том, что *должно быть сделано*.

## Идея-Контейнер: один момент принятия решения

Когда агенту нужно принять решение, весь запрос, который отправляется его «мозгу» (ИИ), упаковывается в специальный тип `Идеи`, который мы называем **Идея-Контейнер**. Она представляет собой один короткий момент выбора.

Идея-Контейнер собирает вместе два ключевых ингредиента, необходимых ИИ для принятия решения:

1.  **Контекст**: Вся важная информация, которая нужна агенту. Например, запрос пользователя, его прошлая переписка и данные об окружении.
2.  **Схема**: В Идее-Контейнере схема играет особую роль — она описывает «Контейнер», то есть набор `Инструментов`, которые агенту разрешено использовать в данной конкретной ситуации.

ИИ обрабатывает эту `Идею` целиком — и контекст, и список доступных инструментов — и его `solution` (решение) — это список из одного или нескольких `Вызовов`, которые нужно выполнить.

Такая структура позволяет одной `Идее` описать сложное, многошаговое действие.

## Шаблоны выполнения Вызовов

Когда Идея-Контейнер создаёт несколько Вызовов, их можно выполнять по-разному, в зависимости от того, что нужно приложению:

```typescript
// Выполнение одного Вызова
const result = await Tool(call);

// Выполнить все Вызовы и дождаться всех результатов
const results = await Tool.all(calls);

// Выполнить все Вызовы и вернуть первый успешный результат
const result = await Tool.any(calls);

// Выполнить все Вызовы и вернуть самый первый результат (успешный или нет)
const result = await Tool.race(calls);
```

Эти шаблоны позволяют:

-   **Точно контролировать процесс**: Обрабатывать Вызовы по одному, выполняя свою логику между ними.
-   **Обрабатывать пачками**: Выполнять независимые Вызовы одновременно для максимальной скорости.
-   **Быстро получать результат**: Останавливаться после первого успеха (`.any()`) или первого же завершения (`.race()`).
-   **Действовать по принципу «всё или ничего»**: Гарантировать, что все Вызовы в группе завершатся успешно (`.all()`), чтобы поддерживать целостность данных.