# 004: Агент/Вызов

> **Вызов:** Это как взять рецепт (`Инструмент`) и решить приготовить блюдо прямо сейчас, с конкретными ингредиентами. Это команда, которая говорит, *что именно* и *как* нужно сделать.
> 
> — [Глоссарий](./000_glossary.md)

> Sidenote:
> - Требует:
>   - [103: Концепция/Идеатор](./103_concept_ideator.md)
> - Открывает возможности для:
>   - [008: Агент/Импорт](./008_agent_imports.md)
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)
>   - [202: Идея/Носитель](./202_idea_vessel.md)
>   - [203: Идея/Процесс](./203_idea_process.md)
> - Расширяется через:
>   - [009: Агент/Модуль](./009_agent_module.md)

Документ [101: Концепция/Идея](./101_concept_idea.md) описывает, как хранить знания и логику, а [002: Агент/Инструмент](./002_agent_tool.md) — как агенты понимают, какие у них есть возможности. Этот документ описывает протокол **004: Агент/Вызов**, который основан на Инструментах и объясняет, как происходит выполнение команд.

**Вызов** — это конкретный экземпляр Инструмента с заданными параметрами, готовый к выполнению. Если Инструменты определяют, *что можно сделать*, то Вызовы определяют, *как именно это будет сделано*.

> [!TIP]
> **[Запрос (Request)](./001_agent_request.md)**, который приводит к набору `Вызовов`, называется **[Носитель (Vessel)](./202_idea_vessel.md)**. `Носитель` — это как один момент принятия решения, когда агент выбирает из доступных `Инструментов`, чтобы сформировать ответ.

## Композиция и Контекст

Сам по себе `Вызов` — это очень простая структура данных. Его сила раскрывается, когда он используется вместе с другими протоколами, которые управляют его окружением. Эти протоколы активируются специальными мета-свойствами (они начинаются с `_`) в схеме `Инструмента`. Это позволяет одному `Вызову` запускать самые разные варианты исполнения.

Поскольку у этих мета-свойств есть ясный смысл, ИИ (искусственный интеллект) может сам участвовать в их комбинировании. Он может размышлять о разных сочетаниях этих свойств, чтобы строить сложные и новые цепочки выполнения. Это уже не просто выбор инструмента, а динамическое управление целым рабочим процессом.

- **Явное выполнение (`_activity`)**: Это самый основной способ — связать `Вызов` с конкретной функцией в коде. Свойство `_activity` означает, что `Вызов` должен быть выполнен **Действием** (заранее написанной программой), а не путём размышлений ИИ.

  > Sidenote:
  > - [003: Агент/Действие](./003_agent_activity.md).

- **Делегированное выполнение (`_module`)**: `Вызов` можно поручить внешнему **Модулю**. Свойство `_module` обычно содержит ссылку на сохраненный **[Запрос](./001_agent_request.md)** (часто в виде пути к файлу), что позволяет использовать этот запрос как многоразовый инструмент. Это обеспечивает «чистую комнату» для выполнения, предотвращая смешивание контекстов и позволяя полностью изолировать задачу.

  > Sidenote:
  > - [009: Агент/Модуль](./009_agent_module.md).

- **Передача контекста (`_imports`)**: Протокол **Импорта** контролирует, какая информация доступна для `Вызова`. В основном он используется, чтобы сфокусировать внимание ИИ во время «размышлений», указывая, какие части общего контекста ему следует учитывать. Это предотвращает путаницу и ведет к более надежным результатам. При использовании с `_module` его роль становится еще важнее: он строго определяет *весь* контекст для изолированного выполнения модуля.

  > Sidenote:
  > - [008: Агент/Импорт](./008_agent_imports.md).

- **Сохранение состояния (`_outputPath`)**: `Вызов` может сохранять результаты своей работы. Свойство `_outputPath` указывает путь внутри **Объекта Состояния**, куда должен быть сохранен результат `Вызова`. Это позволяет создавать многоступенчатые процессы, где результат одного `Вызова` может быть использован как входные данные для другого.

  > Sidenote:
  > - [010: Агент/Состояние](./010_agent_state.md).

- **Выполнение для экземпляра (`_instance`)**: `Вызов` можно направить на конкретный **Экземпляр** в рамках запроса, где таких экземпляров много. Свойство `_instance` работает как уникальный идентификатор, фокусируя все операции `Вызова` (например, чтение и запись в `Объект Состояния`) на определенном контексте. Это позволяет эффективно и параллельно обрабатывать несколько состояний с помощью одного и того же набора инструментов.
  > Sidenote:
  > - [011: Агент/Инстансинг](./011_agent_instancing.md).

## Схемы выполнения Вызовов

Когда агент генерирует несколько Вызовов, их можно выполнять по-разному, в зависимости от задачи:

```typescript
// Выполнение одного Вызова
const result = await Tool(call);

// Выполнить все Вызовы и дождаться всех результатов
const results = await Tool.all(calls);

// Выполнить все Вызовы и вернуть первый успешный результат
const result = await Tool.any(calls);

// Выполнить все Вызовы и вернуть самый первый результат (успешный или нет)
const result = await Tool.race(calls);
```

Эти схемы позволяют:

- **Тонко управлять**: Обрабатывать Вызовы по одному, выполняя свою логику между ними.
- **Обрабатывать пакетами**: Выполнять независимые Вызовы параллельно для максимальной скорости.
- **Быстро получать результат**: Остановиться после первого успеха (`.any()`) или первого завершения (`.race()`).
- **Работать по принципу «всё или ничего»**: Убедиться, что все Вызовы выполнены успешно (`.all()`), сохраняя целостность, когда они логически связаны.

## Управление Вызовами в цикле

Хотя эти схемы управляют выполнением одной «пачки» `Вызовов`, агентам часто нужно выполнять многошаговые задачи, где результат одного `Вызова` влияет на следующий. Этим занимается протокол более высокого уровня, который организует `Запросы` и `Вызовы` в последовательность.

Следующий документ, **[005: Агент/Цикл](./005_agent_loop.md)**, описывает этот цикл выполнения в деталях.
