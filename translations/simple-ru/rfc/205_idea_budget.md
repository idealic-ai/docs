# 205: Идея/Бюджет

> **Идея-Бюджет:** Это Идея, которая объединяет в себе **полномочия** (разрешение действовать, описанное в её `schema`) и **ресурсы** (активы, которые можно тратить и которые отслеживаются в её `solution`).
>
> — [Словарь](./000_glossary.md)

**Идея-Бюджет** превращает скучное финансовое планирование в живой экономический мотор. Это Идея, которая сочетает в себе **право действовать** (определённое в её правилах — `schema`) и **ресурсы** (например, деньги, которые можно потратить и которые отслеживаются в `solution`). Она управляет всеми важными изменениями в системе с помощью специальной команды `refine`.

> Sidenote:
>
> - Требуется понимание:
>   - [Концепция: Идея](./101_concept_idea.md)

Этот документ объясняет главные мысли об Идеях-Бюджетах. Они предлагают совсем новый способ думать о деньгах и экономических системах. Обычные бюджеты — это просто цифры в таблице. А Идеи-Бюджеты — это живые экономические моторы со своими правилами, целями и даже собственными валютами.

## Живой Бюджет

В этой системе **`Бюджет` — это не просто число, а живой экономический мотор.** Можно представить себе `Бюджет` как **мозг и нервную систему** целой компании — живую, работающую модель самого бизнеса. Эту модель можно легко копировать, переносить и проверять.

Используя команду `refine`, мы можем создавать, финансировать и запускать `Бюджеты`, которые работают как маленькие экономики. У них есть свои правила, цели и даже собственные валюты. Это превращает составление бюджета из скучного процесса, где начальник решает всё сверху, в динамичную и честную систему, где можно видеть, как движутся ценности.

```llm
Идея-Бюджет превращает статичное планирование финансов в живой экономический мотор.
Она разделяет планирование (schema определяет правила), финансирование (конкретные переводы денег)
и полномочия (разрешения на действия). Это позволяет создавать что угодно: от простых
счетов для безопасных сделок до сложных казначейств, которые автоматически вкладывают
прибыль обратно в дело. Так получаются гибкие системы для управления любыми ресурсами, которые можно посчитать.
```

### Конституция (`schema`): Стратегическое Планирование

**`schema`** — это **Конституция** бюджета. Это как бы публичное обещание, которое помогает всей команде двигаться в одном направлении. В нём прописаны правила, отношения и что самое важное. Оно отвечает на вопросы: Какие у нас цели? Что делать, если что-то пойдёт не так? Как награждать за успехи? Но это не просто цели. `schema` объясняет **смысл** каждой цифры, превращая `Бюджет` в активного помощника в принятии решений.

`schema` объясняет, *какими* должны быть цели. Некоторые показатели должны постоянно расти, без ограничений. Другие, наоборот, нужно уменьшать. А ещё `schema` может определять порог «и так сойдёт», после которого можно остановиться.

Кроме цифр, `schema` может содержать и словесное описание каждой метрики. Поле `description` для метрики — это официальное определение того, что она значит для дела. Изменение этого описания — это важный шаг, который позволяет команде со временем уточнять свои ценности и цели, не ломая при этом старые данные.

Записывая эти умные правила, `schema` не даёт команде слепо гнаться за одной целью в ущерб другим. Она даёт мудрость понять не только, что делать, но и когда цель достигнута и пора переключиться на что-то другое. Изменить эту конституцию — это очень серьёзная операция `refine`, потому что это значит полностью поменять модель бизнеса.

```llm
Schema — это конституция Бюджета. Она определяет не только, что измерять,
но и характер каждой цели: нужно ли её увеличивать, уменьшать или держать на определённом уровне.
Этот стратегический контекст не даёт слепо гнаться за одним показателем и подсказывает,
когда цель достигнута и ресурсы пора направить на другие задачи. Это превращает бюджеты
из простых ограничений в активные инструменты для принятия решений.
```

### Снимок (`solution`): Реальность в реальном времени

**`solution`** — это **Снимок текущей ситуации**. Это конкретный, посчитанный результат работы «решателя» (это может быть сложная программа, искусственный интеллект, простой скрипт или даже человек), который применил правила из `schema` к самым свежим данным. Результат получается простым, понятным и доступным всем. Пересчитать этот снимок — это дешёвая и безопасная операция. Это как проверить счёт в игре, а не менять её правила.

### Решаемость Бюджета

Не каждый `Бюджет` может выдать работающий `solution`. В `schema` могут быть прописаны **жёсткие ограничения** — минимальные требования по ресурсам, которые нужно выполнить, прежде чем «решатель» сможет что-то толковое посчитать. Когда эти требования не выполнены, `Бюджет` становится **нерешаемым**.

Это не ошибка, а полезная функция. Нерешаемость защищает систему от пустых обещаний. Нерешаемый `Бюджет` всё ещё существует как **план** — чёткое описание того, что нужно сделать и какие ресурсы для этого требуются. Он показывает всем, сколько именно нужно ресурсов, чтобы перейти от мечты к делу. Такая честность превращает сбор денег из туманных просьб в точные и обоснованные запросы.

```llm
Решаемость бюджета — это способность выдать правильное решение (solution)
с учётом имеющихся ресурсов. Жёсткие ограничения в schema определяют минимальный
порог, ниже которого невозможно сделать что-то осмысленное. Нерешаемые бюджеты
остаются планами, ясно показывая, каких ресурсов не хватает. Это защищает
от невыполнимых обещаний и даёт чёткие цели для сбора средств.
```

## Бюджет как общая цель

`Бюджет` — это, по сути, **план** на будущее. Этот план может, и часто так и бывает, существовать ещё до того, как на него собрали все деньги.

**Три стадии жизни Бюджета:**

1.  **Стадия планирования**: `Бюджет` существует как чистая идея — `schema` без денег. Команды могут вместе работать над планом, проигрывать разные сценарии и договариваться.
2.  **Стадия частичного финансирования**: Начинают поступать ресурсы. `Бюджет` может работать в ограниченном режиме, если выполнены некоторые минимальные требования.
3.  **Полная активация**: Все жёсткие ограничения выполнены. `Бюджет` работает на полную мощность.

Настоящей целью всей компании становится совместное **наполнение `Бюджета` по всем фронтам**. Это цель, которую нужно достичь, а не просто кошелёк, который нужно потратить. Ресурсы приходят в разное время и в разных «валютах» от разных людей:

- **Финансовый капитал:** Инвесторы или доходы приносят деньги.
- **Время и внимание:** `Бюджет` может определять, сколько нужно рабочих часов и какой крайний срок.
- **Репутационный капитал:** В `Бюджете` у маркетологов может быть цель по количеству хороших отзывов в прессе.
- **Вовлечённость сообщества:** `Бюджет` команды по работе с разработчиками может пополняться за счёт принятых предложений по коду (pull requests).
- **Вычислительные ресурсы:** `Бюджет` на научный проект может измеряться в `GPU-Hours` (часах работы видеокарт) или `LLM-Tokens` (токенах для нейросетей).

Каждый из этих пунктов — это измеримый ресурс, который заполняет свою строчку в большом плане `Бюджета`.

```llm
Бюджеты проходят три стадии: планирование (идея без денег), частичное
финансирование (ограниченная работа при выполнении минимума) и полная активация
(все условия выполнены). Они собирают разные «валюты» в разное время, а schema
определяет как желаемые цели, так и жёсткие ограничения. Такой поэтапный подход
превращает сбор средств в прозрачный и измеримый процесс.
```

## Стратегические Возможности

`Бюджет` — это место, где человеческая смекалка и машинный интеллект вместе решают сложные бизнес-задачи.

### Динамичное планирование и симуляция

Поскольку `schema` — это самодостаточная экономическая модель, её можно использовать для симуляций. Это как играть в стратегическую игру: можно проверить разные идеи или предсказать, что случится при изменениях, прежде чем тратить настоящие ресурсы. Система может легко справляться с нехваткой или избытком ресурсов:

- **Если денег мало**, логика найдёт лучший компромисс и направит ресурсы на самое важное.
- **Если денег много**, излишек будет разумно потрачен на рост, сбережения или премии.

Это позволяет командам экспериментировать с разными экономическими моделями и стратегиями, поощряя творчество и принятие решений на основе данных.

### Фрактальное планирование: Масштабирование во времени

Если добавить к `Бюджету` систему статистики, которая следит за временем, он становится гибким во времени. Это позволяет делать **фрактальное планирование**.

Представь себе, что ты можешь увеличивать или уменьшать масштаб карты времени:

1.  **Детализация (Приближение):** Большой, долгосрочный `Бюджет` можно автоматически разбить на маленькие, краткосрочные задачи. Годовой бюджет можно посмотреть по кварталам или месяцам.
2.  **Обобщение (Отдаление):** Ежедневные действия постоянно складываются в общую картину, показывая в реальном времени, как вы движетесь к большим целям.
3.  **Прогнозы и сценарии «А что, если?..»:** Временная иерархия делает симуляции ещё мощнее, позволяя предсказывать будущее на основе текущих тенденций.

```llm
Фрактальное планирование позволяет Бюджетам легко переключаться между разными
периодами времени. Годовые стратегические планы разбиваются на ежедневные тактические
задачи, а ежедневные действия суммируются, показывая общий прогресс. Вместе со
статистикой это идеально связывает долгосрочное видение и сиюминутные действия,
а также даёт мощные возможности для симуляций.
```

### Эволюция через улучшения (`refine`)

`schema` Бюджета может меняться с помощью команды `refine`. Изменить `schema` — это как внести поправку в конституцию, очень серьёзный шаг. Обычно изменения должны быть обратно совместимыми, то есть они просто добавляют что-то новое, не ломая старое. Это гарантирует, что процессы, работавшие со старым `Бюджетом`, не сломаются.

Главная причина для таких изменений — это желание добавить больше деталей. Например, разделить один большой `Бюджет` на несколько маленьких для разных отделов. Так создаётся **иерархия делегирования** (система поручений).

### Иерархия Задач: Бюджеты как двигатели мотивации

Когда главный `Бюджет` поручает что-то дочернему, он как бы создаёт для него **устав для мини-экономики**. Этот устав — это `schema` дочернего `Бюджета`. В нём прописано, что ему **выделяется** (например, `USD`) и какое у него **задание** (например, цель по `articles_written` — «написанным статьям»).

Определяя цели вместе с ресурсами для их достижения, мы создаём мощную **мотивацию**. Мы говорим автоматическим агентам (программам), что для нас важно, и даём им средства для работы. Так система организует сложную работу, создавая спрос на конкретные результаты.

В `schema` также можно включить метрики вроде `positive_feedback_tokens` (жетоны за хорошую работу), которые открывают доступ к бонусам, или `complaint_tokens` (жетоны жалоб), которые запускают проверки. Это создаёт мощную систему поощрений.

#### Гибкие бюджеты и обратная связь

Главный `Бюджет` может дать дочернему `Бюджету` гибкие рамки трат (например, `base_budget` — основная сумма и `overdraft_allowance` — возможность потратить немного больше). В `schema` дочернего бюджета может быть логика, которая позволяет ему использовать сверхлимитные средства, если он показывает хорошие результаты. Это создаёт механизм «обратного давления», где успех открывает доступ к новым ресурсам.

#### Метрики снизу вверх и диалог

Поскольку `Бюджет` — это активный экономический мотор, он сам создаёт свои метрики (например, `average_cost_per_article` — средняя стоимость одной статьи). Если эти метрики показывают, что начального бюджета не хватает, эта информация идёт наверх. Это запускает диалог для умной корректировки планов на основе реальных данных.

### Автоматический рост и собственные валюты

В этой модели любая метрика может стать валютой. В `schema` содержатся формулы, что делать, когда эти валюты появляются. Например, `Бюджет` может придумать `ProcessImprovementToken` (жетон улучшения процесса), который зарабатывается за выпуск качественных функций. Его потом можно «потратить», чтобы получить время на улучшение кода.

`Бюджет` можно настроить так, чтобы он периодически проверял свежую статистику и пересчитывал распределение ресурсов. `schema` затем автоматически распределяет результаты по своим правилам, создавая саморазвивающиеся системы роста.

```llm
Бюджеты позволяют создавать автоматические циклы роста, где любая метрика
становится валютой, которую можно тратить. Успех в одной области (например, довольные
клиенты) автоматически открывает ресурсы для другой (например, улучшение качества).
Schema определяет эти связи, создавая прозрачные формулы, где достижения напрямую
питают будущие возможности. Это превращает бюджеты в саморазвивающиеся моторы роста.
```

### Децентрализованные и вложенные экономики

Модель `Бюджета` позволяет создавать отдельные, изолированные финансовые системы, которые могут работать приватно, но при этом взаимодействовать с большой сетью. Например, компания может создать мастер-`Бюджет` в основной системе, а затем вести свой внутренний, закрытый учёт для управления этим `Бюджетом`. Все внутренние операции будут невидимы для основной сети, которая видит только общие пополнения и расчёты.

## Финансирование и Полномочия: Как это работает

Экономическая система построена на двух простых действиях, управляемых командой `refine`: финансирование (перевод денег) и делегирование (выдача разрешения, без перевода).

### 1. Финансирование Бюджета (Транзакция)

«Бюджет» — это отдельная Идея (`Vibe`), которая специально пополняется с какого-то счёта.

- Пользователь использует `refine` на шаблоне `Бюджета`, указывая сумму и с какого счёта её взять.
- Система проверяет, есть ли у пользователя право управлять этим счётом.
- В учётную книгу записывается транзакция: с исходного счёта деньги списываются, а на счёт нового `Бюджета` зачисляются. Теперь у нового `Бюджета` есть эти средства.

### 2. Делегирование Полномочий (Без транзакции)

Как только `Бюджет` пополнен, его владелец может дать право распоряжаться им другим, не создавая новых переводов денег.

- Разрешение выдаётся с конкретными условиями (например, максимальная сумма трат, разрешённые типы ресурсов).
- **Никакой транзакции не создаётся.** Деньги никуда не перемещаются. Новое разрешение — это как «виртуальная карта», которой разрешено брать деньги из родительского `Бюджета`.

Этот двухэтапный процесс — сначала пополнить, потом разрешить — даёт максимальную гибкость и контроль.

```llm
Экономическая система работает через два основных действия:
1. Финансирование создаёт Бюджет через явную транзакцию, перемещая средства
   с исходных счетов в специальные «копилки».
2. Делегирование даёт право тратить без транзакций, как будто выпуская
   виртуальные карты, которые черпают деньги из этой «копилки».
Такое разделение позволяет гибко и прозрачно управлять ценностями, где пополнение
и право тратить контролируются независимо друг от друга.
```

## Траты: Транзакция из двух частей

Окончательное перемещение денег из `Бюджета` происходит, когда задача публикуется и выполняется. Этот процесс состоит из двух простых, отдельных транзакций, которые гарантируют, что средства зарезервированы и выплачены правильно.

### 1. Резервирование средств на задачу

Когда менеджер использует своё право потратить деньги из `Бюджета` на публикацию задачи, система `refine` проверяет запрос и создаёт одну транзакцию: **списание** с `Бюджета`. Теперь эти деньги считаются «в пути», зарезервированными под эту задачу.

Система `refine` делает **три критически важные проверки**:

**а. Проверка правил:** Позволяет ли выданное разрешение совершить это действие?
**б. Проверка баланса:** Хватит ли в `Бюджете` денег?
**в. Проверка решаемости:** После этого списания, сможет ли `Бюджет` по-прежнему выполнять свои жёсткие ограничения?

Если все три проверки пройдены, система записывает одно списание в учётную книгу. Если хотя бы одна проверка не пройдена, система **полностью отклоняет публикацию задачи**. Это защищает работников от того, чтобы браться за работу без денег, и поддерживает порядок в экономической системе.

```llm
Система проверки обеспечивает три уровня защиты: соблюдение правил, достаточность
средств и сохранение решаемости бюджета. Публикация задачи отклоняется, если
резервирование средств под неё нарушит какое-либо ограничение или опустит
бюджет ниже минимального порога. Это создаёт надёжный рынок, где у каждой
принятой задачи есть гарантированное, проверенное финансирование, которое
не поставит под угрозу сам бюджет.
```

### 2. Выплата вознаграждения

После успешного выполнения задачи делается финальный вызов `refine`. Система создаёт вторую, балансирующую транзакцию: **зачисление** на счёт работника.

Цикл завершён. Две простые транзакции — списание с `Бюджета` заказчика и зачисление на счёт исполнителя — это всё, что нужно. Если бы задачу отменили, деньги просто вернулись бы обратно в исходный `Бюджет`.

```llm
Траты используют модель из двух частей: сначала публикация задачи создаёт
списание с Бюджета (резервирование). Затем выполнение задачи создаёт зачисление
работнику (выплата). Эта простая модель гарантирует, что средства правильно
зарезервированы и баланс всегда сходится, без сложных механизмов. Отменённые
задачи просто возвращают деньги в исходный Бюджет.
```

## Универсальные Применения

Идея-`Бюджет` — это гибкий инструмент, который может моделировать множество различных ситуаций.

### Финансовые и бизнес-задачи

1.  **Стандартное финансирование проекта:** Проект по разработке ПО получает `Бюджет`, где в `schema` прописано распределение: `"development": "60%", "design": "20%", "qa": "20%"`.
2.  **Безопасная сделка для одной задачи:** Для простой работы фрилансера создаётся `Бюджет`, который пополняется на точную сумму этой задачи.
3.  **Управление подписками:** Ежемесячная плата за подписку от пользователя попадает в его личный `Бюджет`. `schema` распределяет эти средства на разные сервисы в зависимости от того, чем он пользуется.
4.  **Операционные расходы команды:** Команда маркетинга получает квартальный `Бюджет`. Руководитель команды может разрешать траты по каждой категории.
5.  **Комиссии с продаж и распределение прибыли:** `Бюджет` компании отслеживает `GrossProfit` (валовую прибыль). Его `schema` определяет, как прибыль делится между расходами, реинвестированием и бонусами.

### Продвинутые и неденежные применения

6.  **Торговый бот:** `Бюджет` торгового бота хранит активы. `schema` — это *и есть* торговая стратегия, с правилами для сделок.
7.  **Гранты и научное финансирование:** Грант на исследование в университете управляется как `Бюджет`. `schema` следит за строгими правилами расходования средств, установленными грантодателем.
8.  **Распределение ресурсов по использованию:** Команда по анализу данных может получить месячный `Бюджет` в `1000 GPU-Hours` и `50M LLM-Tokens`.
9.  **Управление казной DAO:** DAO (децентрализованная автономная организация) управляет своей казной как главным `Бюджетом`. `schema` отражает предложения по расходам, одобренные сообществом.
10. **Игровая экономика:** В видеоигре инвентарь игрока — это `Бюджет`, в котором хранятся ресурсы вроде `Gold`, `Wood` и `Stone`.
11. **Двигатель личного развития:** `Бюджет` человека отслеживает его усилия и навыки. Его можно пополнять временем и деньгами, а в `schema` прописать цели, например, повысить показатель `Python-Proficiency` (владение Python). `Бюджет` превращает усилия и вложения в измеримые навыки.

### Управление любыми ресурсами

`Бюджет` не обязательно пополнять деньгами. Его можно пополнить **потенциалом**, например, физическими вещами или даже такими абстрактными вещами, как знания. `Бюджет` тогда становится инструментом для превращения этого потенциала во что-то конкретное. В `schema` могут быть правила, как превратить «Опыт» в «ЧасыКонсультаций» (валюту), которые затем можно «продать» и получить `USD`.

Учётная книга может работать с любыми ресурсами, которые можно посчитать (`LLM-Tokens`, `GPU-Hours`, `Storage-GB`, `API-Credits`, `DeveloperReputation` и т.д.).

```llm
Учётная книга может работать с любыми измеримыми ценностями. Бюджеты
можно пополнять потенциалом (вещами, знаниями), и в них будут правила
для их превращения во что-то другое. Можно отслеживать любой ресурс: деньги,
вычислительную мощность, репутацию. Команда `refine` позволяет обменивать
одни ресурсы на другие, создавая единую систему для всех видов ценностей.
```

## Техническая Основа

Этот раздел описывает ключевые технические части, которые делают систему динамичных `Бюджетов` возможной.

### Разделение для скорости: Роль слоя агрегации

Эта модель использует **отдельный, работающий в реальном времени слой агрегации** (например, базу данных TimescaleDB), чтобы мгновенно видеть балансы `Бюджетов`.

Представь это так:

- **Учётная книга — источник правды:** Система `refine` записывает каждую транзакцию в нестираемую учётную книгу. Это как главный, официальный документ.
- **События питают агрегатор:** Книга сообщает о каждой новой транзакции.
- **Агрегатор показывает текущие балансы:** Слой агрегации слушает эти сообщения и держит под рукой всегда свежую информацию о балансах всех `Бюджетов`. Это как быстрая шпаргалка.
- **Проверка происходит по быстрому слою:** Когда нужно что-то проверить, система смотрит в быструю шпаргалку, а не в медленную главную книгу.

Такая архитектура сочетает надёжность главной книги с высокой скоростью системы проверки балансов.

### Аудит потоков: История транзакций

Главное преимущество нестираемой учётной книги — это идеальная проверяемость. Можно **отследить путь каждой копейки**. Поскольку каждая транзакция связана с `Бюджетом`, который её оплатил, и разрешением, которое её одобрило, мы можем увидеть всю историю любой суммы денег.

Например, запрос по платежу может показать всю его историю:

- `ЗАЧИСЛЕНИЕ Баланс:Дизайнер-Джейн +$1000` `(Оплата за РекламнуюКампанию-123)`
  - `└─ СПИСАНИЕ Бюджет:Маркетинг-2025 -$1000` `(Резерв под РекламнуюКампанию-123)`
    - `   └─ ЗАЧИСЛЕНИЕ Бюджет:Маркетинг-2025 +$200тыс` `(Пополнение из Казны)`
      - `      └─ СПИСАНИЕ Баланс:Казна-Компании -$200тыс` `(Для создания бюджета Маркетинга)`
        - `         └─ ЗАЧИСЛЕНИЕ Баланс:Казна-Компании +$1М` `(Начальное пополнение)`

Эта ясная, непрерывная цепочка даёт полную прозрачность того, как распределяются и тратятся средства.

```llm
Техническая архитектура разделяет нестираемую учётную книгу (источник правды)
и быстрый слой агрегации (для скорости). События из книги попадают в агрегатор,
поддерживая актуальные балансы для быстрой проверки. Каждая транзакция сохраняет
полную историю, позволяя идеально отследить путь средств от начального
финансирования до финальной выплаты. Это обеспечивает и надёжность, и скорость.
```