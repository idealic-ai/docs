# 003: Агент/Действие

> **Действие:** Это конкретная, понятная компьютеру функция, написанная кодом, которая выполняет работу для `Инструмента`. Это как инструкция для выполнения задач, которые требуют обращения к другим сайтам (API), поиска информации в базах данных или любой другой работы, которую искусственный интеллект не может просто «придумать» из головы. — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требуется: [002: Агент/Инструмент](./002_agent_tool.md)

Этот документ объясняет **Протокол Действий**, который определяет, как `Инструменты` подкрепляются настоящим, работающим кодом. Если `Инструмент` — это описание того, *что* можно сделать, то `Действие` — это то, *как* это сделать.

## Архитектура с двумя реестрами

Представь себе, что у системы есть две разные записные книжки (или реестра), которые помогают отделить описание способности от её реального выполнения:

- **Реестр Инструментов**: Здесь хранятся описания всех `Инструментов`. Это как меню в ресторане, где написано, какие блюда можно заказать.
- **Реестр Действий**: Здесь хранится сам код (`Действия`), который выполняет работу для `Инструментов`. Это как книга с рецептами на кухне, по которым повар готовит блюда из меню.

Такое разделение делает систему очень гибкой. `Инструменты` могут существовать просто как идея, и тогда ИИ будет сам «додумывать» результат. А ещё мы можем легко поменять рецепт (`Действие`), не меняя название блюда в меню (`Инструмент`). Например, использовать один рецепт для тестовой версии, а другой — для настоящей.

## Регистрация Действия

`Действие` регистрируется под уникальным именем. Это имя связывает его с `Инструментом`.

```typescript
// Регистрируем реализацию Действия.
// Имя 'weatherCheck' должно совпадать с Инструментом, который оно реализует.
Activity.register('weatherCheck', async call => {
  const data = await weatherAPI.get(call.location);
  return { temperature: data.temp, conditions: data.desc };
});
```

## Режимы выполнения: Скрытый и Явный

Когда агент использует `Инструмент`, система может выполнить задачу двумя способами:

- **Скрытое исполнение**: В этом режиме используется сам искусственный интеллект. Агент как бы «обдумывает» задачу и сам придумывает ответ. Это происходит по умолчанию, если для `Инструмента` не найдено специального кода (`Действия`).
  > Sidenote:
  >
  > - [104: Концепция / Скрытое](./104_concept_latent.md)
- **Явное исполнение**: В этом режиме задача передаётся конкретному коду — `Действию`. Этот код выполняется и выдаёт точный результат. Это нужно для общения с внешним миром (например, с сайтами или базами данных) или для задач, где нужна 100% точность и повторяемость.

## Как система выбирает Действие

Система сама решает, какой режим выполнения использовать, без сложной настройки. Поле `_activity` в описании `Инструмента` — это намёк на то, что нужно использовать настоящий код. Вот как это работает:

1.  **Прямое указание в `_activity`**: Если в описании `Инструмента` прямо указано имя в поле `_activity`, система ищет `Действие` с этим именем. Это как дать повару точный номер рецепта.
2.  **Совпадение по имени (рекомендуется)**: Если поле `_activity` пустое, система ищет `Действие`, имя которого **полностью совпадает** с именем `Инструмента`. Если находит, то они автоматически связываются. Это самый простой способ: блюдо «Бургер» в меню соответствует рецепту «Бургер» на кухне.
3.  **Запасной вариант (Скрытое исполнение)**: Если `Действие` так и не нашлось, поле `_activity` остаётся пустым. Это сигнал для системы, что нужно использовать скрытое исполнение — то есть, попросить ИИ «додумать» ответ самому.

Такой подход всё упрощает:

- **Чтобы всё работало без настроек, называйте `Действие` так же, как и `Инструмент`.**
- `Инструменты` без соответствующего `Действия` автоматически и безопасно будут выполняться силами ИИ.
- Если вы хотите, чтобы один и тот же код (`Действие`) работал для разных `Инструментов`, вы можете прямо указать его имя в поле `_activity`.

## Почему важно разделять Действия

Если бы мы не разделяли описания `Инструментов` и код `Действий`, то каждая способность была бы намертво привязана к своему коду. Чтобы поменять способ выполнения — например, вместо «додумывания» ИИ начать использовать реальный погодный сайт — пришлось бы искать и переделывать каждого агента, который использует этот `Инструмент`.

Архитектура с двумя реестрами решает эту проблему. Описания `Инструментов` остаются стабильными, а их «начинка» (код) может меняться. Агенты всегда видят одно и то же «меню», не зная, по какому «рецепту» готовится блюдо. Это значит, что:

- **Изменения в коде не ломают агентов**: Можно переключиться со скрытого исполнения на явное, не трогая код самого агента.
- **Можно тестировать разные подходы**: Легко сравнить, что работает лучше для одной и той же задачи — «сообразительность» ИИ или чёткий код, обращающийся к внешнему сайту.
- **Можно внедрять изменения постепенно**: Можно выдать новый код (`Действие`) только небольшой группе агентов, чтобы проверить его в деле, пока остальные продолжают использовать старый код или полагаются на ИИ.