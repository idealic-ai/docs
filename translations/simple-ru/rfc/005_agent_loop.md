# 005: Агент/Цикл

> **Цикл:** Последовательность `Запросов`, направленных на достижение цели. Агент продолжает вызывать `Запросы`, обрабатывать полученные `Вызовы` и использовать результат в следующем `Запросе` до тех пор, пока `Вызовы` не перестанут создаваться. — [Глоссарий](./000_glossary.md)

> Sidenote:
> - Требуется:
>   - [001: Агент/Запрос](./001_agent_request.md)
>   - [002: Агент/Инструмент](./002_agent_tool.md)
>   - [004: Агент/Вызов](./004_agent_call.md)

Этот документ описывает **цикл выполнения**, который позволяет агенту выполнять задачи из нескольких шагов, раз за разом отправляя [Запросы (документ 001)](./001_agent_request.md). Этот повторяющийся процесс сбора информации, использования инструментов и получения ответа — это то, что обычно и называют «агентом».

## Цикл выполнения

> Sidenote:
> ```mermaid
> graph TD
>     Start((Старт)) --> ContextAssembly(1. Сбор информации)
>     ContextAssembly --> RequestInvocation(2. Отправка Запроса)
>     RequestInvocation --> CallProcessing(3. Обработка Вызовов)
>     CallProcessing --> HasCalls{Есть Вызовы?}
>     HasCalls -- Нет --> Termination((5. Завершение))
>     HasCalls -- Да --> HITL{Человек в цикле}
>     HITL -- Одобрено --> Execution(4. Выполнение и обратная связь)
>     Execution -- Результаты --> ContextAssembly
>     HITL -- Исправлено --> ContextAssembly
>     classDef optional stroke-dasharray: 5, 5
>     class HITL optional
> ```

Цикл выполнения — это главный механизм, который помогает агенту работать самостоятельно и выполнять сложные задачи. Он работает так:

1.  **Сбор информации:** Представь, что агент — это робот-помощник, который собирается приготовить пиццу. Сначала он смотрит, что у него есть: тесто, соус, сыр. Это и есть сбор «контекста».
2.  **Отправка Запроса:** Робот думает: «Что делать дальше?» и отправляет `Запрос` своему «мозгу» (ИИ-модели), передавая ему список всего, что он знает, и список своих «инструментов» (например, «раскатать тесто», «намазать соус»).
3.  **Обработка Вызовов:** Мозг отвечает списком конкретных команд, которые называются `Вызовы`. Например: `[{'инструмент': 'раскатать тесто'}, {'инструмент': 'намазать соус'}]`. Это его план действий.
4.  **Выполнение и обратная связь:**
    - Если в ответе есть `Вызовы` (команды), робот их выполняет. Он раскатывает тесто и намазывает соус.
    - Результаты этих действий («тесто раскатано», «соус на пицце») добавляются к тому, что он знает. Эта информация поможет ему на следующем шаге.
5.  **Завершение:** Когда мозг в ответ на `Запрос` присылает пустой список `Вызовов`, это значит, что работа сделана. Пицца готова, и цикл останавливается.

## Человек в цикле (ЧВЦ)

Одна из самых крутых особенностей этого цикла — он позволяет человеку легко контролировать агента. Поскольку план действий (`Вызовы`) сначала создаётся, а только потом выполняется, у человека есть возможность вмешаться:

- **Одобрение:** Перед тем как робот начнёт выполнять команды, система может показать их тебе и спросить: «Всё верно? Продолжаем?»
- **Исправление:** Ты можешь изменить команду (например, «добавь побольше сыра») или заменить её на другую.

Это очень важно для безопасности и для совместной работы, когда агент выступает в роли твоего помощника. Агент может учиться на твоих поправках, чтобы в будущем составлять планы ещё лучше, как описано в документе [012: Агент/План](./012_agent_plan.md).

## Роль данных в цикле

Цикл выполнения — это как скелет для поведения агента, но его настоящая сила — в данных, которые циркулируют внутри. Вся информация, которую агент запоминает и обрабатывает на каждом шаге, позволяет ему не терять нить разговора, учиться и выполнять сложные планы, состоящие из многих действий.

Следующий документ, [006: Агент/Данные](./006_agent_data.md), расскажет о том, как управлять этими данными.
