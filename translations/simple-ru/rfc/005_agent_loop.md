# 005: Агент/Цикл

> **Цикл:** Это последовательность «Запросов», которые агент выполняет, чтобы достичь цели. Представь, что агент — это робот-помощник, который шаг за шагом решает задачу. Он делает «Запрос» (спрашивает, что делать дальше), выполняет полученные «Вызовы» (команды), а затем использует результат, чтобы сделать следующий «Запрос». Так продолжается до тех пор, пока не останется ни одной команды для выполнения. — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требуется:
>   - [001: Агент/Запрос](./001_agent_request.md)
>   - [002: Агент/Инструмент](./002_agent_tool.md)
>   - [004: Агент/Вызов](./004_agent_call.md)

Этот документ описывает **Протокол Цикла**, который позволяет агенту выполнять сложные, многошаговые задачи. Он делает это, повторяя снова и снова специальный протокол «Запрос».

## Рабочий Цикл

Цикл Агента — это его основной способ самостоятельно выполнять задачи, состоящие из нескольких шагов. Это похоже на то, как ты собираешь сложный конструктор по инструкции, шаг за шагом.

1.  **Сборка Контекста:** Сначала агент, как и ты, раскладывает перед собой всё необходимое. Он собирает всю начальную информацию: твою главную цель, текущее состояние дел (`State`) и любые другие полезные данные. Это его «рабочее место».
2.  **Отправка Запроса:** Затем агент заглядывает в «инструкцию», чтобы понять, что делать дальше. Он отправляет **[Запрос](./001_agent_request.md)**, спрашивая: «Учитывая всё, что я знаю, и инструменты, которые у меня есть, какой следующий шаг?»
3.  **Обработка Вызовов:** В ответ на `Запрос` он получает `solution` (решение) — это список команд, которые нужно выполнить. Эти команды называются **[Вызовами](./004_agent_call.md)**. Их может быть несколько или не быть совсем.
4.  **Выполнение и Запись Результатов:**
    -   Если в решении есть `Вызовы`, агент выполняет их. Это как взять нужные детали конструктора и соединить их по инструкции.
    -   Результаты этих действий (например, «детали успешно соединены») он добавляет на своё «рабочее место», в общий контекст. Эта информация пригодится ему на следующем шаге.
5.  **Завершение:** Если в ответ на `Запрос` агент получает пустой список `Вызовов`, это сигнал, что работа сделана. Он считает свою цель достигнутой, и цикл останавливается. Конструктор собран!

## Человек в цикле (Контроль со стороны человека)

Главная особенность Цикла Агента — в него очень легко может вмешаться человек для контроля. Поскольку агент сначала предлагает список команд (`Вызовов`) и только потом их выполняет, у нас появляется возможность всё проверить.

-   **Одобрение:** Прежде чем агент начнёт что-то делать, система может показать тебе его план, а ты можешь сказать: «Да, всё правильно, действуй!».
-   **Исправление:** Если ты видишь ошибку, ты можешь изменить команду или даже заменить её на другую. Например, сказать: «Нет, возьми не красную деталь, а синюю».

Эта возможность очень важна для безопасности и для совместной работы, когда агент выступает в роли твоего умного помощника. Агент может учиться на твоих поправках, чтобы в будущем составлять планы ещё лучше, используя **[План Агента](./012_agent_plan.md)**.