# 203: Идея/Процесс

> **Идея-Процесс:** Это как умная папка ([Идея](./101_concept_idea.md)), в которой хранится не только пошаговый [План](./012_agent_plan.md) действий, но и отметка о том, на каком шаге мы сейчас находимся. Её «схема» — это набор доступных [Инструментов](./002_agent_tool.md), её «решение» — это *новый* `План` на следующий шаг, а в её «контексте» лежат исходная задача, текущее состояние и `План` с предыдущего шага.
>
> — [Глоссарий](./000_glossary.md)

> Sidenote:
> - Требует:
>   - [101: Концепция/Идея](./101_concept_idea.md)
>   - [012: Агент/План](./012_agent_plan.md)
>   - [010: Агент/Состояние](./010_agent_state.md)
>   - [007: Агент/Ввод](./007_agent_input.md)
> - Дополняется:
>   - [011: Агент/Инстансинг](./011_agent_instancing.md)

Если [Идея-Носитель (202: Idea/Vessel)](./202_idea_vessel.md) — это одно мгновенное решение, то **Идея-Процесс** — это целый стратегический квест, который длится во времени. Это результат работы системы [Планирования (012: Agent/Plan)](./012_agent_plan.md), когда она решает сложную, многоэтапную задачу. Такая Идея-Процесс становится полной записью и всех возможностей, которые были у системы, и того пути, который она выбрала.

## Из чего состоит План

`Идея-Процесс` использует тройную структуру `Идеи`, чтобы создать полный «слепок» рабочего процесса. Этот слепок содержит не только выбранную агентом стратегию (`План`), но и весь набор его умений и текущее состояние дел.

- **`schema` (Палитра):** Это библиотека всех доступных [Инструментов](./002_agent_tool.md), из которых можно составить `План`. Представь, что это палитра со всеми красками, которые есть у художника. Она показывает всё, что агент умеет делать.

- **`solution` (Новый План):** Это схема действий (`Вызовов`), которую агент выбрал для *текущего* шага. Это как следующий мазок кистью на холсте. Этот новый план станет «Планом с прошлого шага» для следующего такта работы.

- **`context` (Общая картина):** Здесь хранится вся информация, нужная агенту, чтобы спланировать и выполнить текущий шаг.
  - **Входящее сообщение:** Первая команда, которая запустила весь процесс. Обычно она даётся один раз и больше не меняется.

    > Sidenote:
    > - [007: Агент/Ввод](./007_agent_input.md)

  - **Сообщение о состоянии:** Это «живые» данные о том, что происходит прямо сейчас. Тут хранятся все промежуточные результаты, которые связывают разные шаги `Плана` между собой.

    > Sidenote:
    > - [010: Агент/Состояние](./010_agent_state.md)

  - **Сообщение о плане:** Здесь лежит **Утверждённый План** с предыдущего шага. Агент может решить либо следовать ему дальше, либо изменить его.

    > Sidenote:
    > - [012: Агент/План](./012_agent_plan.md)

### Единство планирования и выполнения

Главный секрет этой системы в том, что планирование и выполнение происходят одновременно. В обычных системах ты сначала составляешь план, а потом его выполняешь. Здесь же это один и тот же процесс. Агент не просто создаёт план, а потом отдельно его выполняет; сам процесс создания следующего шага плана (`solution`) *и есть* выполнение текущего шага.

Это делает систему очень быстрой и гибкой. `План` — это живая схема, которой не нужно быть законченной, чтобы работать. Она может быть частичной, использовать результаты прошлого шага и меняться на лету. `Вызовы` (действия), которые генерирует нейросеть, — это одновременно и структура плана, и данные, которые по нему передаются. Благодаря этому один запрос к нейросети может в одно и то же время проверить текущее состояние, поправить план на основе новых данных и выполнить следующий логический шаг. Нет никаких лишних затрат на перепланирование или проверку — выполнение *и есть* проверка, планирование и корректировка, всё в одном.

> Sidenote:
> - [004: Агент/Вызов](./004_agent_call.md)

### Гибкость Плана: от наброска до чертежа

Объект `Состояния` позволяет `Плану` пройти три стадии развития — от гибкого поиска идей до предсказуемого, чёткого алгоритма:

1.  **Свободный План:** Вначале `Состояние` можно создавать без чёткой схемы. Это даёт агенту полную свободу придумывать `План` и создавать новые связи между шагами прямо на ходу.

2.  **План с заданными связями:** Следующий шаг к созданию надёжного `Плана` — «заморозить» схему `Состояния`, то есть определить главные пути для данных. Это можно сделать с разной степенью строгости:
    - **Открытые связи:** Схема может разрешать `additionalProperties` (дополнительные свойства). Это заставляет агента использовать основные пути, но позволяет создавать новые связи для редких или особых случаев.
    - **Закрытые связи:** Схема может запретить `additionalProperties`, создавая жёсткую структуру, которой агент должен следовать в точности.

3.  **Готовый План:** Это финальная стадия, когда план считается полностью проработанным и предсказуемым. Такой `Готовый План` становится **Утверждённым Планом**, который передаётся в `контексте` на следующих шагах. Готовый план может быть двух видов:
    - **Идеальный План:** План, который описывает идеальный сценарий. Он очень эффективен, но может потребовать изменений, если что-то пойдёт не так.
    - **Полный План:** Полностью проработанный план, который со временем дополнили решениями для частых ошибок, альтернативными путями и другими сценариями, что делает его очень надёжным.

Такое развитие позволяет `Идее-Процессу` превратиться из гибкого наброска в очень надёжный и многоразовый инструмент.

## Неизменяемые процессы: управление, анализ и масштабирование

Сила `Идеи-Процесса` — в её неизменяемости. Каждый шаг в процессе создаёт новый, полный «слепок» `Плана` и `Состояния`, сохраняя идеальную историю всех действий, которую можно проверить. Этот принцип создания цепочки неизменяемых «артефактов» и даёт системе её самые продвинутые возможности для управления, анализа и масштабирования.

- **Надёжное, гибкое выполнение:** Работа по «шагам» (тикам) очень надёжна, потому что каждый новый шаг основывается на полном слепке предыдущего состояния. Это предотвращает путаницу и гарантирует, что решение агента следовать плану или изменить его основано на понятной и предсказуемой картине мира. Результат каждого шага — это новая `Идея-Процесс`, которая безопасно двигает работу на один шаг вперёд.

  > Sidenote:
  > - [005: Агент/Цикл](./005_agent_loop.md)
  > - [012: Агент/План](./012_agent_plan.md)

- **Устойчивое управление:** `Идея-Процесс` — это самодостаточный артефакт, что делает управление процессами невероятно надёжным. Процесс можно поставить на паузу, просто сохранив его последний «слепок». Внешние системы — или человек-наблюдатель — могут изучить это замороженное состояние и принять решение. Любые изменения, например, перепланирование или правка состояния, создают *новую* `Идею-Процесс`, которую можно использовать для безопасного возобновления работы, не меняя при этом историю прошлых действий.

  > Sidenote:
  > - [010: Агент/Состояние](./010_agent_state.md)

- **Точное моделирование («путешествие во времени»):** Эта архитектура позволяет буквально путешествовать во времени внутри процесса. Каждая историческая `Идея-Процесс` — это идеальный, точный слепок процесса в определённый момент. Это позволяет пользователям или другим агентам загрузить любую точку в истории процесса, чтобы проверить его, найти ошибку в сложном поведении или запустить сценарии «а что, если», создав новую ветку процесса с этого момента.

  > Sidenote:
  > - [202: Идея/Носитель](./202_idea_vessel.md)

- **Единообразная пакетная обработка:** Подход со «слепками» гарантирует одинаковый результат при масштабировании процессов с помощью протокола Инстансинга. `План` работает как шаблон, который применяется к целой пачке независимых `Состояний`. Поскольку и `План`, и начальное `Состояние` каждого экземпляра — это чётко определённые слепки, агент может обработать всю пачку за один шаг, гарантируя понятный и предсказуемый результат для каждого экземпляра.

  > Sidenote:
  > - [011: Агент/Инстансинг](./011_agent_instancing.md)

## От предсказуемого Плана к управляемому выполнению

`Идея-Процесс` может созреть и превратиться в **Готовый План** — очень предсказуемый и надёжный алгоритм. Но такая жёсткость может ограничивать гибкость. Системе нужен способ вносить тонкие, ситуативные указания, не ломая при этом устоявшийся план.

Эту роль выполняет **[Идея-Инструкция](./204_idea_instruction.md)**. `Инструкция` — это структурированный рецепт для действия, который можно применить к стабильному `Процессу`. Вместо того чтобы менять структуру плана, она даёт точечные указания для отдельных выборов *внутри* этой структуры. Это позволяет `Инструкции` направлять конкретные шаги рассуждений, добавлять новые проверки или влиять на решение в определённой точке схемы. Она даёт дополнительный слой контроля, сохраняя все гарантии предсказуемого плана. Это способ улучшить *логику* процесса, а не просто последовательность его действий.

> Sidenote:
> - [204: Идея/Инструкция](./204_idea_instruction.md)
