# 203: Идея/Процесс

> **Идея-Процесс:** Это как умный рецепт ([Идея](./101_concept_idea.md)), в котором записан не только пошаговый стратегический [План](./012_agent_plan.md), но и то, на каком шаге мы сейчас находимся. Её `схема` — это набор всех доступных [Инструментов](./002_agent_tool.md), её `решение` — это _новый_ `План` на текущий шаг, а её `контекст` содержит исходную задачу, текущее состояние и предыдущий `План`.
>
> — [Глоссарий](./000_glossary.md)



Если [202: Идея/Носитель](./202_idea_vessel.md) — это одно моментальное решение, то **Идея-Процесс** — это целый продуманный рабочий процесс, который длится во времени. Это результат работы системы [012: Агент/План](./012_agent_plan.md), когда она решает сложную, многошаговую задачу. В итоге получается полная запись всего: и того, что агент умеет делать, и того, какую именно стратегию он выбрал.

## Из чего состоит План

`Идея-Процесс` использует триаду `Идеи`, чтобы сделать «фотографию» всего рабочего процесса. На этом снимке видно не только стратегию агента (`План`), но и все его инструменты, и текущее состояние дел.

- **`schema` (Палитра):** Это библиотека всех доступных [Инструментов](./002_agent_tool.md), из которых можно собрать `План`. Представь, что это палитра со всеми красками, которые есть у художника. Это полный набор возможностей агента.

- **`context` (Что происходит вокруг):** Здесь хранится вся информация, которая нужна агенту, чтобы спланировать и выполнить текущий шаг.
  - **Входное сообщение:** Самая первая задача, с которой всё началось. Обычно она даётся один раз и остаётся неизменной.



  - **Сообщение о состоянии:** Это «живые» данные рабочего процесса, которые постоянно меняются. Представь это как записную книжку, где хранятся промежуточные результаты, связывающие разные шаги `Плана` между собой.



  - **Сообщение о плане:** Это утверждённый план с предыдущего шага. Агент может решить либо следовать ему, либо изменить его.



- **`solution` (Новый План):** Это схема из Вызовов (действий), которую агент выбрал в качестве стратегии на _текущий_ шаг. На следующем шаге она станет «Сообщением о плане».

### Когда планирование и действие — одно и то же

Главный принцип этой системы в том, что планирование и выполнение сливаются в один процесс. В обычных системах ты сначала составляешь план, а потом отдельно его выполняешь. Здесь же всё происходит одновременно, на каждом шагу. Агент не просто создаёт план, а потом слепо ему следует. Сам процесс создания нового `решения` (нового `Плана`) — это и *есть* выполнение текущего шага.

Это делает систему очень быстрой и гибкой. `План` — это живая схема, которой не обязательно быть завершённой, чтобы быть полезной. Она может быть частичной и меняться на лету, отталкиваясь от результатов прошлого шага. Каждый новый `Вызов`, придуманный ИИ, — это одновременно и часть плана, и действие. Благодаря этому один запрос к ИИ может сразу и проверить текущее состояние, и скорректировать план, и выполнить следующий логический шаг. Не нужно тратить время на отдельную перепроверку или перепланирование — всё происходит за один раз.



Такая единая модель даёт два больших преимущества. Во-первых, `План` можно продумать и «проиграть в уме» ещё до того, как появятся реальные данные, просто на основе набора инструментов. ИИ может как бы играть роль каждого шага, позволяя создавать и проверять сложные процессы с самого начала. Во-вторых, ИИ работает как умный переходник между шагами. Если результат одного действия не совсем подходит для входа следующего, ИИ может сгладить эту нестыковку. Это делает систему невероятно устойчивой, в отличие от обычных систем, где одна маленькая ошибка может сломать всю цепочку.



### Насколько гибким может быть План

Объект `Состояние` позволяет `Плану` проходить три стадии жизни, превращаясь из гибкого наброска в предсказуемый и надёжный процесс:



1.  **Свободный План:** Сначала `Состояние` можно не описывать строгими правилами. Это даёт агенту максимальную свободу для поиска `Плана`, позволяя ему создавать новые связи (новые записи в «записной книжке» `Состояния`) на ходу.

2.  **План с правилами:** Следующий шаг — сделать `План` более строгим, «заморозив» правила для `Состояния`. Это определяет основные пути, по которым будут передаваться данные. Тут тоже есть варианты:
    - **Открытые связи:** Правила могут разрешать `additionalProperties` (дополнительные свойства). Это заставляет придерживаться основных путей, но оставляет агенту свободу для создания новых связей в необычных случаях.
    - **Закрытые связи:** Можно установить `additionalProperties` в `false`. Это создаёт жёсткую структуру, которой агент должен строго следовать.

3.  **Готовый План:** Это финальная стадия, когда план считается полностью зрелым и предсказуемым. Такой «Готовый План» становится **Утверждённым Планом** и передаётся на следующих шагах. Он может быть двух видов:
    - **Идеальный План:** Готовый план для идеального случая. Он очень эффективен, но может потребовать изменений, если что-то пойдёт не так.
    - **Полный План:** План, который со временем дополнили решениями для частых ошибок и альтернативных сценариев. Он очень надёжный и предсказуемый.

Такое развитие позволяет `Идее-Процессу` вырасти из наброска в очень надёжный и многоразовый инструмент.

## Процессы, которые ничего не забывают: Управление, Анализ и Масштабирование

Сила `Идеи-Процесса` в её неизменности. Каждый шаг в процессе создаёт новый, полный «снимок» `Плана` и `Состояния`, сохраняя идеальную историю, которую можно проверить. Этот принцип создания цепочки неизменяемых «фотографий» и даёт системе самые крутые возможности.

- **Надёжное и гибкое выполнение:** Цикл выполнения по шагам очень надёжен, потому что каждый новый шаг работает с полной копией предыдущего состояния. Это предотвращает путаницу и гарантирует, что агент принимает решения на основе понятной картины мира. Результат каждого шага — новая `Идея-Процесс`, которая безопасно двигает процесс вперёд.



- **Устойчивое управление:** `Идея-Процесс` — это самостоятельная вещь, что делает управление процессами невероятно надёжным. Процесс можно поставить на паузу, просто сохранив его последний «снимок». Внешние системы или люди-наблюдатели могут изучить это замороженное состояние и принять решение. Любые изменения, например, смена плана или данных, создают _новую_ `Идею-Процесс`, с которой можно безопасно продолжить работу, не меняя историю.



- **Точное моделирование («Путешествие во времени»):** Эта архитектура позволяет буквально путешествовать во времени. Каждая прошлая `Идея-Процесс` — это идеальный снимок процесса в определённый момент. Это позволяет пользователям или другим агентам загрузить любую точку в истории, чтобы проверить, что пошло не так, или запустить сценарий «а что, если...», начав новый процесс с этой точки.



- **Одновременная работа над сотней задач:** Архитектура на основе «снимков» позволяет легко справляться с огромными объёмами работы. Представь, что у тебя есть один `План` (рецепт) и нужно выполнить 100 похожих задач (испечь 100 кексов). Каждая задача получает свою изолированную копию `Состояния` (свой набор ингредиентов). Один `План` служит шаблоном для всех сразу. За один шаг агент параллельно планирует действия для всей партии, создавая набор `Вызовов` для каждой конкретной задачи. Это гарантирует одинаковый подход к разным задачам и сильно повышает эффективность.



## От чёткого плана к мудрому руководству

`Идея-Процесс` может созреть до **Готового Плана** — очень предсказуемого и надёжного процесса. Но такая строгость может ограничивать гибкость. Системе нужен способ давать более тонкие, ситуативные указания, не ломая при этом проверенный план.

Эту роль выполняет **[Идея-Инструкция](./204_idea_instruction.md)**. `Инструкция` — это структурированный рецепт для действий, который даёт стратегические советы более высокого уровня. Это как «мысленная шпаргалка» или набор принципов, которые помогают процессу на двух уровнях: направляют агента при выборе или создании самого подходящего `Плана` и дают точечные советы для отдельных решений во время его выполнения. Проще говоря, `Инструкция` улучшает _логику_ и _рассуждения_ в процессе, гарантируя, что и общая стратегия, и конкретные действия соответствуют желаемому подходу.

