# 101: Агент: Запрос

> **Запрос:** Это как одноразовое волшебное заклинание для нейросети (LLM). Оно берёт `контекст` (всю предысторию) и `схему` (чёткую инструкцию), чтобы создать `решение` (готовый ответ).
>
> — [Словарь](./000_glossary.md)

> Sidenote: NPM: [https://www.npmjs.com/package/@augceo/agent](@idealic-ai/agent)

Этот документ расскажет тебе о **Протоколе Запроса**. Это самый главный способ общения с нейросетью. Представь, что `Запрос` — это волшебный двигатель, который превращает абстрактную **[Концепцию: Идею](./001_concept_idea.md)** во что-то, что компьютер может понять и сделать. Для этого он использует её `контекст` и `схему`, чтобы в итоге получить `решение`.

## Конвейер Запроса

`Запрос` — это не просто вопрос, который ты задаёшь. Это целый сборочный конвейер, который берёт много разной информации и превращает её в один-единственный ответ от нейросети, сделанный строго по правилам.

### 1. Контекст: Список Сообщений

Всё начинается с `контекста`. Это как история вашей переписки, представленная в виде списка (`массива`) сообщений. Благодаря этому мы можем показать нейросети целый диалог, где у каждого была своя роль, и всё это будет аккуратно разложено по полочкам.

Простой пример `контекста`:

```json
[
  { "role": "system", "content": "Ты — полезный ассистент." },
  { "role": "user", "content": "Какая столица у Франции?" }
]
```

### 2. Особые Типы Содержимого

Наша система круче, потому что сообщения могут содержать не только текст. Вместо обычной строчки `content` может быть целым объектом со своей структурой. Например, вот так: `{ "type": "state", "state": { ... } }`.

Представь, что ты отправляешь письмо. Обычно в нём просто слова. А теперь вообрази, что ты можешь вложить в письмо «магическую наклейку». Когда почтальон (наша система) видит эту наклейку, он делает что-то особенное. Эти наклейки — наши особые типы содержимого.

Каждая такая «наклейка» может изменять три важные вещи в нашем запросе:

- **Настройки нейросети**: Можно поменять модель, её «фантазию» (`temperature`) и другие параметры.
- **Схему**: Можно на лету изменить инструкцию, по которой нейросеть должна дать ответ.
- **Контекст**: Можно изменить сам список сообщений, например, превратив «наклейку» в понятный для нейросети текст или добавив новые сообщения.

Этот умный конвейер позволяет нам работать со сложными идеями, каждый раз идеально настраивая заклинание для нейросети.

### 3. Схема: Инструкция для Ответа

`Схема` — это как чертёж или инструкция по сборке. Она очень точно говорит, как должен выглядеть готовый ответ (`решение`). Наша система `Запроса` смотрит на то, что умеет конкретная нейросеть, и выбирает лучший способ заставить её следовать этой инструкции:

1.  **Родной режим JSON Schema**: Если нейросеть очень современная, мы просто передаём ей нашу «инструкцию» напрямую. Это самый надёжный способ, как показать архитектору готовый чертёж.
2.  **План Б: Вызов инструмента**: Если нейросеть не понимает чертежи, но умеет пользоваться инструментами, мы хитрим. Мы упаковываем нашу инструкцию в «инструмент» под названием `generate_response` и просим нейросеть его использовать.
3.  **Крайний случай: Внедрение в подсказку**: Если нейросеть умеет только создавать текст в формате JSON, мы просто пишем ей в главной инструкции: «Сделай, пожалуйста, вот такой JSON», и вставляем туда нашу схему в виде текста.

### 4. Исполнение и Решение

После всей подготовки наш идеально собранный запрос отправляется нейросети. Она выполняет задание и создаёт ответ, который точно соответствует нашей схеме-инструкции.

Система получает этот ответ и превращает его в красивый и понятный для программы объект. Этот объект и есть наше `решение`.

Весь этот процесс — от обработки сложной переписки до получения идеально структурированного ответа — и есть та магия, которая позволяет **Идее** быть главным строительным кирпичиком в нашей системе.