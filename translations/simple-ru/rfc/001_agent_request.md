# 001: Агент/Запрос

> **Запрос:** Это как одна команда для очень умного компьютера (ИИ). Ты даёшь ему `контекст` (всю нужную информацию) и `схему` (правила, как должен выглядеть ответ), а он создаёт `решение` (готовый результат). — [Глоссарий](./000_glossary.md)

> Sidenote:
> - Даёт возможность: [101: Концепция/Идея](./101_concept_idea.md)
>
> NPM: [https://www.npmjs.com/package/@augceo/agent](@idealic-ai/agent)

Этот документ объясняет **Протокол Запроса** — основной способ общения с искусственным интеллектом (ИИ). `Запрос` — это как двигатель, который берёт абстрактную **[101: Концепция/Идея](./101_concept_idea.md)** и делает её понятной для компьютера. Он использует `контекст` (что уже известно) и `схему` (каким должен быть ответ), чтобы создать `решение`.

## Конвейер Запроса

> Sidenote:
> ИИ обработает `контекст`, чтобы создать `решение`, которое соответствует `схеме`.
>
> ```mermaid
> graph TD
>     subgraph Что мы даём
>         direction LR
>         Context[Контекст]
>         Schema[Схема]
>     end
>
>     Process{{"Запрос"}}
>
>     subgraph Что мы получаем
>         direction LR
>         Solution[/"Решение (ответ)"/]
>     end
>
>     Context --> Process
>     Schema --> Process
>     Process --> Solution
>     Schema -.-> Solution
>
>     linkStyle 2 stroke-width:2px,fill:none,stroke:gray,stroke-dasharray: 5 5;
>     linkStyle 3 stroke-width:2px,fill:none,stroke:gray,stroke-dasharray: 5 5;
> ```

`Запрос` — это не просто вопрос. Это целый конвейер, который берёт много разной информации (`контекст`) и превращает её в один-единственный ответ от ИИ, который строго следует правилам (`схеме`).

### 1. Контекст: Список сообщений

Основа любого `Запроса` — это `контекст`. Представь, что это история переписки, где записано, кто и что сказал. Это помогает ИИ понять всю ситуацию целиком, а не только последнее сообщение.

Простой пример `контекста`:

```json
[
  { "role": "system", "content": "Ты — полезный помощник." },
  { "role": "user", "content": "Какая столица у Франции?" }
]
```

### 2. Особые типы данных

Система умеет работать не только с текстом. Внутри сообщений могут быть «волшебные ингредиенты» — особые блоки данных. Например, вместо простого текста `content` может быть `{ "type": "state", "state": { ... } }`.

За каждый такой «ингредиент» отвечает свой «повар» (обработчик). Когда он видит свой ингредиент, он может на лету изменить рецепт:

- **Настройки ИИ**: Сказать главному повару-ИИ быть более творческим или, наоборот, очень точным (как поменять температуру в духовке).
- **Схема**: Изменить правила для финального блюда (например, «нужен не торт, а кексы»).
- **Контекст**: Перевести «волшебный ингредиент» на простой язык, понятный ИИ, или добавить в переписку новые полезные заметки.

Это делает систему очень гибкой. Она может работать со сложными идеями, а не просто с текстом, и каждый раз создавать идеальную команду для ИИ.

### 3. Схема: Чертеж для ответа

`Схема` — это как чертёж или рецепт, который точно описывает, как должен выглядеть финальный `результат`. Система смотрит, что умеет конкретный ИИ, и выбирает лучший способ заставить его следовать чертежу:

1.  **Прямой приказ**: Если ИИ современный, ему можно просто отдать чертёж напрямую. Это самый надёжный способ.
2.  **Трюк с инструментом**: Если ИИ хорошо работает с инструментами, можно «упаковать» чертёж в специальный инструмент с названием `generate_response` (создай_ответ) и попросить ИИ его использовать.
3.  **Записка на полях**: Для старых ИИ, которые понимают только общий формат JSON, приходится добавлять чертёж прямо в текст задания с просьбой: «Пожалуйста, сделай ответ в точности вот таким».

### 4. Выполнение и Решение

После всей подготовки готовый список сообщений и правила для ответа упаковываются и отправляются ИИ. ИИ создаёт ответ, который точно соответствует чертежу.

Система получает этот ответ и превращает его в понятный для программы объект. Этот объект и есть `решение`.

> [!TIP]
> Весь этот конвейер — `контекст` (ингредиенты), `схема` (рецепт) и `решение` (готовое блюдо) — образует единое целое. Его можно сохранить и использовать снова. Когда ты сохраняешь такой набор, он называется **[101: Концепция/Идея](./101_concept_idea.md)**.

`Схема` определяет, какую форму примет `решение`.