# 003: Агент/Вызов

> **Вызов:** Это как готовый к запуску приказ для `Инструмента`, в котором уже заполнены все нужные детали (`params`). Это просьба, сфокусированная на том, _что нужно сделать_ прямо сейчас.
> 
> — [Глоссарий](./000_glossary.md)

> Sidenote:
> 
> - Требуется: [Протокол: Идеаторы](./103_concept_ideator.md)
> - Позволяет: [Протокол Импортов](./006_agent_imports.md), [Протокол Инстансинга](./008_agent_instancing.md)

Мы уже знаем, что [Протокол Идей](./101_concept_idea.md) — это способ хранить знания и разную логику. А [Система Инструментов](./002_agent_tool.md) — это набор правил, который помогает агентам понимать свои возможности. Этот документ описывает **Протокол Вызова** — он, как дирижёр, управляет тем, как именно будут работать наши Инструменты, используя Область и Метод.

> Sidenote:
> 
> - Требуется
> - [RFC 1: Инструмент](/)
> - Позволяет
> - [RFC 9: План](/)

**Вызов** — это как конкретный экземпляр Инструмента, у которого все настройки уже выставлены и он готов к работе. Если Инструменты определяют, _что можно сделать_, то Вызовы определяют, _как именно это будет сделано_.

## Путь от Идеи к Вызову

Представь себе, как мысль превращается в действие:

1.  **Идея**: Это просто мысль или знание. Например: «Было бы здорово послушать музыку».
2.  **Инструмент**: Это Идея, которая превратилась в возможность. Например, приложение «Музыка» на твоём телефоне. У него есть разные кнопки и функции.
3.  **Вызов**: Это когда нейросеть решает использовать `Инструмент` и нажимает на его кнопки. Например, она «нажимает» на `Инструмент` «Музыка» и указывает параметры: «включить весёлый плейлист». Это и есть **Вызов**.

Главный принцип: **любую Идею можно превратить в Инструмент, который затем можно использовать через Вызов.**

Чтобы узнать в деталях, как «входы» для `Идеи` превращаются в «параметры» для `Инструмента`, загляни в **[Протокол Ввода](./005_agent_input.md)**.

## Управление исполнением: Область и Метод

Когда мы делаем `Вызов`, мы можем управлять им с помощью двух настроек: **Область** (где он работает) и **Метод** (как он работает). Эти настройки задаются специальными свойствами в схеме инструмента (`_module`, `_activity`, `_output`).

### Две оси исполнения

1.  **Область (Здесь или Там)**
    Область определяет, будет ли действие выполнено прямо тут, внутри агента, или его нужно поручить кому-то вовне.
    - **Здесь (Inline Scope)**: Это режим по умолчанию. `Вызов` выполняется на месте, как если бы ты сам собирал LEGO.
    - **Там (Module Scope)**: Используется метка `_module`. Это как отдать инструкцию и детальки на специальную фабрику LEGO, которая соберёт всё за тебя и вернёт готовую модель.

2.  **Метод (По правилам или Творчески)**
    Метод определяет, как будет создан результат: по чёткому алгоритму или с помощью фантазии нейросети.
    - **По правилам (Explicit Method)**: Помечается свойством `_activity`. Результат создаётся кодом, который работает как калькулятор — всегда точно и предсказуемо.
    - **Творчески (Latent Method)**: Это режим по умолчанию, когда `_activity` нет. Результат создаёт нейросеть. Это как попросить художника нарисовать «радость» — он поймёт идею и создаст что-то уникальное. Для этого ему нужна подсказка в виде свойства `_output`.

Эти настройки можно смешивать, создавая разные способы выполнения задач. Подробнее о том, как это работает, можно прочитать в **[Протоколе Импортов](./008_agent_imports.md)**.

## Идея, Инструмент и Вызов: Разный фокус внимания

Чтобы понять, как всё связано, давай посмотрим, на чём сосредоточен каждый из этих трёх элементов.

-   **Идея** — **сосредоточена на результате**. Её главная цель — описать готовую мысль или итог. Это как написанный сценарий фильма, который рассказывает, что _было_ или что _могло бы быть_.

-   **Инструмент** — **сосредоточен на возможностях**. Его схема описывает, какие у него есть «кнопки» (параметры) и какой будет структура ответа (`_output`). Это как пульт управления или камера — набор функций, которые ждут, когда их используют.

-   **Вызов** — **сосредоточен на действии**. Это конкретный приказ использовать `Инструмент`. Он берёт «пульт управления» и «нажимает» на кнопки, задавая им конкретные значения. Это готовая к исполнению команда о том, что _нужно сделать_.

## Идея-Контейнер: один момент принятия решения

Когда агенту нужно что-то решить, весь его запрос к нейросети упаковывается в специальный тип `Идеи`, который мы называем **Идея-Контейнер**. Она представляет собой один-единственный момент принятия решения.

Идея-Контейнер собирает вместе два ключевых элемента, которые нужны нейросети для выбора:

1.  **Контекст**: Вся важная информация, которая есть у агента: просьба пользователя, его память, данные об окружении. Это как карта и погода для капитана корабля.
2.  **Схема**: Для Идеи-Контейнера схема определяет сам «Контейнер» — то есть набор `Инструментов`, которые агенту разрешено использовать в данной ситуации. Это как список приказов, которые капитан может отдать команде: «Поднять паруса!», «Налево руля!».

Нейросеть обрабатывает всю эту `Идею` целиком — и контекст, и доступные инструменты — и её решением (`solution`) становится список из одного или нескольких `Вызовов`, которые нужно исполнить.

Такая структура позволяет одной простой `Идее` запустить сложное действие из нескольких шагов.

## Шаблоны выполнения Вызовов

Когда Идея-Контейнер создаёт несколько Вызовов, их можно выполнять по-разному, в зависимости от задачи:

```typescript
// Выполнить один Вызов
const result = await Tool(call);

// Выполнить все Вызовы, дождаться всех результатов
const results = await Tool.all(calls);

// Выполнять все Вызовы, но остановиться после первого успеха
const result = await Tool.any(calls);

// Выполнять все Вызовы, но остановиться после самого первого, который завершится (неважно, успешно или нет)
const result = await Tool.race(calls);
```

Такие шаблоны позволяют:

-   **Точно всё контролировать**: Выполнять Вызовы по одному, делая что-то между ними.
-   **Работать пачками**: Запускать независимые Вызовы одновременно, чтобы было быстрее.
-   **Быстро получать результат**: Останавливаться, как только найдётся первое удачное решение (`.any()`).
-   **Действовать по принципу «всё или ничего»**: Убедиться, что все связанные Вызовы выполнились успешно (`.all()`), чтобы не нарушить логику.