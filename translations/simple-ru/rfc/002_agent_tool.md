# 002: Агент/Инструмент

> **Инструмент**: Это как инструкция или чертёж, который описывает, что именно умеет делать агент. Эту инструкцию показывают умной программе (LLM), когда ей дают задание. Она работает как понятное меню с кнопками, на которые можно «нажать».
> Программа «нажимает кнопку», создавая специальную команду (`Call`) со всеми нужными деталями. А потом эту команду выполняет либо сама программа в уме (это называется скрытое исполнение), либо специальный код (`Activity`), который для этого написан. — [Глоссарий](./000_glossary.md)

> Sidenote:
>
> - Требуется: [001: Агент/Запрос](./001_agent_request.md)
> - Дополняется: [003: Агент/Действие](./003_agent_activity.md)

Этот документ рассказывает про Инструменты — это как понятные инструкции, которые помогают агентам понимать, что они могут делать, и как этим пользоваться.

## Что такое Инструменты?

**Инструменты — это фундамент** для системы действий агента. Они дают ему суперспособность: **выбирать действие по ситуации**. Это позволяет агентам решать, какой инструмент лучше всего подходит для конкретной задачи, прямо как ты выбираешь молоток, чтобы забить гвоздь, а не отвёртку.

Что дают Инструменты:

- **Понятные инструкции**: У каждого инструмента есть чёткое описание, чтобы агент знал, для чего он нужен и как им пользоваться.
- **Надёжность**: Это как инструкция к игрушке — ты точно знаешь, какие батарейки нужны и что игрушка будет делать. Агент тоже точно знает, что ему нужно для работы и что он получит в итоге.
- **Конструктор**: Инструменты можно соединять вместе, как детальки Лего, чтобы создавать сложные и умные действия.
- **Дружба с ИИ**: Инструкции написаны на таком языке, который искусственный интеллект (LLM) может легко прочитать, понять и выбрать то, что нужно.

Когда агент решает использовать инструмент и добавляет все нужные детали (например, какой текст перевести), он создаёт **Вызов (Call)**. Это как заполненная анкета, которая говорит: «Я готов, выполняй!». Подробнее о том, как выполняются вызовы, читай в документе [004: Агент/Вызов](./004_agent_call.md).

> **Заметка**: Хотя любое задание для умной программы можно представить как Идею (это хорошо подходит, когда нужно просто создать какой-то текст по шаблону), Инструменты нужны для более сложных задач, где агенту нужно самому выбирать, что делать. О том, как Идеи можно превратить в Инструменты, рассказано в документе [007: Агент/Ввод](./007_agent_input.md).

## Когда нужно использовать систему Инструментов

Используй систему Инструментов, когда хочешь, чтобы агенты могли:

- **Сами выбирать, что делать**, в зависимости от ситуации.
- **Выбирать из нескольких разных способностей**, чтобы достичь цели.
- **Выполнять одно и то же действие по-разному** (например, искать что-то в Google или в Яндексе).
- **Совмещать «размышления» умной программы с чёткими правилами** при принятии решений.

## Как устроена система Инструментов

### Главный принцип: Инструкция — это только описание

Система Инструментов построена на простом правиле: **Инструменты — это просто инструкции**. Они описывают, *что* можно сделать, но не говорят, *как* именно это делать. Это как рецепт, в котором перечислены ингредиенты, но он сам не готовит блюдо.

Выполнить эту инструкцию может либо сама умная программа (она как бы «представляет» результат в уме), либо специальный кусочек кода, который называется **[003: Агент/Действие](./003_agent_activity.md)**.

В инструкции к Инструменту указано:

- **Что делает инструмент** (описание)
- **Что ему нужно для работы** (входные параметры)
- **Что он выдаст в результате** (структура `_output`)
- **Как он называется** (имя `_tool`)
- **Как его выполнить** (поле `_activity`, подробнее в [003: Агент/Действие](./003_agent_activity.md))

### Служебные поля в инструкции Инструмента

В инструкциях для инструментов есть специальные поля, которые начинаются с подчёркивания (`_`). Это как служебные пометки для самой системы, чтобы она всё правильно поняла:

- **_tool**: Уникальное имя инструмента (обязательно).
- **_activity**: Указывает, какое `Действие` (программа) должно выполнить этот инструмент. Подробнее об этом в [003: Агент/Действие](./003_agent_activity.md).
- **_output**: Описывает, как должен выглядеть результат работы.
- **_reasoningForCall**: Сюда система записывает объяснение агента, почему он решил использовать именно этот инструмент.

Все остальные поля без подчёркивания — это обычные параметры для работы инструмента. Служебные поля всегда идут первыми, чтобы умной программе было легче их понять.

### Границы системы

За что отвечает система Инструментов:

- **Регистрация Инструментов**: хранение всех инструкций в одном месте.
- **Заполнение деталей**: умная программа сама находит нужную информацию в задании и подставляет её в инструмент.
- **Выбор исполнителя**: система решает, кто выполнит команду — сама программа «в уме» или специальный код `Activity`.

Более сложные системы уже на основе этих простых правил строят целые цепочки действий, следят за состоянием и решают, как и когда что выполнять, как дирижёр управляет оркестром.

## Создание и регистрация Инструмента

Инструменты создаются с помощью специальных файлов (JSON-схем), которые полностью описывают, что они умеют:

### Простой Инструмент (Скрытое исполнение)

У этого `Инструмента` нет специальной программы (`Activity`), поэтому его будет выполнять сама умная программа.

```typescript
Tool.register('sentimentAnalysis', {
  type: 'object',
  description: 'Анализирует настроение текста',
  properties: {
    _tool: { type: 'string', const: 'sentimentAnalysis' },
    text: { type: 'string', description: 'Текст для анализа' },
    _output: {
      type: 'object',
      properties: {
        sentiment: { type: 'string' },
        confidence: { type: 'number' },
      },
    },
  },
});
```

### Инструмент с Действием (Явное исполнение)

Этот `Инструмент` создан для того, чтобы его выполняла специальная программа (`Activity`). О том, как её подключить, читайте в документе [003: Агент/Действие](./003_agent_activity.md).

```typescript
// Определяем схему инструмента
// Смотрите документацию docs/rfc/003_agent_activity.md
```

### Сборка инструкций

Все инструкции для инструментов собираются в один большой список под названием `calls`, который потом показывают умной программе. Каждая инструкция дополняется служебной информацией, а затем добавляется в общий список с помощью специального правила `anyOf`. Это как сказать программе: «Ты можешь выбрать любой из этих вариантов».

```typescript
{
  // ... существующий код ...
}
```

Это позволяет умной программе выбирать из всех доступных инструментов и даже создавать несколько команд (Вызовов) за один раз.

## Инструменты как основа

Инструменты — это **первый и самый главный кубик** в конструкторе действий для агента. Они просто описывают, *что можно сделать*, с помощью понятных инструкций. Документ [003: Агент/Действие](./003_agent_activity.md) объясняет, *как именно выполняется код*, а [004: Агент/Вызов](./004_agent_call.md) строит на этом всём сложную систему, которая управляет целыми цепочками действий.