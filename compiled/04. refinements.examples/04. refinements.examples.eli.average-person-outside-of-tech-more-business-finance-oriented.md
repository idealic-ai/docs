## Understanding How Your Business Information Can Evolve: Product Records Example

Imagine your company keeps detailed records for everything it manages – perhaps product specifications, customer contracts, or internal procedures. In this system, each of these records is called a "Record Vibe." Think of it like a highly organized digital file folder that not only stores information but also knows its own structure.

### Keeping Your Information Templates Up-to-Date

Just like a business needs to adapt, the structure of these records (their "schema") sometimes needs to change. For example, if you start selling products online, your basic product information sheet needs more fields than when you just had a promotional website. This idea of making your information templates more specific and detailed as your needs grow is a core principle. It's not just something you do once when setting up; it's how the system stays flexible.

**How do we change the template (the `schema`) of a record?**

It's a controlled process. The system uses "Capabilities" – think of these as special permissions or authorizations. These Capabilities don't just allow you to change the _data_ inside a record (like updating a product's description). They can also authorize changes to the _very structure_ or template of the record itself.

This change happens through an operation called `Refine`. To change a record's template:

1.  You target an existing Record Vibe (your specific product information sheet).
2.  You provide an "instruction Vibe." This is another special record whose content (its `solution`) describes exactly _how_ the template of your target record should be modified.

When this `Refine` operation is completed (and authorized by the correct Capability), you get a _new version_ of your Record Vibe. This new version will have the updated template (`schema`) and its data (`solution`) will match this new structure. This is like saying, "My product info sheets now need an 'Inventory Count' field, and for this specific product, let's start that count at zero."

This ensures that how your company organizes its information can evolve smoothly as your business strategies change. It’s about letting your actual use of information drive how that information is structured.

**Let's Walk Through an Example: From Brochure to Online Store**

Imagine your company, "Awesome Gadgets Inc." (let's call its records `aug` for short), initially has a simple website showing off its products. Each product, like the "SuperWidget," has a Record Vibe: `aug:products/superwidget:1` (the `:1` indicates it's the first version).

These product records follow a basic template, let's say defined in a master template record called `aug:products/example:1`.

- The **`schema`** field of this master template (and thus of your SuperWidget record) defines the structure. Initially, it's simple:

  ```json
  // Template for a basic product info sheet
  {
    "type": "object", // The record is a collection of properties
    "properties": {
      "productName": { "type": "string" }, // Expects text for product name
      "description": { "type": "string" }, // Expects text for description
      "promoImage": { "type": "string", "format": "uri" } // Expects a web link for the image
    },
    "required": ["productName", "description"] // Name and description are mandatory
  }
  ```

  Think of this JSON like the design of a form: specifying field names (`productName`), what type of data goes in them (`string` for text, `uri` for a web link), and which fields are compulsory.

- The **`solution`** field of the master template might contain example data, while `aug:products/superwidget:1` would have the actual data for the SuperWidget.

**The Business Change: We Need to Sell Online!**

Awesome Gadgets decides to launch a full online shop. This means they now critically need to track how many SuperWidgets are in stock (`stockLevel`) and how much they cost (`price`). This requires changing the template for all product records.

**The `Refine` Operation: Upgrading the Product Record's Template and Data**

To update the SuperWidget's record (`aug:products/superwidget:1`):

- **`target`**: This is the record we want to change – `aug:products/superwidget:1`.
- **`instruction`**: We use a special "instruction record," say `aug:migrations/evolve-to-shop-item:1`. The crucial part is its `solution` (its content), which tells the system:

  1.  How to modify the template (the `schema`): Add `stockLevel` (a number, can't be negative) and `price` (a number, formatted as currency).
  2.  How to update the data (the `solution`): For existing products being upgraded, set their initial `stockLevel` to `0` and `price` to `"0.00"`.

  Here's a simplified look at what that instruction's content might specify:

  ```json
  // Content of the 'evolve-to-shop-item' instruction record
  {
    "schemaModifications": {
      // How to change the template
      "addProperties": {
        "stockLevel": { "type": "integer", "minimum": 0, "description": "Current available stock" },
        "price": { "type": "number", "format": "currency", "description": "Retail price" }
      },
      "addToRequired": ["stockLevel", "price"] // These new fields are now mandatory
    },
    "solutionUpdate": {
      // Initial values for the new fields in the product's data
      "stockLevel": 0,
      "price": "0.00"
    }
  }
  ```

- **`capability`**: This change needs authorization. Imagine a "System Architect" role holds the necessary permit (`aug:capability-architect-master:1`) to approve such structural upgrades to product records.

The system then performs the `Refine` operation, which looks something like this in concept:

`New SuperWidget Record (Version 2) = Refine(Old SuperWidget Record v1, Instruction to Evolve, Architect's Authorization)`

This creates a **new version** of the SuperWidget record, which we can call `aug:products/superwidget:2`. (The system handles the exact versioning numbers; we use `:2` for clarity).

This `aug:products/superwidget:2` is now ready for the online shop:

- Its **`schema`** field (its template) now includes `stockLevel` and `price`:
  ```json
  // Template for the new 'Shop Product' structure
  {
    "type": "object",
    "properties": {
      "productName": { "type": "string" },
      "description": { "type": "string" },
      "promoImage": { "type": "string", "format": "uri" },
      "stockLevel": { "type": "integer", "minimum": 0, "description": "Current available stock" },
      "price": { "type": "number", "format": "currency", "description": "Retail price" }
    },
    "required": ["productName", "description", "stockLevel", "price"]
  }
  ```
- Its **`solution`** field (its actual data) now contains the original product information _plus_ the newly initialized `stockLevel` and `price`:
  `json
    // Data for SuperWidget, Version 2
    {
      "productName": "Super Widget",
      "description": "The best widget for your needs.",
      "promoImage": "http://example.com/superwidget.png",
      "stockLevel": 0,
      "price": "0.00"
    }
    `
  Importantly, the original `aug:products/superwidget:1` is _not changed_. It remains in the system's records (the ledger) untouched. This is like keeping an archive of all previous versions of a contract – great for history and auditing. Other products, like `aug:products/anotheritem:1`, would go through a similar `Refine` process to become `aug:products/anotheritem:2`.

**A Key Benefit: Compatibility**
If the change to the template simply _adds_ new information (like `stockLevel` and `price`), it's often considered a "compatible refinement." This means older systems or reports that only knew about `productName` and `description` can still read the new version 2 records; they'll just ignore the new fields they don't understand. This is like adding extra columns to a spreadsheet – formulas that only used the old columns still work.

**Updating Data with the New Template**
Now that `aug:products/superwidget:2` has the new shop-ready template, someone like an "Inventory Manager" can be given permission to update its data. For instance, if 150 SuperWidgets arrive in stock:

- **`target`**: `aug:products/superwidget:2`.
- **`instruction`**: An "update stock" instruction record (`aug:updates/update-stock:1`), whose content simply says: `{ "stockLevel": 150 }`.
- **`capability`**: A permit held by the Inventory Manager.

This `Refine` operation would create `aug:products/superwidget:3`, which has the same shop-ready template as version 2, but its data now shows `"stockLevel": 150`.### Major Makeovers: Migrating to a Completely New Product Template

The previous example showed adding new fields to our product information template. That's like adding new sections to an existing form. But what if we need a more fundamental change – a "breaking" change? This could be renaming a field (e.g., changing `productName` to `itemTitle`), significantly altering how we store information (e.g., changing `price` from text like `"$10.99"` to a number representing cents like `1099`), or removing a field entirely.

When such major changes are needed, a better strategy than trying to patch the old template is to migrate your products to a brand-new template version. Think of it like your company deciding that all new contracts will use a completely redesigned legal form (Version 2), instead of trying to awkwardly modify the old Version 1 forms.

This approach aligns with a "content-first" idea: the new template (the `schema`) isn't just an abstract concept floating around. It's directly embedded within the new versions of your product records. The old product record's data will be used as the `instruction` to help fill out a new product record that's already set up with the new template.

**Scenario: Switching to `priceInCents` and Removing the Old `price` Field**

Let's say our existing product records (like `aug:products/superwidget:3` from before) were all based on our "Version 1" product template (`aug:products/example:1`). This V1 template included a `price` field stored as text (e.g., `"19.99"`).

Now, for better accuracy in financial calculations and to avoid issues with currency symbols, we want to move to a "Version 2" structure. This V2 template will use a field called `priceInCents` (an integer, like `1999`) and will completely remove the old `price` field.

Here's how we'd manage this migration for our SuperWidget:

1.  **Design the "Version 2" Master Template (`aug:products/example-v2:1`)**:
    This record acts as the gold standard for all V2 products. It contains:

    - **`schema`**: This field holds the new "ProductSchemaV2" definition. It looks like this:
      ```json
      // "ProductSchemaV2" - The template for V2 products
      {
        "type": "object",
        "properties": {
          "productId": { "type": "string", "description": "Unique business ID for the product" },
          "productName": { "type": "string" },
          "description": { "type": "string" },
          "promoImage": { "type": "string", "format": "uri" },
          "stockLevel": { "type": "integer", "minimum": 0 },
          "priceInCents": {
            // New field for price
            "type": "integer", // Stored as a whole number
            "minimum": 0,
            "description": "Retail price in cents"
          }
          // Notice: the old 'price' field is gone!
        },
        "required": ["productId", "productName", "description", "stockLevel", "priceInCents"]
      }
      ```
    - **`solution`**: This field contains example data for a generic V2 product, conforming to the "ProductSchemaV2" above. For example:
      `json
    {
      "productId": "PROD-V2-EXEMPLAR",
      "productName": "Generic Product V2",
      "description": "This is a standard Version 2 product.",
      "promoImage": "http://example.com/generic-v2.png",
      "stockLevel": 0,
      "priceInCents": 0
    }
    `
      When we migrate the SuperWidget, the new V2 SuperWidget record will adopt this structure and use these defaults if needed.

2.  **The `Refine` Operation for Migration (e.g., Upgrading SuperWidget to V2)**:
    To create the V2 version of SuperWidget, using its V1 data:

    - **`target`**: This is our V2 master template, `aug:products/example-v2:1`. It provides the blueprint (its `schema`) and any default V2 values (from its `solution`) for the new SuperWidget V2 record we're about to create.

    - **`instruction`**: This is where it gets interesting. The `instruction` record's job is to provide the data or directions for the `Refine` operation. In this migration scenario, the _existing V1 SuperWidget record itself_ (`aug:products/superwidget:3`) serves as the `instruction`.

      - Its `solution` (which contains all the V1 data like `productName`, `description`, the old `price`, `stockLevel`, etc.) is the raw material for the migration.

      The process authorized by the `capability` (see below) is responsible for taking this V1 data and making it fit the V2 template. This process will:

      - Use the V2 template (`aug:products/example-v2:1#schema`) as the guide for the new record.
      - Pull relevant data from the V1 SuperWidget's data (`aug:products/superwidget:3#solution`).
      - Perform necessary transformations – for example, converting the text `price` (e.g., `"19.99"`) into an integer `priceInCents` (e.g., `1999`).
      - Fill in the new V2 structure. Any new V2 fields that don't have a direct equivalent in V1 (or if we want to assign a new `productId` for the V2 version) would either be generated by this migration logic or taken from the default data in the V2 master template (`aug:products/example-v2:1#solution`).

    - **`capability`**: A specific permit is needed, say `aug:migrations/product#v1-to-v2`. This permit authorizes using the V2 master template (`aug:products/example-v2:1`) and a V1 product record (like `aug:products/superwidget:3`) as an instruction to create a new V2 product record. The logic for transforming data (like converting price to cents) is part of what this capability allows.

    The `Refine` call effectively says:
    `New SuperWidget V2 Record = Refine(Target: V2 Master Template, Instruction: Old SuperWidget V1 Record, Capability: V1-to-V2 Migration Permit)`

3.  **Result (The New SuperWidget V2 Record)**:
    A **brand new** Record Vibe, `aug:products/superwidget-v2:1`, is created. Notice it has a new identity (`superwidget-v2` instead of just `superwidget`).

    - Its **`schema`** (template) is identical to the V2 master template (`aug:products/example-v2:1#schema`).
    - Its **`solution`** (data) is now filled in according to this V2 template. The data comes from the V1 SuperWidget record, transformed by the migration process:
      ```json
      // Data for aug:products/superwidget-v2:1 (the V2 SuperWidget)
      {
        "productId": "SW-001", // Carried over from V1 to maintain its business identity
        "productName": "SuperWidget Pro", // Could be updated during migration if needed
        "description": "The next generation SuperWidget.", // Also potentially updated
        "promoImage": "http://example.com/superwidget-v2.png", // Potentially updated
        "stockLevel": 150, // Carried over from the V1 data (aug:products/superwidget:3#solution)
        "priceInCents": 1999 // Transformed from the V1 price string "19.99"
      }
      ```
    - Crucially, the original V1 SuperWidget record (`aug:products/superwidget:3`) and the V2 master template (`aug:products/example-v2:1`) remain completely untouched and unchanged.

    _(A quick note: The `productId` like "SW-001" is the business identifier for the product, part of its data. This is different from the Record Vibe's unique system ID like `aug:products/superwidget-v2:1`, which is like its serial number in the system's ledger.)_

4.  **Migrating Another Product (e.g., SuperGizmo)**:
    To migrate another V1 product, say `aug:products/supergizmo:1`, to its V2 version, the process is the same:
    - `target`: Still the V2 master template, `aug:products/example-v2:1`.
    - `instruction`: The V1 SuperGizmo record, `aug:products/supergizmo:1`.
    - `capability`: The same V1-to-V2 migration permit, `aug:migrations/product#v1-to-v2`.
    - This creates `aug:products/supergizmo-v2:1`, which also follows the V2 template.

**Why Use This Migration Approach?**

- **Clean New Versions**: The new V2 product records (like `aug:products/superwidget-v2:1`) are pristine instances of the new V2 template. They don't carry around old, unused fields from V1 in their structure.
- **Clear Transformation Rules**: The way data is converted from V1 to V2 (e.g., how price is changed to priceInCents) is defined by the process authorized by the `capability`. This conversion logic itself can be documented, audited, and even versioned if it gets complex.
- **Full Audit Trail & History (Immutability)**: The old V1 product record (`aug:products/superwidget:3`) still exists. You have a complete history. The new V2 record's lineage back to its V1 origin is clear.
- **Rollout at Your Own Pace**: Systems that use product data can be updated gradually. During a transition period, some systems might still read the old V1 records (if they're still relevant for some purpose), while newer systems can start using the new V2 records.

This strategy provides a robust and clean way to handle major changes to your information structures, fully respecting the system's principles of keeping old versions unchanged and making all transformations explicit and authorized.### The Chain of Command: How Business Needs Drive Information Changes

This whole process of evolving product information templates, whether it's a small addition or a major migration, follows a clear chain of events and authorizations:

1.  **Business Need Emerges**: It starts with a real-world requirement. For example, the decision to "launch an online shop" creates the need for new information fields like stock levels and prices.
2.  **Authorized Experts Act**: Someone with the right expertise and permissions (like a "System Architect" in our example) takes action. They use the `Refine` operation to change the templates (`schema` field) of existing records. They do this by providing an "instruction record" (`instruction` Vibe). The content (`solution`) of this instruction record details exactly how the template should change and how the existing data should be adjusted to fit the new template. This is all done under an authorizing Capability (a permit).
3.  **New, Evolved Records are Created**: The result is new versions of the records (new Record Vibes). Each of these new records now contains the updated template definition in its `schema` field and its data (in the `solution` field) matches this new structure.
4.  **New Business Operations Become Possible**: This evolved structure then allows other roles (like an "Inventory Manager") to be granted new types of permissions (Capabilities) to work with this data. For example, once `stockLevel` is part of the product template, the Inventory Manager can be authorized to update it.

This "capability-driven" approach treats changes to information structure (the `schema`) as just another type of controlled data evolution. Modifying a record's template uses the same fundamental `Refine` tool and permit-based authorization that governs all other data changes. This ensures that your information structures can change in a way that is controlled, auditable, secure, and directly reflects your evolving business requirements.

---

## Who Can Change What? Practical Permission Management

Think of permissions in this system like job-specific security badges. They are very specific ("granular") and tied to particular tasks. These permissions are granted through "permits."

These permits can be very precise, authorizing actions on one specific record. More powerfully, they can authorize actions on _any_ record that matches a specific template (an "exemplar Vibe"). This is like saying, "This person can edit any document that follows the 'Standard Operating Procedure' template."

Here are some e-commerce examples to make this clearer. We'll use `aug:/...` to mean a globally recognized template or permit (like a company-wide standard) and `aug:...` for things defined more locally (perhaps specific to a department or project).

- **Product Managers Launching New Gadgets:**
  A Product Manager needs to add new electronic gadgets to the product catalog.

  - **Permit Issued**: They get a permit like "Permit to Create New Product Listings from Approved Product Templates using Standard Launch Instructions." This permit is itself a record, an instance of a global permit type like `aug:/permits/spawn-policy:1` (a policy for creating new things).
  - **Action**: The Product Manager is authorized to use the `Refine` operation on any master template record (`target`) whose own template (`schema` field) defines it as an electronics product (e.g., `aug:products/electronics-product:1`, the master template for all electronic items). They can use any set of launch instructions (`instruction`) that conforms to an approved instruction template (e.g., `aug:schema-instruction-launch:1`).
  - **Outcome**: This allows them to create various new product records. For example, to list a new smartwatch, the `target` might be `aug:products/smartwatch:1` (a specific template for smartwatches, which itself might be based on the general `electronics-product:1` template). The `instruction` would be a record with all the details for the new smartwatch, like `aug:announcements/smartwatch-gen5-details:1`. The result is a new product record: `aug:products/smartwatch-gen5:1`. Similarly for creating `aug:products/earbuds-pro:1` from an `aug:products/earbuds:1` template.

- **Inventory Managers Adjusting Stock Levels:**
  An Inventory Manager needs to update stock numbers for all products based on warehouse feeds.

  - **Permit Issued**: "Permit to Update Stock Counts for Any Inventory-Tracked Product via System Feeds," an instance of a permit type like `aug:/permits/input-change:1`.
  - **Action**: The Inventory Manager can `Refine` any product record (`target`) whose template shows it's an "inventory-tracked product" (i.e., its `schema` matches the structure defined in a master template like `aug:products/inventory-tracked-product:1`). The `instruction` would be a data feed record, like `aug:feeds/stock-feed:1`.
  - **Outcome**: The `stockLevel` field within any valid product record (e.g., `aug:products/smartwatch-gen5:1`, `aug:products/charger-c30:1`) can be updated, creating a new version of that product record with the new stock count.

- **Marketing Specialists Setting Up Promotions:**
  A Marketing Specialist needs to define different kinds of discount rules for sales events.

  - **Permit Issued**: "Permit to Define New Discount Rules in Promotion Engine via Approved Rule Structures," an instance of a permit type like `aug:/permits/schema-govern:1` (governing template changes).
  - **Action**: The Marketing Specialist can `Refine` the main record that defines promotion rule templates (`target` = `aug:schema-promo-rules:1`). The `instruction` would be a record describing a new type of discount, conforming to an approved discount instruction template (`aug:schema-instruction-discount:1`). Examples include instructions for percentage-off, Buy-One-Get-One (BOGO), or tiered discounts.
  - **Outcome**: Various new discount rule templates (e.g., a template for "percentage-off-category-X" or "BOGO-on-accessories") can be added to the global promotion rules. These new templates can then be used to create specific discount offers.

- **Content Writers Updating Product Descriptions:**
  A Content Writer needs to update marketing text on product pages.

  - **Permit Issued**: "Permit to Update Product Page Content for Any Product via SEO Guidelines," an instance of an editorial permit like `aug:/permits/editorial:1`.
  - **Action**: The Content Writer can `Refine` any product page record (`target`) that follows the standard product page template (`aug:schema-prod-page:1`). The `instruction` might be a specific set of SEO guidelines or approved copy, like `aug:guide-seo-desc:1`.
  - **Outcome**: The `description` and `marketingCopy` fields in the data (`solution`) of any valid product page record (e.g., `aug:products/smartwatch-gen5:1`) can be updated, creating a new version of that page record.

- **Customer Support Leads Handling Order Adjustments:**
  A Customer Support Lead needs to process common order changes like refunds or shipping updates.
  - **Permit Issued**: "Permit to Adjust Customer Orders via Standard Service Protocols," an instance of a permit type like `aug:/permits/merge-policy:1` (or a more specific adjustment permit).
  - **Action**: The Support Lead can `Refine` any customer order record (`target`) that follows the standard order template (`aug:schema-order:1`). The `instruction` would be a record detailing the adjustment, conforming to an approved adjustment type (`aug:schema-instruction-order-adj:1`) – for example, instructions for partial refunds, shipping address changes, or item swaps, all following specific company protocols.
  - **Outcome**: New versions of customer order records (e.g., `aug:order-12345:1` becomes `aug:order-12345:2` after an adjustment) can be created, reflecting the authorized changes.

Whenever any user or automated process attempts to `Refine` a record, the system checks if they possess a valid Capability that includes an appropriate permit. This permit must clearly authorize:

1.  The specific `target` record (or a target record matching a specific template).
2.  The use of the specific `instruction` record (or an instruction record matching a specific template).

The permit itself, through its own definition and how it refers to these templates (using global `aug:/` for company-wide standards vs. local `aug:` for more specific ones), clearly lays out the boundaries and rules for what changes are allowed. This ensures that all modifications, whether to data or to the structure of the data itself, are done in a controlled, secure, and auditable way.
